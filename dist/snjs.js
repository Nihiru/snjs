!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("SNLibrary",[],t):"object"==typeof exports?exports.SNLibrary=t():e.SNLibrary=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s=141)}([function(e,t,n){e.exports=n(142)},function(e,t,n){"use strict";(function(e){n.d(t,"m",(function(){return w})),n.d(t,"i",(function(){return k})),n.d(t,"t",(function(){return x})),n.d(t,"r",(function(){return S})),n.d(t,"l",(function(){return O})),n.d(t,"D",(function(){return P})),n.d(t,"f",(function(){return j})),n.d(t,"q",(function(){return C})),n.d(t,"o",(function(){return _})),n.d(t,"p",(function(){return D})),n.d(t,"s",(function(){return I})),n.d(t,"n",(function(){return E})),n.d(t,"J",(function(){return M})),n.d(t,"K",(function(){return R})),n.d(t,"w",(function(){return A})),n.d(t,"j",(function(){return T})),n.d(t,"G",(function(){return K})),n.d(t,"B",(function(){return F})),n.d(t,"b",(function(){return L})),n.d(t,"k",(function(){return N})),n.d(t,"c",(function(){return V})),n.d(t,"e",(function(){return W})),n.d(t,"C",(function(){return U})),n.d(t,"d",(function(){return B})),n.d(t,"x",(function(){return H})),n.d(t,"F",(function(){return z})),n.d(t,"H",(function(){return q})),n.d(t,"v",(function(){return J})),n.d(t,"z",(function(){return G})),n.d(t,"y",(function(){return Q})),n.d(t,"u",(function(){return $})),n.d(t,"a",(function(){return Y})),n.d(t,"h",(function(){return X})),n.d(t,"A",(function(){return Z})),n.d(t,"g",(function(){return ee})),n.d(t,"I",(function(){return te})),n.d(t,"E",(function(){return ne}));var r=n(0),a=n.n(r),i=n(42),o=n.n(i),s=n(38),c=n.n(s),u=n(34),l=n.n(u),f=n(139),p=n.n(f),h=n(140),y=n.n(h),d=n(55),v=n.n(d);function b(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){b(i,r,a,o,s,"next",e)}function s(e){b(i,r,a,o,s,"throw",e)}o(void 0)}))}}function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(){return"undefined"!=typeof window?window:void 0!==e?e:null}function k(e){return Object.keys(e).map((function(t){return e[t]}))}function x(){return null!==w()&&!(document&&document.documentMode)||/Edge/.test(navigator.userAgent)&&window.crypto&&!!window.crypto.subtle}function S(){return"undefined"!=typeof navigator&&"ReactNative"===navigator.product}function O(e,t,n){return e.find((function(e){return e[t]===n}))}function P(e,t){return c()(e,t)}function j(){for(var e=[],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];e=e.concat(o)}return e}function C(e){return null!==e&&("function"==typeof e||"object"===g(e))}function _(e){return null!==e&&"function"==typeof e}function D(e){return null==e}function I(e){return"string"==typeof e||e instanceof String}function E(e,t){return e>t?e:t}function M(e,t,n){return y()(e.concat(t),(function(e,t){var r=!0,a=!1,i=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;if(e[c]!==t[c])return!1}}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return!0}))}function R(e){return v()(e)}function A(e){return e[e.length-1]}function T(e,t){var n=!0,r=!1,a=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;e.push(s)}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}}function K(e,t){var n=!0,r=!1,a=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){F(e,i.value)}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}}function F(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}function L(e,t){e.includes(t)||e.push(t)}function N(e,t){o()(e,t)}function V(e,t){return e.filter((function(e){return!t.includes(e)})).concat(t.filter((function(t){return!e.includes(t)})))}function W(e,t){return!(e&&!t||!e&&t)&&(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof String&&t instanceof String?e===t:q(e,t))}function U(e,t){e.splice(t,1)}function B(e,t){var n=e.slice();return U(n,t),n}function H(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var a=r[n];t.push(e[a])}return t}function z(e){var t=Object.keys(e).sort(),n={},r=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;n[c]=e[c]}}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return Y(n)}function q(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var a=0,i=n;a<i.length;a++){var o=i[a];if(e[o]!==t[o])return!1}return!0}function J(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var a=r[n],i=void 0;try{i=JSON.parse(e[a])}catch(t){i=e[a]}t[a]=i}return t}function G(e,t){if(e){var n=!0,r=!1,a=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){delete e[i.value]}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}}}function Q(e,t){var n=Object.assign({},e),r=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){delete n[o.value]}}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}function $(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e,t){return 0===t?e.trim().replace(/[\/]*$/g,""):e.trim().replace(/(^[\/]*|[\/]*$)/g,"")})).filter((function(e){return e.length})).join("/")}function Y(e){return e instanceof Date?new Date(e):C(e)?JSON.parse(JSON.stringify(e)):e}function X(e,t){if(!e||!t)throw"Attempting to deepMerge with null values";return p()(e,t,(function(e,t){if(l()(e))return t})),e}function Z(e,t){var n={},r=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;n[c]=e[c]}}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return Y(n)}function ee(e){var t=Object.getOwnPropertyNames(e),n=!0,r=!1,a=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value,c=e[s];c&&"object"===g(c)&&!Object.isFrozen(c)?e[s]=ee(c):e[s]=c}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return Object.freeze(e)}function te(e,t){var n=t/4;return e.substring(0,n)}function ne(e){return re.apply(this,arguments)}function re(){return(re=m(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.warn("Sleeping for",t),e.abrupt("return",new Promise((function(e,n){setTimeout((function(){e()}),t)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}).call(this,n(69))},function(e,t,n){"use strict";n.d(t,"e",(function(){return b})),n.d(t,"g",(function(){return m})),n.d(t,"d",(function(){return g})),n.d(t,"f",(function(){return w})),n.d(t,"b",(function(){return k})),n.d(t,"c",(function(){return S})),n.d(t,"a",(function(){return O}));var r=n(66),a=n(3),i=n(11),o=n(1),s=n(5),c=[s.a.Uuid,s.a.ContentType,s.a.ItemsKeyId,s.a.EncItemKey,s.a.Content,s.a.CreatedAt,s.a.UpdatedAt,s.a.Deleted,s.a.Legacy003AuthHash,s.a.Legacy003AuthParams,s.a.Dirty,s.a.DirtiedDate,s.a.ErrorDecrypting,s.a.ErrorDecryptingChanged,s.a.WaitingForKey,s.a.LastSyncBegan,s.a.LastSyncEnd],u=[s.a.Uuid,s.a.ItemsKeyId,s.a.EncItemKey,s.a.Content,s.a.Legacy003AuthHash,s.a.ErrorDecrypting,s.a.ErrorDecryptingChanged,s.a.WaitingForKey],l=[s.a.Uuid,s.a.ContentType,s.a.ItemsKeyId,s.a.EncItemKey,s.a.Content,s.a.CreatedAt,s.a.UpdatedAt,s.a.Legacy003AuthHash],f=[s.a.Uuid,s.a.ContentType,s.a.ItemsKeyId,s.a.EncItemKey,s.a.Content,s.a.CreatedAt,s.a.UpdatedAt,s.a.Deleted,s.a.Legacy003AuthHash,s.a.Legacy003AuthParams,s.a.Dirty,s.a.DirtiedDate,s.a.ErrorDecrypting,s.a.WaitingForKey],p=[s.a.Uuid,s.a.ContentType,s.a.ItemsKeyId,s.a.EncItemKey,s.a.Content,s.a.CreatedAt,s.a.UpdatedAt,s.a.Deleted,s.a.Legacy003AuthHash],h=[s.a.Uuid,s.a.ContentType,s.a.Content,s.a.UpdatedAt],y=[s.a.Uuid,s.a.Content,s.a.CreatedAt],d=[s.a.Uuid,s.a.Content,s.a.ContentType,s.a.CreatedAt],v=[s.a.Uuid,s.a.ContentType,s.a.UpdatedAt,s.a.Deleted,s.a.Dirty,s.a.LastSyncEnd];function b(e,t){return x(e,c.slice(),void 0,t)}function m(e,t,n,r){var a={},i=n||t.fields,o=!0,s=!1,c=void 0;try{for(var u,l=i[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var f=u.value;a[f]=t[f]}}catch(e){s=!0,c=e}finally{try{o||null==l.return||l.return()}finally{if(s)throw c}}if(r)for(var p=0,h=Object.keys(r);p<h.length;p++){var y=h[p];a[y]=r[y]}return k(e,a)}function g(e,t,n){return x(e,function(e){if(e===i.a.FileEncrypted||e===i.a.FileDecrypted||e===i.a.FilePreferEncrypted)return l.slice();if(e===i.a.LocalStoragePreferEncrypted||e===i.a.LocalStorageDecrypted||e===i.a.LocalStorageEncrypted)return f.slice();if(e===i.a.Sync||e===i.a.SyncDecrypted)return p.slice();throw"No payload fields found for intent ".concat(e)}(t),a.a.Constructor,n)}function w(e,t,n){return x(e,function(e){if(e===a.a.FileImport)return l.slice();if(e===a.a.SessionHistory)return h.slice();if(e===a.a.ComponentRetrieved)return y.slice();if(e===a.a.ComponentCreated)return d.slice();if(e===a.a.LocalRetrieved||e===a.a.LocalChanged)return f.slice();if(e===a.a.RemoteRetrieved||e===a.a.ConflictData||e===a.a.ConflictUuid)return p.slice();if(e===a.a.LocalSaved||e===a.a.RemoteSaved)return v.slice();throw"No payload fields found for source ".concat(e)}(t),t,n)}function k(e,t){return x(e,e.fields,e.source,t)}function x(e,t,n,i){var s=Object(o.A)(e,t),c=i instanceof r.a?i.fields.slice():Object.keys(i||[]),u=!0,l=!1,f=void 0;try{for(var p,h=c[Symbol.iterator]();!(u=(p=h.next()).done);u=!0){var y=p.value,d=i[y];s[y]=d?Object(o.a)(d):d}}catch(e){l=!0,f=e}finally{try{u||null==h.return||h.return()}finally{if(l)throw f}}var v=Object(o.K)(t.concat(c));return new r.a(s,v,n||a.a.Constructor)}function S(e){return x(e,Object.keys(e))}function O(e,t){return x(e,u.slice(),void 0,t)}},function(e,t,n){"use strict";var r;function a(e){return[r.RemoteRetrieved,r.ComponentRetrieved,r.RemoteActionRetrieved].includes(e)}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),function(e){e[e.RemoteRetrieved=1]="RemoteRetrieved",e[e.RemoteSaved=2]="RemoteSaved",e[e.LocalSaved=3]="LocalSaved",e[e.LocalRetrieved=4]="LocalRetrieved",e[e.LocalChanged=5]="LocalChanged",e[e.ComponentRetrieved=6]="ComponentRetrieved",e[e.DesktopInstalled=7]="DesktopInstalled",e[e.RemoteActionRetrieved=8]="RemoteActionRetrieved",e[e.FileImport=9]="FileImport",e[e.RemoteConflict=10]="RemoteConflict",e[e.ImportConflict=11]="ImportConflict",e[e.SavedOrSaving=12]="SavedOrSaving",e[e.DecryptedTransient=13]="DecryptedTransient",e[e.ConflictUuid=14]="ConflictUuid",e[e.ConflictData=15]="ConflictData",e[e.SessionHistory=16]="SessionHistory",e[e.Constructor=17]="Constructor",e[e.ComponentCreated=18]="ComponentCreated",e[e.PreSyncSave=19]="PreSyncSave"}(r||(r={}))},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return o}));var a,i="org.standardnotes.sn";function o(e){var t;return(r(t={},a.Note,"note"),r(t,a.Tag,"tag"),r(t,a.SmartTag,"smart tag"),r(t,a.ActionsExtension,"action-based extension"),r(t,a.Component,"component"),r(t,a.Editor,"editor"),r(t,a.Theme,"theme"),r(t,a.ServerExtension,"server extension"),r(t,a.Mfa,"two-factor authentication setting"),r(t,a.FilesafeCredentials,"FileSafe credential"),r(t,a.FilesafeFileMetadata,"FileSafe file"),r(t,a.FilesafeIntegration,"FileSafe integration"),t)[e]}!function(e){e.Any="*",e.Item="SF|Item",e.RootKey="SN|RootKey|NoSync",e.ItemsKey="SN|ItemsKey",e.EncryptedStorage="SN|EncryptedStorage",e.Note="Note",e.Tag="Tag",e.SmartTag="SN|SmartTag",e.Component="SN|Component",e.Editor="SN|Editor",e.ActionsExtension="Extension",e.UserPrefs="SN|UserPreferences",e.Privileges="SN|Privileges",e.HistorySession="SN|HistorySession",e.Theme="SN|Theme",e.Mfa="SF|MFA",e.ServerExtension="SF|Extension",e.FilesafeCredentials="SN|FileSafe|Credentials",e.FilesafeFileMetadata="SN|FileSafe|FileMetadata",e.FilesafeIntegration="SN|FileSafe|Integration",e.ExtensionRepo="SN|ExtensionRepo"}(a||(a={}))},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.Uuid="uuid",e.ContentType="content_type",e.ItemsKeyId="items_key_id",e.EncItemKey="enc_item_key",e.Content="content",e.CreatedAt="created_at",e.UpdatedAt="updated_at",e.Deleted="deleted",e.Legacy003AuthHash="auth_hash",e.Legacy003AuthParams="auth_params",e.Dirty="dirty",e.DirtiedDate="dirtiedDate",e.WaitingForKey="waitingForKey",e.ErrorDecrypting="errorDecrypting",e.ErrorDecryptingChanged="errorDecryptingValueChanged",e.LastSyncBegan="lastSyncBegan",e.LastSyncEnd="lastSyncEnd"}(r||(r={}))},function(e,t,n){"use strict";(function(e){n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"e",(function(){return i})),n.d(t,"d",(function(){return v})),n.d(t,"b",(function(){return b}));var r,a,i,o=n(12),s=n(26),c=n(2),u=n(1),l=n(27),f=n(4);function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.UserInteraction=1]="UserInteraction",e[e.Internal=2]="Internal",e[e.NonDirtying=3]="NonDirtying"}(r||(r={})),function(e){e.Pinned="pinned",e.Archived="archived",e.Locked="locked",e.UserModifiedDate="client_updated_at",e.DefaultEditor="defaultEditor",e.MobileRules="mobileRules",e.NotAvailableOnMobile="notAvailableOnMobile",e.MobileActive="mobileActive",e.LastSize="lastSize",e.PrefersPlainEditor="prefersPlainEditor",e.ComponentInstallError="installError"}(a||(a={})),function(e){e[e.KeepEarliest=1]="KeepEarliest"}(i||(i={}));var v=function(){function t(n){var r=this;if(p(this,t),d(this,"payload",void 0),d(this,"conflictOf",void 0),d(this,"createdAtString",void 0),d(this,"updatedAtString",void 0),d(this,"protected",!1),d(this,"trashed",!1),d(this,"pinned",!1),d(this,"archived",!1),d(this,"locked",!1),!n.uuid||!n.content_type)throw Error("Cannot create item without both uuid and content_type");if(n.format===o.a.DecryptedBareObject&&(n.enc_item_key||n.items_key_id||n.auth_hash))throw Error("Creating an item from a decrypted payload should not contain enc params");this.payload=n,this.conflictOf=n.safeContent.conflict_of,this.createdAtString=this.created_at&&this.dateToLocalizedString(this.created_at),n.format===o.a.DecryptedBareObject&&(this.updatedAtString=this.dateToLocalizedString(this.userModifiedDate),this.protected=this.payload.safeContent.protected,this.trashed=this.payload.safeContent.trashed,this.pinned=this.getAppDomainValue(a.Pinned),this.archived=this.getAppDomainValue(a.Archived),this.locked=this.getAppDomainValue(a.Locked)),e((function(){Object(u.g)(r)}))}return y(t,[{key:"payloadRepresentation",value:function(e){return Object(c.b)(this.payload,e)}},{key:"hasRelationshipWithItem",value:function(e){var t;return!!(null===(t=this.payload.safeContent.references)||void 0===t?void 0:t.find((function(t){return t.uuid===e.uuid})))}},{key:"getDomainData",value:function(e){var t=this.payload.safeContent.appData;if(t)return t[e]}},{key:"getAppDomainValue",value:function(e){return this.getDomainData(t.DefaultAppDomain())[e]}},{key:"contentKeysToIgnoreWhenCheckingEquality",value:function(){return["conflict_of"]}},{key:"appDataContentKeysToIgnoreWhenCheckingEquality",value:function(){return[a.UserModifiedDate]}},{key:"getContentCopy",value:function(){return JSON.parse(JSON.stringify(this.content))}},{key:"strategyWhenConflictingWithItem",value:function(e){return this.errorDecrypting?s.a.KeepLeftDuplicateRight:this.isSingleton?s.a.KeepLeft:this.deleted||e.deleted?s.a.KeepRight:m(this,e)?m(this,e,["references"])?s.a.KeepLeftDuplicateRight:s.a.KeepLeftMergeRefs:s.a.KeepRight}},{key:"isItemContentEqualWith",value:function(e){return g(this.payload.contentObject,e.payload.contentObject,this.contentKeysToIgnoreWhenCheckingEquality(),this.appDataContentKeysToIgnoreWhenCheckingEquality())}},{key:"satisfiesPredicate",value:function(e){return l.a.ItemSatisfiesPredicate(this,e)}},{key:"updatedAtTimestamp",value:function(){var e;return null===(e=this.updated_at)||void 0===e?void 0:e.getTime()}},{key:"dateToLocalizedString",value:function(e){if("undefined"!=typeof Intl&&Intl.DateTimeFormat){if(!t.sharedDateFormatter){var n=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language;t.sharedDateFormatter=new Intl.DateTimeFormat(n,{year:"numeric",month:"short",day:"2-digit",weekday:"long",hour:"2-digit",minute:"2-digit"})}return t.sharedDateFormatter.format(e)}return e.toDateString()+" "+e.toLocaleTimeString()}},{key:"uuid",get:function(){return this.payload.uuid}},{key:"content",get:function(){return this.payload.content}},{key:"safeContent",get:function(){return this.payload.safeContent}},{key:"references",get:function(){return this.payload.safeContent.references||[]}},{key:"deleted",get:function(){return this.payload.deleted}},{key:"content_type",get:function(){return this.payload.content_type}},{key:"created_at",get:function(){return this.payload.created_at}},{key:"updated_at",get:function(){return this.payload.updated_at}},{key:"userModifiedDate",get:function(){var e=this.getAppDomainValue(a.UserModifiedDate);return new Date(e||this.updated_at)}},{key:"dirtiedDate",get:function(){return this.payload.dirtiedDate}},{key:"dirty",get:function(){return this.payload.dirty}},{key:"errorDecrypting",get:function(){return this.payload.errorDecrypting}},{key:"waitingForKey",get:function(){return this.payload.waitingForKey}},{key:"errorDecryptingValueChanged",get:function(){return this.payload.errorDecryptingValueChanged}},{key:"lastSyncBegan",get:function(){return this.payload.lastSyncBegan}},{key:"lastSyncEnd",get:function(){return this.payload.lastSyncEnd}},{key:"auth_hash",get:function(){return this.payload.auth_hash}},{key:"auth_params",get:function(){return this.payload.auth_params}},{key:"neverSynced",get:function(){return!this.updated_at||0===this.updated_at.getTime()}},{key:"isSingleton",get:function(){return!1}},{key:"singletonPredicate",get:function(){throw"Must override SNItem.singletonPredicate"}},{key:"singletonStrategy",get:function(){return i.KeepEarliest}}],[{key:"DefaultAppDomain",value:function(){return f.b}}]),t}();d(v,"sharedDateFormatter",void 0);var b=function(){function e(t,n){p(this,e),d(this,"item",void 0),d(this,"type",void 0),d(this,"payload",void 0),d(this,"content",void 0),this.item=t,this.type=n,this.payload=t.payload,this.payload.content&&(this.content=Object(u.a)(this.payload.content))}return y(e,[{key:"getUuid",value:function(){return this.payload.uuid}},{key:"getItem",value:function(){return this.item}},{key:"getResult",value:function(){if(this.type===r.NonDirtying)return Object(c.b)(this.payload,{content:this.content});this.payload.deleted||(this.type===r.UserInteraction?this.userModifiedDate=new Date:this.item.userModifiedDate||(this.userModifiedDate=new Date(this.item.updated_at)));return Object(c.b)(this.payload,{content:this.content,dirty:!0,dirtiedDate:new Date})}},{key:"mergePayload",value:function(e){this.payload=Object(c.g)(this.payload,e),this.payload.content?this.content=Object(u.a)(this.payload.safeContent):this.content=void 0}},{key:"setContent",value:function(e){this.content=Object(u.a)(e)}},{key:"setDeleted",value:function(){this.content=void 0,this.payload=Object(c.b)(this.payload,{content:this.content,deleted:!0})}},{key:"setDomainData",value:function(e,t){this.payload.errorDecrypting||(this.content.appData||(this.content.appData={}),this.content.appData[t]=e)}},{key:"setDomainDataKey",value:function(e,t,n){if(!this.payload.errorDecrypting){this.content.appData||(this.content.appData={});var r=this.content.appData;r[n]||(r[n]={}),r[n][e]=t}}},{key:"setAppDataItem",value:function(e,t){this.setDomainDataKey(e,t,v.DefaultAppDomain())}},{key:"addItemAsRelationship",value:function(e){var t=this.content.references||[];t.find((function(t){return t.uuid===e.uuid}))||t.push({uuid:e.uuid,content_type:e.content_type}),this.content.references=t}},{key:"removeItemAsRelationship",value:function(e){var t=this.content.references||[];t=t.filter((function(t){return t.uuid!==e.uuid})),this.content.references=t}},{key:"lastSyncBegan",set:function(e){this.payload=Object(c.b)(this.payload,{content:this.content,lastSyncBegan:e})}},{key:"errorDecrypting",set:function(e){this.payload=Object(c.b)(this.payload,{content:this.content,errorDecrypting:e})}},{key:"updated_at",set:function(e){this.payload=Object(c.b)(this.payload,{updated_at:e})}},{key:"userModifiedDate",set:function(e){this.setAppDataItem(a.UserModifiedDate,e)}},{key:"conflictOf",set:function(e){this.content.conflict_of=e}},{key:"protected",set:function(e){this.content.protected=e}},{key:"trashed",set:function(e){this.content.trashed=e}},{key:"pinned",set:function(e){this.setAppDataItem(a.Pinned,e)}},{key:"archived",set:function(e){this.setAppDataItem(a.Archived,e)}},{key:"locked",set:function(e){this.setAppDataItem(a.Locked,e)}}]),e}();function m(e,t,n){return n||(n=[]),!g(e.content,t.content,e.contentKeysToIgnoreWhenCheckingEquality().concat(n),e.appDataContentKeysToIgnoreWhenCheckingEquality())}function g(e,t,n,r){if((e=Object(u.F)(e)).appData){var a=e.appData[f.b];Object(u.z)(a,r),a?0===Object.keys(a).length&&delete e.appData:delete e.appData}if(Object(u.z)(e,n),(t=Object(u.F)(t)).appData){var i=t.appData[f.b];Object(u.z)(i,r),i?0===Object.keys(i).length&&delete t.appData:delete t.appData}return Object(u.z)(t,n),JSON.stringify(e)===JSON.stringify(t)}}).call(this,n(133).setImmediate)},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"d",(function(){return w})),n.d(t,"c",(function(){return k}));var r,a,i=n(26),o=n(1),s=n(6),c=n(4);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}function h(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?y(e):t}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t,n){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.Editor="editor-editor",e.Themes="themes",e.TagsList="tags-list",e.EditorStack="editor-stack",e.NoteTags="note-tags",e.Rooms="rooms",e.Modal="modal",e.Any="*"}(r||(r={})),function(e){e.SetSize="set-size",e.StreamItems="stream-items",e.StreamContextItem="stream-context-item",e.SaveItems="save-items",e.SelectItem="select-item",e.AssociateItem="associate-item",e.DeassociateItem="deassociate-item",e.ClearSelection="clear-selection",e.CreateItem="create-item",e.CreateItems="create-items",e.DeleteItems="delete-items",e.SetComponentData="set-component-data",e.InstallLocalComponent="install-local-component",e.ToggleActivateComponent="toggle-activate-component",e.RequestPermissions="request-permissions",e.PresentConflictResolution="present-conflict-resolution",e.DuplicateItem="duplicate-item",e.ComponentRegistered="component-registered",e.ActivateThemes="themes",e.Reply="reply",e.SaveSuccess="save-success",e.SaveError="save-error"}(a||(a={}));var w=function(e){function t(e){var n;return l(this,t),g(y(n=h(this,v(t).call(this,e))),"componentData",void 0),g(y(n),"disassociatedItemIds",void 0),g(y(n),"associatedItemIds",void 0),g(y(n),"local_url",void 0),g(y(n),"hosted_url",void 0),g(y(n),"offlineOnly",void 0),g(y(n),"name",void 0),g(y(n),"autoupdateDisabled",void 0),g(y(n),"package_info",void 0),g(y(n),"area",void 0),g(y(n),"permissions",[]),g(y(n),"valid_until",void 0),g(y(n),"active",void 0),g(y(n),"legacy_url",void 0),g(y(n),"isMobileDefault",void 0),n.componentData=n.payload.safeContent.componentData||{},n.legacy_url=n.payload.safeContent.legacy_url,n.hosted_url=n.payload.safeContent.hosted_url||n.payload.safeContent.url,n.local_url=n.payload.safeContent.local_url,n.valid_until=new Date(n.payload.safeContent.valid_until),n.offlineOnly=n.payload.safeContent.offlineOnly,n.name=n.payload.safeContent.name,n.area=n.payload.safeContent.area,n.package_info=n.payload.safeContent.package_info,n.permissions=n.payload.safeContent.permissions||[],n.active=n.payload.safeContent.active,n.autoupdateDisabled=n.payload.safeContent.autoupdateDisabled,n.disassociatedItemIds=n.payload.safeContent.disassociatedItemIds||[],n.associatedItemIds=n.payload.safeContent.associatedItemIds||[],n.isMobileDefault=n.payload.safeContent.isMobileDefault,n.legacy_url=n.payload.safeContent.hosted_url?void 0:n.payload.safeContent.url,n}return b(t,e),p(t,[{key:"strategyWhenConflictingWithItem",value:function(e){return this.errorDecrypting?d(v(t.prototype),"strategyWhenConflictingWithItem",this).call(this,e):i.a.KeepLeft}},{key:"isEditor",value:function(){return this.area===r.Editor}},{key:"isTheme",value:function(){return this.content_type===c.a.Theme||this.area===r.Themes}},{key:"isDefaultEditor",value:function(){return!0===this.getAppDomainValue(s.a.DefaultEditor)}},{key:"getLastSize",value:function(){return this.getAppDomainValue(s.a.LastSize)}},{key:"acceptsThemes",value:function(){var e;return null===(e=this.payload.safeContent.package_info)||void 0===e?void 0:e.acceptsThemes}},{key:"getClientDataKey",value:function(){return this.legacy_url?this.legacy_url:this.uuid}},{key:"hasValidHostedUrl",value:function(){return this.hosted_url||this.legacy_url}},{key:"contentKeysToIgnoreWhenCheckingEquality",value:function(){return["active","disassociatedItemIds","associatedItemIds"].concat(d(v(t.prototype),"contentKeysToIgnoreWhenCheckingEquality",this).call(this))}},{key:"isAssociative",value:function(){return t.associativeAreas().includes(this.area)}},{key:"isExplicitlyEnabledForItem",value:function(e){return-1!==this.associatedItemIds.indexOf(e)}},{key:"isExplicitlyDisabledForItem",value:function(e){return-1!==this.disassociatedItemIds.indexOf(e)}}],[{key:"associativeAreas",value:function(){return[r.Editor]}}]),t}(s.d),k=function(e){function t(){return l(this,t),h(this,v(t).apply(this,arguments))}return b(t,e),p(t,[{key:"associateWithItem",value:function(e){var t=this.typedContent.associatedItemIds||[];Object(o.b)(t,e),this.typedContent.associatedItemIds=t}},{key:"disassociateWithItem",value:function(e){var t=this.typedContent.disassociatedItemIds||[];Object(o.b)(t,e),this.typedContent.disassociatedItemIds=t}},{key:"removeAssociatedItemId",value:function(e){Object(o.B)(this.typedContent.associatedItemIds||[],e)}},{key:"removeDisassociatedItemId",value:function(e){Object(o.B)(this.typedContent.disassociatedItemIds||[],e)}},{key:"setLastSize",value:function(e){this.setAppDataItem(s.a.LastSize,e)}},{key:"typedContent",get:function(){return this.content}},{key:"active",set:function(e){this.typedContent.active=e}},{key:"defaultEditor",set:function(e){this.setAppDataItem(s.a.DefaultEditor,e)}},{key:"componentData",set:function(e){this.typedContent.componentData=e}},{key:"package_info",set:function(e){this.typedContent.package_info=e}},{key:"local_url",set:function(e){this.typedContent.local_url=e}},{key:"hosted_url",set:function(e){this.typedContent.hosted_url=e}},{key:"permissions",set:function(e){this.typedContent.permissions=e}}]),t}(s.b)},function(e,t,n){"use strict";var r,a;function i(e,t){return e?"".concat(e,"-").concat(t):t}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i})),function(e){e.StorageObject="storage",e.LastMigrationTimestamp="last_migration_timestamp"}(r||(r={})),function(e){e.RootKeyParams="ROOT_KEY_PARAMS",e.WrappedRootKey="WRAPPED_ROOT_KEY",e.RootKeyWrapperKeyParams="ROOT_KEY_WRAPPER_KEY_PARAMS",e.Session="session",e.User="user",e.ServerHost="server",e.LegacyUuid="uuid",e.LastSyncToken="syncToken",e.PaginationToken="cursorToken",e.BiometricPrefs="biometrics_prefs",e.MobilePasscodeTiming="passcode_timing",e.PrivilegesExpirey="SessionExpiresAtKey",e.PrivilegesSessionLength="SessionLengthKey",e.SessionHistoryPersistable="sessionHistory_persist",e.SessionHistoryRevisions="sessionHistory_revisions",e.SessionHistoryOptimize="sessionHistory_autoOptimize"}(a||(a={}))},function(e,t,n){"use strict";var r;function a(e,t){return Number(e)-Number(t)}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),function(e){e.V000Base64Decrypted="000",e.V001="001",e.V002="002",e.V003="003",e.V004="004",e[e.VersionLength=3]="VersionLength"}(r||(r={}))},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.FullSyncCompleted="sync =full-completed",e.SingleSyncCompleted="sync =single-completed",e.SyncWillBegin="sync =will-begin",e.DownloadFirstSyncCompleted="sync =download-first-completed",e.SyncTakingTooLong="sync =taking-too-long",e.SyncError="sync =error",e.InvalidSession="sync =invalid-session",e.MajorDataChange="major-data-change",e.LocalDataIncrementalLoad="local-data-incremental-load",e.LocalDataLoaded="local-data-loaded",e.EnterOutOfSync="enter-out-of-sync",e.ExitOutOfSync="exit-out-of-sync",e.StatusChanged="status-changed",e.DatabaseWriteError="database-write-error",e.DatabaseReadError="database-read-error"}(r||(r={}))},function(e,t,n){"use strict";var r;function a(e){return e===r.LocalStorageEncrypted||e===r.LocalStorageDecrypted||e===r.LocalStoragePreferEncrypted}function i(e){return e===r.FileEncrypted||e===r.FileDecrypted||e===r.FilePreferEncrypted}function o(e){return e===r.SyncDecrypted||e===r.LocalStorageDecrypted||e===r.FileDecrypted}function s(e){return e===r.Sync||e===r.LocalStorageEncrypted||e===r.FileEncrypted}n.d(t,"a",(function(){return r})),n.d(t,"e",(function(){return a})),n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return s})),function(e){e[e.Sync=0]="Sync",e[e.SyncDecrypted=1]="SyncDecrypted",e[e.LocalStorageEncrypted=2]="LocalStorageEncrypted",e[e.LocalStorageDecrypted=3]="LocalStorageDecrypted",e[e.LocalStoragePreferEncrypted=4]="LocalStoragePreferEncrypted",e[e.FileEncrypted=5]="FileEncrypted",e[e.FileDecrypted=6]="FileDecrypted",e[e.FilePreferEncrypted=7]="FilePreferEncrypted"}(r||(r={}))},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.EncryptedString=0]="EncryptedString",e[e.DecryptedBareObject=1]="DecryptedBareObject",e[e.DecryptedBase64String=2]="DecryptedBase64String",e[e.Deleted=3]="Deleted"}(r||(r={}))},function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return i}));var r=n(4);function a(e){return e.map((function(e){return e.uuid}))}function i(e){return e.references||(e.references=[]),e.appData||(e.appData={}),e.appData[r.b]||(e.appData[r.b]={}),e}},function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"a",(function(){return j}));var r,a,i,o,s=n(0),c=n.n(s),u=n(8),l=n(25),f=n(2),p=n(11),h=n(16),y=n(4),d=n(1),v=n(20);function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function g(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){m(i,r,a,o,s,"next",e)}function s(e){m(i,r,a,o,s,"throw",e)}o(void 0)}))}}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e,t,n){return(x="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=S(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Default=1]="Default",e[e.Ephemeral=2]="Ephemeral"}(r||(r={})),function(e){e[e.Default=1]="Default",e[e.Disabled=2]="Disabled"}(a||(a={})),function(e){e[e.Default=1]="Default",e[e.Nonwrapped=2]="Nonwrapped"}(i||(i={})),function(e){e.Wrapped="wrapped",e.Unwrapped="unwrapped",e.Nonwrapped="nonwrapped"}(o||(o={}));var j=function(e){function t(e,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=function(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?k(e):t}(this,S(t).call(this)),P(k(i),"encryptionDelegate",void 0),P(k(i),"namespace",void 0),P(k(i),"storagePersistable",!1),P(k(i),"persistencePolicy",void 0),P(k(i),"encryptionPolicy",void 0),P(k(i),"values",void 0),i.deviceInterface=e,i.namespace=n,i.setPersistencePolicy(r.Default),i.setEncryptionPolicy(a.Default),i}var n,s,h,m,j,C,_,D,I,E,M,R,A,T,K,F,L,N,V,W,U,B,H;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(t,e),n=t,s=[{key:"deinit",value:function(){this.deviceInterface=void 0,this.encryptionDelegate=void 0,x(S(t.prototype),"deinit",this).call(this)}},{key:"handleApplicationStage",value:(H=g(c.a.mark((function e(n){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(S(t.prototype),"handleApplicationStage",this).call(this,n);case 2:n===l.a.Launched_10&&(this.storagePersistable=!0);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return H.apply(this,arguments)})},{key:"setPersistencePolicy",value:(B=g(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.persistencePolicy=t,this.persistencePolicy!==r.Ephemeral){e.next=6;break}return e.next=4,this.deviceInterface.removeAllRawStorageValues();case 4:return e.next=6,this.clearAllPayloads();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"setEncryptionPolicy",value:(U=g(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.encryptionPolicy=t;case 1:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"isEphemeralSession",value:function(){return this.persistencePolicy===r.Ephemeral}},{key:"initializeFromDisk",value:(W=g(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deviceInterface.getRawStorageValue(this.getPersistenceKey());case 2:t=e.sent,n=t?JSON.parse(t):null,this.setInitialValues(n);case 5:case"end":return e.stop()}}),e,this)}))),function(){return W.apply(this,arguments)})},{key:"setInitialValues",value:function(e){e||(e=this.defaultValuesObject()),e[o.Unwrapped]||(e[o.Unwrapped]={}),this.values=e}},{key:"isStorageWrapped",value:function(){var e=this.values[o.Wrapped];return!Object(d.p)(e)&&Object.keys(e).length>0}},{key:"canDecryptWithKey",value:(V=g(c.a.mark((function e(t){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.values[o.Wrapped],e.next=3,this.decryptWrappedValue(n,t);case 3:return r=e.sent,e.abrupt("return",!r.errorDecrypting);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"decryptWrappedValue",value:(N=g(c.a.mark((function e(t,n){var r,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.content_type){e.next=2;break}throw"Attempting to decrypt nonexistent wrapped value";case 2:return r=Object(f.e)(t,{content_type:y.a.EncryptedStorage}),e.next=5,this.encryptionDelegate.payloadByDecryptingPayload(r,n);case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return N.apply(this,arguments)})},{key:"decryptStorage",value:(L=g(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.values[o.Wrapped],e.next=3,this.decryptWrappedValue(t);case 3:if(!(n=e.sent).errorDecrypting){e.next=6;break}throw"Unable to decrypt storage.";case 6:this.values[o.Unwrapped]=Object(d.a)(n.contentObject),delete this.values[o.Wrapped];case 8:case"end":return e.stop()}}),e,this)}))),function(){return L.apply(this,arguments)})},{key:"generatePersistenceValue",value:(F=g(c.a.mark((function e(){var t,n,r,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object.assign({},this.values),n=t[o.Unwrapped],e.t0=f.e,e.next=5,v.a.GenerateUuid();case 5:return e.t1=e.sent,e.t2=n,e.t3=y.a.EncryptedStorage,e.t4={uuid:e.t1,content:e.t2,content_type:e.t3},r=(0,e.t0)(e.t4),e.next=12,this.encryptionDelegate.payloadByEncryptingPayload(r,p.a.LocalStoragePreferEncrypted);case 12:return a=e.sent,t[o.Wrapped]=a.ejected(),t[o.Unwrapped]=void 0,e.abrupt("return",t);case 16:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"repersistToDisk",value:(K=g(c.a.mark((function e(){var t=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.storagePersistable){e.next=2;break}return e.abrupt("return");case 2:if(this.persistencePolicy!==r.Ephemeral){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this.executeCriticalFunction(g(c.a.mark((function e(){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.generatePersistenceValue();case 2:return n=e.sent,t.values[o.Wrapped]=n[o.Wrapped],e.abrupt("return",t.deviceInterface.setRawStorageValue(t.getPersistenceKey(),JSON.stringify(n)));case 5:case"end":return e.stop()}}),e)})))));case 5:case"end":return e.stop()}}),e,this)}))),function(){return K.apply(this,arguments)})},{key:"setValue",value:(T=g(c.a.mark((function e(t,n){var r,a=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:i.Default,this.values){e.next=3;break}throw"Attempting to set storage key ".concat(t," before loading local storage.");case 3:return this.values[this.domainKeyForMode(r)][t]=n,e.abrupt("return",this.repersistToDisk());case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return T.apply(this,arguments)})},{key:"getValue",value:(A=g(c.a.mark((function e(t){var n,r=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]?r[1]:i.Default,this.values){e.next=3;break}throw"Attempting to get storage key ".concat(t," before loading local storage.");case 3:if(this.values[this.domainKeyForMode(n)]){e.next=5;break}throw"Storage domain mode not available ".concat(n," for key ").concat(t);case 5:return e.abrupt("return",this.values[this.domainKeyForMode(n)][t]);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"removeValue",value:(R=g(c.a.mark((function e(t){var n,r=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]?r[1]:i.Default,this.values){e.next=3;break}throw"Attempting to remove storage key ".concat(t," before loading local storage.");case 3:return delete this.values[this.domainKeyForMode(n)][t],e.abrupt("return",this.repersistToDisk());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"getPersistenceKey",value:function(){return Object(u.c)(this.namespace,u.a.StorageObject)}},{key:"defaultValuesObject",value:function(e,n,r){return t.defaultValuesObject(e,n,r)}},{key:"domainKeyForMode",value:function(e){if(e===i.Default)return o.Unwrapped;if(e===i.Nonwrapped)return o.Nonwrapped;throw"Invalid mode"}},{key:"clearValues",value:(M=g(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setInitialValues(),e.next=3,this.repersistToDisk();case 3:case"end":return e.stop()}}),e,this)}))),function(){return M.apply(this,arguments)})},{key:"getAllRawPayloads",value:(E=g(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deviceInterface.getAllRawDatabasePayloads());case 1:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"savePayload",value:(I=g(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.savePayloads([t]));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"savePayloads",value:(D=g(c.a.mark((function e(t){var n,i,o,s,u,l,f,h,y=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.persistencePolicy!==r.Ephemeral){e.next=2;break}return e.abrupt("return");case 2:n=[],i=!0,o=!1,s=void 0,e.prev=6,u=t[Symbol.iterator]();case 8:if(i=(l=u.next()).done){e.next=24;break}if(!(f=l.value).discardable){e.next=15;break}return e.next=13,this.deletePayloadWithId(f.uuid);case 13:e.next=21;break;case 15:if(f.uuid){e.next=17;break}throw Error("Attempting to persist payload with no uuid");case 17:return e.next=19,this.encryptionDelegate.payloadByEncryptingPayload(f,this.encryptionPolicy===a.Default?p.a.LocalStoragePreferEncrypted:p.a.LocalStorageDecrypted);case 19:h=e.sent,n.push(h.ejected());case 21:i=!0,e.next=8;break;case 24:e.next=30;break;case 26:e.prev=26,e.t0=e.catch(6),o=!0,s=e.t0;case 30:e.prev=30,e.prev=31,i||null==u.return||u.return();case 33:if(e.prev=33,!o){e.next=36;break}throw s;case 36:return e.finish(33);case 37:return e.finish(30);case 38:return e.abrupt("return",this.executeCriticalFunction(g(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.deviceInterface.saveRawDatabasePayloads(n));case 1:case"end":return e.stop()}}),e)})))));case 39:case"end":return e.stop()}}),e,this,[[6,26,30,38],[31,,33,37]])}))),function(e){return D.apply(this,arguments)})},{key:"deletePayloads",value:(_=g(c.a.mark((function e(t){var n,r,a,i,o,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,r=!1,a=void 0,e.prev=3,i=t[Symbol.iterator]();case 5:if(n=(o=i.next()).done){e.next=12;break}return s=o.value,e.next=9,this.deletePayloadWithId(s.uuid);case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),r=!0,a=e.t0;case 18:e.prev=18,e.prev=19,n||null==i.return||i.return();case 21:if(e.prev=21,!r){e.next=24;break}throw a;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))),function(e){return _.apply(this,arguments)})},{key:"deletePayloadWithId",value:(C=g(c.a.mark((function e(t){var n=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.executeCriticalFunction(g(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.deviceInterface.removeRawDatabasePayloadWithId(t));case 1:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"clearAllPayloads",value:(j=g(c.a.mark((function e(){var t=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.executeCriticalFunction(g(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.deviceInterface.removeAllRawDatabasePayloads());case 1:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"clearAllData",value:(m=g(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.clearValues(),this.clearAllPayloads()]));case 1:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})}],h=[{key:"defaultValuesObject",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return P(e={},o.Wrapped,t),P(e,o.Unwrapped,n),P(e,o.Nonwrapped,r),e}}],s&&w(n.prototype,s),h&&w(n,h),t}(h.a)},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o,s;n.d(t,"d",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"e",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"f",(function(){return f})),function(e){e[e.LocalPasscode=1]="LocalPasscode",e[e.AccountPassword=2]="AccountPassword",e[e.Biometric=3]="Biometric"}(o||(o={})),function(e){e[e.ApplicationUnlock=1]="ApplicationUnlock",e[e.ResaveRootKey=2]="ResaveRootKey",e[e.ProtocolUpgrade=3]="ProtocolUpgrade",e[e.Migration=4]="Migration"}(s||(s={}));var c=function e(t,n){a(this,e),i(this,"types",void 0),i(this,"reason",void 0),i(this,"id",void 0),this.types=t,this.reason=n,this.id=(new Date).getTime(),Object.freeze(this)},u=function e(t,n){a(this,e),i(this,"type",void 0),i(this,"value",void 0),this.type=t,this.value=n,Object.freeze(this)},l=function(){function e(t,n,r){a(this,e),i(this,"challenge",void 0),i(this,"values",void 0),i(this,"artifacts",void 0),this.challenge=t,this.values=n,this.artifacts=r,Object.freeze(this)}var t,n,o;return t=e,(n=[{key:"getValueForType",value:function(e){return this.values.find((function(t){return t.type===e}))}}])&&r(t.prototype,n),o&&r(t,o),e}();function f(e){var t;return(i(t={},o.LocalPasscode,"application passcode"),i(t,o.AccountPassword,"account password"),i(t,o.Biometric,"biometrics"),t)[e]}},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(0),a=n.n(r),i=n(1);function o(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function s(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){s(i,r,a,o,c,"next",e)}function c(e){s(i,r,a,o,c,"throw",e)}o(void 0)}))}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),l(this,"eventObservers",[]),l(this,"loggingEnabled",!1),l(this,"deviceInterface",void 0),l(this,"criticalPromises",[])}var t,n,r,s,f,p,h;return t=e,(n=[{key:"addEventObserver",value:function(e){var t=this;return this.eventObservers.push(e),function(){Object(i.B)(t.eventObservers,e)}}},{key:"notifyEvent",value:(h=c(a.a.mark((function e(t,n){var r,i,o,s,c,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!0,i=!1,o=void 0,e.prev=3,s=this.eventObservers[Symbol.iterator]();case 5:if(r=(c=s.next()).done){e.next=12;break}return u=c.value,e.next=9,u(t,n||{});case 9:r=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),i=!0,o=e.t0;case 18:e.prev=18,e.prev=19,r||null==s.return||s.return();case 21:if(e.prev=21,!i){e.next=24;break}throw o;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))),function(e,t){return h.apply(this,arguments)})},{key:"blockDeinit",value:(p=c(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.criticalPromises);case 2:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"deinit",value:function(){this.eventObservers.length=0,this.deviceInterface=void 0}},{key:"executeCriticalFunction",value:(f=c(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t(),this.criticalPromises.push(n),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"handleApplicationStage",value:(s=c(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"log",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(this.loggingEnabled){var a,i=new Date,s=i.toLocaleTimeString().replace(" PM","").replace(" AM",""),c="".concat(s,".").concat(i.getMilliseconds());n?(n=n.map((function(e){return Array.isArray(e)?e.slice():e})),(a=console).log.apply(a,[c,e].concat(o(n)))):console.log(c,e)}}}])&&u(t.prototype,n),r&&u(t,r),e}()},function(e,t,n){"use strict";var r=n(6);n.d(t,"l",(function(){return r.d})),n.d(t,"g",(function(){return r.b})),n.d(t,"b",(function(){return r.a}));var a=n(30);n.d(t,"m",(function(){return a.b}));var i=n(27);n.d(t,"o",(function(){return i.a}));var o=n(7);n.d(t,"j",(function(){return o.d})),n.d(t,"d",(function(){return o.c})),n.d(t,"c",(function(){return o.a}));var s=n(86);n.d(t,"k",(function(){return s.a}));var c=n(53);n.d(t,"i",(function(){return c.b}));var u=n(60);n.d(t,"a",(function(){return u.a}));var l=n(48);n.d(t,"n",(function(){return l.b})),n.d(t,"h",(function(){return l.a}));var f=n(47);n.d(t,"q",(function(){return f.a}));var p=n(43);n.d(t,"s",(function(){return p.a})),n.d(t,"t",(function(){return p.b})),n.d(t,"u",(function(){return p.c}));n(21);var h=n(87);n.d(t,"p",(function(){return h.a}));var y=n(65);n.d(t,"r",(function(){return y.a}));var d=n(4);n.d(t,"e",(function(){return d.a}));var v=n(19);n.d(t,"f",(function(){return v.a}))},function(e,t,n){"use strict";var r,a,i,o;n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return o})),function(e){e[e.SaltSeedLength=128]="SaltSeedLength",e[e.PbkdfMinCost=3e3]="PbkdfMinCost",e[e.PbkdfOutputLength=512]="PbkdfOutputLength",e[e.EncryptionKeyLength=256]="EncryptionKeyLength"}(r||(r={})),function(e){e[e.SaltSeedLength=128]="SaltSeedLength",e[e.PbkdfMinCost=3e3]="PbkdfMinCost",e[e.PbkdfOutputLength=768]="PbkdfOutputLength",e[e.EncryptionKeyLength=256]="EncryptionKeyLength",e[e.EncryptionIvLength=128]="EncryptionIvLength"}(a||(a={})),function(e){e[e.SaltSeedLength=256]="SaltSeedLength",e[e.PbkdfCost=11e4]="PbkdfCost",e[e.PbkdfOutputLength=768]="PbkdfOutputLength",e[e.EncryptionKeyLength=256]="EncryptionKeyLength",e[e.EncryptionIvLength=128]="EncryptionIvLength"}(i||(i={})),function(e){e[e.ArgonSaltSeedLength=256]="ArgonSaltSeedLength",e[e.ArgonSaltLength=128]="ArgonSaltLength",e[e.ArgonIterations=5]="ArgonIterations",e[e.ArgonMemLimit=67108864]="ArgonMemLimit",e[e.ArgonOutputKeyBytes=64]="ArgonOutputKeyBytes",e[e.EncryptionKeyLength=256]="EncryptionKeyLength",e[e.EncryptionNonceLength=192]="EncryptionNonceLength"}(o||(o={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var r,a=n(43),i=n(21),o=n(7),s=n(65),c=n(86),u=n(53),l=n(87),f=n(47),p=n(48),h=n(6),y=n(4),d=n(30);function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=(v(r={},y.a.Note,p.b),v(r,y.a.Tag,f.a),v(r,y.a.ItemsKey,d.b),v(r,y.a.SmartTag,l.a),v(r,y.a.ActionsExtension,u.b),v(r,y.a.Editor,c.a),v(r,y.a.Theme,s.a),v(r,y.a.Component,o.d),v(r,y.a.Privileges,i.d),v(r,y.a.UserPrefs,a.a),r);function m(e){return new(b[e.content_type]||h.d)(e)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(0),a=n.n(r),i=n(1);function o(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r,c,u;return t=e,n=null,r=[{key:"SetGenerators",value:function(e,t){this.syncUuidFunc=t,this.asyncUuidFunc=e}},{key:"canGenSync",value:function(){return!Object(i.p)(this.syncUuidFunc)}},{key:"GenerateUuid",value:(c=a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.syncUuidFunc){e.next=4;break}return e.abrupt("return",this.syncUuidFunc());case 4:return e.abrupt("return",this.asyncUuidFunc());case 5:case"end":return e.stop()}}),e,this)})),u=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=c.apply(e,t);function i(e){o(a,n,r,i,s,"next",e)}function s(e){o(a,n,r,i,s,"throw",e)}i(void 0)}))},function(){return u.apply(this,arguments)})},{key:"GenerateUuidSynchronously",value:function(){return this.syncUuidFunc()}}],n&&s(t.prototype,n),r&&s(t,r),e}();c(u,"syncUuidFunc",void 0),c(u,"asyncUuidFunc",void 0)},function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"d",(function(){return g})),n.d(t,"b",(function(){return w}));var r,a,i=n(1),o=n(6),s=n(27);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=y(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}function h(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?d(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.ManageExtensions="ActionManageExtensions",e.ManageBackups="ActionManageBackups",e.ViewProtectedNotes="ActionViewProtectedNotes",e.ManagePrivileges="ActionManagePrivileges",e.ManagePasscode="ActionManagePasscode",e.DeleteNote="ActionDeleteNote"}(r||(r={})),function(e){e.AccountPassword="CredentialAccountPassword",e.LocalPasscode="CredentialLocalPasscode"}(a||(a={}));var g=function(e){function t(e){var n;return l(this,t),m(d(n=h(this,y(t).call(this,e))),"privilegeMap",{}),n.privilegeMap=e.safeContent.desktopPrivileges||{},n}return v(t,e),p(t,[{key:"getCredentialsForAction",value:function(e){return this.privilegeMap[e]||[]}},{key:"isCredentialRequiredForAction",value:function(e,t){return this.getCredentialsForAction(e).includes(t)}},{key:"isSingleton",get:function(){return!0}},{key:"singletonPredicate",get:function(){return new s.a("content_type","=",this.content_type)}}]),t}(o.d),w=function(e){function t(e,n){var r;return l(this,t),m(d(r=h(this,y(t).call(this,e,n))),"privileges",void 0),m(d(r),"privilegeMap",{}),r.privileges=e,r.privilegeMap=Object(i.a)(r.payload.safeContent.desktopPrivileges||{}),r}return v(t,e),p(t,[{key:"getResult",value:function(){return this.content&&(this.content.desktopPrivileges=this.privilegeMap),u(y(t.prototype),"getResult",this).call(this)}},{key:"setCredentialsForAction",value:function(e,t){this.privilegeMap[e]=t}},{key:"toggleCredentialForAction",value:function(e,t){this.privileges.isCredentialRequiredForAction(e,t)?this.removeCredentialForAction(e,t):this.addCredentialForAction(e,t)}},{key:"removeCredentialForAction",value:function(e,t){Object(i.B)(this.privilegeMap[e],t)}},{key:"addCredentialForAction",value:function(e,t){var n=this.privileges.getCredentialsForAction(e).slice();n.push(t),this.setCredentialsForAction(e,n)}}]),t}(o.b)},function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"f",(function(){return o})),n.d(t,"i",(function(){return s})),n.d(t,"h",(function(){return c})),n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return l})),n.d(t,"g",(function(){return f})),n.d(t,"j",(function(){return p})),n.d(t,"s",(function(){return h})),n.d(t,"k",(function(){return y})),n.d(t,"p",(function(){return d})),n.d(t,"r",(function(){return v})),n.d(t,"l",(function(){return b})),n.d(t,"o",(function(){return m})),n.d(t,"n",(function(){return g})),n.d(t,"m",(function(){return w})),n.d(t,"q",(function(){return k}));var r="A server error occurred while trying to sign in. Please try again.",a="A server error occurred while trying to register. Please try again.",i="Something went wrong while changing your password.\n                                                      Your password was not changed. Please try again.",o="Could not connect to server.",s="An existing registration request is already in progress.",c="An existing sign in request is already in progress.",u="An existing change password request is already in progress.",l="Invalid email or password.",f="A server error occurred while trying to refresh your session.\n                                                      Please try again.",p="Your account session is being renewed with the server. Please try your request again.",h="This version of the application does not support your\n                                                      newer account type. Please upgrade to the latest version\n                                                      of Standard Notes to sign in.",y="The protocol version associated with your account is\n                                                      outdated and no longer supported by this application.\n                                                      Please visit standardnotes.org/help/security for more\n                                                      information.",d="The encryption version for your account is outdated and\n                                                      requires upgrade. You may proceed with login, but are\n                                                      advised to perform a security update using the web or\n                                                      desktop application. Please visit\n                                                      standardnotes.org/help/security for more information.",v="Your account was created on a platform with higher security\n                                                      capabilities than this browser supports. If we attempted\n                                                      to generate your login keys here, it would take hours. Please\n                                                      use a browser with more up to date security capabilities,\n                                                      like Google Chrome or Firefox, to log in.",b="Unable to login due to insecure password parameters.\n                                                      Please visit standardnotes.org/help/security for\n                                                      more information.",m="Update Recommended",g="Sign In";function w(e){return"\n          Your password must be at least ".concat(e," characters in length.\n          For your security, please choose a longer password or,\n          ideally, a passphrase, and try again.\n         ")}function k(e,t){return"\n          Strict Sign In has refused the server's sign-in parameters.\n          The latest account version is ".concat(t,", but the server is reporting a \n          version of ").concat(e," for your account. If you'd like to proceed\n          with sign in anyway, please disable Strict Sign In and try again.\n          ")}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?c(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return f}));var f=function(e){function t(){var e,n;a(this,t);for(var r=arguments.length,i=new Array(r),u=0;u<r;u++)i[u]=arguments[u];return l(c(n=o(this,(e=s(t)).call.apply(e,[this].concat(i)))),"source",void 0),n}var n,r,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,e),n=t,f=[{key:"WithPayloads",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,r=new t;return r.source=n,e.length>0&&r.set(e),Object.freeze(r),r}},{key:"FromCollection",value:function(e){var n=new t(!0,Object.freeze(Object.assign({},e.map)),Object.freeze(Object.assign({},e.typedMap)),Object.freeze(e.referenceMap.makeCopy()),Object.freeze(e.conflictMap.makeCopy()));return Object.freeze(n),n}}],(r=[{key:"payloads",get:function(){return this.all()}}])&&i(n.prototype,r),f&&i(n,f),t}(n(41).a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return o}));var r,a=n(10);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){var t;return(t={},i(t,a.a.FullSyncCompleted,r.CompletedFullSync),i(t,a.a.SingleSyncCompleted,r.CompletedIncrementalSync),i(t,a.a.SyncError,r.FailedSync),i(t,a.a.SyncTakingTooLong,r.HighLatencySync),i(t,a.a.EnterOutOfSync,r.EnteredOutOfSync),i(t,a.a.ExitOutOfSync,r.ExitedOutOfSync),i(t,a.a.LocalDataLoaded,r.LocalDataLoaded),i(t,a.a.MajorDataChange,r.MajorDataChange),i(t,a.a.LocalDataIncrementalLoad,r.LocalDataIncrementalLoad),i(t,a.a.StatusChanged,r.SyncStatusChanged),i(t,a.a.SyncWillBegin,r.WillSync),i(t,a.a.InvalidSession,r.InvalidSyncSession),i(t,a.a.DatabaseReadError,r.LocalDatabaseReadError),i(t,a.a.DatabaseWriteError,r.LocalDatabaseWriteError),t)[e]}n.d(t,"b",(function(){return a.a})),function(e){e[e.SignedIn=2]="SignedIn",e[e.SignedOut=3]="SignedOut",e[e.CompletedFullSync=5]="CompletedFullSync",e[e.FailedSync=6]="FailedSync",e[e.HighLatencySync=7]="HighLatencySync",e[e.EnteredOutOfSync=8]="EnteredOutOfSync",e[e.ExitedOutOfSync=9]="ExitedOutOfSync",e[e.Started=10]="Started",e[e.Launched=11]="Launched",e[e.LocalDataLoaded=12]="LocalDataLoaded",e[e.KeyStatusChanged=13]="KeyStatusChanged",e[e.MajorDataChange=14]="MajorDataChange",e[e.CompletedRestart=15]="CompletedRestart",e[e.LocalDataIncrementalLoad=16]="LocalDataIncrementalLoad",e[e.SyncStatusChanged=17]="SyncStatusChanged",e[e.WillSync=18]="WillSync",e[e.InvalidSyncSession=19]="InvalidSyncSession",e[e.LocalDatabaseReadError=20]="LocalDatabaseReadError",e[e.LocalDatabaseWriteError=21]="LocalDatabaseWriteError",e[e.CompletedIncrementalSync=22]="CompletedIncrementalSync"}(r||(r={}))},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.PreparingForLaunch_0=0]="PreparingForLaunch_0",e[e.ReadyForLaunch_05=.5]="ReadyForLaunch_05",e[e.StorageDecrypted_09=.9]="StorageDecrypted_09",e[e.Launched_10=1]="Launched_10",e[e.LoadingDatabase_11=1.1]="LoadingDatabase_11",e[e.LoadedDatabase_12=1.2]="LoadedDatabase_12",e[e.FullSyncCompleted_13=1.3]="FullSyncCompleted_13",e[e.SignedIn_30=3]="SignedIn_30"}(r||(r={}))},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.KeepLeft=1]="KeepLeft",e[e.KeepRight=2]="KeepRight",e[e.KeepLeftDuplicateRight=3]="KeepLeftDuplicateRight",e[e.DuplicateLeftKeepRight=4]="DuplicateLeftKeepRight",e[e.KeepLeftMergeRefs=5]="KeepLeftMergeRefs"}(r||(r={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(1);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){function e(t,n,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"keypath",void 0),i(this,"operator",void 0),i(this,"value",void 0),this.keypath=t,this.operator=n,this.value=r,this.isRecursive()){var a=this.value;this.value=a.map((function(t){return Array.isArray(t)?e.FromArray(t):t}))}else"true"!==this.value&&"false"!==this.value||(this.value=JSON.parse(this.value))}var t,n,o;return t=e,o=[{key:"FromJson",value:function(t){return new e(t.keypath,t.operator,t.value)}},{key:"FromArray",value:function(t){return new e(t[0],t[1],t[2])}},{key:"CompoundPredicate",value:function(t){return new e("ignored","and",t)}},{key:"ObjectSatisfiesPredicate",value:function(e,t){if(Array.isArray(t)&&(t=this.FromArray(t)),t.isRecursive()){if("and"===t.operator){var n=!0,r=!1,a=void 0;try{for(var i,o=t.valueAsArray()[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;if(!this.ObjectSatisfiesPredicate(e,s))return!1}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return!0}if("or"===t.operator){var c=!0,u=!1,l=void 0;try{for(var f,p=t.valueAsArray()[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var h=f.value;if(this.ObjectSatisfiesPredicate(e,h))return!0}}catch(e){u=!0,l=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw l}}return!1}}var y=t.value;"string"==typeof y&&y.includes(".ago")&&(y=this.DateFromString(y));var d=t.keypath.split(".").reduce((function(e,t){return e&&e[t]}),e),v=[!1,"",null,void 0,NaN];return void 0===d?"!="===t.operator?!v.includes(t.value):v.includes(t.value):"="===t.operator?Array.isArray(d)?JSON.stringify(d)===JSON.stringify(y):d===y:"!="===t.operator?Array.isArray(d)?JSON.stringify(d)!==JSON.stringify(y):d!==y:"<"===t.operator?d<y:">"===t.operator?d>y:"<="===t.operator?d<=y:">="===t.operator?d>=y:"startsWith"===t.operator?d.startsWith(y):"in"===t.operator?-1!==y.indexOf(d):"includes"===t.operator?this.resolveIncludesPredicate(d,y):"matches"===t.operator&&new RegExp(y).test(d)}},{key:"resolveIncludesPredicate",value:function(t,n){if(Object(r.s)(n))return t.includes(n);var a;a=Array.isArray(n)?e.FromArray(n):n;var i=!0,o=!1,s=void 0;try{for(var c,u=t[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var l=c.value;if(this.ObjectSatisfiesPredicate(l,a))return!0}}catch(e){o=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw s}}return!1}},{key:"ItemSatisfiesPredicate",value:function(t,n){return Array.isArray(n)&&(n=e.FromArray(n)),this.ObjectSatisfiesPredicate(t,n)}},{key:"ItemSatisfiesPredicates",value:function(e,t){var n=!0,r=!1,a=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;if(!this.ItemSatisfiesPredicate(e,s))return!1}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return!0}},{key:"DateFromString",value:function(e){var t=e.split("."),n=t[1],r=new Date,a=parseInt(t[0]);return"days"===n?r.setDate(r.getDate()-a):"hours"===n&&r.setHours(r.getHours()-a),r}}],(n=[{key:"isRecursive",value:function(){return["and","or"].includes(this.operator)}},{key:"arrayRepresentation",value:function(){return[this.keypath,this.operator,this.value]}},{key:"valueAsArray",value:function(){return this.value}}])&&a(t.prototype,n),o&&a(t,o),e}()},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a,i;function o(e){return{"mac-web":i.MacWeb,"mac-desktop":i.MacDesktop,"linux-web":i.LinuxWeb,"linux-desktop":i.LinuxDesktop,"windows-web":i.WindowsWeb,"windows-desktop":i.WindowsDesktop,ios:i.Ios,android:i.Android}[e]}function s(e){var t;return(r(t={},i.MacWeb,"mac-web"),r(t,i.MacDesktop,"mac-desktop"),r(t,i.LinuxWeb,"linux-web"),r(t,i.LinuxDesktop,"linux-desktop"),r(t,i.WindowsWeb,"windows-web"),r(t,i.WindowsDesktop,"windows-desktop"),r(t,i.Ios,"ios"),r(t,i.Android,"android"),t)[e]}function c(e){var t;return(r(t={},a.Web,"web"),r(t,a.Desktop,"desktop"),r(t,a.Mobile,"mobile"),t)[e]}function u(e){return e===a.Web||e===a.Desktop}function l(e){return e===a.Mobile}n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i})),n.d(t,"f",(function(){return o})),n.d(t,"g",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"e",(function(){return u})),n.d(t,"d",(function(){return l})),function(e){e[e.Web=1]="Web",e[e.Desktop=2]="Desktop",e[e.Mobile=3]="Mobile"}(a||(a={})),function(e){e[e.Ios=1]="Ios",e[e.Android=2]="Android",e[e.MacWeb=3]="MacWeb",e[e.MacDesktop=4]="MacDesktop",e[e.WindowsWeb=5]="WindowsWeb",e[e.WindowsDesktop=6]="WindowsDesktop",e[e.LinuxWeb=7]="LinuxWeb",e[e.LinuxDesktop=8]="LinuxDesktop"}(i||(i={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var r=n(0),a=n.n(r),i=n(13),o=n(2),s=n(6),c=n(4),u=n(9),l=n(20);function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(){return h(this,t),d(this,v(t).apply(this,arguments))}var n,r,s,f,m;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,e),n=t,r=[{key:"compare",value:function(e){if(this.version!==e.version)return!1;var t=this.serverPassword&&e.serverPassword;return this.masterKey===e.masterKey&&(!t||this.serverPassword===e.serverPassword)}},{key:"getPersistableValue",value:function(){var e={version:this.version};return this.masterKey&&(e.masterKey=this.masterKey),this.dataAuthenticationKey&&(e.dataAuthenticationKey=this.dataAuthenticationKey),e}},{key:"version",get:function(){if(!this.payload.safeContent.version)throw"Attempting to create key without version.";return this.payload.safeContent.version}},{key:"isRootKey",get:function(){return!0}},{key:"itemsKey",get:function(){return this.masterKey}},{key:"masterKey",get:function(){return this.payload.safeContent.masterKey}},{key:"serverPassword",get:function(){return this.payload.safeContent.serverPassword}},{key:"dataAuthenticationKey",get:function(){return this.payload.safeContent.dataAuthenticationKey}}],s=[{key:"Create",value:(f=a.a.mark((function e(n,r){var s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=4;break}return e.next=3,l.a.GenerateUuid();case 3:r=e.sent;case 4:return n.version||(n.dataAuthenticationKey?n.version=u.a.V002:n.version=u.a.V001),s=Object(o.e)({uuid:r,content_type:c.a.RootKey,content:Object(i.a)(n)}),e.abrupt("return",new t(s));case 7:case"end":return e.stop()}}),e)})),m=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=f.apply(e,t);function i(e){p(a,n,r,i,o,"next",e)}function o(e){p(a,n,r,i,o,"throw",e)}i(void 0)}))},function(e,t){return m.apply(this,arguments)})}],r&&y(n.prototype,r),s&&y(n,s),t}(s.d)},function(e,t,n){"use strict";n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return v}));var r=n(26),a=n(6),i=n(9);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function l(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e,t,n){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(){return s(this,t),l(this,p(t).apply(this,arguments))}return h(t,e),u(t,[{key:"strategyWhenConflictingWithItem",value:function(e){return this.errorDecrypting?f(p(t.prototype),"strategyWhenConflictingWithItem",this).call(this,e):r.a.KeepLeft}},{key:"version",get:function(){return this.payload.safeContent.version}},{key:"isItemsKey",get:function(){return!0}},{key:"isDefault",get:function(){return this.payload.safeContent.isDefault}},{key:"itemsKey",get:function(){return this.payload.safeContent.itemsKey}},{key:"dataAuthenticationKey",get:function(){if(this.version===i.a.V004)throw"Attempting to access legacy data authentication key.";return this.payload.safeContent.dataAuthenticationKey}}]),t}(a.d),v=function(e){function t(){return s(this,t),l(this,p(t).apply(this,arguments))}return h(t,e),u(t,[{key:"isDefault",set:function(e){this.content.isDefault=e}}]),t}(a.b)},function(e,t,n){"use strict";n.d(t,"c",(function(){return w})),n.d(t,"b",(function(){return x})),n.d(t,"a",(function(){return j}));var r=n(0),a=n.n(r),i=n(6),o=n(7),s=n(19),c=n(42),u=n.n(c),l=n(2),f=n(1),p=n(20),h=n(17);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function b(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){v(i,r,a,o,s,"next",e)}function s(e){v(i,r,a,o,s,"throw",e)}o(void 0)}))}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=m({},h.e.Note,(function(e,t,n){var r=n.all(h.e.Component).map((function(e){return Object(s.a)(e)})).filter((function(e){return e.area===o.b.Editor})).find((function(t){return t.isExplicitlyEnabledForItem(e.uuid)}));if(r){var a=new o.c(r,i.c.Internal);return a.associateWithItem(t.uuid),[a.getResult()]}}));function w(e,t,n){return k.apply(this,arguments)}function k(){return(k=b(a.a.mark((function e(t,n,r){var i,o,s,c,u,h,y;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=[],e.next=3,p.a.GenerateUuid();case 3:return e.t0=e.sent,e.t1=new Date,o={uuid:e.t0,dirty:!0,dirtiedDate:e.t1,lastSyncBegan:null,lastSyncEnd:null},r&&(o.content=d({},t.safeContent,{conflict_of:t.uuid})),s=Object(l.b)(t,o),i.push(s),c=n.elementsReferencingElement(t),e.next=12,O(c,[{uuid:s.uuid,content_type:s.content_type}]);case 12:return u=e.sent,Object(f.j)(i,u),(h=g[t.content_type])&&(y=h(t,s,n))&&Object(f.j)(i,y),e.abrupt("return",i);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e,t){return S.apply(this,arguments)}function S(){return(S=b(a.a.mark((function e(t,n){var r,i,o,s,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],e.t0=l.b,e.t1=t,e.next=5,p.a.GenerateUuid();case 5:return e.t2=e.sent,e.t3=new Date,e.t4={uuid:e.t2,dirty:!0,dirtiedDate:e.t3,lastSyncBegan:null,lastSyncEnd:null},i=(0,e.t0)(e.t1,e.t4),r.push(i),o=n.elementsReferencingElement(t),e.next=13,O(o,[{uuid:i.uuid,content_type:i.content_type}],[t.uuid]);case 13:return s=e.sent,Object(f.j)(r,s),c=Object(l.b)(t,{deleted:!0,dirty:!1,content:void 0}),r.push(c),e.abrupt("return",r);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t,n){return P.apply(this,arguments)}function P(){return(P=b(a.a.mark((function e(t,n,r){var i,o,s,c,f,p,h,y,v,b,m,g,w,k,x,S,O,P,j,C,_;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=[],o=!0,s=!1,c=void 0,e.prev=4,f=t[Symbol.iterator]();case 6:if(o=(p=f.next()).done){e.next=54;break}if(h=p.value,y=h.contentObject.references.slice(),!n){e.next=29;break}for(v=!0,b=!1,m=void 0,e.prev=13,g=n[Symbol.iterator]();!(v=(w=g.next()).done);v=!0)k=w.value,y.push(k);e.next=21;break;case 17:e.prev=17,e.t0=e.catch(13),b=!0,m=e.t0;case 21:e.prev=21,e.prev=22,v||null==g.return||g.return();case 24:if(e.prev=24,!b){e.next=27;break}throw m;case 27:return e.finish(24);case 28:return e.finish(21);case 29:if(!r){e.next=49;break}for(x=!0,S=!1,O=void 0,e.prev=33,P=r[Symbol.iterator]();!(x=(j=P.next()).done);x=!0)C=j.value,u()(y,{uuid:C});e.next=41;break;case 37:e.prev=37,e.t1=e.catch(33),S=!0,O=e.t1;case 41:e.prev=41,e.prev=42,x||null==P.return||P.return();case 44:if(e.prev=44,!S){e.next=47;break}throw O;case 47:return e.finish(44);case 48:return e.finish(41);case 49:_=Object(l.b)(h,{dirty:!0,dirtiedDate:new Date,content:d({},h.safeContent,{references:y})}),i.push(_);case 51:o=!0,e.next=6;break;case 54:e.next=60;break;case 56:e.prev=56,e.t2=e.catch(4),s=!0,c=e.t2;case 60:e.prev=60,e.prev=61,o||null==f.return||f.return();case 63:if(e.prev=63,!s){e.next=66;break}throw c;case 66:return e.finish(63);case 67:return e.finish(60);case 68:return e.abrupt("return",i);case 69:case"end":return e.stop()}}),e,null,[[4,56,60,68],[13,17,21,29],[22,,24,28],[33,37,41,49],[42,,44,48],[61,,63,67]])})))).apply(this,arguments)}function j(e,t){var n=Object(s.a)(e),r=Object(s.a)(t);return n.isItemContentEqualWith(r)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(0),a=n.n(r);function i(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"baseCollection",void 0),s(this,"applyCollection",void 0),s(this,"relatedCollectionSet",void 0),this.baseCollection=t,this.applyCollection=n,this.relatedCollectionSet=r}var t,n,r,c,u;return t=e,(n=[{key:"resultingCollection",value:(c=a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override PayloadDelta.resultingCollection.";case 1:case"end":return e.stop()}}),e)})),u=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=c.apply(e,t);function o(e){i(a,n,r,o,s,"next",e)}function s(e){i(a,n,r,o,s,"throw",e)}o(void 0)}))},function(){return u.apply(this,arguments)})},{key:"findBasePayload",value:function(e){return this.baseCollection.find(e)}},{key:"findRelatedPayload",value:function(e,t){var n,r=null===(n=this.relatedCollectionSet)||void 0===n?void 0:n.collectionForSource(t);return null==r?void 0:r.find(e)}}])&&o(t.prototype,n),r&&o(t,r),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(1),a=n(9);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e){return new s(e)}var s=function(){function e(t){var n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a=void 0,(r="content")in(n=this)?Object.defineProperty(n,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[r]=a,this.content=t}var t,n,o;return t=e,(n=[{key:"getPortableValue",value:function(){return Object(a.b)(this.version,a.a.V003)>=0?Object(r.y)(this.content,["pw_cost"]):this.content}},{key:"isKeyParamsObject",get:function(){return!0}},{key:"kdfIterations",get:function(){return this.content.pw_cost}},{key:"seed",get:function(){return this.content.pw_nonce}},{key:"identifier",get:function(){return this.content.identifier||this.content.email}},{key:"salt",get:function(){return this.content.pw_salt}},{key:"version",get:function(){return this.content.version}}])&&i(t.prototype,n),o&&i(t,o),e}()},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.LastSyncToken="sync_token",e.PaginationToken="cursor_token",e.IntegrityCheck="compute_integrity",e.IntegrityResult="integrity_hash",e.SyncDlLimit="limit",e.SyncPayloads="items",e.ApiVersion="api"}(r||(r={}))},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=n(112),i="object"==("undefined"==typeof self?"undefined":r(self))&&self&&self.Object===Object&&self,o=a||i||Function("return this")();e.exports=o},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return d}));var r,a=n(41),i=n(1);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t,n){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.CreatedAt="created_at",e.UpdatedAt="userModifiedDate",e.Title="title"}(r||(r={}));var d=function(e){function t(){var e,n;s(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return y(l(n=u(this,(e=p(t)).call.apply(e,[this].concat(a)))),"displaySortBy",{}),y(l(n),"displayFilter",{}),y(l(n),"filteredMap",{}),y(l(n),"sortedMap",{}),n}var n,a,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,e),n=t,(a=[{key:"set",value:function(e){e=Array.isArray(e)?e:[e],f(p(t.prototype),"set",this).call(this,e),this.filterSortElements(e)}},{key:"discard",value:function(e){e=Array.isArray(e)?e:[e],f(p(t.prototype),"discard",this).call(this,e),this.filterSortElements(e)}},{key:"setDisplayOptions",value:function(e,t,n,r){var a=this.displaySortBy[e],i=this.displayFilter[e];if(!a||a.key!==t||a.dir!==n||i||r){this.displaySortBy[e]=t?{key:t,dir:n}:void 0,this.displayFilter[e]=r,this.filteredMap[e]={},this.sortedMap[e]=[];var o=this.all(e);o.length>0&&this.filterSortElements(o)}}},{key:"displayElements",value:function(e){var t=this.sortedMap[e];if(!t)throw Error("Attempting to access display elements for \n        non-configured content type ".concat(e));return t.slice()}},{key:"filterSortElements",value:function(e){if(0!==Object.keys(this.displaySortBy).length){var t=new Set,n=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var c=o.value,u=c.content_type,l=this.displaySortBy[u];if(l){var f=this.displayFilter[u],p=this.filteredMap[u],h=this.sortedMap[u],y=!(c.deleted||!this.map[c.uuid])&&(!f||f(c)),d=p[c.uuid];if(y)if(Object(i.p)(d))h.push(c),t.add(u);else{var v=h[d],b=v[l.key],m=c[l.key];h[d]=c;var g=v.pinned!==c.pinned;Object(i.e)(b,m)&&!g||t.add(u)}else Object(i.p)(d)||(delete p[c.uuid],h[d]=void 0,t.add(u))}}}catch(e){r=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}var w=!0,k=!1,x=void 0;try{for(var S,O=t.values()[Symbol.iterator]();!(w=(S=O.next()).done);w=!0){var P=S.value;this.resortContentType(P)}}catch(e){k=!0,x=e}finally{try{w||null==O.return||O.return()}finally{if(k)throw x}}}}},{key:"resortContentType",value:function(e){var t=this.sortedMap[e],n=this.displaySortBy[e],a=this.filteredMap[e],i=t.sort((function(e,t){return function e(t,a){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return-1;if(!a)return 1;if(!i){if(t.pinned&&a.pinned)return e(t,a,!0);if(t.pinned)return-1;if(a.pinned)return 1}var o=t[n.key]||"",s=a[n.key]||"",c=1;if("asc"===n.dir&&(c*=-1),n.key===r.Title){if(o=o.toLowerCase(),s=s.toLowerCase(),0===o.length&&0===s.length)return 0;if(0===o.length&&0!==s.length)return 1*c;if(0!==o.length&&0===s.length)return-1*c;c*=-1}return o>s?-1*c:o<s?1*c:0}(e,t)})),o=[],s=0,c=!0,u=!1,l=void 0;try{for(var f,p=i[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var h=f.value;h&&(o.push(h),a[h.uuid]=s,s++)}}catch(e){u=!0,l=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw l}}this.sortedMap[e]=o}}])&&c(n.prototype,a),o&&c(n,o),t}(a.a)},function(e,t,n){var r=n(218)(n(219));e.exports=r},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){var t=n(e);return null!=e&&("object"==t||"function"==t)}},function(e,t,n){"use strict";n.d(t,"c",(function(){return He})),n.d(t,"b",(function(){return ze})),n.d(t,"d",(function(){return qe})),n.d(t,"a",(function(){return Je}));var r=n(0),a=n.n(r),i=n(10),o=n(8),s=n(6),c=n(1),u=n(16),l=n(92);function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),p(this,"interval",void 0),p(this,"receiver",void 0),p(this,"inProgress",!1),p(this,"completedUpload",0),p(this,"totalUpload",0),p(this,"downloaded",0),p(this,"databaseLoadCurrent",0),p(this,"databaseLoadTotal",0),p(this,"databaseLoadDone",!1),p(this,"syncing",!1),p(this,"syncStart",void 0),p(this,"syncEnd",void 0),p(this,"timingMonitor",void 0),p(this,"error",void 0),this.interval=t,this.receiver=n}var t,n,r;return t=e,(n=[{key:"deinit",value:function(){this.stopTimingMonitor()}},{key:"setSyncInProgress",value:function(e){this.inProgress=!0}},{key:"setUploadStatus",value:function(e,t){this.completedUpload=e,this.totalUpload=t,this.receiver(i.a.StatusChanged)}},{key:"setDownloadStatus",value:function(e){this.downloaded+=e,this.receiver(i.a.StatusChanged)}},{key:"setDatabaseLoadStatus",value:function(e,t,n){this.databaseLoadCurrent=e,this.databaseLoadTotal=t,this.databaseLoadDone=n,n?this.receiver(i.a.LocalDataLoaded):this.receiver(i.a.LocalDataIncrementalLoad)}},{key:"getStats",value:function(){return{uploadCompletionCount:this.completedUpload,uploadTotalCount:this.totalUpload,downloadCount:this.downloaded,localDataDone:this.databaseLoadDone,localDataCurrent:this.databaseLoadCurrent,localDataTotal:this.databaseLoadTotal}}},{key:"setDidBegin",value:function(){this.syncing=!0,this.syncStart=new Date}},{key:"setDidEnd",value:function(){this.syncing=!1,this.syncEnd=new Date}},{key:"startTimingMonitor",value:function(){var e=this;this.timingMonitor&&this.stopTimingMonitor(),this.timingMonitor=this.interval((function(){e.secondsSinceSyncStart>5&&(e.receiver(i.a.SyncTakingTooLong),e.stopTimingMonitor())}),500)}},{key:"stopTimingMonitor",value:function(){Object.prototype.hasOwnProperty.call(this.interval,"cancel")?this.interval.cancel(this.timingMonitor):clearInterval(this.timingMonitor),this.timingMonitor=null}},{key:"hasError",value:function(){return!!this.error}},{key:"setError",value:function(e){this.error=e}},{key:"clearError",value:function(){this.error=null}},{key:"reset",value:function(){this.downloaded=0,this.completedUpload=0,this.totalUpload=0,this.inProgress=!1,this.syncing=!1,this.error=null,this.stopTimingMonitor(),this.receiver(i.a.StatusChanged)}},{key:"syncInProgress",get:function(){return!0===this.syncing}},{key:"secondsSinceSyncStart",get:function(){return((new Date).getTime()-this.syncStart.getTime())/1e3}}])&&f(t.prototype,n),r&&f(t,r),e}();function y(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),v(this,"lastPreSyncSave",void 0),v(this,"lastSyncDate",void 0),v(this,"receiver",void 0),v(this,"discordance",0),v(this,"maxDiscordance",void 0),v(this,"outOfSync",!1),v(this,"lastClientHash",void 0),v(this,"lastServerHash",void 0),this.receiver=t,this.maxDiscordance=n,this.reset()}var t,n,r,o,s;return t=e,(n=[{key:"isOutOfSync",value:function(){return this.outOfSync}},{key:"reset",value:function(){this.lastPreSyncSave=void 0,this.lastSyncDate=void 0,this.discordance=0,this.outOfSync=!1}},{key:"getLastClientIntegrityHash",value:function(){return this.lastClientHash}},{key:"clearIntegrityHashes",value:function(){this.lastClientHash=void 0,this.lastServerHash=void 0}},{key:"setIntegrityHashes",value:(o=a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.lastClientHash=t,this.lastServerHash=n,n&&0!==n.length&&t&&t!==n?(this.discordance++,this.discordance>=this.maxDiscordance&&!this.outOfSync&&(this.outOfSync=!0,this.receiver(i.a.EnterOutOfSync))):(this.outOfSync&&(this.outOfSync=!1,this.receiver(i.a.ExitOutOfSync)),this.discordance=0);case 4:case"end":return e.stop()}}),e,this)})),s=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=o.apply(e,t);function i(e){y(a,n,r,i,s,"next",e)}function s(e){y(a,n,r,i,s,"throw",e)}i(void 0)}))},function(e,t){return s.apply(this,arguments)})},{key:"needsSync",get:function(){return this.discordance>0&&this.discordance<this.maxDiscordance}}])&&d(t.prototype,n),r&&d(t,r),e}(),m=n(2),g=n(3);function w(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=function(){function e(t,n,r,a,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),x(this,"apiService",void 0),x(this,"protocolService",void 0),x(this,"contentType",void 0),x(this,"customEvent",void 0),x(this,"limit",void 0),x(this,"progress",void 0),this.apiService=t,this.protocolService=n,this.contentType=r,this.customEvent=a,this.limit=i,this.progress={retrievedPayloads:[]}}var t,n,r,i,o;return t=e,(n=[{key:"run",value:(i=a.a.mark((function e(){var t,n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.sync([],this.progress.lastSyncToken,this.progress.paginationToken,this.limit||500,!1,this.contentType,this.customEvent);case 2:return t=e.sent,n=t.retrieved_items.map((function(e){return Object(m.f)(e,g.a.RemoteRetrieved)})),e.next=6,this.protocolService.payloadsByDecryptingPayloads(n);case 6:if(r=e.sent,this.progress.retrievedPayloads=this.progress.retrievedPayloads.concat(r),this.progress.lastSyncToken=t.sync_token,this.progress.paginationToken=t.cursor_token,!t.cursor_token){e.next=14;break}return e.abrupt("return",this.run());case 14:return e.abrupt("return",this.progress.retrievedPayloads);case 15:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){w(a,n,r,o,s,"next",e)}function s(e){w(a,n,r,o,s,"throw",e)}o(void 0)}))},function(){return o.apply(this,arguments)})}])&&k(t.prototype,n),r&&k(t,r),e}(),O=n(32),P=n(49),j=n(23),C=n(31);function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function I(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){D(i,r,a,o,s,"next",e)}function s(e){D(i,r,a,o,s,"throw",e)}o(void 0)}))}}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var K=function(e){function t(){return E(this,t),R(this,A(t).apply(this,arguments))}var n,r,i,o,s,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(t,e),n=t,(r=[{key:"resultingCollection",value:(u=I(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.applyCollection.source!==g.a.ConflictUuid){e.next=4;break}return e.abrupt("return",this.collectionsByHandlingUuidConflicts());case 4:if(this.applyCollection.source!==g.a.ConflictData){e.next=8;break}return e.abrupt("return",this.collectionsByHandlingDataConflicts());case 8:throw"Unhandled conflict type ".concat(this.applyCollection.source);case 9:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"collectionsByHandlingDataConflicts",value:(s=I(a.a.mark((function e(){var t,n,r,i,o,s,u,l,f,p,h,y;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=!0,r=!1,i=void 0,e.prev=4,o=this.applyCollection.all()[Symbol.iterator]();case 6:if(n=(s=o.next()).done){e.next=27;break}if(u=s.value,l=this.findBasePayload(u.uuid)){e.next=12;break}return t.push(u),e.abrupt("continue",24);case 12:if(f=this.findRelatedPayload(u.uuid,g.a.DecryptedTransient)){e.next=18;break}if(u.deleted){e.next=16;break}throw"Unable to find decrypted counterpart for data conflict.";case 16:return t.push(u),e.abrupt("continue",24);case 18:return p=new P.a(this.baseCollection,l,f,g.a.ConflictData),e.next=21,p.resultingCollection();case 21:h=e.sent,y=h.all(),Object(c.j)(t,y);case 24:n=!0,e.next=6;break;case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(4),r=!0,i=e.t0;case 33:e.prev=33,e.prev=34,n||null==o.return||o.return();case 36:if(e.prev=36,!r){e.next=39;break}throw i;case 39:return e.finish(36);case 40:return e.finish(33);case 41:return e.abrupt("return",j.a.WithPayloads(t,g.a.RemoteRetrieved));case 42:case"end":return e.stop()}}),e,this,[[4,29,33,41],[34,,36,40]])}))),function(){return s.apply(this,arguments)})},{key:"collectionsByHandlingUuidConflicts",value:(o=I(a.a.mark((function e(){var t,n,r,i,o,s,u,l,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=!0,r=!1,i=void 0,e.prev=4,o=this.applyCollection.all()[Symbol.iterator]();case 6:if(n=(s=o.next()).done){e.next=16;break}return u=s.value,l=this.findRelatedPayload(u.uuid,g.a.DecryptedTransient),e.next=11,Object(C.b)(l,this.baseCollection);case 11:f=e.sent,Object(c.j)(t,f);case 13:n=!0,e.next=6;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(4),r=!0,i=e.t0;case 22:e.prev=22,e.prev=23,n||null==o.return||o.return();case 25:if(e.prev=25,!r){e.next=28;break}throw i;case 28:return e.finish(25);case 29:return e.finish(22);case 30:return e.abrupt("return",j.a.WithPayloads(t,g.a.RemoteRetrieved));case 31:case"end":return e.stop()}}),e,this,[[4,18,22,30],[23,,25,29]])}))),function(){return o.apply(this,arguments)})}])&&M(n.prototype,r),i&&M(n,i),t}(O.a);function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function N(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e,t){return!t||"object"!==F(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var H=function(e){function t(){return N(this,t),W(this,U(t).apply(this,arguments))}var n,r,i,o,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}(t,e),n=t,(r=[{key:"resultingCollection",value:(o=a.a.mark((function e(){var t,n,r,i,o,s,c,u,l,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=[],n=!0,r=!1,i=void 0,e.prev=4,o=this.applyCollection.all()[Symbol.iterator]();!(n=(s=o.next()).done);n=!0)c=s.value,u=this.findBasePayload(c.uuid),l=u?u.deleted:c.deleted,f=Object(m.f)(c,g.a.RemoteSaved,{lastSyncEnd:new Date,deleted:l}),t.push(f);e.next=12;break;case 8:e.prev=8,e.t0=e.catch(4),r=!0,i=e.t0;case 12:e.prev=12,e.prev=13,n||null==o.return||o.return();case 15:if(e.prev=15,!r){e.next=18;break}throw i;case 18:return e.finish(15);case 19:return e.finish(12);case 20:return e.abrupt("return",j.a.WithPayloads(t,g.a.RemoteSaved));case 21:case"end":return e.stop()}}),e,this,[[4,8,12,20],[13,,15,19]])})),s=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=o.apply(e,t);function i(e){L(a,n,r,i,s,"next",e)}function s(e){L(a,n,r,i,s,"throw",e)}i(void 0)}))},function(){return s.apply(this,arguments)})}])&&V(n.prototype,r),i&&V(n,i),t}(O.a);function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function J(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Q(e,t){return!t||"object"!==z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $(e){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Y(e,t){return(Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var X=function(e){function t(){return J(this,t),Q(this,$(t).apply(this,arguments))}var n,r,i,o,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(t,e),n=t,(r=[{key:"resultingCollection",value:(o=a.a.mark((function e(){var t,n,r,i,o,s,u,l,f,p,h,y,d,v,b,m,w,k,x,S;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=[],r=!0,i=!1,o=void 0,e.prev=5,s=this.applyCollection.all()[Symbol.iterator]();case 7:if(r=(u=s.next()).done){e.next=27;break}if(l=u.value,f=this.findRelatedPayload(l.uuid,g.a.SavedOrSaving),p=this.findRelatedPayload(l.uuid,g.a.DecryptedTransient)){e.next=16;break}if(l.deleted){e.next=14;break}throw"Cannot find decrypted for non-deleted payload.";case 14:return t.push(l),e.abrupt("continue",24);case 16:if(!f){e.next=19;break}return n.push(p),e.abrupt("continue",24);case 19:if(!(h=this.findBasePayload(l.uuid))||!h.dirty){e.next=23;break}return n.push(p),e.abrupt("continue",24);case 23:t.push(p);case 24:r=!0,e.next=7;break;case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(5),i=!0,o=e.t0;case 33:e.prev=33,e.prev=34,r||null==s.return||s.return();case 36:if(e.prev=36,!i){e.next=39;break}throw o;case 39:return e.finish(36);case 40:return e.finish(33);case 41:y=[],d=0,v=n;case 43:if(!(d<v.length)){e.next=60;break}if(b=v[d],m=this.findRelatedPayload(b.uuid,g.a.DecryptedTransient)){e.next=48;break}return e.abrupt("continue",57);case 48:if(w=this.findBasePayload(b.uuid)){e.next=51;break}return e.abrupt("continue",57);case 51:return k=new P.a(this.baseCollection,w,m,g.a.ConflictData),e.next=54,k.resultingCollection();case 54:x=e.sent,S=x.all(),Object(c.j)(y,S);case 57:d++,e.next=43;break;case 60:return e.abrupt("return",j.a.WithPayloads(t.concat(y),g.a.RemoteRetrieved));case 61:case"end":return e.stop()}}),e,this,[[5,29,33,41],[34,,36,40]])})),s=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=o.apply(e,t);function i(e){q(a,n,r,i,s,"next",e)}function s(e){q(a,n,r,i,s,"throw",e)}i(void 0)}))},function(){return s.apply(this,arguments)})}])&&G(n.prototype,r),i&&G(n,i),t}(O.a);function Z(e){return e===g.a.RemoteRetrieved?X:e===g.a.RemoteSaved?H:e===g.a.ConflictData||e===g.a.ConflictUuid?K:void 0}function ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var te=function(){function e(t){var n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a=void 0,(r="collections")in(n=this)?Object.defineProperty(n,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[r]=a,this.collections=t,Object.freeze(this)}var t,n,r;return t=e,(n=[{key:"collectionForSource",value:function(e){return this.collections.find((function(t){return t.source===e}))}}])&&ee(t.prototype,n),r&&ee(t,r),e}();function ne(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function re(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){ne(i,r,a,o,s,"next",e)}function s(e){ne(i,r,a,o,s,"throw",e)}o(void 0)}))}}function ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var oe,se=function(){function e(t,n,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ie(this,"response",void 0),ie(this,"baseCollection",void 0),ie(this,"relatedCollectionSet",void 0),this.response=t,this.baseCollection=r,this.relatedCollectionSet=new te([j.a.WithPayloads(n,g.a.DecryptedTransient),j.a.WithPayloads(a,g.a.SavedOrSaving)])}var t,n,r,i,o;return t=e,(n=[{key:"collectionsByProcessingResponse",value:(o=re(a.a.mark((function e(){var t,n,r,i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.collectionByProcessingPayloads(this.response.retrievedPayloads,g.a.RemoteRetrieved);case 3:return(n=e.sent).all().length>0&&t.push(n),e.next=7,this.collectionByProcessingPayloads(this.response.savedPayloads,g.a.RemoteSaved);case 7:if((r=e.sent).all().length>0&&t.push(r),!(this.response.uuidConflictPayloads.length>0)){e.next=14;break}return e.next=12,this.collectionByProcessingPayloads(this.response.uuidConflictPayloads,g.a.ConflictUuid);case 12:(i=e.sent).all().length>0&&t.push(i);case 14:if(!(this.response.dataConflictPayloads.length>0)){e.next=19;break}return e.next=17,this.collectionByProcessingPayloads(this.response.dataConflictPayloads,g.a.ConflictData);case 17:(o=e.sent).all().length>0&&t.push(o);case 19:return e.abrupt("return",t);case 20:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"collectionByProcessingPayloads",value:(i=re(a.a.mark((function e(t,n){var r,i,o,s,c,u=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=j.a.WithPayloads(t,n),i=Z(n),o=new i(this.baseCollection,r,this.relatedCollectionSet),e.next=5,o.resultingCollection();case 5:return s=e.sent,c=s.all().map((function(e){var t=u.finalDirtyStateForPayload(e);return Object(m.b)(e,{dirty:t,dirtiedDate:t?new Date:void 0})})),e.abrupt("return",j.a.WithPayloads(c,n));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"finalDirtyStateForPayload",value:function(e){var t=this.baseCollection.find(e.uuid);return t?e.dirtiedDate&&e.dirtiedDate>t.dirtiedDate?e.dirty:t.dirtiedDate>t.lastSyncBegan:e.dirty}}])&&ae(t.prototype,n),r&&ae(t,r),e}(),ce=n(35);function ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.ConflictingData="sync_conflict",e.UuidConflict="uuid_conflict"}(oe||(oe={}));var fe,pe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),le(this,"rawResponse",void 0),le(this,"savedPayloads",void 0),le(this,"retrievedPayloads",void 0),le(this,"uuidConflictPayloads",void 0),le(this,"dataConflictPayloads",void 0),le(this,"deletedPayloads",void 0),this.rawResponse=t,this.savedPayloads=this.filterRawItemArray(t.saved_items).map((function(e){return Object(m.f)(e,g.a.RemoteSaved)})),this.retrievedPayloads=this.filterRawItemArray(t.retrieved_items).map((function(e){return Object(m.f)(e,g.a.RemoteRetrieved)})),this.dataConflictPayloads=this.filterRawItemArray(this.rawDataConflictItems).map((function(e){return Object(m.f)(e,g.a.ConflictData)})),this.uuidConflictPayloads=this.filterRawItemArray(this.rawUuidConflictItems).map((function(e){return Object(m.f)(e,g.a.ConflictUuid)})),this.deletedPayloads=this.allProcessedPayloads.filter((function(e){return e.discardable})),Object(c.g)(this)}var t,n,r;return t=e,(n=[{key:"filterRawItemArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter((function(e){return!!e.uuid}))}},{key:"error",get:function(){return this.rawResponse.error}},{key:"status",get:function(){return this.rawResponse.status}},{key:"lastSyncToken",get:function(){return this.rawResponse[ce.a.LastSyncToken]}},{key:"paginationToken",get:function(){return this.rawResponse[ce.a.PaginationToken]}},{key:"integrityHash",get:function(){return this.rawResponse[ce.a.IntegrityResult]}},{key:"checkIntegrity",get:function(){return this.integrityHash&&!this.paginationToken}},{key:"numberOfItemsInvolved",get:function(){return this.allProcessedPayloads.length}},{key:"allProcessedPayloads",get:function(){return this.savedPayloads.concat(this.retrievedPayloads).concat(this.dataConflictPayloads).concat(this.uuidConflictPayloads)}},{key:"rawUuidConflictItems",get:function(){return this.rawConflictObjects.filter((function(e){return e.type===oe.UuidConflict})).map((function(e){return e.unsaved_item||e.item}))}},{key:"rawDataConflictItems",get:function(){return this.rawConflictObjects.filter((function(e){return e.type===oe.ConflictingData})).map((function(e){return e.server_item||e.item}))}},{key:"rawConflictObjects",get:function(){var e=this.rawResponse.conflicts||[],t=this.rawResponse.unsaved||[];return e.concat(t)}},{key:"hasError",get:function(){return!Object(c.p)(this.rawResponse.error)}}])&&ue(t.prototype,n),r&&ue(t,r),e}();function he(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function de(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Response=1]="Response",e[e.StatusChanged=2]="StatusChanged"}(fe||(fe={}));var ve=function(){function e(t,n,r,a,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),de(this,"payloads",void 0),de(this,"receiver",void 0),de(this,"lastSyncToken",void 0),de(this,"paginationToken",void 0),de(this,"checkIntegrity",void 0),de(this,"apiService",void 0),de(this,"pendingPayloads",void 0),de(this,"responses",[]),this.payloads=t,this.lastSyncToken=r,this.paginationToken=a,this.checkIntegrity=i,this.apiService=o,this.receiver=n,this.pendingPayloads=t}var t,n,r,i,o;return t=e,(n=[{key:"popPayloads",value:function(e){var t=this.pendingPayloads.slice(0,e);return Object(c.G)(this.pendingPayloads,t),t}},{key:"run",value:(i=a.a.mark((function e(){var t,n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.popPayloads(this.upLimit),e.next=3,this.apiService.sync(t,this.lastSyncToken,this.paginationToken,this.downLimit,this.checkIntegrity,void 0,void 0);case 3:return n=e.sent,r=new pe(n),this.responses.push(r),this.lastSyncToken=r.lastSyncToken,this.paginationToken=r.paginationToken,e.next=10,this.receiver(fe.Response,r);case 10:if(this.done){e.next=12;break}return e.abrupt("return",this.run());case 12:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){he(a,n,r,o,s,"next",e)}function s(e){he(a,n,r,o,s,"throw",e)}o(void 0)}))},function(){return o.apply(this,arguments)})},{key:"pendingUploadCount",value:function(){return this.pendingPayloads.length}},{key:"totalUploadCount",value:function(){return this.payloads.length}},{key:"payloadsSavedOrSaving",get:function(){return Object(c.c)(this.payloads,this.pendingPayloads)}},{key:"done",get:function(){return 0===this.pendingPayloads.length&&!this.paginationToken}},{key:"upLimit",get:function(){return 150}},{key:"downLimit",get:function(){return 150}},{key:"numberOfItemsInvolved",get:function(){var e=0,t=!0,n=!1,r=void 0;try{for(var a,i=this.responses[Symbol.iterator]();!(t=(a=i.next()).done);t=!0)e+=a.value.numberOfItemsInvolved}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return e}}])&&ye(t.prototype,n),r&&ye(t,r),e}();function be(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var we=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ge(this,"payloads",void 0),ge(this,"receiver",void 0),this.payloads=t,this.receiver=n}var t,n,r,i,o;return t=e,(n=[{key:"run",value:(i=a.a.mark((function e(){var t,n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.payloads.map((function(e){return Object(m.f)(e,g.a.LocalSaved,{dirty:!1,lastSyncEnd:new Date})})),n=Object(c.a)(t),r=new pe({saved_items:n}),e.next=5,this.receiver(fe.Response,r);case 5:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){be(a,n,r,o,s,"next",e)}function s(e){be(a,n,r,o,s,"throw",e)}o(void 0)}))},function(){return o.apply(this,arguments)})}])&&me(t.prototype,n),r&&me(t,r),e}();n(88);function ke(e){return(ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xe(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function Se(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pe(e,t){return!t||"object"!==ke(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function je(e){return(je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ce(e,t){return(Ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _e=function(e){function t(){return Se(this,t),Pe(this,je(t).apply(this,arguments))}var n,r,i,o,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ce(e,t)}(t,e),n=t,(r=[{key:"resultingCollection",value:(o=a.a.mark((function e(){var t,n,r,i,o,s,u,l,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=!0,r=!1,i=void 0,e.prev=4,o=this.applyCollection.all()[Symbol.iterator]();case 6:if(n=(s=o.next()).done){e.next=22;break}if(u=s.value,t.push(u),l=this.findBasePayload(u.uuid)){e.next=12;break}return e.abrupt("continue",19);case 12:if(!Object(C.a)(u,l)){e.next=15;break}return e.abrupt("continue",19);case 15:return e.next=17,Object(C.c)(l,this.baseCollection,!0);case 17:f=e.sent,Object(c.j)(t,f);case 19:n=!0,e.next=6;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(4),r=!0,i=e.t0;case 28:e.prev=28,e.prev=29,n||null==o.return||o.return();case 31:if(e.prev=31,!r){e.next=34;break}throw i;case 34:return e.finish(31);case 35:return e.finish(28);case 36:return e.abrupt("return",j.a.WithPayloads(t,g.a.RemoteRetrieved));case 37:case"end":return e.stop()}}),e,this,[[4,24,28,36],[29,,31,35]])})),s=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=o.apply(e,t);function i(e){xe(a,n,r,i,s,"next",e)}function s(e){xe(a,n,r,i,s,"throw",e)}i(void 0)}))},function(){return s.apply(this,arguments)})}])&&Oe(n.prototype,r),i&&Oe(n,i),t}(O.a),De=n(5),Ie=n(11),Ee=n(4),Me=n(19),Re=n(13);function Ae(e){return(Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ke(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function Fe(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){Ke(i,r,a,o,s,"next",e)}function s(e){Ke(i,r,a,o,s,"throw",e)}o(void 0)}))}}function Le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ve(e,t,n){return(Ve="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=We(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function We(e){return(We=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ue(e,t){return(Ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Be(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var He,ze,qe;!function(e){e[e.ResolveOnNext=1]="ResolveOnNext",e[e.ForceSpawnNew=2]="ForceSpawnNew"}(He||(He={})),function(e){e[e.Default=1]="Default",e[e.DownloadFirst=2]="DownloadFirst"}(ze||(ze={})),function(e){e[e.External=1]="External",e[e.SpawnQueue=2]="SpawnQueue",e[e.ResolveQueue=3]="ResolveQueue",e[e.MoreDirtyItems=4]="MoreDirtyItems",e[e.AfterDownloadFirst=5]="AfterDownloadFirst",e[e.IntegrityCheck=6]="IntegrityCheck",e[e.ResolveOutOfSync=7]="ResolveOutOfSync"}(qe||(qe={}));var Je=function(e){function t(e,n,r,a,i,o,s){var c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c=function(e,t){return!t||"object"!==Ae(t)&&"function"!=typeof t?Ne(e):t}(this,We(t).call(this)),Be(Ne(c),"sessionManager",void 0),Be(Ne(c),"protocolService",void 0),Be(Ne(c),"storageService",void 0),Be(Ne(c),"modelManager",void 0),Be(Ne(c),"itemManager",void 0),Be(Ne(c),"apiService",void 0),Be(Ne(c),"interval",void 0),Be(Ne(c),"state",void 0),Be(Ne(c),"opStatus",void 0),Be(Ne(c),"resolveQueue",[]),Be(Ne(c),"spawnQueue",[]),Be(Ne(c),"completedOnlineDownloadFirstSync",!1),Be(Ne(c),"majorChangeThreshold",15),Be(Ne(c),"maxDiscordance",5),Be(Ne(c),"locked",!1),Be(Ne(c),"databaseLoaded",!1),Be(Ne(c),"syncToken",void 0),Be(Ne(c),"cursorToken",void 0),Be(Ne(c),"syncLock",void 0),Be(Ne(c),"_simulate_latency",void 0),Be(Ne(c),"localLoadPriorty",[Ee.a.ItemsKey,Ee.a.UserPrefs,Ee.a.Privileges,Ee.a.Component,Ee.a.Theme]),Be(Ne(c),"nonEncryptedTypes",[Ee.a.Mfa,Ee.a.ServerExtension]),c.itemManager=e,c.sessionManager=n,c.protocolService=r,c.modelManager=i,c.storageService=a,c.apiService=o,c.interval=s,c.initializeStatus(),c.initializeState(),c}var n,r,u,f,p,y,d,v,w,k,x,O,P,_,D,I,E,M,R,A,T,K,F,L,N,V,W,U,B;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ue(e,t)}(t,e),n=t,(r=[{key:"onNewDatabaseCreated",value:(B=Fe(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLastSyncToken();case 2:if(!e.sent){e.next=5;break}return e.next=5,this.clearSyncPositionTokens();case 5:case"end":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:"deinit",value:function(){this.sessionManager=void 0,this.itemManager=void 0,this.protocolService=void 0,this.modelManager=void 0,this.storageService=void 0,this.apiService=void 0,this.interval=void 0,this.state.reset(),this.opStatus.reset(),this.state=void 0,this.opStatus=void 0,this.resolveQueue.length=0,this.spawnQueue.length=0,Ve(We(t.prototype),"deinit",this).call(this)}},{key:"initializeStatus",value:function(){var e=this;this.opStatus=new h(this.interval,(function(t){e.notifyEvent(t)}))}},{key:"initializeState",value:function(){var e=this;this.state=new b((function(t){t===i.a.EnterOutOfSync?e.notifyEvent(i.a.EnterOutOfSync):t===i.a.ExitOutOfSync&&e.notifyEvent(i.a.ExitOutOfSync)}),this.maxDiscordance)}},{key:"lockSyncing",value:function(){this.locked=!0}},{key:"unlockSyncing",value:function(){this.locked=!1}},{key:"isOutOfSync",value:function(){return this.state.isOutOfSync()}},{key:"getLastSyncDate",value:function(){return this.state.lastSyncDate}},{key:"getStatus",value:function(){return this.opStatus}},{key:"resetSyncState",value:function(){this.state.reset()}},{key:"isDatabaseLoaded",value:function(){return this.databaseLoaded}},{key:"getDatabasePayloads",value:(U=Fe(a.a.mark((function e(){var t=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageService.getAllRawPayloads().catch((function(e){throw t.notifyEvent(i.a.DatabaseReadError,e),e})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return U.apply(this,arguments)})},{key:"loadDatabasePayloads",value:(W=Fe(a.a.mark((function e(t){var n,r,o,s,u,f,p,h,y,d,v;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.databaseLoaded){e.next=2;break}throw"Attempting to initialize already initialized local database.";case 2:if(0!==t.length){e.next=6;break}return this.databaseLoaded=!0,this.opStatus.setDatabaseLoadStatus(0,0,!0),e.abrupt("return");case 6:return n=t.map((function(e){return Object(m.e)(e)})),r=Object(l.a)(n,this.localLoadPriorty),o=r.filter((function(e){return e.content_type===Ee.a.ItemsKey})),Object(c.G)(r,o),e.next=12,this.protocolService.payloadsByDecryptingPayloads(o);case 12:return s=e.sent,e.next=15,this.modelManager.emitPayloads(s,g.a.LocalRetrieved);case 15:u=r.length,f=100,p=Math.ceil(u/f),h=0;case 19:if(!(h<p)){e.next=32;break}return y=h*f,d=r.slice(y,y+f),e.next=24,this.protocolService.payloadsByDecryptingPayloads(d);case 24:return v=e.sent,e.next=27,this.modelManager.emitPayloads(v,g.a.LocalRetrieved);case 27:this.notifyEvent(i.a.LocalDataIncrementalLoad),this.opStatus.setDatabaseLoadStatus(y,u,!1);case 29:h++,e.next=19;break;case 32:this.databaseLoaded=!0,this.opStatus.setDatabaseLoadStatus(0,0,!0);case 34:case"end":return e.stop()}}),e,this)}))),function(e){return W.apply(this,arguments)})},{key:"setLastSyncToken",value:(V=Fe(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.syncToken=t,e.abrupt("return",this.storageService.setValue(o.b.LastSyncToken,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"setPaginationToken",value:(N=Fe(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cursorToken=t,!t){e.next=5;break}return e.abrupt("return",this.storageService.setValue(o.b.PaginationToken,t));case 5:return e.abrupt("return",this.storageService.removeValue(o.b.PaginationToken));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"getLastSyncToken",value:(L=Fe(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.syncToken){e.next=4;break}return e.next=3,this.storageService.getValue(o.b.LastSyncToken);case 3:this.syncToken=e.sent;case 4:return e.abrupt("return",this.syncToken);case 5:case"end":return e.stop()}}),e,this)}))),function(){return L.apply(this,arguments)})},{key:"getPaginationToken",value:(F=Fe(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cursorToken){e.next=4;break}return e.next=3,this.storageService.getValue(o.b.PaginationToken);case 3:this.cursorToken=e.sent;case 4:return e.abrupt("return",this.cursorToken);case 5:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"clearSyncPositionTokens",value:(K=Fe(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.syncToken=void 0,this.cursorToken=void 0,e.next=4,this.storageService.removeValue(o.b.LastSyncToken);case 4:return e.next=6,this.storageService.removeValue(o.b.PaginationToken);case 6:case"end":return e.stop()}}),e,this)}))),function(){return K.apply(this,arguments)})},{key:"itemsNeedingSync",value:(T=Fe(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.itemManager.getDirtyItems(),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"alternateUuidForItem",value:(A=Fe(a.a.mark((function e(t){var n,r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.itemManager.findItem(t),r=Object(m.e)(n),e.next=4,Object(C.b)(r,this.modelManager.getMasterCollection());case 4:return i=e.sent,e.next=7,this.modelManager.emitPayloads(i,g.a.LocalChanged);case 7:return e.next=9,this.persistPayloads(i);case 9:return e.abrupt("return",this.itemManager.findItem(i[0].uuid));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"markAllItemsAsNeedingSync",value:(R=Fe(a.a.mark((function e(t){var n,r,i,o,s,c,u,l,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log("Marking all items as needing sync"),!t){e.next=29;break}n=this.itemManager.items.filter((function(e){return!e.errorDecrypting})).slice(),r=!0,i=!1,o=void 0,e.prev=6,s=n[Symbol.iterator]();case 8:if(r=(c=s.next()).done){e.next=15;break}return u=c.value,e.next=12,this.alternateUuidForItem(u.uuid);case 12:r=!0,e.next=8;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(6),i=!0,o=e.t0;case 21:e.prev=21,e.prev=22,r||null==s.return||s.return();case 24:if(e.prev=24,!i){e.next=27;break}throw o;case 27:return e.finish(24);case 28:return e.finish(21);case 29:return l=this.itemManager.items,f=l.map((function(e){return Object(m.e)(e,{dirty:!0,dirtiedDate:new Date})})),e.next=33,this.modelManager.emitPayloads(f,g.a.LocalChanged);case 33:return e.next=35,this.persistPayloads(f);case 35:case"end":return e.stop()}}),e,this,[[6,17,21,29],[22,,24,28]])}))),function(e){return R.apply(this,arguments)})},{key:"popPayloadsNeedingPreSyncSave",value:(M=Fe(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.state.lastPreSyncSave){e.next=3;break}return e.abrupt("return",t);case 3:return r=t.filter((function(e){return!e.dirtiedDate||e.dirtiedDate>n})),this.state.lastPreSyncSave=new Date,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"queueStrategyResolveOnNext",value:function(){var e=this;return new Promise((function(t,n){e.resolveQueue.push({resolve:t,reject:n})}))}},{key:"queueStrategyForceSpawnNew",value:function(e){var t=this;return new Promise((function(n,r){t.spawnQueue.push({resolve:n,reject:r,options:e})}))}},{key:"popSpawnQueue",value:function(){if(0===this.spawnQueue.length)return null;var e=this.spawnQueue[0];return Object(c.C)(this.spawnQueue,0),this.log("Syncing again from spawn queue"),this.sync(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(n),!0).forEach((function(t){Be(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({queueStrategy:He.ForceSpawnNew,source:qe.SpawnQueue},e.options)).then((function(){e.resolve()})).catch((function(){e.reject()}))}},{key:"payloadsByPreparingForServer",value:(E=Fe(a.a.mark((function e(t){var n=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.protocolService.payloadsByEncryptingPayloads(t,(function(e){return n.nonEncryptedTypes.includes(e.content_type)?Ie.a.SyncDecrypted:Ie.a.Sync})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"sync",value:(I=Fe(a.a.mark((function e(){var t,n,r,o,u,l,f,p,h,y,d,v,b,m,w,k,x,S,O,P,j,C,_,D,I,E=this,M=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=M.length>0&&void 0!==M[0]?M[0]:{},!this.locked){e.next=4;break}return this.log("Sync Locked"),e.abrupt("return");case 4:return n=function(){return E.syncLock},r=function(){E.syncLock=!0},o=function(){E.syncLock=!1},u=this.opStatus.syncInProgress,l=this.databaseLoaded,(f=!n())&&l&&!u&&r(),t.source||(t.source=qe.External),e.next=14,this.itemsNeedingSync();case 14:return p=e.sent,h=p.filter((function(e){return e.neverSynced&&e.deleted})),Object(c.G)(p,h),y=p.map((function(e){return e.payloadRepresentation()})),e.next=20,this.popPayloadsNeedingPreSyncSave(y);case 20:return d=e.sent,e.next=23,this.persistPayloads(d);case 23:if(v=this.resolveQueue.slice(),b=Object(c.p)(t.queueStrategy)?He.ResolveOnNext:t.queueStrategy,!u&&l&&f){e.next=36;break}if(this.log(f?u?"Attempting to sync while existing sync in progress.":"Attempting to sync before local database has loaded.":"Another function call has begun preparing for sync."),b!==He.ResolveOnNext){e.next=31;break}return e.abrupt("return",this.queueStrategyResolveOnNext());case 31:if(b!==He.ForceSpawnNew){e.next=35;break}return e.abrupt("return",this.queueStrategyForceSpawnNew({mode:t.mode,checkIntegrity:t.checkIntegrity,source:t.source}));case 35:throw"Unhandled timing strategy ".concat(b);case 36:if(this.opStatus.setDidBegin(),this.notifyEvent(i.a.SyncWillBegin),Object(c.G)(this.resolveQueue,v),m=new Date,!(p.length>0)){e.next=43;break}return e.next=43,this.itemManager.changeItems(Object(Re.b)(p),(function(e){e.lastSyncBegan=m}),s.c.NonDirtying,g.a.PreSyncSave);case 43:if(w=this.sessionManager.online(),a=t.mode,k=w&&!E.completedOnlineDownloadFirstSync?ze.DownloadFirst:Object(c.p)(a)?ze.Default:a,x=[],k!==ze.Default){e.next=58;break}if(!w||this.completedOnlineDownloadFirstSync){e.next=49;break}throw"Attempting to default mode sync without having completed initial.";case 49:if(!w){e.next=55;break}return e.next=52,this.payloadsByPreparingForServer(y);case 52:x=e.sent,e.next=56;break;case 55:x=y;case 56:e.next=59;break;case 58:k===ze.DownloadFirst&&(x=[]);case 59:if(!w){e.next=65;break}return e.next=62,this.syncOnlineOperation(x,t.checkIntegrity,t.source,k);case 62:S=e.sent,e.next=68;break;case 65:return e.next=67,this.syncOfflineOperation(x,t.source,k);case 67:S=e.sent;case 68:return e.next=70,S.run();case 70:if(this.opStatus.setDidEnd(),o(),!this.opStatus.hasError()){e.next=74;break}return e.abrupt("return");case 74:if(this.opStatus.reset(),this.state.lastSyncDate=new Date,S instanceof ve&&S.numberOfItemsInvolved>=this.majorChangeThreshold&&this.notifyEvent(i.a.MajorDataChange),!(h.length>0)){e.next=80;break}return e.next=80,this.handleNeverSyncedDeleted(h);case 80:if(k===ze.DownloadFirst){e.next=83;break}return e.next=83,this.notifyEvent(i.a.FullSyncCompleted,{source:t.source});case 83:if(k!==ze.DownloadFirst){e.next=91;break}return w&&(this.completedOnlineDownloadFirstSync=!0),e.next=87,this.notifyEvent(i.a.DownloadFirstSyncCompleted);case 87:return e.next=89,this.sync({source:qe.AfterDownloadFirst,checkIntegrity:!0,awaitAll:t.awaitAll});case 89:e.next=117;break;case 91:if(this.popSpawnQueue()||!(this.resolveQueue.length>0)){e.next=99;break}if(this.log("Syncing again from resolve queue"),O=this.sync({source:qe.ResolveQueue,checkIntegrity:t.checkIntegrity}),!t.awaitAll){e.next=97;break}return e.next=97,O;case 97:e.next=117;break;case 99:return e.next=101,this.itemsNeedingSync();case 101:if(e.t0=e.sent.length,!(e.t0>0)){e.next=107;break}return e.next=105,this.sync({source:qe.MoreDirtyItems,checkIntegrity:t.checkIntegrity,awaitAll:t.awaitAll});case 105:e.next=117;break;case 107:if(!(S instanceof ve&&S.checkIntegrity)){e.next=116;break}if(!this.state.needsSync||!S.done){e.next=114;break}if(this.log("Syncing again from integrity check"),P=this.sync({checkIntegrity:!0,queueStrategy:He.ForceSpawnNew,source:qe.IntegrityCheck,awaitAll:t.awaitAll}),!t.awaitAll){e.next=114;break}return e.next=114,P;case 114:e.next=117;break;case 116:this.state.clearIntegrityHashes();case 117:for(j=!0,C=!1,_=void 0,e.prev=120,D=v[Symbol.iterator]();!(j=(I=D.next()).done);j=!0)I.value.resolve();e.next=128;break;case 124:e.prev=124,e.t1=e.catch(120),C=!0,_=e.t1;case 128:e.prev=128,e.prev=129,j||null==D.return||D.return();case 131:if(e.prev=131,!C){e.next=134;break}throw _;case 134:return e.finish(131);case 135:return e.finish(128);case 136:case"end":return e.stop()}var a}),e,this,[[120,124,128,136],[129,,131,135]])}))),function(){return I.apply(this,arguments)})},{key:"syncOnlineOperation",value:(D=Fe(a.a.mark((function e(t,n,r,i){var o,s=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("Syncing online user","source:",r,"integrity check",n,"mode:",i,"payloads:",t),e.t0=ve,e.t1=t,e.t2=function(){var e=Fe(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==fe.Response){e.next=10;break}if(!n.hasError){e.next=6;break}return e.next=4,s.handleErrorServerResponse(n);case 4:e.next=8;break;case 6:return e.next=8,s.handleSuccessServerResponse(o,n);case 8:e.next=13;break;case 10:if(t!==fe.StatusChanged){e.next=13;break}return e.next=13,s.handleStatusChange(o);case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.next=6,this.getLastSyncToken();case 6:return e.t3=e.sent,e.next=9,this.getPaginationToken();case 9:return e.t4=e.sent,e.t5=n,e.t6=this.apiService,o=new e.t0(e.t1,e.t2,e.t3,e.t4,e.t5,e.t6),e.abrupt("return",o);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return D.apply(this,arguments)})},{key:"syncOfflineOperation",value:(_=Fe(a.a.mark((function e(t,n,r){var i,o=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("Syncing offline user","source:",n,"mode:",r,"payloads:",t),i=new we(t,function(){var e=Fe(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==fe.Response){e.next=3;break}return e.next=3,o.handleOfflineResponse(n);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.abrupt("return",i);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return _.apply(this,arguments)})},{key:"handleStatusChange",value:(P=Fe(a.a.mark((function e(t){var n,r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.pendingUploadCount(),r=t.totalUploadCount(),i=r-n,this.opStatus.setUploadStatus(i,r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"handleOfflineResponse",value:(O=Fe(a.a.mark((function e(t){var n,r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log("Offline Sync Response",t.rawResponse),!((n=t.savedPayloads).length>0)){e.next=8;break}return e.next=5,this.modelManager.emitPayloads(n,g.a.LocalSaved);case 5:return r=this.modelManager.find(Object(Re.b)(n)),e.next=8,this.persistPayloads(r);case 8:if(!((o=t.deletedPayloads).length>0)){e.next=12;break}return e.next=12,this.deletePayloads(o);case 12:return this.opStatus.clearError(),this.opStatus.setDownloadStatus(t.retrievedPayloads.length),e.next=16,this.notifyEvent(i.a.SingleSyncCompleted,t);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"handleErrorServerResponse",value:(x=Fe(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.log("Sync Error",t),401===t.status&&this.notifyEvent(i.a.InvalidSession),this.opStatus.setError(t.error),this.notifyEvent(i.a.SyncError,t.error);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"handleSuccessServerResponse",value:(k=Fe(a.a.mark((function e(t,n){var r,o,s,u,l,f,p,h,y,d,v,b,m,g,w,k,x,S,O,P;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._simulate_latency){e.next=3;break}return e.next=3,Object(c.E)(this._simulate_latency.latency);case 3:this.log("Online Sync Response",n.rawResponse),this.setLastSyncToken(n.lastSyncToken),this.setPaginationToken(n.paginationToken),this.opStatus.clearError(),this.opStatus.setDownloadStatus(n.retrievedPayloads.length),r=[],o=!0,s=!1,u=void 0,e.prev=12,l=n.allProcessedPayloads[Symbol.iterator]();case 14:if(o=(f=l.next()).done){e.next=25;break}if(!(p=f.value).deleted&&p.fields.includes(De.a.Content)){e.next=18;break}return e.abrupt("continue",22);case 18:return e.next=20,this.protocolService.payloadByDecryptingPayload(p);case 20:h=e.sent,r.push(h);case 22:o=!0,e.next=14;break;case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(12),s=!0,u=e.t0;case 31:e.prev=31,e.prev=32,o||null==l.return||l.return();case 34:if(e.prev=34,!s){e.next=37;break}throw u;case 37:return e.finish(34);case 38:return e.finish(31);case 39:return y=this.modelManager.getMasterCollection(),d=new se(n,r,y,t.payloadsSavedOrSaving),e.next=43,d.collectionsByProcessingResponse();case 43:v=e.sent,b=!0,m=!1,g=void 0,e.prev=47,w=v[Symbol.iterator]();case 49:if(b=(k=w.next()).done){e.next=59;break}return x=k.value,e.next=53,this.modelManager.emitCollection(x);case 53:return S=this.modelManager.find(x.uuids()),e.next=56,this.persistPayloads(S);case 56:b=!0,e.next=49;break;case 59:e.next=65;break;case 61:e.prev=61,e.t1=e.catch(47),m=!0,g=e.t1;case 65:e.prev=65,e.prev=66,b||null==w.return||w.return();case 68:if(e.prev=68,!m){e.next=71;break}throw g;case 71:return e.finish(68);case 72:return e.finish(65);case 73:if(!((O=n.deletedPayloads).length>0)){e.next=77;break}return e.next=77,this.deletePayloads(O);case 77:return e.next=79,this.notifyEvent(i.a.SingleSyncCompleted,n);case 79:if(!n.checkIntegrity){e.next=85;break}return e.next=82,this.computeDataIntegrityHash();case 82:return P=e.sent,e.next=85,this.state.setIntegrityHashes(P,n.integrityHash);case 85:case"end":return e.stop()}}),e,this,[[12,27,31,39],[32,,34,38],[47,61,65,73],[66,,68,72]])}))),function(e,t){return k.apply(this,arguments)})},{key:"handleNeverSyncedDeleted",value:(w=Fe(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map((function(e){return e.payloadRepresentation({dirty:!1})})),e.next=3,this.modelManager.emitPayloads(n,g.a.LocalChanged);case 3:return e.next=5,this.persistPayloads(n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"persistPayloads",value:(v=Fe(a.a.mark((function e(t){var n=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",this.storageService.savePayloads(t).catch((function(e){throw n.notifyEvent(i.a.DatabaseWriteError,e),e})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"deletePayloads",value:(d=Fe(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.persistPayloads(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"computeDataIntegrityHash",value:(y=Fe(a.a.mark((function e(){var t,n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.itemManager.nonDeletedItems.sort((function(e,t){return t.updated_at.getTime()-e.updated_at.getTime()})),n=t.map((function(e){return e.updatedAtTimestamp()})),r=n.join(","),e.abrupt("return",this.protocolService.crypto.sha256(r));case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error computing data integrity hash",e.t0),e.abrupt("return",void 0);case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return y.apply(this,arguments)})},{key:"resolveOutOfSync",value:(p=Fe(a.a.mark((function e(){var t,n,r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new S(this.apiService,this.protocolService,void 0,"resolve-out-of-sync"),e.next=3,t.run();case 3:return n=e.sent,r=new _e(this.modelManager.getMasterCollection(),j.a.WithPayloads(n,g.a.RemoteRetrieved)),e.next=7,r.resultingCollection();case 7:return i=e.sent,e.next=10,this.modelManager.emitCollection(i);case 10:return e.next=12,this.persistPayloads(i.payloads);case 12:return e.abrupt("return",this.sync({checkIntegrity:!0,source:qe.ResolveOutOfSync}));case 13:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"statelessDownloadAllItems",value:(f=Fe(a.a.mark((function e(t,n){var r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new S(this.apiService,this.protocolService,t,n),e.next=3,r.run();case 3:return i=e.sent,e.abrupt("return",i.map((function(e){return Object(Me.a)(e)})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"ut_setDatabaseLoaded",value:function(e){this.databaseLoaded=e}},{key:"ut_clearLastSyncDate",value:function(){this.state.lastSyncDate=void 0}},{key:"ut_beginLatencySimulator",value:function(e){this._simulate_latency={latency:e||1e3,enabled:!0}}},{key:"ut_endLatencySimulator",value:function(){this._simulate_latency=null}}])&&Le(n.prototype,r),u&&Le(n,u),t}(u.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(1);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"directMap",{}),i(this,"inverseMap",{})}var t,n,o;return t=e,(n=[{key:"makeCopy",value:function(){var t=new e;return t.directMap=Object.assign({},this.directMap),t.inverseMap=Object.assign({},this.inverseMap),t}},{key:"getDirectRelationships",value:function(e){return this.directMap[e]||[]}},{key:"getInverseRelationships",value:function(e){return this.inverseMap[e]||[]}},{key:"establishRelationship",value:function(e,t){this.establishDirectRelationship(e,t),this.establishInverseRelationship(e,t)}},{key:"deestablishRelationship",value:function(e,t){this.deestablishDirectRelationship(e,t),this.deestablishInverseRelationship(e,t)}},{key:"setAllRelationships",value:function(e,t){var n=this.directMap[e]||[];this.directMap[e]=t;var r=!0,a=!1,i=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;this.deestablishInverseRelationship(e,c)}}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}var u=!0,l=!1,f=void 0;try{for(var p,h=t[Symbol.iterator]();!(u=(p=h.next()).done);u=!0){var y=p.value;this.establishInverseRelationship(e,y)}}catch(e){l=!0,f=e}finally{try{u||null==h.return||h.return()}finally{if(l)throw f}}}},{key:"removeFromMap",value:function(e){var t=this.directMap[e]||[],n=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var c=o.value;Object(r.B)(this.inverseMap[c]||[],e)}}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}delete this.directMap[e];var u=this.inverseMap[e]||[],l=!0,f=!1,p=void 0;try{for(var h,y=u[Symbol.iterator]();!(l=(h=y.next()).done);l=!0){var d=h.value;Object(r.B)(this.directMap[d]||[],e)}}catch(e){f=!0,p=e}finally{try{l||null==y.return||y.return()}finally{if(f)throw p}}delete this.inverseMap[e]}},{key:"establishDirectRelationship",value:function(e,t){var n=this.directMap[e]||[];Object(r.b)(n,t),this.directMap[e]=n}},{key:"establishInverseRelationship",value:function(e,t){var n=this.inverseMap[t]||[];Object(r.b)(n,e),this.inverseMap[t]=n}},{key:"deestablishDirectRelationship",value:function(e,t){var n=this.directMap[e]||[];Object(r.B)(n,t),this.directMap[e]=n}},{key:"deestablishInverseRelationship",value:function(e,t){var n=this.inverseMap[t]||[];Object(r.B)(n,e),this.inverseMap[t]=n}}])&&a(t.prototype,n),o&&a(t,o),e}(),s=n(42),c=n.n(s);function u(e){if(null==e)throw new TypeError("Cannot destructure undefined")}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;l(this,e),p(this,"map",{}),p(this,"typedMap",(u(t={}),t)),p(this,"dirtyIndex",new Set),p(this,"invalidsIndex",new Set),p(this,"nondeletedIndex",new Set),p(this,"referenceMap",void 0),p(this,"conflictMap",void 0),n?(this.map=r,this.typedMap=a,this.referenceMap=i,this.conflictMap=s):(this.referenceMap=new o,this.conflictMap=new o)}var t,n,a;return t=e,(n=[{key:"uuids",value:function(){return Object.keys(this.map)}},{key:"all",value:function(e){var t=this;if(e){if(Array.isArray(e)){var n=[],a=!0,i=!1,o=void 0;try{for(var s,c=e[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var u=s.value;Object(r.j)(n,this.typedMap[u]||[])}}catch(e){i=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}return n}var l;return(null===(l=this.typedMap[e])||void 0===l?void 0:l.slice())||[]}return Object.keys(this.map).map((function(e){return t.map[e]}))}},{key:"find",value:function(e){return this.map[e]}},{key:"dirtyElements",value:function(){var e=Array.from(this.dirtyIndex);return this.findAll(e)}},{key:"invalidElements",value:function(){var e=Array.from(this.invalidsIndex);return this.findAll(e)}},{key:"nondeletedElements",value:function(){var e=Array.from(this.nondeletedIndex);return this.findAll(e)}},{key:"findAll",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value,u=this.map[c];(u||t)&&n.push(u)}}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}},{key:"set",value:function(e){if(0!==(e=Array.isArray(e)?e:[e]).length){var t=!0,n=!1,r=void 0;try{for(var a,i=e[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;if(this.map[o.uuid]=o,this.setToTypedMap(o),o.dirty?this.dirtyIndex.add(o.uuid):this.dirtyIndex.delete(o.uuid),o.errorDecrypting||o.waitingForKey?this.invalidsIndex.add(o.uuid):this.invalidsIndex.delete(o.uuid),o.deleted)this.referenceMap.removeFromMap(o.uuid),this.nondeletedIndex.delete(o.uuid);else{this.nondeletedIndex.add(o.uuid);var s=o.safeContent.conflict_of;s&&this.conflictMap.establishRelationship(s,o.uuid),this.referenceMap.setAllRelationships(o.uuid,o.references.map((function(e){return e.uuid})))}}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}else console.warn("Attempting to set 0 elements onto collection")}},{key:"discard",value:function(e){e=Array.isArray(e)?e:[e];var t=!0,n=!1,r=void 0;try{for(var a,i=e[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;this.conflictMap.removeFromMap(o.uuid),this.referenceMap.removeFromMap(o.uuid),this.deleteFromTypedMap(o),delete this.map[o.uuid]}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"setToTypedMap",value:function(e){var t=this.typedMap[e.content_type]||[];c()(t,{uuid:e.uuid}),t.push(e),this.typedMap[e.content_type]=t}},{key:"deleteFromTypedMap",value:function(e){var t=this.typedMap[e.content_type]||[];c()(t,{uuid:e.uuid}),this.typedMap[e.content_type]=t}},{key:"uuidsThatReferenceUuid",value:function(e){if(!Object(r.s)(e))throw Error("Must use uuid string");return this.referenceMap.getInverseRelationships(e)}},{key:"elementsReferencingElement",value:function(e){var t=this.uuidsThatReferenceUuid(e.uuid);return this.findAll(t)}},{key:"conflictsOf",value:function(e){var t=this.conflictMap.getDirectRelationships(e);return this.findAll(t)}}])&&f(t.prototype,n),a&&f(t,a),e}()},function(e,t,n){var r=n(95),a=n(213);e.exports=function(e,t){var n=[];if(!e||!e.length)return n;var i=-1,o=[],s=e.length;for(t=r(t,3);++i<s;){var c=e[i];t(c,i,e)&&(n.push(c),o.push(i))}return a(e,o),n}},function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return y})),n.d(t,"b",(function(){return d}));var r,a=n(6),i=n(27);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function l(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(e){e.TagsPanelWidth="tagsPanelWidth",e.NotesPanelWidth="notesPanelWidth",e.EditorWidth="editorWidth",e.EditorLeft="editorLeft",e.EditorMonospaceEnabled="monospaceFont",e.EditorSpellcheck="spellcheck",e.EditorResizersEnabled="marginResizersEnabled",e.SortNotesBy="sortBy",e.SortNotesReverse="sortReverse",e.NotesShowArchived="showArchived",e.NotesHidePinned="hidePinned",e.NotesHideNotePreview="hideNotePreview",e.NotesHideDate="hideDate"}(r||(r={}));var y=function(e){function t(){return s(this,t),l(this,f(t).apply(this,arguments))}return p(t,e),u(t,[{key:"getPref",value:function(e){return this.getAppDomainValue(e)}},{key:"isSingleton",get:function(){return!0}},{key:"singletonPredicate",get:function(){return new i.a("content_type","=",this.content_type)}}]),t}(a.d),d=function(e){function t(){return s(this,t),l(this,f(t).apply(this,arguments))}return p(t,e),u(t,[{key:"setWebPref",value:function(e,t){this.setAppDataItem(e,t)}}]),t}(a.b)},function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(0),a=n.n(r),i=n(18),o=n(33),s=n(45),c=n(9);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){l(i,r,a,o,s,"next",e)}function s(e){l(i,r,a,o,s,"throw",e)}o(void 0)}))}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(e){function t(){return p(this,t),y(this,d(t).apply(this,arguments))}var n,r,s,u,l,b;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,e),n=t,(r=[{key:"computeRootKey",value:(b=f(a.a.mark((function e(t,n){var r,o,s,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.c.PbkdfCost,o=this.version,e.next=4,this.generateSalt(n.identifier,o,r,n.seed);case 4:return s=e.sent,e.next=7,this.deriveKey(t,s,r);case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"createRootKey",value:(l=f(a.a.mark((function e(t,n){var r,s,c,u,l,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.version,s=i.c.PbkdfCost,e.next=4,this.crypto.generateRandomKey(i.c.SaltSeedLength);case 4:return c=e.sent,e.next=7,this.generateSalt(t,r,s,c);case 7:return u=e.sent,e.next=10,this.deriveKey(n,u,s);case 10:return l=e.sent,f=Object(o.a)({identifier:t,pw_cost:s,pw_nonce:c,version:r}),e.abrupt("return",{key:l,keyParams:f});case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"generateSalt",value:(u=f(a.a.mark((function e(t,n,r,i){var o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.crypto.sha256([t,"SF",n,r,i].join(":"));case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return u.apply(this,arguments)})},{key:"version",get:function(){return c.a.V003}}])&&h(n.prototype,r),s&&h(n,s),t}(s.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return x}));var r=n(0),a=n.n(r),i=n(30),o=n(18),s=n(33),c=n(46),u=n(12),l=n(2),f=n(9),p=n(29);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){y(i,r,a,o,s,"next",e)}function s(e){y(i,r,a,o,s,"throw",e)}o(void 0)}))}}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e,t,n){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var x=function(e){function t(){return v(this,t),m(this,w(t).apply(this,arguments))}var n,r,c,h,y,x,S,O,P,j,C,_,D;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,e),n=t,(r=[{key:"generateNewItemsKeyContent",value:(D=d(a.a.mark((function e(){var t,n,r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.b.EncryptionKeyLength,e.next=3,this.crypto.generateRandomKey(t);case 3:return n=e.sent,e.next=6,this.crypto.generateRandomKey(t);case 6:return r=e.sent,i={itemsKey:n,dataAuthenticationKey:r,version:this.version},e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"createRootKey",value:(_=d(a.a.mark((function e(t,n){var r,i,c,u,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.b.PbkdfMinCost,e.next=3,this.crypto.generateRandomKey(o.b.SaltSeedLength);case 3:return i=e.sent,e.next=6,this.crypto.unsafeSha1(t+":"+i);case 6:return c=e.sent,e.next=9,this.deriveKey(n,c,r);case 9:return u=e.sent,l=Object(s.a)({email:t,pw_cost:r,pw_nonce:i,pw_salt:c,version:this.version}),e.abrupt("return",{key:u,keyParams:l});case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return _.apply(this,arguments)})},{key:"computeRootKey",value:(C=d(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deriveKey(t,n.salt,n.kdfIterations);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"decryptString002",value:(j=d(a.a.mark((function e(t,n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.crypto.aes256CbcDecrypt(t,r,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return j.apply(this,arguments)})},{key:"encryptString002",value:(P=d(a.a.mark((function e(t,n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.crypto.aes256CbcEncrypt(t,r,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return P.apply(this,arguments)})},{key:"encryptTextParams",value:(O=d(a.a.mark((function e(t,n,r,i,s){var c,u,l,f,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.crypto.generateRandomKey(o.b.EncryptionIvLength);case 2:return c=e.sent,e.next=5,this.encryptString002(t,n,c);case 5:return u=e.sent,l=[s,i,c,u].join(":"),e.next=9,this.crypto.hmac256(l,r);case 9:return f=e.sent,p=[s,f,i,c,u].join(":"),e.abrupt("return",p);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,a){return O.apply(this,arguments)})},{key:"decryptTextParams",value:(S=d(a.a.mark((function e(t,n,r,i,o,s){var c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw"Attempting to decryptTextParams with null encryptionKey";case 2:return e.next=4,this.crypto.hmac256(t,s);case 4:if(c=e.sent,!1!==this.crypto.timingSafeEqual(o,c)){e.next=8;break}return console.error("Auth hash does not match, returning null."),e.abrupt("return",null);case 8:return e.abrupt("return",this.decryptString002(n,r,i));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,a,i){return S.apply(this,arguments)})},{key:"generateEncryptedParameters",value:(x=d(a.a.mark((function e(n,r,s){var c,f,p,h,y;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r!==u.a.DecryptedBareObject&&r!==u.a.DecryptedBase64String){e.next=2;break}return e.abrupt("return",g(w(t.prototype),"generateEncryptedParameters",this).call(this,n,r,s));case 2:if(r===u.a.EncryptedString){e.next=4;break}throw"Unsupport format for generateEncryptedParameters ".concat(r);case 4:if(s&&s.itemsKey){e.next=6;break}throw"Attempting to generateEncryptedParameters with no itemsKey.";case 6:return e.next=8,this.crypto.generateRandomKey(2*o.b.EncryptionKeyLength);case 8:return c=e.sent,e.next=11,this.encryptTextParams(c,s.itemsKey,s.dataAuthenticationKey,n.uuid,s.version);case 11:return f=e.sent,e.next=14,this.firstHalfOfKey(c);case 14:return p=e.sent,e.next=17,this.secondHalfOfKey(c);case 17:return h=e.sent,e.next=20,this.encryptTextParams(JSON.stringify(n.content),p,h,n.uuid,s.version);case 20:return y=e.sent,e.abrupt("return",Object(l.c)({uuid:n.uuid,items_key_id:s instanceof i.b?s.uuid:void 0,content:y,enc_item_key:f}));case 22:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return x.apply(this,arguments)})},{key:"generateDecryptedParameters",value:(y=d(a.a.mark((function e(n,r){var i,o,s,c,f,p,h,y,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=n.format)!==u.a.DecryptedBareObject&&i!==u.a.DecryptedBase64String){e.next=3;break}return e.abrupt("return",g(w(t.prototype),"generateDecryptedParameters",this).call(this,n,r));case 3:if(n.enc_item_key){e.next=6;break}return console.error("Missing item encryption key, skipping decryption."),e.abrupt("return",n);case 6:if(r&&r.itemsKey){e.next=8;break}throw"Attempting to generateDecryptedParameters with no itemsKey.";case 8:return o=n.enc_item_key,s=this.encryptionComponentsFromString002(o,r.itemsKey,r.dataAuthenticationKey),e.next=12,this.decryptTextParams(s.ciphertextToAuth,s.contentCiphertext,s.encryptionKey,s.iv,s.authHash,s.authKey);case 12:if(c=e.sent){e.next=16;break}return console.error("Error decrypting item_key parameters",n),e.abrupt("return",Object(l.a)(n,{errorDecrypting:!0,errorDecryptingValueChanged:!n.errorDecrypting}));case 16:return e.next=18,this.firstHalfOfKey(c);case 18:return f=e.sent,e.next=21,this.secondHalfOfKey(c);case 21:return p=e.sent,h=this.encryptionComponentsFromString002(n.contentString,f,p),e.next=25,this.decryptTextParams(h.ciphertextToAuth,h.contentCiphertext,h.encryptionKey,h.iv,h.authHash,h.authKey);case 25:if(y=e.sent){e.next=30;break}return e.abrupt("return",Object(l.a)(n,{errorDecrypting:!0,errorDecryptingValueChanged:!n.errorDecrypting}));case 30:return e.prev=30,e.t0=JSON,e.next=34,this.crypto.base64Decode(h.authParams);case 34:e.t1=e.sent,d=e.t0.parse.call(e.t0,e.t1),e.next=40;break;case 38:e.prev=38,e.t2=e.catch(30);case 40:return e.abrupt("return",Object(l.a)(n,{content:JSON.parse(y),items_key_id:void 0,enc_item_key:void 0,auth_params:d,errorDecrypting:!1,errorDecryptingValueChanged:!0===n.errorDecrypting,waitingForKey:!1}));case 41:case"end":return e.stop()}}),e,this,[[30,38]])}))),function(e,t){return y.apply(this,arguments)})},{key:"deriveKey",value:(h=d(a.a.mark((function e(t,n,r){var i,s,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.crypto.pbkdf2(t,n,r,o.b.PbkdfOutputLength);case 2:return i=e.sent,e.next=5,this.splitKey(i,3);case 5:return s=e.sent,e.next=8,p.a.Create({serverPassword:s[0],masterKey:s[1],dataAuthenticationKey:s[2],version:this.version});case 8:return c=e.sent,e.abrupt("return",c);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return h.apply(this,arguments)})},{key:"encryptionComponentsFromString002",value:function(e,t,n){var r=e.split(":");return{encryptionVersion:r[0],authHash:r[1],uuid:r[2],iv:r[3],contentCiphertext:r[4],authParams:r[5],ciphertextToAuth:[r[0],r[2],r[3],r[4]].join(":"),encryptionKey:t,authKey:n}}},{key:"version",get:function(){return f.a.V002}}])&&b(n.prototype,r),c&&b(n,c),t}(c.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return I}));var r=n(0),a=n.n(r),i=n(30),o=n(13),s=n(20),c=n(19),u=n(12),l=n(2),f=n(9),p=n(17);function h(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function y(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){h(i,r,a,o,s,"next",e)}function s(e){h(i,r,a,o,s,"throw",e)}o(void 0)}))}}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var v=function(){function e(t){var n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a=void 0,(r="crypto")in(n=this)?Object.defineProperty(n,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[r]=a,this.crypto=t}var t,n,r,i,h,v,b,m;return t=e,(n=[{key:"firstHalfOfKey",value:(m=y(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.substring(0,t.length/2));case 1:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"secondHalfOfKey",value:(b=y(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.substring(t.length/2,t.length));case 1:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)})},{key:"splitKey",value:function(e,t){for(var n=e.length/t,r=[],a=0;a<t;a++){var i=e.slice(n*a,n*(a+1));r.push(i)}return r}},{key:"createItemsKey",value:(v=y(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.generateNewItemsKeyContent();case 2:return t=e.sent,e.t0=l.e,e.next=6,s.a.GenerateUuid();case 6:return e.t1=e.sent,e.t2=p.e.ItemsKey,e.t3=Object(o.a)(t),e.t4={uuid:e.t1,content_type:e.t2,content:e.t3},n=(0,e.t0)(e.t4),e.abrupt("return",Object(c.a)(n));case 12:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"generateEncryptedParameters",value:(h=y(a.a.mark((function e(t,n,r){var i,o,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n!==u.a.DecryptedBareObject){e.next=4;break}return e.abrupt("return",Object(l.c)({content:t.content}));case 4:if(n!==u.a.DecryptedBase64String){e.next=13;break}return i=JSON.stringify(t.content),e.next=8,this.crypto.base64Encode(i);case 8:return o=e.sent,s=f.a.V000Base64Decrypted+o,e.abrupt("return",Object(l.c)({content:s}));case 13:throw"Must override generateEncryptedParameters to handle format ".concat(n,".");case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return h.apply(this,arguments)})},{key:"generateDecryptedParameters",value:(i=y(a.a.mark((function e(t,n){var r,i,o,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.format)!==u.a.DecryptedBareObject){e.next=5;break}return e.abrupt("return",t);case 5:if(r!==u.a.DecryptedBase64String){e.next=20;break}return i=t.contentString.substring(f.a.VersionLength,t.contentString.length),e.prev=7,e.next=10,this.crypto.base64Decode(i);case 10:s=e.sent,o=JSON.parse(s),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),o=t.content;case 17:return e.abrupt("return",Object(l.a)(t,{content:o}));case 20:throw"Must override generateDecryptedParameters to handle format ".concat(r,".");case 21:case"end":return e.stop()}}),e,this,[[7,14]])}))),function(e,t){return i.apply(this,arguments)})}])&&d(t.prototype,n),r&&d(t,r),e}(),b=n(33),m=n(29),g=n(18);function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function x(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){k(i,r,a,o,s,"next",e)}function s(e){k(i,r,a,o,s,"throw",e)}o(void 0)}))}}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function j(e,t,n){return(j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=C(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var D="00000000000000000000000000000000",I=function(e){function t(){return S(this,t),P(this,C(t).apply(this,arguments))}var n,r,o,s,c,p,h,y,d,v,w;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,e),n=t,(r=[{key:"generateNewItemsKeyContent",value:(w=x(a.a.mark((function e(){var t,n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=g.a.EncryptionKeyLength,e.next=3,this.crypto.generateRandomKey(t);case 3:return n=e.sent,r={itemsKey:n,version:this.version},e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"createRootKey",value:(v=x(a.a.mark((function e(t,n){var r,i,o,s,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=g.a.PbkdfMinCost,e.next=3,this.crypto.generateRandomKey(g.a.SaltSeedLength);case 3:return i=e.sent,e.next=6,this.crypto.unsafeSha1(t+"SN"+i);case 6:return o=e.sent,e.next=9,this.deriveKey(n,o,r);case 9:return s=e.sent,c=Object(b.a)({email:t,pw_cost:r,pw_nonce:i,pw_salt:o,version:this.version}),e.abrupt("return",{key:s,keyParams:c});case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"computeRootKey",value:(d=x(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deriveKey(t,n.salt,n.kdfIterations);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"decryptString",value:(y=x(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.crypto.aes256CbcDecrypt(t,D,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"encryptString",value:(h=x(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.crypto.aes256CbcEncrypt(t,D,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"generateEncryptedParameters",value:(p=x(a.a.mark((function e(n,r,o){var s,c,f,p,h,y,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r!==u.a.DecryptedBareObject&&r!==u.a.DecryptedBase64String){e.next=2;break}return e.abrupt("return",j(C(t.prototype),"generateEncryptedParameters",this).call(this,n,r,o));case 2:if(r===u.a.EncryptedString){e.next=4;break}throw"Unsupport format for generateEncryptedParameters ".concat(r);case 4:if(o){e.next=6;break}throw"Attempting to generateEncryptedParameters with no itemsKey.";case 6:return e.next=8,this.crypto.generateRandomKey(2*g.a.EncryptionKeyLength);case 8:return s=e.sent,e.next=11,this.encryptString(s,o.itemsKey);case 11:return c=e.sent,e.next=14,this.firstHalfOfKey(s);case 14:return f=e.sent,e.next=17,this.secondHalfOfKey(s);case 17:return p=e.sent,e.next=20,this.encryptString(JSON.stringify(n.content),f);case 20:return h=e.sent,y=o.version+h,e.next=24,this.crypto.hmac256(y,p);case 24:return d=e.sent,e.abrupt("return",Object(l.c)({uuid:n.uuid,items_key_id:o instanceof i.b?o.uuid:void 0,content:y,enc_item_key:c,auth_hash:d}));case 26:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return p.apply(this,arguments)})},{key:"generateDecryptedParameters",value:(c=x(a.a.mark((function e(n,r){var i,o,s,c,f,p,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=n.format)!==u.a.DecryptedBareObject&&i!==u.a.DecryptedBase64String){e.next=3;break}return e.abrupt("return",j(C(t.prototype),"generateDecryptedParameters",this).call(this,n,r));case 3:if(n.enc_item_key){e.next=6;break}return console.error("Missing item encryption key, skipping decryption."),e.abrupt("return",n);case 6:return o=n.enc_item_key,o=this.version+o,s=this.encryptionComponentsFromString(o,r.itemsKey),e.next=11,this.decryptString(s.ciphertext,s.key);case 11:if(c=e.sent){e.next=15;break}return console.error("Error decrypting parameters",n),e.abrupt("return",Object(l.a)(n,{errorDecrypting:!0,errorDecryptingValueChanged:!n.errorDecrypting}));case 15:return e.next=17,this.firstHalfOfKey(c);case 17:return f=e.sent,p=this.encryptionComponentsFromString(n.contentString,f),e.next=21,this.decryptString(p.ciphertext,p.key);case 21:if(h=e.sent){e.next=26;break}return e.abrupt("return",Object(l.a)(n,{errorDecrypting:!0,errorDecryptingValueChanged:!n.errorDecrypting}));case 26:return e.abrupt("return",Object(l.a)(n,{content:JSON.parse(h),items_key_id:void 0,enc_item_key:void 0,errorDecrypting:!1,errorDecryptingValueChanged:!0===n.errorDecrypting,waitingForKey:!1}));case 27:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"encryptionComponentsFromString",value:function(e,t){var n=e.substring(0,f.a.VersionLength);return{ciphertext:e.substring(f.a.VersionLength,e.length),version:n,key:t}}},{key:"deriveKey",value:(s=x(a.a.mark((function e(t,n,r){var i,o,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.crypto.pbkdf2(t,n,r,g.a.PbkdfOutputLength);case 2:return i=e.sent,e.next=5,this.splitKey(i,2);case 5:return o=e.sent,e.next=8,m.a.Create({serverPassword:o[0],masterKey:o[1],version:this.version});case 8:return s=e.sent,e.abrupt("return",s);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return s.apply(this,arguments)})},{key:"version",get:function(){return f.a.V001}}])&&O(n.prototype,r),o&&O(n,o),t}(v)},function(e,t,n){"use strict";n.d(t,"a",(function(){return y})),n.d(t,"b",(function(){return d}));var r=n(6),a=n(4);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function u(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?f(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(e){function t(e){var n,r,a,i;return o(this,t),n=u(this,l(t).call(this,e)),r=f(n),i=void 0,(a="title")in r?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i,n.title=n.payload.safeContent.title,n}return p(t,e),c(t,[{key:"isSmartTag",value:function(){return this.content_type===a.a.SmartTag}},{key:"noteCount",get:function(){return this.payload.safeReferences.length}},{key:"isAllTag",get:function(){return this.payload.safeContent.isAllTag}},{key:"isTrashTag",get:function(){return this.payload.safeContent.isTrashTag}},{key:"isArchiveTag",get:function(){return this.payload.safeContent.isArchiveTag}}],[{key:"arrayToDisplayString",value:function(e){return e.sort((function(e,t){return e.title>t.title?1:-1})).map((function(e){return"#"+e.title})).join(" ")}}]),t}(r.d),d=function(e){function t(){return o(this,t),u(this,l(t).apply(this,arguments))}return p(t,e),c(t,[{key:"title",set:function(e){this.content.title=e}}]),t}(r.b)},function(e,t,n){"use strict";n.d(t,"b",(function(){return v})),n.d(t,"a",(function(){return b}));var r=n(12),a=n(1),i=n(6);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function l(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?p(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(e){function t(e){var n;return s(this,t),d(p(n=l(this,f(t).call(this,e))),"title",void 0),d(p(n),"text",""),d(p(n),"mobilePrefersPlainEditor",void 0),d(p(n),"hidePreview",!1),d(p(n),"preview_plain",void 0),d(p(n),"preview_html",void 0),d(p(n),"prefersPlainEditor",void 0),n.title=n.payload.safeContent.title,n.text=n.payload.safeContent.text,n.preview_plain=n.payload.safeContent.preview_plain,n.preview_html=n.payload.safeContent.preview_html,n.hidePreview=n.payload.safeContent.hidePreview,e.format===r.a.DecryptedBareObject&&(n.prefersPlainEditor=n.getAppDomainValue(i.a.PrefersPlainEditor)),Object(a.p)(n.payload.safeContent.mobilePrefersPlainEditor)||(n.mobilePrefersPlainEditor=n.payload.safeContent.mobilePrefersPlainEditor),n}return h(t,e),u(t,[{key:"safeText",value:function(){return this.text||""}},{key:"safeTitle",value:function(){return this.title||""}}]),t}(i.d),b=function(e){function t(){return s(this,t),l(this,f(t).apply(this,arguments))}return h(t,e),u(t,[{key:"typedContent",get:function(){return this.content}},{key:"title",set:function(e){this.typedContent.title=e}},{key:"text",set:function(e){this.typedContent.text=e}},{key:"hidePreview",set:function(e){this.typedContent.hidePreview=e}},{key:"preview_plain",set:function(e){this.typedContent.preview_plain=e}},{key:"preview_html",set:function(e){this.typedContent.preview_html=e}},{key:"prefersPlainEditor",set:function(e){this.setAppDataItem(i.a.PrefersPlainEditor,e)}}]),t}(i.b)},function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var r=n(0),a=n.n(r),i=n(2),o=n(19),s=n(23),c=n(26),u=n(31),l=n(1),f=n(5);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){b(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){y(i,r,a,o,s,"next",e)}function s(e){y(i,r,a,o,s,"throw",e)}o(void 0)}))}}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=function(){function e(t,n,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),b(this,"baseCollection",void 0),b(this,"basePayload",void 0),b(this,"applyPayload",void 0),b(this,"source",void 0),this.baseCollection=t,this.basePayload=n,this.applyPayload=r,this.source=a}var t,n,r,p,y;return t=e,(n=[{key:"resultingCollection",value:(y=d(a.a.mark((function e(){var t,n,r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(o.a)(this.basePayload),n=Object(o.a)(this.applyPayload),r=t.strategyWhenConflictingWithItem(n),e.next=5,this.payloadsByHandlingStrategy(r);case 5:return i=e.sent,e.abrupt("return",s.a.WithPayloads(i,this.source));case 7:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"payloadsByHandlingStrategy",value:(p=d(a.a.mark((function e(t){var n,r,o,s,p,y,d,v,b,m,g,w;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.baseCollection.conflictsOf(this.applyPayload.uuid)[0])||!Object(u.a)(n,this.applyPayload)){e.next=3;break}return e.abrupt("return",[]);case 3:if(t!==c.a.KeepLeft){e.next=7;break}return r=Object(l.n)(this.basePayload.updated_at,this.applyPayload.updated_at),o=Object(i.b)(this.basePayload,{updated_at:r,dirty:!0,dirtiedDate:new Date}),e.abrupt("return",[o]);case 7:if(t!==c.a.KeepRight){e.next=10;break}return s=Object(i.g)(this.applyPayload,this.basePayload,[f.a.LastSyncBegan],{lastSyncEnd:new Date}),e.abrupt("return",[s]);case 10:if(t!==c.a.KeepLeftDuplicateRight){e.next=17;break}return p=Object(l.n)(this.basePayload.updated_at,this.applyPayload.updated_at),y=Object(i.b)(this.basePayload,{updated_at:p,dirty:!0,dirtiedDate:new Date}),e.next=15,Object(u.c)(this.applyPayload,this.baseCollection,!0);case 15:return d=e.sent,e.abrupt("return",[y].concat(d));case 17:if(t!==c.a.DuplicateLeftKeepRight){e.next=23;break}return e.next=20,Object(u.c)(this.basePayload,this.baseCollection,!0);case 20:return v=e.sent,b=Object(i.g)(this.applyPayload,this.basePayload,[f.a.LastSyncBegan],{lastSyncEnd:new Date}),e.abrupt("return",v.concat([b]));case 23:if(t!==c.a.KeepLeftMergeRefs){e.next=28;break}return m=Object(l.J)(this.basePayload.contentObject.references,this.applyPayload.contentObject.references,["uuid","content_type"]),g=Object(l.n)(this.basePayload.updated_at,this.applyPayload.updated_at),w=Object(i.b)(this.basePayload,{updated_at:g,dirty:!0,dirtiedDate:new Date,content:h({},this.basePayload.safeContent,{references:m})}),e.abrupt("return",[w]);case 28:throw"Unhandled strategy";case 29:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})}])&&v(t.prototype,n),r&&v(t,r),e}()},function(e,t,n){var r=n(155),a=n(160);e.exports=function(e,t){var n=a(e,t);return r(n)?n:void 0}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){return null!=e&&"object"==n(e)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return d}));var r,a=n(0),i=n.n(a),o=n(16);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){c(i,r,a,o,s,"next",e)}function s(e){c(i,r,a,o,s,"throw",e)}o(void 0)}))}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(e){e.Get="get",e.Post="post",e.Patch="patch"}(r||(r={}));var d=function(e){function t(){return l(this,t),p(this,h(t).apply(this,arguments))}var n,a,o,s,c,d,v,b;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,e),n=t,(a=[{key:"getAbsolute",value:(b=u(i.a.mark((function e(t,n,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runHttp({url:t,params:n,verb:r.Get,authentication:a}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return b.apply(this,arguments)})},{key:"postAbsolute",value:(v=u(i.a.mark((function e(t,n,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runHttp({url:t,params:n,verb:r.Post,authentication:a}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return v.apply(this,arguments)})},{key:"patchAbsolute",value:(d=u(i.a.mark((function e(t,n,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runHttp({url:t,params:n,verb:r.Patch,authentication:a}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"runHttp",value:(c=u(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.createXmlRequest(t),e.abrupt("return",this.runRequest(n,t.verb,t.params));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"createXmlRequest",value:function(e){var t=new XMLHttpRequest;return e.params&&e.verb===r.Get&&Object.keys(e.params).length>0&&(e.url=this.urlForUrlAndParams(e.url,e.params)),t.open(e.verb,e.url,!0),t.setRequestHeader("Content-type","application/json"),e.authentication&&t.setRequestHeader("Authorization","Bearer "+e.authentication),t}},{key:"runRequest",value:(s=u(i.a.mark((function e(t,n,a){var o=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,i){t.onreadystatechange=function(){o.stateChangeHandlerForRequest(t,e,i)},n===r.Post||n===r.Patch?t.send(JSON.stringify(a)):t.send()})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,n){return s.apply(this,arguments)})},{key:"stateChangeHandlerForRequest",value:function(e,t,n){if(4===e.readyState){var r=e.status,a={status:r};try{var i=JSON.parse(e.responseText);Object.assign(a,i)}catch(e){}r>=200&&r<=299?t(a):(a.error||(a.error={status:r}),n(a))}}},{key:"urlForUrlAndParams",value:function(e,t){var n=Object.keys(t).map((function(e){return e+"="+encodeURIComponent(t[e])})).join("&");return e.includes("?")?e+"&"+n:e+"?"+n}},{key:"isErrorResponseExpiredToken",value:function(e){return 498===e.status}}])&&f(n.prototype,a),o&&f(n,o),t}(o.a)},function(e,t,n){"use strict";n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return v}));var r=n(6),a=n(60);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function u(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?f(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(e){function t(e){var n;return o(this,t),y(f(n=u(this,l(t).call(this,e))),"actions",[]),y(f(n),"description",void 0),y(f(n),"name",void 0),y(f(n),"url",void 0),y(f(n),"package_info",void 0),y(f(n),"supported_types",void 0),n.description=e.safeContent.description,n.url=e.safeContent.url,n.name=e.safeContent.name,n.package_info=e.safeContent.package_info,n.supported_types=e.safeContent.supported_types,e.safeContent.actions&&(n.actions=e.safeContent.actions.map((function(e){return new a.a(e)}))),n}return p(t,e),c(t,[{key:"actionsWithContextForItem",value:function(e){return this.actions.filter((function(t){return t.context===e.content_type||"Item"===t.context}))}}]),t}(r.d),v=function(e){function t(){return o(this,t),u(this,l(t).apply(this,arguments))}return p(t,e),c(t,[{key:"description",set:function(e){this.content.description=e}},{key:"supported_types",set:function(e){this.content.supported_types=e}},{key:"actions",set:function(e){this.content.actions=e}}]),t}(r.b)},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return o}));var o=function(){function e(t,n,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"accessToken",void 0),i(this,"expireAt",void 0),i(this,"refreshToken",void 0),i(this,"validUntil",void 0),this.accessToken=t,this.expireAt=n,this.refreshToken=r,this.validUntil=a}return a(e,null,[{key:"FromRaw",value:function(t){return new e(t.accessToken,t.expireAt,t.refreshToken,t.validUntil)}},{key:"FromResponse",value:function(t){var n,r,a;return new e(t.token,null===(n=t.session)||void 0===n?void 0:n.expire_at,null===(r=t.session)||void 0===r?void 0:r.refresh_token,null===(a=t.session)||void 0===a?void 0:a.valid_until)}}]),a(e,[{key:"getExpireAt",value:function(){return this.expireAt||0}},{key:"canExpire",value:function(){return this.getExpireAt()>0}},{key:"isExpired",value:function(){return!!this.canExpire()&&this.getExpireAt()<Date.now()}}]),e}()},function(e,t,n){var r=n(132);e.exports=function(e){return e&&e.length?r(e):[]}},function(e,t,n){var r=n(72),a=n(156),i=n(157),o=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?a(e):i(e)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return P}));var r,a,i,o=n(0),s=n.n(o),c=n(13),u=n(16),l=n(27),f=n(8),p=n(17),h=n(21);function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function v(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){d(i,r,a,o,s,"next",e)}function s(e){d(i,r,a,o,s,"throw",e)}o(void 0)}))}}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t,n){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.None=0]="None",e[e.FiveMinutes=300]="FiveMinutes",e[e.OneHour=3600]="OneHour",e[e.OneWeek=604800]="OneWeek"}(i||(i={}));var S=(x(r={},h.a.AccountPassword,{label:"Account Password",prompt:"Please enter your account password."}),x(r,h.a.LocalPasscode,{label:"Local Passcode",prompt:"Please enter your local passcode."}),r),O=(x(a={},h.c.ManageExtensions,{label:"Manage Extensions"}),x(a,h.c.ManageBackups,{label:"Download/Import Backups"}),x(a,h.c.ViewProtectedNotes,{label:"View Protected Notes"}),x(a,h.c.ManagePrivileges,{label:"Manage Privileges"}),x(a,h.c.ManagePasscode,{label:"Manage Passcode"}),x(a,h.c.DeleteNote,{label:"Delete Notes"}),a),P=function(e){function t(e,n,r,a,i,o){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s=function(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?m(e):t}(this,w(t).call(this)),x(m(s),"itemManager",void 0),x(m(s),"syncService",void 0),x(m(s),"singletonManager",void 0),x(m(s),"protocolService",void 0),x(m(s),"storageService",void 0),x(m(s),"sessionManager",void 0),x(m(s),"availableActions",[]),x(m(s),"availableCredentials",[]),s.itemManager=e,s.syncService=n,s.singletonManager=r,s.protocolService=a,s.storageService=i,s.sessionManager=o,s.loadDefaults(),s}var n,r,a,o,u,d,P,j,C,_,D,I,E;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,e),n=t,(r=[{key:"deinit",value:function(){this.itemManager=void 0,this.syncService=void 0,this.singletonManager=void 0,this.protocolService=void 0,this.storageService=void 0,this.sessionManager=void 0,g(w(t.prototype),"deinit",this).call(this)}},{key:"loadDefaults",value:function(){this.availableActions=Object.keys(h.c).map((function(e){return h.c[e]})),this.availableCredentials=[h.a.AccountPassword,h.a.LocalPasscode]}},{key:"getAvailableActions",value:function(){return this.availableActions}},{key:"getAvailableCredentials",value:function(){return this.availableCredentials}},{key:"netCredentialsForAction",value:(E=v(s.a.mark((function e(t){var n,r,a,i,o,c,u,l,f;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPrivileges();case 2:n=e.sent,r=n.getCredentialsForAction(t),a=[],i=!0,o=!1,c=void 0,e.prev=8,u=r[Symbol.iterator]();case 10:if(i=(l=u.next()).done){e.next=27;break}if((f=l.value)!==h.a.AccountPassword){e.next=19;break}return e.next=15,this.sessionManager.online();case 15:e.sent&&a.push(f),e.next=24;break;case 19:if(f!==h.a.LocalPasscode){e.next=24;break}return e.next=22,this.protocolService.hasRootKeyWrapper();case 22:e.sent&&a.push(f);case 24:i=!0,e.next=10;break;case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(8),o=!0,c=e.t0;case 33:e.prev=33,e.prev=34,i||null==u.return||u.return();case 36:if(e.prev=36,!o){e.next=39;break}throw c;case 39:return e.finish(36);case 40:return e.finish(33);case 41:return e.abrupt("return",a);case 42:case"end":return e.stop()}}),e,this,[[8,29,33,41],[34,,36,40]])}))),function(e){return E.apply(this,arguments)})},{key:"getPrivileges",value:(I=v(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.e.Privileges,n=new l.a("content_type","=",t),e.abrupt("return",this.singletonManager.findOrCreateSingleton(n,t,Object(c.a)({})));case 3:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"setSessionLength",value:(D=v(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t,a=void 0,(a=new Date).setSeconds(a.getSeconds()+r),n=a,e.next=4,this.storageService.setValue(f.b.PrivilegesExpirey,n);case 4:return e.next=6,this.storageService.setValue(f.b.PrivilegesSessionLength,t);case 6:case"end":return e.stop()}var r,a}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"clearSession",value:(_=v(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.setSessionLength(i.None));case 1:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"getSelectedSessionLength",value:(C=v(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.getValue(f.b.PrivilegesSessionLength);case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t);case 7:return e.abrupt("return",i.None);case 8:case"end":return e.stop()}}),e,this)}))),function(){return C.apply(this,arguments)})},{key:"getSessionExpirey",value:(j=v(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.getValue(f.b.PrivilegesExpirey);case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",new Date(t));case 7:return e.abrupt("return",new Date);case 8:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"actionHasPrivilegesConfigured",value:(P=v(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.netCredentialsForAction(t);case 2:return e.t0=e.sent.length,e.abrupt("return",e.t0>0);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"actionRequiresPrivilege",value:(d=v(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionExpirey();case 2:if(!(e.sent>new Date)){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,this.netCredentialsForAction(t);case 7:return n=e.sent,e.abrupt("return",n.length>0);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"authenticateAction",value:(u=v(s.a.mark((function e(t,n){var r,a,i,o,c,u,l,f,p;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.netCredentialsForAction(t);case 2:r=e.sent,a=[],i=[],o=!0,c=!1,u=void 0,e.prev=8,l=r[Symbol.iterator]();case 10:if(o=(f=l.next()).done){e.next=19;break}return p=f.value,e.next=14,this.verifyAuthenticationParameters(p,n[p]);case 14:e.sent?a.push(p):i.push(p);case 16:o=!0,e.next=10;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(8),c=!0,u=e.t0;case 25:e.prev=25,e.prev=26,o||null==l.return||l.return();case 28:if(e.prev=28,!c){e.next=31;break}throw u;case 31:return e.finish(28);case 32:return e.finish(25);case 33:return e.abrupt("return",{success:0===i.length,successfulCredentials:a,failedCredentials:i});case 34:case"end":return e.stop()}}),e,this,[[8,21,25,33],[26,,28,32]])}))),function(e,t){return u.apply(this,arguments)})},{key:"verifyAuthenticationParameters",value:(o=v(s.a.mark((function e(t,n){var r,a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==h.a.AccountPassword){e.next=8;break}return e.next=3,this.protocolService.validateAccountPassword(n);case 3:return r=e.sent,a=r.valid,e.abrupt("return",a);case 8:if(t!==h.a.LocalPasscode){e.next=14;break}return e.next=11,this.protocolService.validatePasscode(n);case 11:return i=e.sent,o=i.valid,e.abrupt("return",o);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"displayInfoForCredential",value:function(e){return S[e]}},{key:"displayInfoForAction",value:function(e){return O[e]}},{key:"getSessionLengthOptions",value:function(){return[{value:i.None,label:"Don't Remember"},{value:i.FiveMinutes,label:"5 Minutes"},{value:i.OneHour,label:"1 Hour"},{value:i.OneWeek,label:"1 Week"}]}}])&&b(n.prototype,r),a&&b(n,a),t}(u.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return F}));var r,a=n(0),i=n.n(a),o=n(13),s=n(11),c=n(9),u=n(33),l=n(59),f=n(44),p=n(45),h=n(46),y=n(12),d=n(3),v=n(2),b=n(24),m=n(19),g=n(29),w=n(16),k=n(20),x=n(1),S=n(18),O=n(4),P=n(8),j=n(14);function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function D(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){_(i,r,a,o,s,"next",e)}function s(e){_(i,r,a,o,s,"throw",e)}o(void 0)}))}}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e,t,n){return(M="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=R(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.RootKeyNone=0]="RootKeyNone",e[e.RootKeyOnly=1]="RootKeyOnly",e[e.RootKeyPlusWrapper=2]="RootKeyPlusWrapper",e[e.WrapperOnly=3]="WrapperOnly"}(r||(r={}));var K=c.a.V003,F=function(e){function t(e,n,a,i,o){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s=function(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?E(e):t}(this,R(t).call(this)),T(E(s),"itemManager",void 0),T(E(s),"modelManager",void 0),T(E(s),"storageService",void 0),T(E(s),"crypto",void 0),T(E(s),"operators",{}),T(E(s),"keyMode",r.RootKeyNone),T(E(s),"keyObservers",[]),T(E(s),"rootKey",void 0),T(E(s),"removeItemsObserver",void 0),s.itemManager=e,s.modelManager=n,s.deviceInterface=a,s.storageService=i,s.crypto=o,Object(x.r)()?k.a.SetGenerators(s.crypto.generateUUID,void 0):k.a.SetGenerators(s.crypto.generateUUID,s.crypto.generateUUIDSync),Object.defineProperty(E(s),"rootKey",{enumerable:!1,writable:!0}),s.removeItemsObserver=s.itemManager.addObserver([O.a.ItemsKey],(function(e,t){t.length>0&&s.decryptErroredItems()})),s}var n,a,w,_,F,L,N,V,W,U,B,H,z,q,J,G,Q,$,Y,X,Z,ee,te,ne,re,ae,ie,oe,se,ce,ue,le,fe,pe,he,ye,de,ve,be,me,ge,we,ke,xe,Se,Oe;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,e),n=t,(a=[{key:"deinit",value:function(){this.itemManager=void 0,this.modelManager=void 0,this.deviceInterface=void 0,this.storageService=void 0,this.crypto.deinit(),this.crypto=void 0,this.operators={},this.keyObservers.length=0,this.removeItemsObserver(),this.removeItemsObserver=null,this.rootKey=void 0,M(R(t.prototype),"deinit",this).call(this)}},{key:"initialize",value:(Oe=D(i.a.mark((function e(){var t,n,a,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWrappedRootKey();case 2:return t=e.sent,e.next=5,this.getAccountKeyParams();case 5:return n=e.sent,e.next=8,this.hasRootKeyWrapper();case 8:if(a=e.sent,o=!Object(x.p)(t)||!Object(x.p)(n),!a||!o){e.next=14;break}this.keyMode=r.RootKeyPlusWrapper,e.next=27;break;case 14:if(!a||o){e.next=18;break}this.keyMode=r.WrapperOnly,e.next=27;break;case 18:if(a||!o){e.next=22;break}this.keyMode=r.RootKeyOnly,e.next=27;break;case 22:if(a||o){e.next=26;break}this.keyMode=r.RootKeyNone,e.next=27;break;case 26:throw"Invalid key mode condition";case 27:if(this.keyMode!==r.RootKeyOnly){e.next=33;break}return e.next=30,this.getRootKeyFromKeychain();case 30:return this.rootKey=e.sent,e.next=33,this.notifyObserversOfKeyChange();case 33:case"end":return e.stop()}}),e,this)}))),function(){return Oe.apply(this,arguments)})},{key:"getLatestVersion",value:function(){return c.a.V004}},{key:"getUserVersion",value:(Se=D(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAccountKeyParams();case 2:return t=e.sent,e.abrupt("return",t&&t.version);case 4:case"end":return e.stop()}}),e,this)}))),function(){return Se.apply(this,arguments)})},{key:"upgradeAvailable",value:(xe=D(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountUpgradeAvailable();case 2:return t=e.sent,e.next=5,this.passcodeUpgradeAvailable();case 5:return n=e.sent,e.abrupt("return",t||n);case 7:case"end":return e.stop()}}),e,this)}))),function(){return xe.apply(this,arguments)})},{key:"accountUpgradeAvailable",value:(ke=D(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUserVersion();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return e.abrupt("return",t!==this.getLatestVersion());case 6:case"end":return e.stop()}}),e,this)}))),function(){return ke.apply(this,arguments)})},{key:"passcodeUpgradeAvailable",value:(we=D(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRootKeyWrapperKeyParams();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return e.abrupt("return",t.version!==this.getLatestVersion());case 6:case"end":return e.stop()}}),e,this)}))),function(){return we.apply(this,arguments)})},{key:"platformSupportsKeyDerivation",value:function(e){return Object(c.b)(e.version,c.a.V004)>=0||!!Object(x.t)()}},{key:"supportedVersions",value:function(){return[c.a.V001,c.a.V002,c.a.V003,c.a.V004]}},{key:"isVersionNewerThanLibraryVersion",value:function(e){var t=this.getLatestVersion();return 1===Object(c.b)(e,t)}},{key:"isProtocolVersionOutdated",value:function(e){var t,n=(T(t={},c.a.V001,Date.parse("2018-01-01")),T(t,c.a.V002,Date.parse("2020-01-01")),t)[e];return!!n&&(new Date).getTime()>n}},{key:"costMinimumForVersion",value:function(e){if(Object(c.b)(e,c.a.V003)>=0)throw"Cost minimums only apply to versions <= 002";if(e===c.a.V001)return S.a.PbkdfMinCost;if(e===c.a.V002)return S.b.PbkdfMinCost;throw"Invalid version for cost minimum: ".concat(e)}},{key:"createOperatorForLatestVersion",value:function(){return this.createOperatorForVersion(this.getLatestVersion())}},{key:"createOperatorForVersion",value:function(e){if(e===c.a.V001)return new h.a(this.crypto);if(e===c.a.V002)return new p.a(this.crypto);if(e===c.a.V003)return new f.a(this.crypto);if(e===c.a.V004)return new l.a(this.crypto);if(e===c.a.V000Base64Decrypted)return this.createOperatorForLatestVersion();throw"Unable to find operator for version ".concat(e)}},{key:"operatorForVersion",value:function(e){var t=e,n=this.operators[t];return n||(n=this.createOperatorForVersion(e),this.operators[t]=n),n}},{key:"defaultOperator",value:function(){return this.operatorForVersion(this.getLatestVersion())}},{key:"computeRootKey",value:(ge=D(i.a.mark((function e(t,n){var r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.version,a=this.operatorForVersion(r),e.abrupt("return",a.computeRootKey(t,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return ge.apply(this,arguments)})},{key:"createRootKey",value:(me=D(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.defaultOperator(),e.abrupt("return",r.createRootKey(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return me.apply(this,arguments)})},{key:"payloadContentFormatForIntent",value:function(e,t){if(t){if(e===s.a.Sync||e===s.a.FileEncrypted||e===s.a.FilePreferEncrypted||e===s.a.LocalStorageEncrypted||e===s.a.LocalStoragePreferEncrypted)return y.a.EncryptedString;throw"Unhandled encrypted case in protocolService.payloadContentFormatForIntent."}if(e===s.a.LocalStorageDecrypted||e===s.a.LocalStoragePreferEncrypted||e===s.a.FileDecrypted||e===s.a.FilePreferEncrypted)return y.a.DecryptedBareObject;if(e===s.a.SyncDecrypted)return y.a.DecryptedBase64String;throw"Unhandled decrypted case in protocolService.payloadContentFormatForIntent."}},{key:"payloadByEncryptingPayload",value:(be=D(i.a.mark((function e(t,n,r){var a,o,c,u,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.errorDecrypting){e.next=2;break}return e.abrupt("return",t);case 2:if(!t.deleted){e.next=4;break}return e.abrupt("return",t);case 4:if(!Object(x.p)(n)){e.next=6;break}throw"Attempting to encrypt payload with null intent";case 6:if(r||Object(s.c)(n)){e.next=10;break}return e.next=9,this.keyToUseForEncryptionOfPayload(t,n);case 9:r=e.sent;case 10:if(r||!Object(s.b)(n)){e.next=12;break}throw Error("Attempting to generate encrypted payload with no key.");case 12:if(t.format===y.a.DecryptedBareObject){e.next=14;break}throw"Attempting to encrypt already encrypted payload.";case 14:if(t.content){e.next=16;break}throw"Attempting to encrypt payload with no content.";case 16:if(t.uuid){e.next=18;break}throw"Attempting to encrypt payload with no uuid.";case 18:return a=r?r.version:this.getLatestVersion(),o=this.payloadContentFormatForIntent(n,r),c=this.operatorForVersion(a),e.next=23,c.generateEncryptedParameters(t,o,r);case 23:if(u=e.sent){e.next=26;break}throw"Unable to generate encryption parameters";case 26:return l=Object(v.d)(t,n,u),e.abrupt("return",l);case 28:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return be.apply(this,arguments)})},{key:"payloadsByEncryptingPayloads",value:(ve=D(i.a.mark((function e(t,n){var r,a,o,s,c,u,l,f,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=!0,o=!1,s=void 0,e.prev=4,c=t[Symbol.iterator]();case 6:if(a=(u=c.next()).done){e.next=16;break}return l=u.value,f=Object(x.o)(n)?n(l):n,e.next=11,this.payloadByEncryptingPayload(l,f);case 11:p=e.sent,r.push(p);case 13:a=!0,e.next=6;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(4),o=!0,s=e.t0;case 22:e.prev=22,e.prev=23,a||null==c.return||c.return();case 25:if(e.prev=25,!o){e.next=28;break}throw s;case 28:return e.finish(25);case 29:return e.finish(22);case 30:return e.abrupt("return",r);case 31:case"end":return e.stop()}}),e,this,[[4,18,22,30],[23,,25,29]])}))),function(e,t){return ve.apply(this,arguments)})},{key:"payloadByDecryptingPayload",value:(de=D(i.a.mark((function e(t,n){var r,a,o,s,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.content){e.next=2;break}throw"Attempting to decrypt payload that has no content.";case 2:if((r=t.format)!==y.a.DecryptedBareObject){e.next=5;break}return e.abrupt("return",t);case 5:if(n||r!==y.a.EncryptedString){e.next=11;break}return e.next=8,this.keyToUseForDecryptionOfPayload(t);case 8:if(n=e.sent){e.next=11;break}return e.abrupt("return",Object(v.e)(t,{waitingForKey:!0,errorDecrypting:!0}));case 11:return a=t.version,o=this.operatorForVersion(a),s=Object(v.c)(t),e.next=16,o.generateDecryptedParameters(s,n);case 16:return c=e.sent,e.abrupt("return",Object(v.e)(t,c));case 18:case"end":return e.stop()}}),e,this)}))),function(e,t){return de.apply(this,arguments)})},{key:"payloadsByDecryptingPayloads",value:(ye=D(i.a.mark((function e(t,n){var r,a,o,s,c,u,l,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=!0,o=!1,s=void 0,e.prev=4,c=t[Symbol.iterator]();case 6:if(a=(u=c.next()).done){e.next=32;break}if(l=u.value){e.next=11;break}return r.push(l),e.abrupt("continue",29);case 11:if(!0!==l.deleted||!Object(x.p)(l.content)){e.next=14;break}return r.push(l),e.abrupt("continue",29);case 14:if(Object(x.s)(l.content)){e.next=18;break}return r.push(l),e.abrupt("continue",29);case 18:return e.prev=18,e.next=21,this.payloadByDecryptingPayload(l,n);case 21:f=e.sent,r.push(f),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(18),r.push(Object(v.e)(l,{errorDecrypting:!0,errorDecryptingValueChanged:!l.errorDecrypting})),console.error("Error decrypting payload",l,e.t0);case 29:a=!0,e.next=6;break;case 32:e.next=38;break;case 34:e.prev=34,e.t1=e.catch(4),o=!0,s=e.t1;case 38:e.prev=38,e.prev=39,a||null==c.return||c.return();case 41:if(e.prev=41,!o){e.next=44;break}throw s;case 44:return e.finish(41);case 45:return e.finish(38);case 46:return e.abrupt("return",r);case 47:case"end":return e.stop()}}),e,this,[[4,34,38,46],[18,25],[39,,41,45]])}))),function(e,t){return ye.apply(this,arguments)})},{key:"decryptErroredItems",value:(he=D(i.a.mark((function e(){var t,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=this.itemManager.invalidItems).length){e.next=3;break}return e.abrupt("return");case 3:return n=t.map((function(e){return e.payloadRepresentation()})),e.next=6,this.payloadsByDecryptingPayloads(n);case 6:return r=e.sent,e.next=9,this.modelManager.emitPayloads(r,d.a.LocalChanged);case 9:case"end":return e.stop()}}),e,this)}))),function(){return he.apply(this,arguments)})},{key:"payloadsByDecryptingBackupFile",value:(pe=D(i.a.mark((function e(t,n){var r,a,o,s,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.keyParams||t.auth_params,a=t.items,o=a.map((function(e){return Object(v.f)(e,d.a.FileImport)})),!r){e.next=12;break}return e.next=6,this.computeRootKey(n,r);case 6:return c=e.sent,e.next=9,this.payloadsByDecryptingPayloads(o,c);case 9:s=e.sent,e.next=13;break;case 12:s=o;case 13:return e.abrupt("return",s);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return pe.apply(this,arguments)})},{key:"createKeyParams",value:function(e){return e.version||(e.version=c.a.V002),Object(u.a)(e)}},{key:"createBackupFile",value:(fe=D(i.a.mark((function e(t){var n,r,a,o,c,u,l,f,p,h,y,b,m,g,w,k=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=k.length>1&&void 0!==k[1]?k[1]:s.a.FilePreferEncrypted,r=k.length>2&&void 0!==k[2]&&k[2],a=t||this.itemManager.items,!r||0!==a.length){e.next=5;break}return e.abrupt("return",void 0);case 5:o=[],c=!0,u=!1,l=void 0,e.prev=9,f=a[Symbol.iterator]();case 11:if(c=(p=f.next()).done){e.next=25;break}if(!(h=p.value).errorDecrypting){e.next=17;break}o.push(h.payload),e.next=22;break;case 17:return y=Object(v.f)(h.payload,d.a.FileImport),e.next=20,this.payloadByEncryptingPayload(y,n);case 20:b=e.sent,o.push(b);case 22:c=!0,e.next=11;break;case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(9),u=!0,l=e.t0;case 31:e.prev=31,e.prev=32,c||null==f.return||f.return();case 34:if(e.prev=34,!u){e.next=37;break}throw l;case 37:return e.finish(34);case 38:return e.finish(31);case 39:return m={items:o.map((function(e){return e.ejected()}))},e.next=42,this.getRootKeyParams();case 42:return(g=e.sent)&&n!==s.a.FileDecrypted&&(m.keyParams=g.getPortableValue()),w=2,e.abrupt("return",JSON.stringify(m,null,w));case 46:case"end":return e.stop()}}),e,this,[[9,27,31,39],[32,,34,38]])}))),function(e){return fe.apply(this,arguments)})},{key:"onKeyStatusChange",value:function(e){var t=this;return this.keyObservers.push(e),function(){Object(x.B)(t.keyObservers,e)}}},{key:"notifyObserversOfKeyChange",value:(le=D(i.a.mark((function e(){var t,n,r,a,o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,r=void 0,e.prev=3,a=this.keyObservers[Symbol.iterator]();case 5:if(t=(o=a.next()).done){e.next=12;break}return s=o.value,e.next=9,s();case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,r=e.t0;case 18:e.prev=18,e.prev=19,t||null==a.return||a.return();case 21:if(e.prev=21,!n){e.next=24;break}throw r;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))),function(){return le.apply(this,arguments)})},{key:"getRootKeyFromKeychain",value:(ue=D(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deviceInterface.getKeychainValue();case 2:if(t=e.sent,!Object(x.p)(t)){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.next=7,g.a.Create(t);case 7:return n=e.sent,e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)}))),function(){return ue.apply(this,arguments)})},{key:"saveRootKeyToKeychain",value:(ce=D(i.a.mark((function e(){var t,n=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(x.p)(this.rootKey)){e.next=2;break}throw"Attempting to non-existent root key to the keychain.";case 2:if(this.keyMode===r.RootKeyOnly){e.next=4;break}throw"Should not be persisting wrapped key to keychain.";case 4:return t=this.rootKey.getPersistableValue(),e.abrupt("return",this.executeCriticalFunction((function(){return n.deviceInterface.setKeychainValue(t)})));case 6:case"end":return e.stop()}}),e,this)}))),function(){return ce.apply(this,arguments)})},{key:"hasRootKeyWrapper",value:(se=D(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRootKeyWrapperKeyParams();case 2:return t=e.sent,e.abrupt("return",!Object(x.p)(t));case 4:case"end":return e.stop()}}),e,this)}))),function(){return se.apply(this,arguments)})},{key:"hasPasscode",value:function(){return this.keyMode===r.WrapperOnly||this.keyMode===r.RootKeyPlusWrapper}},{key:"rootKeyNeedsUnwrapping",value:(oe=D(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.hasRootKeyWrapper();case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}e.t0=Object(x.p)(this.rootKey);case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}}),e,this)}))),function(){return oe.apply(this,arguments)})},{key:"getRootKeyWrapperKeyParams",value:(ie=D(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.getValue(P.b.RootKeyWrapperKeyParams,j.d.Nonwrapped);case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",this.createKeyParams(t));case 6:case"end":return e.stop()}}),e,this)}))),function(){return ie.apply(this,arguments)})},{key:"getWrappedRootKey",value:(ae=D(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageService.getValue(P.b.WrappedRootKey,j.d.Nonwrapped));case 1:case"end":return e.stop()}}),e,this)}))),function(){return ae.apply(this,arguments)})},{key:"getRootKeyParams",value:(re=D(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.keyMode!==r.WrapperOnly){e.next=4;break}return e.abrupt("return",this.getRootKeyWrapperKeyParams());case 4:if(this.keyMode!==r.RootKeyOnly&&this.keyMode!==r.RootKeyPlusWrapper){e.next=8;break}return e.abrupt("return",this.getAccountKeyParams());case 8:if(this.keyMode!==r.RootKeyNone){e.next=12;break}return e.abrupt("return",void 0);case 12:throw"Unhandled key mode for getRootKeyParams ".concat(this.keyMode);case 13:case"end":return e.stop()}}),e,this)}))),function(){return re.apply(this,arguments)})},{key:"getAccountKeyParams",value:(ne=D(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.getValue(P.b.RootKeyParams,j.d.Nonwrapped);case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",this.createKeyParams(t));case 6:case"end":return e.stop()}}),e,this)}))),function(){return ne.apply(this,arguments)})},{key:"validateWrappingKey",value:(te=D(i.a.mark((function e(t){var n,a,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWrappedRootKey();case 2:if(n=e.sent,this.keyMode!==r.WrapperOnly){e.next=7;break}return e.abrupt("return",this.storageService.canDecryptWithKey(t));case 7:if(this.keyMode!==r.RootKeyOnly&&this.keyMode!==r.RootKeyPlusWrapper){e.next=15;break}return a=Object(v.e)(n),e.next=11,this.payloadByDecryptingPayload(a,t);case 11:return o=e.sent,e.abrupt("return",!o.errorDecrypting);case 15:throw"Unhandled case in validateWrappingKey";case 16:case"end":return e.stop()}}),e,this)}))),function(e){return te.apply(this,arguments)})},{key:"computeWrappingKey",value:(ee=D(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRootKeyWrapperKeyParams();case 2:return n=e.sent,e.next=5,this.computeRootKey(t,n);case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return ee.apply(this,arguments)})},{key:"unwrapRootKey",value:(Z=D(i.a.mark((function e(t){var n,a,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.keyMode!==r.WrapperOnly){e.next=3;break}return this.rootKey=t,e.abrupt("return");case 3:if(this.keyMode===r.RootKeyPlusWrapper){e.next=5;break}throw"Invalid key mode condition for unwrapping.";case 5:return e.next=7,this.getWrappedRootKey();case 7:return n=e.sent,a=Object(v.e)(n),e.next=11,this.payloadByDecryptingPayload(a,t);case 11:if(!(o=e.sent).errorDecrypting){e.next=16;break}throw Error("Unable to decrypt root key with provided wrapping key.");case 16:return e.next=18,g.a.Create(o.contentObject,o.uuid);case 18:return this.rootKey=e.sent,e.next=21,this.notifyObserversOfKeyChange();case 21:case"end":return e.stop()}}),e,this)}))),function(e){return Z.apply(this,arguments)})},{key:"setNewRootKeyWrapper",value:(X=D(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.keyMode!==r.RootKeyNone){e.next=4;break}this.keyMode=r.WrapperOnly,e.next=9;break;case 4:if(this.keyMode!==r.RootKeyOnly){e.next=8;break}this.keyMode=r.RootKeyPlusWrapper,e.next=9;break;case 8:throw Error("Attempting to set wrapper on already wrapped key.");case 9:return e.next=11,this.deviceInterface.clearKeychainValue();case 11:if(this.keyMode!==r.WrapperOnly&&this.keyMode!==r.RootKeyPlusWrapper){e.next=26;break}if(this.keyMode!==r.WrapperOnly){e.next=18;break}return this.rootKey=t,e.next=16,this.reencryptItemsKeys();case 16:e.next=20;break;case 18:return e.next=20,this.wrapAndPersistRootKey(t);case 20:return e.next=22,this.storageService.setValue(P.b.RootKeyWrapperKeyParams,n.getPortableValue(),j.d.Nonwrapped);case 22:return e.next=24,this.notifyObserversOfKeyChange();case 24:e.next=27;break;case 26:throw Error("Invalid keyMode on setNewRootKeyWrapper");case 27:case"end":return e.stop()}}),e,this)}))),function(e,t){return X.apply(this,arguments)})},{key:"wrapAndPersistRootKey",value:(Y=D(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(v.e)(this.rootKey,{content:this.rootKey.getPersistableValue()}),e.next=3,this.payloadByEncryptingPayload(n,s.a.LocalStorageEncrypted,t);case 3:return r=e.sent,e.next=6,this.storageService.setValue(P.b.WrappedRootKey,r.ejected(),j.d.Nonwrapped);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return Y.apply(this,arguments)})},{key:"removeRootKeyWrapper",value:($=D(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.keyMode===r.WrapperOnly||this.keyMode===r.RootKeyPlusWrapper){e.next=2;break}throw"Attempting to remove root key wrapper on unwrapped key.";case 2:return this.keyMode===r.WrapperOnly?(this.keyMode=r.RootKeyNone,this.rootKey=void 0):this.keyMode===r.RootKeyPlusWrapper&&(this.keyMode=r.RootKeyOnly),e.next=5,this.storageService.removeValue(P.b.WrappedRootKey,j.d.Nonwrapped);case 5:return e.next=7,this.storageService.removeValue(P.b.RootKeyWrapperKeyParams,j.d.Nonwrapped);case 7:if(this.keyMode!==r.RootKeyOnly){e.next=10;break}return e.next=10,this.saveRootKeyToKeychain();case 10:return e.next=12,this.notifyObserversOfKeyChange();case 12:case"end":return e.stop()}}),e,this)}))),function(){return $.apply(this,arguments)})},{key:"setNewRootKey",value:(Q=D(i.a.mark((function e(t,n,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw Error("keyParams must be supplied if setting root key.");case 2:if(this.rootKey!==t){e.next=4;break}throw Error("Attempting to set root key as same current value.");case 4:if(this.keyMode!==r.WrapperOnly){e.next=8;break}this.keyMode=r.RootKeyPlusWrapper,e.next=16;break;case 8:if(this.keyMode!==r.RootKeyNone){e.next=12;break}this.keyMode=r.RootKeyOnly,e.next=16;break;case 12:if(this.keyMode!==r.RootKeyOnly&&this.keyMode!==r.RootKeyPlusWrapper){e.next=15;break}e.next=16;break;case 15:throw Error("Unhandled key mode for setNewRootKey ".concat(this.keyMode));case 16:return this.rootKey=t,e.next=19,this.storageService.setValue(P.b.RootKeyParams,n.getPortableValue(),j.d.Nonwrapped);case 19:if(this.keyMode!==r.RootKeyOnly){e.next=24;break}return e.next=22,this.saveRootKeyToKeychain();case 22:e.next=29;break;case 24:if(this.keyMode!==r.RootKeyPlusWrapper){e.next=29;break}if(a){e.next=27;break}throw Error("wrappingKey must be supplied");case 27:return e.next=29,this.wrapAndPersistRootKey(a);case 29:return e.next=31,this.notifyObserversOfKeyChange();case 31:return e.next=33,this.reencryptItemsKeys();case 33:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return Q.apply(this,arguments)})},{key:"getRootKey",value:(G=D(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rootKey);case 1:case"end":return e.stop()}}),e,this)}))),function(){return G.apply(this,arguments)})},{key:"clearLocalKeyState",value:(J=D(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deviceInterface.clearKeychainValue();case 2:return e.next=4,this.storageService.removeValue(P.b.WrappedRootKey,j.d.Nonwrapped);case 4:return e.next=6,this.storageService.removeValue(P.b.RootKeyWrapperKeyParams,j.d.Nonwrapped);case 6:return e.next=8,this.storageService.removeValue(P.b.RootKeyParams,j.d.Nonwrapped);case 8:return this.keyMode=r.RootKeyNone,this.rootKey=void 0,e.next=12,this.notifyObserversOfKeyChange();case 12:case"end":return e.stop()}}),e,this)}))),function(){return J.apply(this,arguments)})},{key:"validateAccountPassword",value:(q=D(i.a.mark((function e(t){var n,r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRootKeyParams();case 2:return n=e.sent,e.next=5,this.computeRootKey(t,n);case 5:if(r=e.sent,!(a=r.compare(this.rootKey))){e.next=11;break}return e.abrupt("return",{valid:a,artifacts:{rootKey:r}});case 11:return e.abrupt("return",{valid:!1});case 12:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"validatePasscode",value:(z=D(i.a.mark((function e(t){var n,r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRootKeyWrapperKeyParams();case 2:return n=e.sent,e.next=5,this.computeRootKey(t,n);case 5:return r=e.sent,e.next=8,this.validateWrappingKey(r);case 8:if(!(a=e.sent)){e.next=13;break}return e.abrupt("return",{valid:a,artifacts:{wrappingKey:r}});case 13:return e.abrupt("return",{valid:!1});case 14:case"end":return e.stop()}}),e,this)}))),function(e){return z.apply(this,arguments)})},{key:"contentTypeUsesRootKeyEncryption",value:function(e){return e===O.a.ItemsKey||e===O.a.EncryptedStorage}},{key:"keyToUseForEncryptionOfPayload",value:(H=D(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(x.p)(n)){e.next=2;break}throw"Intent must be supplied when looking up key for encryption of item.";case 2:if(!this.contentTypeUsesRootKeyEncryption(t.content_type)){e.next=15;break}return e.next=5,this.getRootKey();case 5:if(r=e.sent){e.next=12;break}if(!Object(s.b)(n)){e.next=11;break}throw"Root key encryption is required but no root key is available.";case 11:return e.abrupt("return",void 0);case 12:return e.abrupt("return",r);case 15:return e.abrupt("return",this.getDefaultItemsKey());case 16:case"end":return e.stop()}}),e,this)}))),function(e,t){return H.apply(this,arguments)})},{key:"keyToUseForDecryptionOfPayload",value:(B=D(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.contentTypeUsesRootKeyEncryption(t.content_type)){e.next=2;break}return e.abrupt("return",this.getRootKey());case 2:if(!t.items_key_id){e.next=5;break}return n=this.itemsKeyForPayload(t),e.abrupt("return",n);case 5:if((r=t.version)!==this.getLatestVersion()){e.next=8;break}throw"No associated key found for item encrypted with latest protocol version.";case 8:return e.abrupt("return",this.defaultItemsKeyForItemVersion(r));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"onSyncEvent",value:(U=D(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==b.b.FullSyncCompleted){e.next=3;break}return e.next=3,this.handleFullSyncCompletion();case 3:if(t!==b.b.DownloadFirstSyncCompleted){e.next=6;break}return e.next=6,this.handleDownloadFirstSyncCompletion();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"handleDownloadFirstSyncCompletion",value:(W=D(i.a.mark((function e(){var t,n,r,a,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.latestItemsKeys(),n=t.filter((function(e){return e.neverSynced})),r=t.find((function(e){return!e.neverSynced&&e.isDefault})),Object(x.p)(r)){e.next=9;break}return e.next=7,this.itemManager.setItemsToBeDeleted(Object(o.b)(n));case 7:e.next=20;break;case 9:return e.next=11,this.getRootKey();case 11:if(!(a=e.sent)){e.next=20;break}if(!((s=n.filter((function(e){return e.version!==a.version}))).length>0)){e.next=17;break}return e.next=17,this.itemManager.setItemsToBeDeleted(Object(o.b)(s));case 17:if(0!==this.latestItemsKeys().length){e.next=20;break}return e.next=20,this.createNewDefaultItemsKey();case 20:case"end":return e.stop()}}),e,this)}))),function(){return W.apply(this,arguments)})},{key:"handleFullSyncCompletion",value:(V=D(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.getDefaultItemsKey()){e.next=6;break}return e.next=4,this.createNewDefaultItemsKey();case 4:if(this.keyMode!==r.WrapperOnly){e.next=6;break}return e.abrupt("return",this.repersistAllItems());case 6:case"end":return e.stop()}}),e,this)}))),function(){return V.apply(this,arguments)})},{key:"repersistAllItems",value:(N=D(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.itemManager.items,n=t.map((function(e){return Object(v.e)(e)})),e.abrupt("return",this.storageService.savePayloads(n));case 3:case"end":return e.stop()}}),e,this)}))),function(){return N.apply(this,arguments)})},{key:"latestItemsKeys",value:function(){return this.itemManager.itemsKeys()}},{key:"itemsKeyForPayload",value:function(e){return this.latestItemsKeys().find((function(t){return t.uuid===e.items_key_id}))}},{key:"getDefaultItemsKey",value:function(){var e=this.latestItemsKeys();return 1===e.length?e[0]:e.find((function(e){return e.isDefault}))}},{key:"reencryptItemsKeys",value:(L=D(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=this.latestItemsKeys()).length>0)){e.next=4;break}return e.next=4,this.itemManager.setItemsDirty(Object(o.b)(t));case 4:case"end":return e.stop()}}),e,this)}))),function(){return L.apply(this,arguments)})},{key:"defaultItemsKeyForItemVersion",value:(F=D(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.latestItemsKeys().find((function(e){return e.version===t})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"createNewDefaultItemsKey",value:(_=D(i.a.mark((function e(){var t,n,r,a,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRootKey();case 2:if(t=e.sent,n=t?t.version:this.getLatestVersion(),!(Object(c.b)(n,K)<=0)){e.next=16;break}return e.t0=v.e,e.next=8,k.a.GenerateUuid();case 8:e.t1=e.sent,e.t2=O.a.ItemsKey,e.t3=Object(o.a)({itemsKey:t.masterKey,dataAuthenticationKey:t.dataAuthenticationKey,version:n}),e.t4={uuid:e.t1,content_type:e.t2,content:e.t3},a=(0,e.t0)(e.t4),r=Object(m.a)(a),e.next=19;break;case 16:return e.next=18,this.operatorForVersion(n).createItemsKey();case 18:r=e.sent;case 19:if(!(s=this.getDefaultItemsKey())){e.next=23;break}return e.next=23,this.itemManager.changeItemsKey(s.uuid,(function(e){e.isDefault=!1}));case 23:return e.next=25,this.itemManager.insertItem(r);case 25:return u=e.sent,e.next=28,this.itemManager.changeItemsKey(u.uuid,(function(e){e.isDefault=!0}));case 28:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})}])&&I(n.prototype,a),w&&I(n,w),t}(w.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return S}));var r=n(0),a=n.n(r),i=n(30),o=n(18),s=n(33),c=n(44),u=n(12),l=n(2),f=n(9),p=n(29),h=n(1);function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function v(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){d(i,r,a,o,s,"next",e)}function s(e){d(i,r,a,o,s,"throw",e)}o(void 0)}))}}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e,t,n){return(w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var S=function(e){function t(){return b(this,t),g(this,k(t).apply(this,arguments))}var n,r,c,y,d,S,O,P,j,C,_,D,I;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(t,e),n=t,(r=[{key:"generateNewItemsKeyContent",value:(I=v(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.crypto.generateRandomKey(o.d.EncryptionKeyLength);case 2:return t=e.sent,n={itemsKey:t,version:this.version},e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"generateSalt004",value:(D=v(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.crypto.sha256([t,n].join(":"));case 2:return r=e.sent,e.abrupt("return",Object(h.I)(r,o.d.ArgonSaltLength));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"computeRootKey",value:(_=v(a.a.mark((function e(t,n){var r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.generateSalt004(n.identifier,n.seed);case 2:return r=e.sent,e.next=5,this.deriveKey(t,r,o.d.ArgonIterations);case 5:return i=e.sent,e.abrupt("return",i);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return _.apply(this,arguments)})},{key:"createRootKey",value:(C=v(a.a.mark((function e(t,n){var r,i,c,u,l,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.version,i=o.d.ArgonIterations,e.next=4,this.crypto.generateRandomKey(o.d.ArgonSaltSeedLength);case 4:return c=e.sent,e.next=7,this.generateSalt004(t,c);case 7:return u=e.sent,e.next=10,this.deriveKey(n,u,i);case 10:return l=e.sent,f=Object(s.a)({identifier:t,pw_cost:i,pw_nonce:c,version:r}),e.abrupt("return",{key:l,keyParams:f});case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"encryptString004",value:(j=v(a.a.mark((function e(t,n,r,i){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw"encryptString null nonce";case 2:if(n){e.next=4;break}throw"encryptString null rawKey";case 4:return e.abrupt("return",this.crypto.xchacha20Encrypt(t,r,n,JSON.stringify(i)));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return j.apply(this,arguments)})},{key:"decryptString004",value:(P=v(a.a.mark((function e(t,n,r,i){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.crypto.xchacha20Decrypt(t,r,n,JSON.stringify(i)));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return P.apply(this,arguments)})},{key:"generateEncryptedProtocolString",value:(O=v(a.a.mark((function e(t,n,r){var i,s,c,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.crypto.generateRandomKey(o.d.EncryptionNonceLength);case 2:return i=e.sent,s=this.version,e.next=6,this.encryptString004(t,n,i,{u:r,v:s});case 6:return c=e.sent,u=[s,i,c].join(":"),e.abrupt("return",u);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return O.apply(this,arguments)})},{key:"generateEncryptedParameters",value:(S=v(a.a.mark((function e(n,r,s){var c,f,p,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r!==u.a.DecryptedBareObject&&r!==u.a.DecryptedBase64String){e.next=2;break}return e.abrupt("return",w(k(t.prototype),"generateEncryptedParameters",this).call(this,n,r,s));case 2:if(r===u.a.EncryptedString){e.next=4;break}throw"Unsupport format for generateEncryptedParameters ".concat(r);case 4:if(n.uuid){e.next=6;break}throw"payload.uuid cannot be null";case 6:if(s&&s.itemsKey){e.next=8;break}throw"Attempting to generateEncryptedParameters with no itemsKey.";case 8:return e.next=10,this.crypto.generateRandomKey(o.d.EncryptionKeyLength);case 10:return c=e.sent,f=JSON.stringify(n.content),e.next=14,this.generateEncryptedProtocolString(f,c,n.uuid);case 14:return p=e.sent,e.next=17,this.generateEncryptedProtocolString(c,s.itemsKey,n.uuid);case 17:return h=e.sent,e.abrupt("return",Object(l.c)({uuid:n.uuid,items_key_id:s instanceof i.b?s.uuid:void 0,content:p,enc_item_key:h}));case 19:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return S.apply(this,arguments)})},{key:"generateDecryptedParameters",value:(d=v(a.a.mark((function e(n,r){var i,o,s,c,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=n.format)!==u.a.DecryptedBareObject&&i!==u.a.DecryptedBase64String){e.next=3;break}return e.abrupt("return",w(k(t.prototype),"generateDecryptedParameters",this).call(this,n,r));case 3:if(n.uuid){e.next=5;break}throw"encryptedParameters.uuid cannot be null";case 5:if(r&&r.itemsKey){e.next=7;break}throw"Attempting to generateDecryptedParameters with no itemsKey.";case 7:return o=this.deconstructEncryptedPayloadString(n.enc_item_key),e.next=10,this.decryptString004(o.ciphertext,r.itemsKey,o.nonce,{u:n.uuid,v:o.version});case 10:if(s=e.sent){e.next=14;break}return console.error("Error decrypting itemKey parameters",n),e.abrupt("return",Object(l.a)(n,{errorDecrypting:!0,errorDecryptingValueChanged:!n.errorDecrypting}));case 14:return c=this.deconstructEncryptedPayloadString(n.contentString),e.next=17,this.decryptString004(c.ciphertext,s,c.nonce,{u:n.uuid,v:c.version});case 17:if(f=e.sent){e.next=22;break}return e.abrupt("return",Object(l.a)(n,{errorDecrypting:!0,errorDecryptingValueChanged:!n.errorDecrypting}));case 22:return e.abrupt("return",Object(l.a)(n,{content:JSON.parse(f),items_key_id:void 0,enc_item_key:void 0,errorDecrypting:!1,errorDecryptingValueChanged:!0===n.errorDecrypting,waitingForKey:!1}));case 23:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"deconstructEncryptedPayloadString",value:function(e){var t=e.split(":");return{version:t[0],nonce:t[1],ciphertext:t[2]}}},{key:"deriveKey",value:(y=v(a.a.mark((function e(t,n,r){var i,s,c,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.crypto.argon2(t,n,r,o.d.ArgonMemLimit,o.d.ArgonOutputKeyBytes);case 2:return i=e.sent,s=this.splitKey(i,2),c=s[0],u=s[1],e.abrupt("return",p.a.Create({masterKey:c,serverPassword:u,version:this.version}));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return y.apply(this,arguments)})},{key:"version",get:function(){return f.a.V004}}])&&m(n.prototype,r),c&&m(n,c),t}(c.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(93),a=n.n(r);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"label",void 0),i(this,"desc",void 0),i(this,"running",void 0),i(this,"error",void 0),i(this,"lastExecuted",void 0),i(this,"context",void 0),i(this,"verb",void 0),i(this,"url",void 0),i(this,"access_type",void 0),i(this,"subactions",void 0),i(this,"subrows",void 0),a()(this,t),this.running=!1,this.error=!1,this.lastExecuted&&(this.lastExecuted=new Date(this.lastExecuted))}},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){var r=n(98),a=n(105);e.exports=function(e){return null!=e&&a(e.length)&&!r(e)}},function(e,t,n){var r=n(76);e.exports=function(e){if("string"==typeof e||r(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},function(e,t,n){"use strict";n.d(t,"a",(function(){return k})),n.d(t,"b",(function(){return O}));var r=n(0),a=n.n(r),i=n(16),o=n(8),s=n(14),c=n(1),u=n(15);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function p(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){f(i,r,a,o,s,"next",e)}function s(e){f(i,r,a,o,s,"throw",e)}o(void 0)}))}}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t,n){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),e}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=function(){function e(t,n,r,a){b(this,e),w(this,"setClientFunctions",void 0),w(this,"submitValues",void 0),w(this,"setValidationStatus",void 0),w(this,"cancel",void 0),this.setClientFunctions=t,this.submitValues=n,this.setValidationStatus=r,this.cancel=a}return g(e,[{key:"setCallbacks",value:function(e,t,n,r){this.setClientFunctions(e,t,n,r)}}]),e}(),x=function e(t,n,r,a){b(this,e),w(this,"onValidValue",void 0),w(this,"onInvalidValue",void 0),w(this,"onComplete",void 0),w(this,"onCancel",void 0),this.onValidValue=t||function(e){},this.onInvalidValue=n||function(e){},this.onComplete=r||function(){},this.onCancel=a||function(){}},S=function(){function e(t,n){b(this,e),w(this,"challenge",void 0),w(this,"validate",void 0),w(this,"validValues",[]),w(this,"invalidValues",[]),w(this,"artifacts",{}),w(this,"client",void 0),w(this,"resolve",void 0),w(this,"orchestrator",void 0),this.challenge=t,this.validate=n}return g(e,[{key:"setResolver",value:function(e){this.resolve=e}},{key:"complete",value:function(e){var t;e||(e=new u.c(this.challenge,this.validValues,this.artifacts)),this.resolve(e),null===(t=this.client)||void 0===t||t.onComplete()}},{key:"cancel",value:function(){var e;this.resolve(null),null===(e=this.client)||void 0===e||e.onCancel()}},{key:"isFinished",value:function(){return this.validValues.length===this.challenge.types.length}},{key:"setOrchestratorFunctions",value:function(e,t,n,r){this.orchestrator=new k(e,n,t,r)}},{key:"setValueStatus",value:function(e,t,n){var r,a,i=t?this.validValues:this.invalidValues,o=i.find((function(t){return t.type===e.type}));(o&&Object(c.B)(i,o),i.push(e),t?this.validValues=i:this.invalidValues=i,Object.assign(this.artifacts,n),this.isFinished())?this.complete():t?null===(r=this.client)||void 0===r||r.onValidValue(e):null===(a=this.client)||void 0===a||a.onInvalidValue(e)}}]),e}(),O=function(e){function t(e,n){var r;return b(this,t),r=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?h(e):t}(this,d(t).call(this)),w(h(r),"storageService",void 0),w(h(r),"protocolService",void 0),w(h(r),"challengeOperations",{}),w(h(r),"challengeHandler",void 0),r.storageService=e,r.protocolService=n,r}var n,r,i,c,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,e),g(t,[{key:"deinit",value:function(){this.storageService=void 0,this.protocolService=void 0,this.challengeHandler=void 0,y(d(t.prototype),"deinit",this).call(this)}},{key:"promptForChallengeResponse",value:(f=p(a.a.mark((function e(t){var n,r,i,o,s=this,c=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(c.length>1&&void 0!==c[1])||c[1],r=c.length>2?c[2]:void 0,i=this.getChallengeOperation(t),o=!i,i||(i=this.createChallengeOperation(t,n)),r&&(r.orchestrator=i.orchestrator),e.abrupt("return",new Promise((function(e){i.setResolver(e),o&&s.challengeHandler(t,i.orchestrator)})));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"validateChallengeValue",value:(c=p(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.type!==u.d.LocalPasscode){e.next=4;break}return e.abrupt("return",this.protocolService.validatePasscode(t.value));case 4:if(t.type!==u.d.AccountPassword){e.next=8;break}return e.abrupt("return",this.protocolService.validateAccountPassword(t.value));case 8:if(t.type!==u.d.Biometric){e.next=10;break}return e.abrupt("return",{valid:!0===t.value});case 10:throw"Cannot validate challenge type ".concat(t.type);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"getLaunchChallenge",value:(i=p(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],this.protocolService.hasPasscode()&&t.push(u.d.LocalPasscode),e.next=5,this.storageService.getValue(o.b.BiometricPrefs,s.d.Nonwrapped);case 5:if((n=e.sent)&&n.enabled&&t.push(u.d.Biometric),!(t.length>0)){e.next=12;break}return e.abrupt("return",new u.a(t,u.b.ApplicationUnlock));case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"isPasscodeLocked",value:function(){return this.protocolService.rootKeyNeedsUnwrapping()}},{key:"enableBiometrics",value:(r=p(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.setValue(o.b.BiometricPrefs,{enabled:!0},s.d.Nonwrapped);case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"createChallengeOperation",value:function(e,t){var n=this,r=new S(e,t);return r.setOrchestratorFunctions((function(e,t,n,a){var i=new x(e,t,n,a);r.client=i}),(function(t,r,a){n.setValidationStatusForChallenge(e,t,r,a)}),(function(t){n.submitValuesForChallenge(e,t)}),(function(){n.cancelChallenge(e)})),this.setChallengeOperation(r),r}},{key:"getChallengeOperation",value:function(e){return this.challengeOperations[e.id]}},{key:"setChallengeOperation",value:function(e){this.challengeOperations[e.challenge.id]=e}},{key:"deleteChallengeOperation",value:function(e){delete this.challengeOperations[e.challenge.id]}},{key:"cancelChallenge",value:function(e){var t=this.challengeOperations[e.id];t.cancel(),this.deleteChallengeOperation(t)}},{key:"submitValuesForChallenge",value:(n=p(a.a.mark((function e(t,n){var r,i,o,s,c,l,f,p,h,y,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==n.length){e.next=2;break}throw Error("Attempting to submit 0 values for challenge");case 2:if(!(r=this.getChallengeOperation(t)).validate){e.next=36;break}i=!0,o=!1,s=void 0,e.prev=7,c=n[Symbol.iterator]();case 9:if(i=(l=c.next()).done){e.next=20;break}return f=l.value,e.next=13,this.validateChallengeValue(f);case 13:p=e.sent,h=p.valid,y=p.artifacts,this.setValidationStatusForChallenge(t,f,h,y);case 17:i=!0,e.next=9;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(7),o=!0,s=e.t0;case 26:e.prev=26,e.prev=27,i||null==c.return||c.return();case 29:if(e.prev=29,!o){e.next=32;break}throw s;case 32:return e.finish(29);case 33:return e.finish(26);case 34:e.next=38;break;case 36:d=new u.c(t,n),r.complete(d);case 38:case"end":return e.stop()}}),e,this,[[7,22,26,34],[27,,29,33]])}))),function(e,t){return n.apply(this,arguments)})},{key:"setValidationStatusForChallenge",value:function(e,t,n,r){var a=this.getChallengeOperation(e);a.setValueStatus(t,n,r),a.isFinished()&&this.deleteChallengeOperation(a)}}]),t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(6),a=n(26),i=n(7);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function l(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?f(e):t}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t,n){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=function(e){function t(){var e,n;s(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return v(f(n=l(this,(e=h(t)).call.apply(e,[this].concat(a)))),"area",i.b.Themes),n}return y(t,e),u(t,[{key:"isLayerable",value:function(){return this.package_info&&this.package_info.layerable}},{key:"strategyWhenConflictingWithItem",value:function(e){return this.errorDecrypting?p(h(t.prototype),"strategyWhenConflictingWithItem",this).call(this,e):a.a.KeepLeft}},{key:"getMobileRules",value:function(){return this.getAppDomainValue(r.a.MobileRules)||{constants:{},rules:{}}}},{key:"hasMobileRules",value:function(){return this.getAppDomainValue(r.a.MobileRules)}},{key:"getNotAvailOnMobile",value:function(){return this.getAppDomainValue(r.a.NotAvailableOnMobile)}},{key:"isMobileActive",value:function(){return this.getAppDomainValue(r.a.MobileActive)}}]),t}(i.d);r.b},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(13),a=n(5),i=n(3),o=n(9),s=n(1),c=n(12);function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(){function e(t,n,u){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),l(this,"fields",void 0),l(this,"source",void 0),l(this,"uuid",void 0),l(this,"content_type",void 0),l(this,"content",void 0),l(this,"deleted",void 0),l(this,"items_key_id",void 0),l(this,"enc_item_key",void 0),l(this,"created_at",void 0),l(this,"updated_at",void 0),l(this,"dirtiedDate",void 0),l(this,"dirty",void 0),l(this,"errorDecrypting",void 0),l(this,"waitingForKey",void 0),l(this,"errorDecryptingValueChanged",void 0),l(this,"lastSyncBegan",void 0),l(this,"lastSyncEnd",void 0),l(this,"auth_hash",void 0),l(this,"auth_params",void 0),l(this,"format",void 0),l(this,"version",void 0),this.fields=n||Object.keys(t),this.source=u||i.a.Constructor,this.uuid=t.uuid,!this.uuid&&this.fields.includes(a.a.Uuid))throw Error("uuid is null, yet this payloads fields indicate it shouldnt be.");this.content_type=t.content_type,t.content&&(Object(s.q)(t.content)?this.content=Object(r.a)(t.content):this.content=t.content),this.deleted=t.deleted,this.items_key_id=t.items_key_id,this.enc_item_key=t.enc_item_key,this.created_at=new Date(t.created_at||new Date),this.updated_at=new Date(t.updated_at||new Date(0)),this.dirtiedDate=new Date(t.dirtiedDate),this.dirty=t.dirty,this.errorDecrypting=t.errorDecrypting,this.waitingForKey=t.waitingForKey,this.errorDecryptingValueChanged=t.errorDecryptingValueChanged,this.lastSyncBegan=t.lastSyncBegan?new Date(t.lastSyncBegan):void 0,this.lastSyncEnd=t.lastSyncEnd?new Date(t.lastSyncEnd):void 0,this.auth_hash=t.auth_hash,this.auth_params=t.auth_params,Object(s.s)(this.content)?this.content.startsWith(o.a.V000Base64Decrypted)?this.format=c.a.DecryptedBase64String:this.format=c.a.EncryptedString:Object(s.q)(this.content)?this.format=c.a.DecryptedBareObject:this.format=c.a.Deleted,Object(s.s)(this.content)?this.version=this.content.substring(0,o.a.VersionLength):this.content&&(this.version=this.content.version),Object(s.g)(this)}var t,n,f;return t=e,(n=[{key:"ejected",value:function(){var e=[a.a.Legacy003AuthHash,a.a.Deleted],t=[a.a.DirtiedDate,a.a.ErrorDecrypting,a.a.ErrorDecryptingChanged,a.a.WaitingForKey,a.a.LastSyncBegan,a.a.LastSyncEnd],n={},r=!0,i=!1,o=void 0;try{for(var c,u=this.fields[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var l=c.value;if(!t.includes(l)){var f=this[l];Object(s.p)(f)&&e.includes(l)||(n[l]=f)}}}catch(e){i=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}},{key:"safeContent",get:function(){return this.format===c.a.DecryptedBareObject?this.content:{}}},{key:"references",get:function(){return this.safeReferences}},{key:"safeReferences",get:function(){return this.safeContent.references||[]}},{key:"contentObject",get:function(){if(this.format!==c.a.DecryptedBareObject)throw Error("Attempting to access non-object content as object");return this.content}},{key:"contentString",get:function(){if(this.format===c.a.DecryptedBareObject)throw Error("Attempting to access non-string content as string");return this.content}},{key:"discardable",get:function(){return this.deleted&&!this.dirty}}])&&u(t.prototype,n),f&&u(t,f),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n(5);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){function t(){return i(this,t),s(this,c(t).apply(this,arguments))}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,e),n=t,(r=[{key:"previewTitle",value:function(){return this.payload.updated_at.toLocaleString()}},{key:"previewSubTitle",value:function(){return this.hasPreviousEntry?this.textCharDiffLength<0?"".concat(-1*this.textCharDiffLength," characters removed"):this.textCharDiffLength>0?"".concat(this.textCharDiffLength," characters added"):"Title or metadata changed":"".concat(this.textCharDiffLength," characters loaded")}}])&&o(n.prototype,r),a&&o(n,a),t}(n(91).a),f=n(4);function p(e){var t,n,a,i=(t={},n=f.a.Note,a=l,n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t)[e[r.a.ContentType]];if(!i)throw"Invalid item history class";return new i(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y=function(){function e(t){var n,r,a;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a=[],(r="entries")in(n=this)?Object.defineProperty(n,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[r]=a,t){var i=!0,o=!1,s=void 0;try{for(var c,u=t[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var l=c.value;l.setPreviousEntry(this.getLastEntry()),this.entries.push(l)}}catch(e){o=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw s}}}}var t,n,r;return t=e,r=[{key:"FromJson",value:function(t){return new e(t.entries.map((function(e){return p(e.payload)})))}}],(n=[{key:"getLastEntry",value:function(){return this.entries[this.entries.length-1]}},{key:"addHistoryEntryForItem",value:function(e){var t=p(e),n=this.getLastEntry();if(t.setPreviousEntry(n),!t.isSameAsEntry(n))return this.entries.push(t),t}},{key:"clear",value:function(){this.entries.length=0}},{key:"optimize",value:function(){var e=this,t=[],n=function(e){return e.deltaSize()>15},r=function(r,a,i){if(i)t.push(r);else{var o=t.indexOf(r);-1!==o&&t.splice(o,1)}if(i&&n(r)&&-1===r.operationVector()){var s=e.entries[a-1];s&&t.push(s)}};this.entries.forEach((function(t,a){if(0===a||a===e.entries.length-1)r(t,a,!0);else{var i=n(t);r(t,a,i)}})),this.entries=this.entries.filter((function(e,n){return-1!==t.indexOf(e)}))}}])&&h(t.prototype,n),r&&h(t,r),e}()},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"===("undefined"==typeof window?"undefined":n(window))&&(r=window)}e.exports=r},function(e,t,n){var r=n(145),a=n(146),i=n(147),o=n(148),s=n(149);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=a,c.prototype.get=i,c.prototype.has=o,c.prototype.set=s,e.exports=c},function(e,t,n){var r=n(61);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},function(e,t,n){var r=n(36).Symbol;e.exports=r},function(e,t,n){var r=n(50)(Object,"create");e.exports=r},function(e,t,n){var r=n(169);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var a=n(e);return!!(t=null==t?9007199254740991:t)&&("number"==a||"symbol"!=a&&r.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=n(56),i=n(51);e.exports=function(e){return"symbol"==r(e)||i(e)&&"[object Symbol]"==a(e)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(0),a=n.n(r);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){o(i,r,a,s,c,"next",e)}function c(e){o(i,r,a,s,c,"throw",e)}s(void 0)}))}}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=u(this,f(t).call(this))).deviceInterface=e,n}var n,r,i,o,h;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,e),n=t,(r=[{key:"deinit",value:function(){this.deviceInterface=void 0,l(f(t.prototype),"deinit",this).call(this)}},{key:"alert",value:(h=s(a.a.mark((function e(t,n){var r=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>2&&void 0!==r[2]&&r[2],r.length>3&&r[3],e.abrupt("return",new Promise((function(e,n){window.alert(t),e()})));case 3:case"end":return e.stop()}}),e)}))),function(e,t){return h.apply(this,arguments)})},{key:"confirm",value:(o=s(a.a.mark((function e(t,n){var r=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>2&&void 0!==r[2]&&r[2],r.length>3&&void 0!==r[3]&&r[3],r.length>4&&r[4],r.length>5&&r[5],r.length>6&&void 0!==r[6]&&r[6],e.abrupt("return",new Promise((function(e,n){window.confirm(t)?e():n()})));case 6:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})}])&&c(n.prototype,r),i&&c(n,i),t}(n(16).a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var r=n(0),a=n.n(r),i=n(16),o=n(1),s=n(8),c=n(54),u=n(22);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function p(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){f(i,r,a,o,s,"next",e)}function s(e){f(i,r,a,o,s,"throw",e)}o(void 0)}))}}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t,n){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=function(e){function t(e,n,r,a){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?y(e):t}(this,v(t).call(this)),m(y(i),"storageService",void 0),m(y(i),"apiService",void 0),m(y(i),"alertService",void 0),m(y(i),"protocolService",void 0),m(y(i),"user",void 0),i.protocolService=a,i.storageService=e,i.apiService=n,i.alertService=r,i}var n,r,i,f,g,w,k,x,S,O;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,e),n=t,(r=[{key:"deinit",value:function(){this.protocolService=void 0,this.storageService=void 0,this.apiService=void 0,this.alertService=void 0,this.user=void 0,d(v(t.prototype),"deinit",this).call(this)}},{key:"initializeFromDisk",value:(O=p(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.getValue(s.b.User);case 2:if(this.user=e.sent,this.user){e.next=8;break}return e.next=6,this.storageService.getValue(s.b.LegacyUuid);case 6:(t=e.sent)&&(this.user={uuid:t});case 8:return e.next=10,this.storageService.getValue(s.b.Session);case 10:if(!(n=e.sent)){e.next=14;break}return e.next=14,this.setSession(c.a.FromRaw(n),!1);case 14:case"end":return e.stop()}}),e,this)}))),function(){return O.apply(this,arguments)})},{key:"setSession",value:(S=p(a.a.mark((function e(t){var n,r=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(r.length>1&&void 0!==r[1])||r[1],e.next=3,this.apiService.setSession(t,n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"online",value:function(){return!this.offline()}},{key:"offline",value:function(){return Object(o.p)(this.apiService.getSession())}},{key:"getUser",value:function(){return this.user}},{key:"signOut",value:(x=p(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.user=void 0,e.next=3,this.apiService.getSession();case 3:(t=e.sent)&&t.canExpire()&&this.apiService.signOut();case 5:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"register",value:(k=p(a.a.mark((function e(t,n){var r,i,o,s,c=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length<8)){e.next=2;break}return e.abrupt("return",{response:this.apiService.createErrorResponse(u.m(8))});case 2:return e.next=4,this.protocolService.createRootKey(t,n);case 4:return r=e.sent,i=r.key.serverPassword,o=r.keyParams,s=r.key,e.abrupt("return",this.apiService.register(t,i,o).then(function(){var e=p(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.handleAuthResponse(t);case 2:return e.abrupt("return",{response:t,keyParams:o,rootKey:s});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return k.apply(this,arguments)})},{key:"signIn",value:(w=p(a.a.mark((function e(t,n){var r,i,o,s,c,l,f,h,y,d,v,b,m=this,g=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=g.length>2&&void 0!==g[2]&&g[2],i=g.length>3?g[3]:void 0,o=g.length>4?g[4]:void 0,e.next=5,this.apiService.getAccountKeyParams(t,i,o);case 5:if(!(s=e.sent).error){e.next=8;break}return e.abrupt("return",{response:s});case 8:if(c={pw_cost:s.pw_cost,pw_nonce:s.pw_nonce,identifier:s.identifier,email:s.email,pw_salt:s.pw_salt,version:s.version},(l=this.protocolService.createKeyParams(c))&&l.version){e.next=12;break}return e.abrupt("return",{response:this.apiService.createErrorResponse(u.b)});case 12:if(this.protocolService.supportedVersions().includes(l.version)){e.next=18;break}if(!this.protocolService.isVersionNewerThanLibraryVersion(l.version)){e.next=17;break}return e.abrupt("return",{response:this.apiService.createErrorResponse(u.s)});case 17:return e.abrupt("return",{response:this.apiService.createErrorResponse(u.k)});case 18:if(!this.protocolService.isProtocolVersionOutdated(l.version)){e.next=29;break}if(f=this.protocolService.costMinimumForVersion(l.version),!(l.kdfIterations<f)){e.next=22;break}return e.abrupt("return",{response:this.apiService.createErrorResponse(u.l)});case 22:return h=u.p,e.next=26,this.alertService.confirm(h,u.o,u.n).catch((function(){}));case 26:if(e.sent){e.next=29;break}return e.abrupt("return",{response:this.apiService.createErrorResponse(u.b)});case 29:if(this.protocolService.platformSupportsKeyDerivation(l)){e.next=31;break}return e.abrupt("return",{response:this.apiService.createErrorResponse(u.r)});case 31:if(!r){e.next=35;break}if(y=this.protocolService.getLatestVersion(),l.version===y){e.next=35;break}return e.abrupt("return",{response:this.apiService.createErrorResponse(u.q(l.version,y))});case 35:return e.next=37,this.protocolService.computeRootKey(n,l).then((function(e){return{rootKey:e,serverPassword:e.serverPassword}}));case 37:return d=e.sent,v=d.rootKey,b=d.serverPassword,e.abrupt("return",this.apiService.signIn(t,b,i,o).then(function(){var e=p(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.handleAuthResponse(t);case 2:return e.abrupt("return",{response:t,keyParams:l,rootKey:v});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 41:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"changePassword",value:(g=p(a.a.mark((function e(t,n,r){var i,o,s,c,l,f,h=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length<8)){e.next=2;break}return e.abrupt("return",{response:this.apiService.createErrorResponse(u.m(8))});case 2:return e.next=4,this.protocolService.computeRootKey(t,n).then((function(e){return e.serverPassword}));case 4:return i=e.sent,o=this.user.email,e.next=8,this.protocolService.createRootKey(o,r).then((function(e){return{newRootKey:e.key,newServerPassword:e.key.serverPassword,newKeyParams:e.keyParams}}));case 8:return s=e.sent,c=s.newServerPassword,l=s.newRootKey,f=s.newKeyParams,e.abrupt("return",this.apiService.changePassword(i,c,f).then(function(){var e=p(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.handleAuthResponse(t);case 2:return e.abrupt("return",{response:t,keyParams:f,rootKey:l});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return g.apply(this,arguments)})},{key:"handleAuthResponse",value:(f=p(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.error){e.next=2;break}return e.abrupt("return");case 2:return n=t.user,this.user=n,e.next=6,this.storageService.setValue(s.b.User,n);case 6:if(!t.token){e.next=10;break}return r=c.a.FromResponse(t),e.next=10,this.setSession(r);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})}])&&h(n.prototype,r),i&&h(n,i),t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return P}));var r=n(0),a=n.n(r),i=n(54),o=n(52),s=n(93),c=n.n(s),u=n(35),l=n(22),f=n(16),p=n(1),h=n(8);function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){b(i,r,a,o,s,"next",e)}function s(e){b(i,r,a,o,s,"throw",e)}o(void 0)}))}}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e,t,n){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=x(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var P=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?w(e):t}(this,x(t).call(this)),O(w(r),"httpService",void 0),O(w(r),"storageService",void 0),O(w(r),"host",void 0),O(w(r),"session",void 0),O(w(r),"registering",!1),O(w(r),"authenticating",!1),O(w(r),"changing",!1),O(w(r),"refreshingSession",!1),r.httpService=e,r.storageService=n,r}var n,r,s,f,d,b,P,j,C,_,D,I,E,M,R,A;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,e),n=t,(r=[{key:"deinit",value:function(){this.httpService=void 0,this.storageService=void 0,this.host=void 0,this.session=void 0,k(x(t.prototype),"deinit",this).call(this)}},{key:"loadHost",value:(A=m(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.getValue(h.b.ServerHost);case 2:t=e.sent,this.host=t||window._default_sync_server;case 4:case"end":return e.stop()}}),e,this)}))),function(){return A.apply(this,arguments)})},{key:"setHost",value:(R=m(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.host=t,e.next=3,this.storageService.setValue(h.b.ServerHost,t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"getHost",value:(M=m(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.host);case 1:case"end":return e.stop()}}),e,this)}))),function(){return M.apply(this,arguments)})},{key:"setSession",value:(E=m(a.a.mark((function e(t){var n,r=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(r.length>1&&void 0!==r[1])||r[1],this.session=t,!n){e.next=5;break}return e.next=5,this.storageService.setValue(h.b.Session,t);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"getSession",value:function(){return this.session}},{key:"path",value:(I=m(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getHost();case 2:if(n=e.sent){e.next=5;break}throw"Attempting to build path ".concat(t," with no host.");case 5:if(t){e.next=7;break}throw"Attempting to build path with null path.";case 7:return e.abrupt("return",Object(p.u)(n,t));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"params",value:function(e){var t=c()(e,O({},u.a.ApiVersion,"20200115"));return t}},{key:"createErrorResponse",value:function(e){return{error:{message:e}}}},{key:"errorResponseWithFallbackMessage",value:function(e,t){return e.error.message||(e.error.message=t),e}},{key:"getAccountKeyParams",value:(D=m(a.a.mark((function e(t,n,r){var i,o,s,c=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.path("/auth/params");case 2:return i=e.sent,o=this.params({email:t}),n&&(o[n]=r),e.next=7,this.httpService.getAbsolute(i,o).catch((function(e){return c.errorResponseWithFallbackMessage(e,l.d)}));case 7:return s=e.sent,e.abrupt("return",s);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return D.apply(this,arguments)})},{key:"register",value:(_=m(a.a.mark((function e(t,n,r){var i,o,s,c=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.registering){e.next=2;break}return e.abrupt("return",this.createErrorResponse(l.i));case 2:return this.registering=!0,e.next=5,this.path("/auth");case 5:return i=e.sent,o=this.params(v({password:n,email:t},r.getPortableValue())),e.next=9,this.httpService.postAbsolute(i,o).catch((function(e){return c.errorResponseWithFallbackMessage(e,l.e)}));case 9:return s=e.sent,this.registering=!1,e.abrupt("return",s);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return _.apply(this,arguments)})},{key:"signIn",value:(C=m(a.a.mark((function e(t,n,r,i){var o,s,c,u=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.authenticating){e.next=2;break}return e.abrupt("return",this.createErrorResponse(l.h));case 2:return this.authenticating=!0,e.next=5,this.path("/auth/sign_in");case 5:return o=e.sent,s=this.params({email:t,password:n}),r&&(s[r]=i),e.next=10,this.httpService.postAbsolute(o,s).catch((function(e){return u.errorResponseWithFallbackMessage(e,l.d)}));case 10:return c=e.sent,this.authenticating=!1,e.abrupt("return",c);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return C.apply(this,arguments)})},{key:"signOut",value:(j=m(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.path("/auth/sign_out");case 2:return t=e.sent,e.abrupt("return",this.httpService.postAbsolute(t,void 0,this.session.accessToken));case 4:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"changePassword",value:(P=m(a.a.mark((function e(t,n,r){var i,s,c,u=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.changing){e.next=2;break}return e.abrupt("return",this.createErrorResponse(l.a));case 2:if(!this.refreshingSession){e.next=4;break}return e.abrupt("return",this.createErrorResponse(l.j));case 4:return this.changing=!0,e.next=7,this.path("/auth/change_pw");case 7:return i=e.sent,s=this.params(v({current_password:t,new_password:n},r.getPortableValue())),e.next=11,this.httpService.postAbsolute(i,s,this.session.accessToken).catch(function(){var e=m(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u.httpService.isErrorResponseExpiredToken(t)){e.next=2;break}return e.abrupt("return",u.refreshSessionThenRetryRequest({verb:o.a.Post,url:i,params:s}));case 2:return e.abrupt("return",u.errorResponseWithFallbackMessage(t,l.c));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 11:return c=e.sent,this.changing=!1,e.abrupt("return",c);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return P.apply(this,arguments)})},{key:"sync",value:(b=m(a.a.mark((function e(t,n,r,i){var s,c,f,p,h,y,d,v=this,b=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=b.length>4&&void 0!==b[4]&&b[4],f=b.length>5?b[5]:void 0,p=b.length>6?b[6]:void 0,!this.refreshingSession){e.next=5;break}return e.abrupt("return",this.createErrorResponse(l.j));case 5:return e.next=7,this.path("/items/sync");case 7:return h=e.sent,y=this.params((O(s={},u.a.SyncPayloads,t.map((function(e){return e.ejected()}))),O(s,u.a.LastSyncToken,n),O(s,u.a.PaginationToken,r),O(s,u.a.IntegrityCheck,c),O(s,u.a.SyncDlLimit,i),O(s,"content_type",f),O(s,"event",p),s)),e.next=11,this.httpService.postAbsolute(h,y,this.session.accessToken).catch(function(){var e=m(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!v.httpService.isErrorResponseExpiredToken(t)){e.next=2;break}return e.abrupt("return",v.refreshSessionThenRetryRequest({verb:o.a.Post,url:h,params:y}));case 2:return e.abrupt("return",v.errorResponseWithFallbackMessage(t,l.f));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 11:return d=e.sent,e.abrupt("return",d);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return b.apply(this,arguments)})},{key:"refreshSessionThenRetryRequest",value:(d=m(a.a.mark((function e(t){var n=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.refreshSession().then((function(e){return(null==e?void 0:e.error)?e:n.httpService.runHttp(v({},t,{authentication:n.session.accessToken}))})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"refreshSession",value:(f=m(a.a.mark((function e(){var t,n,r,o=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.refreshingSession){e.next=2;break}return e.abrupt("return",this.createErrorResponse(l.j));case 2:return this.refreshingSession=!0,e.next=5,this.path("/session/refresh");case 5:return t=e.sent,n=this.params({access_token:this.session.accessToken,refresh_token:this.session.refreshToken}),e.next=9,this.httpService.postAbsolute(t,n).then(function(){var e=m(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.a.FromResponse(t),e.next=3,o.setSession(n);case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return o.errorResponseWithFallbackMessage(e,l.g)}));case 9:return r=e.sent,this.refreshingSession=!1,e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})}])&&g(n.prototype,r),s&&g(n,s),t}(f.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return M}));var r=n(0),a=n.n(r),i=n(13),o=n(19),s=n(4),c=n(3),u=n(2),l=n(6),f=n(38),p=n.n(f),h=n(55),y=n.n(h),d=n(42),v=n.n(d),b=n(16),m=n(7),g=n(20),w=n(1),k=n(28);function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function O(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){S(i,r,a,o,s,"next",e)}function s(e){S(i,r,a,o,s,"throw",e)}o(void 0)}))}}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e,t,n){return(C="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E="org.standardnotes.sn.components",M=function(e){function t(e,n,r,a,i,o){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s=function(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?j(e):t}(this,_(t).call(this)),I(j(s),"itemManager",void 0),I(j(s),"syncService",void 0),I(j(s),"alertService",void 0),I(j(s),"environment",void 0),I(j(s),"platform",void 0),I(j(s),"timeout",void 0),I(j(s),"desktopManager",void 0),I(j(s),"componentState",{}),I(j(s),"removeItemObserver",void 0),I(j(s),"streamObservers",[]),I(j(s),"contextStreamObservers",[]),I(j(s),"activeComponents",[]),I(j(s),"permissionDialogs",[]),I(j(s),"handlers",[]),I(j(s),"detectFocusChange",(function(){var e=s.itemManager.findItems(s.activeComponents),t=!0,n=!1,r=void 0;try{for(var a,i=function(){var e=a.value;if(document.activeElement===s.iframeForComponent(e.uuid))return s.timeout((function(){s.focusChangedForComponent(e)})),"break"},o=e[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){if("break"===i())break}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}})),I(j(s),"onWindowMessage",(function(e){e.data.sessionKey&&(s.log("Component manager received message",e.data),s.handleMessage(s.componentForSessionKey(e.data.sessionKey),e.data))})),s.timeout=o||setTimeout.bind(window),s.itemManager=e,s.syncService=n,s.alertService=r,s.environment=a,s.platform=i,s.configureForGeneralUsage(),a!==k.a.Mobile&&s.configureForNonMobileUsage(),s}var n,r,f,h,d,b,S,M,R,A;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(t,e),n=t,(r=[{key:"componentsForArea",value:function(e){return this.components.filter((function(t){return t.area===e}))}},{key:"deinit",value:function(){C(_(t.prototype),"deinit",this).call(this),this.streamObservers.length=0,this.contextStreamObservers.length=0,this.activeComponents.length=0,this.permissionDialogs.length=0,this.handlers.length=0,this.itemManager=void 0,this.syncService=void 0,this.alertService=void 0,this.removeItemObserver(),this.removeItemObserver=null,window&&(window.removeEventListener("focus",this.detectFocusChange,!0),window.removeEventListener("blur",this.detectFocusChange,!0),window.removeEventListener("message",this.onWindowMessage))}},{key:"setDesktopManager",value:function(e){this.desktopManager=e,this.configureForDesktop()}},{key:"configureForGeneralUsage",value:function(){var e=this;this.removeItemObserver=this.itemManager.addObserver(s.a.Any,(function(t,n,r,a,i){var o=Object(w.f)(t,n,r),u=o.filter((function(e){return e.content_type===s.a.Component||e.content_type===s.a.Theme}));u.length>0&&a!==c.a.RemoteSaved&&e.isDesktop&&e.desktopManager.syncComponentsInstallation(u);var l=!0,f=!1,p=void 0;try{for(var h,y=u[Symbol.iterator]();!(l=(h=y.next()).done);l=!0){var d=h.value,v=e.activeComponents.includes(d.uuid);!d.active||d.deleted||v?!d.active&&v&&e.deactivateComponent(d.uuid):e.activateComponent(d.uuid)}}catch(e){f=!0,p=e}finally{try{l||null==y.return||y.return()}finally{if(f)throw p}}a!==c.a.LocalChanged&&e.notifyStreamObservers(o,a,i)}))}},{key:"notifyStreamObservers",value:function(e,t,n){var r=this,a=!0,i=!1,o=void 0;try{for(var s,c=function(){var t=s.value;if(n&&n===t.componentUuid)return"continue";var a=e.filter((function(e){return-1!==t.contentTypes.indexOf(e.content_type)}));if(0===a.length)return"continue";var i=[{name:m.a.StreamItems,content_types:t.contentTypes.sort()}];r.runWithPermissions(t.componentUuid,i,(function(){r.sendItemsInReply(t.componentUuid,a,t.originalMessage)}))},u=this.streamObservers[Symbol.iterator]();!(a=(s=u.next()).done);a=!0)c()}catch(e){i=!0,o=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw o}}var l=[{name:m.a.StreamContextItem}],f=!0,h=!1,y=void 0;try{for(var d,v=function(){var a=d.value;if(n&&n===a.componentUuid)return"continue";var i=!0,o=!1,s=void 0;try{for(var c,u=r.handlers[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var f=c.value;if((f.areas.includes(a.area)||f.areas.includes(m.b.Any))&&f.contextRequestHandler){var h=f.contextRequestHandler(a.componentUuid);if(h&&"continue"===function(){var n=p()(e,{uuid:h.uuid});if(n){if(n.deleted)return"continue";r.runWithPermissions(a.componentUuid,l,(function(){r.sendContextItemInReply(a.componentUuid,n,a.originalMessage,t)}))}}())continue}}}catch(e){o=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw s}}},b=this.contextStreamObservers[Symbol.iterator]();!(f=(d=b.next()).done);f=!0)v()}catch(e){h=!0,y=e}finally{try{f||null==b.return||b.return()}finally{if(h)throw y}}}},{key:"isNativeExtension",value:function(e){var t=[window._extensions_manager_location,window._batch_manager_location],n=e.hosted_url,r=e.local_url&&e.local_url.replace("sn://","");return t.includes(n)||t.includes(r)}},{key:"configureForNonMobileUsage",value:function(){window.addEventListener?window.addEventListener("focus",this.detectFocusChange,!0):window.attachEvent("onfocusout",this.detectFocusChange),window.addEventListener?window.addEventListener("blur",this.detectFocusChange,!0):window.attachEvent("onblur",this.detectFocusChange),window.addEventListener("message",this.onWindowMessage)}},{key:"configureForDesktop",value:function(){var e=this;this.desktopManager.registerUpdateObserver((function(t){t.active&&t.isTheme()&&e.postActiveThemesToAllComponents()}))}},{key:"postActiveThemesToAllComponents",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.components[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var i=r.value,o=this.findOrCreateDataForComponent(i);!i.isTheme()&&i.active&&o.window&&this.postActiveThemesToComponent(i)}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}},{key:"getActiveThemes",value:function(){return this.componentsForArea(m.b.Themes).filter((function(e){return e.active}))}},{key:"urlsForActiveThemes",value:function(){var e=this.getActiveThemes(),t=[],n=!0,r=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value,c=this.urlForComponent(s);c&&t.push(c)}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}},{key:"postActiveThemesToComponent",value:function(e){var t={themes:this.urlsForActiveThemes()},n={action:m.a.ActivateThemes,data:t};this.sendMessageToComponent(e,n)}},{key:"contextItemDidChangeInArea",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=this.handlers[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;if(o.areas.includes(e)||o.areas.includes(m.b.Any)){var s=this.contextStreamObservers.filter((function(t){return t.area===e})),c=!0,u=!1,l=void 0;try{for(var f,p=s[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var h=f.value;if(o.contextRequestHandler){var y=o.contextRequestHandler(h.componentUuid);y&&this.sendContextItemInReply(h.componentUuid,y,h.originalMessage)}}}catch(e){u=!0,l=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw l}}}}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"isComponentHidden",value:function(e){return this.findOrCreateDataForComponent(e).hidden}},{key:"setComponentHidden",value:function(e,t){var n=this.findOrCreateDataForComponent(e);if(t)n.hidden=!0;else if(n.hidden){n.hidden=!1;var r=p()(this.contextStreamObservers,{identifier:e.uuid});r&&this.handleStreamContextItemMessage(e,r.originalMessage);var a=p()(this.streamObservers,{identifier:e.uuid});a&&this.handleStreamItemsMessage(e,a.originalMessage)}}},{key:"jsonForItem",value:function(e,t,n){var r=n===c.a.RemoteSaved||n===c.a.LocalSaved,a=(e.getDomainData(E)||{})[t.getClientDataKey()]||{},i={uuid:e.uuid,content_type:e.content_type,created_at:e.created_at,updated_at:e.updated_at,deleted:e.deleted,isMetadataUpdate:r,content:e.content,clientData:a};return this.removePrivatePropertiesFromResponseItems([i],t),i}},{key:"sendItemsInReply",value:function(e,t,n,r){var a=this,i=this.itemManager.findItem(e);this.log("Component manager send items in reply",i,t,n);var o={},s=t.map((function(e){return a.jsonForItem(e,i,r)}));o.items=s,this.replyToMessage(i,n,o)}},{key:"sendContextItemInReply",value:function(e,t,n,r){var a=this.itemManager.findItem(e);this.log("Component manager send context item in reply",a,t,n);var i={item:this.jsonForItem(t,a,r)};this.replyToMessage(a,n,i)}},{key:"replyToMessage",value:function(e,t,n){var r={action:m.a.Reply,original:t,data:n};this.sendMessageToComponent(e,r)}},{key:"sendMessageToComponent",value:function(e,t){var n=[m.a.ComponentRegistered,m.a.ActivateThemes],r=this.findOrCreateDataForComponent(e);if(!r.hidden||n.includes(t.action)){this.log("Component manager send message to component",e,t);var a=this.urlForComponent(e);a&&r.window||this.alertService.alert("Standard Notes is trying to communicate with ".concat(e.name,", \n        but an error is occurring. Please restart this extension and try again.")),a.startsWith("http")||a.startsWith("file")||(a=window.location.href+a),r.window.postMessage(this.isMobile?JSON.stringify(t):t,a)}else this.log("Component disabled for current item, ignoring messages.",e.name)}},{key:"urlForComponent",value:function(e){if(e.offlineOnly&&!this.isDesktop)return null;if(e.offlineOnly||this.isDesktop&&e.local_url)return e.local_url&&e.local_url.replace("sn://",this.desktopManager.getExtServerHost());var t=e.hosted_url||e.legacy_url;if(this.isMobile){var n=this.platform===k.b.Ios?"localhost":"10.0.2.2";t=t.replace("localhost",n).replace("sn.local",n)}return t}},{key:"componentForUrl",value:function(e){return this.components.filter((function(t){return t.hosted_url===e||t.legacy_url===e}))[0]}},{key:"sessionKeyForComponent",value:function(e){return this.findOrCreateDataForComponent(e).sessionKey}},{key:"componentForSessionKey",value:function(e){for(var t,n=this,r=function(){var r=i[a],o=n.componentState[r];if((null==o?void 0:o.sessionKey)===e)return t=n.components.find((function(e){return e.uuid===r})),"break"},a=0,i=Object.keys(this.componentState);a<i.length&&"break"!==r();a++);if(!t){var o=!0,s=!1,c=void 0;try{for(var u,l=this.handlers[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var f=u.value;if(f.componentForSessionKeyHandler&&(t=f.componentForSessionKeyHandler(e)))break}}catch(e){s=!0,c=e}finally{try{o||null==l.return||l.return()}finally{if(s)throw c}}}return t}},{key:"handleMessage",value:function(e,t){var n=this;if(!e)return this.log("Component not defined for message, returning",t),void this.alertService.alert("An extension is trying to communicate with Standard Notes,but there is an error establishing a bridge. Please restart the app and try again.");var r=[m.a.SaveItems,m.a.AssociateItem,m.a.DeassociateItem,m.a.CreateItem,m.a.CreateItems,m.a.DeleteItems,m.a.SetComponentData];if(this.getReadonlyStateForComponent(e).readonly&&r.includes(t.action))this.alertService.alert("The extension ".concat(e.name," is trying to save, but it is in a locked state and cannot accept changes."));else{if(t.action===m.a.StreamItems)this.handleStreamItemsMessage(e,t);else if(t.action===m.a.StreamContextItem)this.handleStreamContextItemMessage(e,t);else if(t.action===m.a.SetComponentData)this.handleSetComponentDataMessage(e,t);else if(t.action===m.a.DeleteItems)this.handleDeleteItemsMessage(e,t);else if(t.action===m.a.CreateItems||t.action===m.a.CreateItem)this.handleCreateItemsMessage(e,t);else if(t.action===m.a.SaveItems)this.handleSaveItemsMessage(e,t);else if(t.action===m.a.ToggleActivateComponent){var a=this.itemManager.findItem(t.data.uuid);this.handleToggleComponentMessage(a,t)}else t.action===m.a.RequestPermissions?this.handleRequestPermissionsMessage(e,t):t.action===m.a.InstallLocalComponent?this.handleInstallLocalComponentMessage(e,t):t.action===m.a.DuplicateItem&&this.handleDuplicateItemMessage(e,t);var i=!0,o=!1,s=void 0;try{for(var c,u=function(){var r=c.value;r.actionHandler&&(r.areas.includes(e.area)||r.areas.includes(m.b.Any))&&n.timeout((function(){r.actionHandler(e,t.action,t.data)}))},l=this.handlers[Symbol.iterator]();!(i=(c=l.next()).done);i=!0)u()}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}}}},{key:"removePrivatePropertiesFromResponseItems",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t||!this.isNativeExtension(t)){var r=["autoupdateDisabled","permissions","active"];n&&(r=r.concat(["url","hosted_url","local_url"]));var a=!0,i=!1,o=void 0;try{for(var s,c=e[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var u=s.value,l=!0,f=!1,p=void 0;try{for(var h,y=r[Symbol.iterator]();!(l=(h=y.next()).done);l=!0){var d=h.value;delete u.content[d]}}catch(e){f=!0,p=e}finally{try{l||null==y.return||y.return()}finally{if(f)throw p}}}}catch(e){i=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}}}},{key:"handleStreamItemsMessage",value:function(e,t){var n=this,r=[{name:m.a.StreamItems,content_types:t.data.content_types.sort()}];this.runWithPermissions(e.uuid,r,(function(){p()(n.streamObservers,{identifier:e.uuid})||n.streamObservers.push({identifier:e.uuid,componentUuid:e.uuid,area:e.area,originalMessage:t,contentTypes:t.data.content_types});var r=[],a=!0,i=!1,o=void 0;try{for(var s,c=t.data.content_types[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var u=s.value;Object(w.j)(r,n.itemManager.nonErroredItemsForContentType(u))}}catch(e){i=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}n.sendItemsInReply(e.uuid,r,t)}))}},{key:"handleStreamContextItemMessage",value:function(e,t){var n=this,r=[{name:m.a.StreamContextItem}];this.runWithPermissions(e.uuid,r,(function(){p()(n.contextStreamObservers,{identifier:e.uuid})||n.contextStreamObservers.push({identifier:e.uuid,componentUuid:e.uuid,area:e.area,originalMessage:t});var r=!0,a=!1,i=void 0;try{for(var o,s=n.handlersForArea(e.area)[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;if(c.contextRequestHandler){var u=c.contextRequestHandler(e.uuid);u&&n.sendContextItemInReply(e.uuid,u,t)}}}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}}))}},{key:"isItemIdWithinComponentContextJurisdiction",value:function(e,t){return this.itemIdsInContextJurisdictionForComponent(t).includes(e)}},{key:"itemIdsInContextJurisdictionForComponent",value:function(e){var t=[],n=!0,r=!1,a=void 0;try{for(var i,o=this.handlersForArea(e.area)[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;if(s.contextRequestHandler){var c=s.contextRequestHandler(e.uuid);c&&t.push(c.uuid)}}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}},{key:"handlersForArea",value:function(e){return this.handlers.filter((function(t){return t.areas.includes(e)}))}},{key:"handleSaveItemsMessage",value:(A=O(a.a.mark((function e(t,n){var r,o,s,f,p,h,d,b,g,k,x,S=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.data.items,o=[],s=this.itemIdsInContextJurisdictionForComponent(t),f=r.slice(),p=!0,h=!1,d=void 0,e.prev=7,b=r.slice()[Symbol.iterator]();case 9:if(p=(g=b.next()).done){e.next=18;break}if(k=g.value,!s.includes(k.uuid)){e.next=15;break}return o.push({name:m.a.StreamContextItem}),Object(w.B)(f,k),e.abrupt("break",18);case 15:p=!0,e.next=9;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(7),h=!0,d=e.t0;case 24:e.prev=24,e.prev=25,p||null==b.return||b.return();case 27:if(e.prev=27,!h){e.next=30;break}throw d;case 30:return e.finish(27);case 31:return e.finish(24);case 32:f.length>0&&(x=y()(f.map((function(e){return e.content_type}))).sort(),o.push({name:m.a.StreamItems,content_types:x})),this.runWithPermissions(t.uuid,o,O(a.a.mark((function e(){var o,s,f,p,h,y;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S.removePrivatePropertiesFromResponseItems(r,t,!0),o=Object(i.b)(r),s=S.itemManager.findItems(o,!0),f=0,s.forEach((function(e,n){if(e)e.locked&&(v()(r,{uuid:e.uuid}),f++);else{var a=r[n];S.alertService.alert("The extension ".concat(t.name," is trying to save an item with type ")+"".concat(a.content_type,", but that item does not exist .")+"Please restart this extension and try again.")}})),!(f>0)){e.next=10;break}return p=1===f?"item":"items",h=1===f?"is":"are",S.alertService.alert("".concat(f," ").concat(p," you are attempting to save ").concat(h," locked and cannot be edited."),"Items Locked"),e.abrupt("return");case 10:return y=r.map((function(e){return Object(u.f)(e,c.a.ComponentRetrieved)})),e.next=13,S.itemManager.changeItems(o,(function(e){var n=Object(w.D)(y,{uuid:e.getUuid()});e.mergePayload(n);var a=Object(w.D)(r,{uuid:e.getUuid()});if(a.clientData){var i=Object(w.a)(e.getItem().getDomainData(E)||{});i[t.getClientDataKey()]=a.clientData,e.setDomainData(i,E)}}),l.c.UserInteraction,c.a.ComponentRetrieved,t.uuid);case 13:S.syncService.sync().then((function(){var e=Object.assign({},n);e.action=m.a.SaveSuccess,S.replyToMessage(t,n,{}),S.handleMessage(t,e)})).catch((function(){var e=Object.assign({},n);e.action=m.a.SaveError,S.replyToMessage(t,n,{error:m.a.SaveError}),S.handleMessage(t,e)}));case 14:case"end":return e.stop()}}),e)}))));case 34:case"end":return e.stop()}}),e,this,[[7,20,24,32],[25,,27,31]])}))),function(e,t){return A.apply(this,arguments)})},{key:"handleDuplicateItemMessage",value:function(e,t){var n=this,r=t.data.item,i=this.itemManager.findItem(r.uuid),o=[{name:m.a.StreamItems,content_types:[i.content_type]}];this.runWithPermissions(e.uuid,o,O(a.a.mark((function r(){var o;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.itemManager.duplicateItem(i.uuid);case 2:o=r.sent,n.syncService.sync(),n.replyToMessage(e,t,{item:n.jsonForItem(o,e)});case 5:case"end":return r.stop()}}),r)}))))}},{key:"handleCreateItemsMessage",value:function(e,t){var n=this,r=t.data.item?[t.data.item]:t.data.items,i=y()(r.map((function(e){return e.content_type}))),s=[{name:m.a.StreamItems,content_types:i}];this.runWithPermissions(e.uuid,s,O(a.a.mark((function i(){var s,f,p,h,y,d,v,b;return a.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:n.removePrivatePropertiesFromResponseItems(r,e),s=[],f=!0,p=!1,h=void 0,i.prev=5,y=a.a.mark((function t(){var r,i,f,p;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=v.value).uuid){t.next=5;break}return t.next=4,g.a.GenerateUuid();case 4:r.uuid=t.sent;case 5:return i=Object(u.f)(r,c.a.ComponentCreated),f=Object(o.a)(i),t.next=9,n.itemManager.insertItem(f);case 9:return p=t.sent,t.next=12,n.itemManager.changeItem(p.uuid,(function(t){if(r.clientData){var n=Object(w.a)(p.getDomainData(E)||{});n[e.getClientDataKey()]=r.clientData,t.setDomainData(n,E)}}),l.c.UserInteraction,c.a.ComponentCreated,e.uuid);case 12:s.push(p);case 13:case"end":return t.stop()}}),t)})),d=r[Symbol.iterator]();case 8:if(f=(v=d.next()).done){i.next=13;break}return i.delegateYield(y(),"t0",10);case 10:f=!0,i.next=8;break;case 13:i.next=19;break;case 15:i.prev=15,i.t1=i.catch(5),p=!0,h=i.t1;case 19:i.prev=19,i.prev=20,f||null==d.return||d.return();case 22:if(i.prev=22,!p){i.next=25;break}throw h;case 25:return i.finish(22);case 26:return i.finish(19);case 27:n.syncService.sync(),b=t.action===m.a.CreateItem?{item:n.jsonForItem(s[0],e)}:{items:s.map((function(t){return n.jsonForItem(t,e)}))},n.replyToMessage(e,t,b);case 30:case"end":return i.stop()}}),i,null,[[5,15,19,27],[20,,22,26]])}))))}},{key:"handleDeleteItemsMessage",value:function(e,t){var n=this,r=y()(t.data.items.map((function(e){return e.content_type}))).sort(),i=[{name:m.a.StreamItems,content_types:r}];this.runWithPermissions(e.uuid,i,O(a.a.mark((function r(){var i,o,c,u,l,f,p,h,y,d,v;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=t.data.items,o=1===i.length?"item":"items",c=null,u=!0,r.next=6,n.alertService.confirm("Are you sure you want to delete ".concat(i.length," ").concat(o,"?")).catch((function(){u=!1}));case 6:if(!u){r.next=44;break}l=!0,f=!1,p=void 0,r.prev=10,h=i[Symbol.iterator]();case 12:if(l=(y=h.next()).done){r.next=26;break}if(d=y.value,v=n.itemManager.findItem(d.uuid)){r.next=18;break}return n.alertService.alert("The item you are trying to delete cannot be found."),r.abrupt("continue",23);case 18:if(![s.a.Component,s.a.Theme].includes(v.content_type)){r.next=21;break}return r.next=21,n.deactivateComponent(v.uuid);case 21:return r.next=23,n.itemManager.setItemToBeDeleted(v.uuid);case 23:l=!0,r.next=12;break;case 26:r.next=32;break;case 28:r.prev=28,r.t0=r.catch(10),f=!0,p=r.t0;case 32:r.prev=32,r.prev=33,l||null==h.return||h.return();case 35:if(r.prev=35,!f){r.next=38;break}throw p;case 38:return r.finish(35);case 39:return r.finish(32);case 40:n.syncService.sync(),c={deleted:!0},r.next=45;break;case 44:c={deleted:!1};case 45:n.replyToMessage(e,t,c);case 46:case"end":return r.stop()}}),r,null,[[10,28,32,40],[33,,35,39]])}))))}},{key:"handleRequestPermissionsMessage",value:function(e,t){var n=this;this.runWithPermissions(e.uuid,t.data.permissions,(function(){n.replyToMessage(e,t,{approved:!0})}))}},{key:"handleSetComponentDataMessage",value:function(e,t){var n=this;this.runWithPermissions(e.uuid,[],O(a.a.mark((function r(){return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.itemManager.changeComponent(e.uuid,(function(e){e.componentData=t.data.componentData}));case 2:n.syncService.sync();case 3:case"end":return r.stop()}}),r)}))))}},{key:"handleToggleComponentMessage",value:function(e,t){this.toggleComponent(e)}},{key:"toggleComponent",value:(R=O(a.a.mark((function e(t){var n,r,i=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.area!==m.b.Modal){e.next=4;break}this.openModalComponent(t),e.next=19;break;case 4:if(!t.active){e.next=9;break}return e.next=7,this.deactivateComponent(t.uuid);case 7:e.next=19;break;case 9:if(t.content_type!==s.a.Theme){e.next=17;break}return n=t,r=this.getActiveThemes(),e.next=14,this.activateComponent(t.uuid);case 14:n.isLayerable()||setTimeout(O(a.a.mark((function e(){var t,n,o,s,c,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,o=void 0,e.prev=3,s=r[Symbol.iterator]();case 5:if(t=(c=s.next()).done){e.next=13;break}if(!(u=c.value)||u.isLayerable()){e.next=10;break}return e.next=10,i.deactivateComponent(u.uuid);case 10:t=!0,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),n=!0,o=e.t0;case 19:e.prev=19,e.prev=20,t||null==s.return||s.return();case 22:if(e.prev=22,!n){e.next=25;break}throw o;case 25:return e.finish(22);case 26:return e.finish(19);case 27:case"end":return e.stop()}}),e,null,[[3,15,19,27],[20,,22,26]])}))),10),e.next=19;break;case 17:return e.next=19,this.activateComponent(t.uuid);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"handleInstallLocalComponentMessage",value:function(e,t){if(this.isNativeExtension(e)){var n=this.itemManager.findItem(t.data.uuid);this.desktopManager.installComponent(n)}}},{key:"runWithPermissions",value:function(e,t,n){var r=this.itemManager.findItem(e);t=Object(w.a)(t);var i=r.permissions,o=!0,s=!1,c=void 0;try{for(var u,l=function(){var e=u.value,n=i.find((function(t){return t.name===e.name}));if(!n)return"continue";var r=e.content_types;if(!r)return Object(w.k)(t,e),"continue";var a=!0,o=!1,s=void 0;try{for(var c,l=n.content_types[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var f=c.value;Object(w.B)(r,f)}}catch(e){o=!0,s=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}0===r.length&&Object(w.k)(t,e)},f=t.slice()[Symbol.iterator]();!(o=(u=f.next()).done);o=!0)l()}catch(e){s=!0,c=e}finally{try{o||null==f.return||f.return()}finally{if(s)throw c}}t.length>0?this.promptForPermissions(r,t,function(){var e=O(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&n();case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()):n()}},{key:"promptForPermissions",value:function(e,t,n){var r,i=this,o={component:e,permissions:t,permissionsString:this.permissionsStringForPermissions(t,e),actionBlock:n,callback:(r=O(a.a.mark((function n(r){return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!r){n.next=5;break}return i.log("Changing component to expand permissions",e),n.next=4,i.itemManager.changeItem(e.uuid,(function(n){var r=Object(w.a)(e.permissions),a=!0,i=!1,o=void 0;try{for(var s,c=function(){var e=s.value,t=r.find((function(t){return t.name===e.name}));if(t){var n=t.content_types||[];t.content_types=y()(n.concat(e.content_types))}else r.push(e)},u=t[Symbol.iterator]();!(a=(s=u.next()).done);a=!0)c()}catch(e){i=!0,o=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw o}}n.permissions=r}));case 4:i.syncService.sync();case 5:i.permissionDialogs=i.permissionDialogs.filter((function(n){return n===o?(n.actionBlock&&n.actionBlock(r),!1):!!(n.component!==e||n.permissions!==t&&(a=t,n.permissions.some((function(e){return!a.find((function(t){return JSON.stringify(t)===JSON.stringify(e)}))}))))||(r&&n.actionBlock&&n.actionBlock(r),!1);var a})),i.permissionDialogs.length>0&&i.presentPermissionsDialog(i.permissionDialogs[0]);case 7:case"end":return n.stop()}}),n)}))),function(e){return r.apply(this,arguments)})},s=p()(this.permissionDialogs,{component:e});this.permissionDialogs.push(o),s?this.log("Existing dialog, not presenting."):this.presentPermissionsDialog(o)}},{key:"presentPermissionsDialog",value:function(e){throw"Must override SNComponentManager.presentPermissionsDialog"}},{key:"openModalComponent",value:function(e){throw"Must override SNComponentManager.presentPermissionsDialog"}},{key:"registerHandler",value:function(e){var t=this;return this.handlers.push(e),function(){var n=p()(t.handlers,{identifier:e.identifier});n?Object(w.B)(t.handlers,n):t.log("Attempting to deregister non-existing handler")}}},{key:"findOrCreateDataForComponent",value:function(e){var t=this.componentState[e.uuid];return t||(t={},this.componentState[e.uuid]=t),t}},{key:"setReadonlyStateForComponent",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.findOrCreateDataForComponent(e);r.readonly=t,r.lockReadonly=n}},{key:"getReadonlyStateForComponent",value:function(e){var t=this.findOrCreateDataForComponent(e);return{readonly:t.readonly,lockReadonly:t.lockReadonly}}},{key:"registerComponentWindow",value:(M=O(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("Register component window",t),(r=this.findOrCreateDataForComponent(t)).window===n&&this.log("Web|componentManager","attempting to re-register same component window."),this.log("Web|componentManager|registerComponentWindow",t),r.window=n,e.next=7,g.a.GenerateUuid();case 7:r.sessionKey=e.sent,this.sendMessageToComponent(t,{action:m.a.ComponentRegistered,sessionKey:r.sessionKey,componentData:t.componentData,data:{uuid:t.uuid,environment:Object(k.c)(this.environment),platform:Object(k.g)(this.platform),activeThemeUrls:this.urlsForActiveThemes()}}),this.postActiveThemesToComponent(t),this.desktopManager&&this.desktopManager.notifyComponentActivation(t);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return M.apply(this,arguments)})},{key:"registerComponent",value:function(e){this.log("Registering component",e),Object(w.b)(this.activeComponents,e);var t=this.itemManager.findItem(e),n=!0,r=!1,a=void 0;try{for(var i,o=this.handlers[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;(s.areas.includes(t.area)||s.areas.includes(m.b.Any))&&s.activationHandler&&s.activationHandler(t)}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}t.area===m.b.Themes&&this.postActiveThemesToAllComponents()}},{key:"activateComponent",value:(S=O(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log("Activating component",t),(n=this.itemManager.findItem(t)).active){e.next=5;break}return e.next=5,this.itemManager.changeComponent(n.uuid,(function(e){e.active=!0}));case 5:this.registerComponent(t),this.syncService.sync();case 7:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"deregisterComponent",value:function(e){this.log("Degregistering component",e);var t=this.itemManager.findItem(e);Object(w.B)(this.activeComponents,e),delete this.componentState[t.uuid];var n=!0,r=!1,a=void 0;try{for(var i,o=this.handlers[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;(s.areas.includes(t.area)||s.areas.includes(m.b.Any))&&s.activationHandler&&s.activationHandler(t)}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}this.streamObservers=this.streamObservers.filter((function(t){return t.componentUuid!==e})),this.contextStreamObservers=this.contextStreamObservers.filter((function(t){return t.componentUuid!==e})),t.area===m.b.Themes&&this.postActiveThemesToAllComponents()}},{key:"deactivateComponent",value:(b=O(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log("Deactivating component",t),!(r=null===(n=this.itemManager)||void 0===n?void 0:n.findItem(t)).active){e.next=5;break}return e.next=5,this.itemManager.changeComponent(r.uuid,(function(e){e.active=!1}));case 5:this.findOrCreateDataForComponent(r).sessionKey=void 0,this.deregisterComponent(t),this.syncService.sync();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"reloadComponent",value:(d=O(a.a.mark((function e(t){var n,r,i=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("Reloading component",t),r=null===(n=this.itemManager)||void 0===n?void 0:n.findItem(t),e.next=4,this.itemManager.changeComponent(r.uuid,(function(e){e.active=!1}));case 4:return this.deregisterComponent(r.uuid),e.abrupt("return",new Promise((function(e){i.timeout(O(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.itemManager.changeComponent(r.uuid,(function(e){e.active=!0}));case 2:i.registerComponent(r.uuid),e();case 4:case"end":return t.stop()}}),t)}))))})));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"deleteComponent",value:(h=O(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.itemManager.setItemToBeDeleted(t);case 2:this.syncService.sync();case 3:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"isComponentActive",value:function(e){return e.active}},{key:"iframeForComponent",value:function(e){for(var t=0,n=Array.from(document.getElementsByTagName("iframe"));t<n.length;t++){var r=n[t];if(r.dataset.componentId===e)return r}}},{key:"focusChangedForComponent",value:function(e){var t=document.activeElement===this.iframeForComponent(e.uuid),n=!0,r=!1,a=void 0;try{for(var i,o=this.handlers[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;s.focusHandler&&s.focusHandler(e,t)}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}}},{key:"handleSetSizeEvent",value:function(e,t){var n=function(e,n){var r=Object(w.s)(n.width)?n.width:"".concat(t.width,"px"),a=Object(w.s)(n.height)?n.height:"".concat(t.height,"px");e&&e.setAttribute("style","width:".concat(r,"; height:").concat(a,";"))};if(e.area===m.b.Rooms||e.area===m.b.Modal){var r=e.area===m.b.Rooms?"inner":"outer",a=document.getElementById("component-content-".concat(r,"-").concat(e.uuid));a&&n(a,t)}else{var i=this.iframeForComponent(e.uuid);if(!i)return;if(n(i,t),e.area===m.b.EditorStack){var o=i.parentElement;o&&n(o,t)}}}},{key:"editorForNote",value:function(e){var t,n=this.componentsForArea(m.b.Editor),r=!0,a=!1,i=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;if(c.isExplicitlyEnabledForItem(e.uuid))return c}}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return this.isMobile?e.mobilePrefersPlainEditor||(t=this.getDefaultEditor()):e.prefersPlainEditor||(t=this.getDefaultEditor()),t&&!t.isExplicitlyDisabledForItem(e.uuid)?t:void 0}},{key:"getDefaultEditor",value:function(){var e=this.componentsForArea(m.b.Editor);return this.isMobile?e.filter((function(e){return e.isMobileDefault}))[0]:e.filter((function(e){return e.isDefaultEditor()}))[0]}},{key:"permissionsStringForPermissions",value:function(e,t){var n="",r=e.length,a=function(e,t){return e>0?e===t-1?2===t?" and ":", and ":", ":""};return e.forEach((function(e,i){if(e.name===m.a.StreamItems){for(var o=e.content_types.map((function(e){var t=Object(s.c)(e);return t?t+"s":"items of type "+e})),c="",u=0;u<o.length;u++){var l=o[u];c+=a(u,o.length+r-i-1),c+=l}n+=a(i,r),n+=c,o.length>=2&&i<r-1&&(n+=", ")}else if(e.name===m.a.StreamContextItem){var f,p=(I(f={},m.b.EditorStack,"working note"),I(f,m.b.NoteTags,"working note"),I(f,m.b.Editor,"working note"),f);n+=a(i,r),n+=p[t.area]}})),n+"."}},{key:"isDesktop",get:function(){return this.environment===k.a.Desktop}},{key:"isMobile",get:function(){return this.environment===k.a.Mobile}},{key:"components",get:function(){return this.itemManager.getItems([s.a.Component,s.a.Theme])}}])&&P(n.prototype,r),f&&P(n,f),t}(b.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return S}));var r=n(0),a=n.n(r),i=n(1),o=n(2),s=n(88),c=n(3),u=n(4),l=n(13),f=n(16),p=n(41),h=n(23);function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function v(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){d(i,r,a,o,s,"next",e)}function s(e){d(i,r,a,o,s,"throw",e)}o(void 0)}))}}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t,n){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=function(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?m(e):t}(this,w(t).call(this)),x(m(e),"changeObservers",[]),x(m(e),"collection",void 0),x(m(e),"emitQueue",[]),e.collection=new p.a,e}var n,r,f,d,S,O,P,j;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,e),n=t,(r=[{key:"getMasterCollection",value:function(){return h.a.FromCollection(this.collection)}},{key:"deinit",value:function(){g(w(t.prototype),"deinit",this).call(this),this.changeObservers.length=0,this.resetState()}},{key:"resetState",value:function(){this.collection=new p.a}},{key:"find",value:function(e){return this.collection.findAll(e)}},{key:"emitCollection",value:(j=v(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.emitPayloads(t.all(),t.source,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return j.apply(this,arguments)})},{key:"emitPayload",value:(P=v(a.a.mark((function e(t,n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.emitPayloads([t],n,r);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return P.apply(this,arguments)})},{key:"emitPayloads",value:(O=v(a.a.mark((function e(t,n,r){var i=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 0===t.length&&console.warn("Attempting to emit 0 payloads."),e.abrupt("return",new Promise((function(e){i.emitQueue.push({payloads:t,source:n,sourceKey:r,resolve:e}),1===i.emitQueue.length&&i.popQueue()})));case 2:case"end":return e.stop()}}),e)}))),function(e,t,n){return O.apply(this,arguments)})},{key:"popQueue",value:(S=v(a.a.mark((function e(){var t,n,r,o,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.emitQueue[0],n=this.mergePayloadsOntoMaster(t.payloads),r=n.changed,o=n.inserted,s=n.discarded,this.notifyChangeObservers(r,o,s,t.source,t.sourceKey),Object(i.B)(this.emitQueue,t),t.resolve(),this.emitQueue.length>0&&this.popQueue();case 6:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"mergePayloadsOntoMaster",value:function(e){var t=[],n=[],r=[],a=!0,i=!1,s=void 0;try{for(var c,u=e[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value;if(l.uuid&&l.content_type){var f=this.collection.find(l.uuid),p=f?Object(o.g)(f,l):l;p.discardable?(this.collection.discard(p),r.push(p)):(this.collection.set(p),f?t.push(p):n.push(p))}else console.error("Payload is corrupt:",l)}}catch(e){i=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw s}}return{changed:t,inserted:n,discarded:r}}},{key:"addObserver",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Array.isArray(e)||(e=[e]);var a={types:e,priority:r,callback:t};return this.changeObservers.push(a),function(){Object(i.B)(n.changeObservers,a)}}},{key:"notifyChangeObservers",value:function(e,t,n,r,a){var i=this.changeObservers.slice().sort((function(e,t){return e.priority<t.priority?-1:1})),o=function(e,t){return t.includes(u.a.Any)?e.slice():e.slice().filter((function(e){return t.includes(e.content_type)}))},s=!0,c=!1,l=void 0;try{for(var f,p=i[Symbol.iterator]();!(s=(f=p.next()).done);s=!0){var h=f.value;h.callback(o(e,h.types),o(t,h.types),o(n,h.types),r,a)}}catch(e){c=!0,l=e}finally{try{s||null==p.return||p.return()}finally{if(c)throw l}}}},{key:"importPayloads",value:(d=v(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new s.a(this.getMasterCollection(),h.a.WithPayloads(t,c.a.FileImport)),e.next=3,n.resultingCollection();case 3:return r=e.sent,e.next=6,this.emitCollection(r);case 6:return e.abrupt("return",Object(l.b)(r.payloads));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"removePayloadLocally",value:function(e){this.collection.discard(e)}}])&&b(n.prototype,r),f&&b(n,f),t}(f.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return x}));var r=n(0),a=n.n(r),i=n(4),o=n(6),s=n(16),c=n(1),u=n(2),l=n(20),f=n(10),p=n(13);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){y(i,r,a,o,s,"next",e)}function s(e){y(i,r,a,o,s,"throw",e)}o(void 0)}))}}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t,n){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var x=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?b(e):t}(this,g(t).call(this)),k(b(r),"itemManager",void 0),k(b(r),"syncService",void 0),k(b(r),"resolveQueue",[]),k(b(r),"registeredPredicates",[]),k(b(r),"removeItemObserver",void 0),k(b(r),"removeSyncObserver",void 0),r.itemManager=e,r.syncService=n,r.addObservers(),r}var n,r,s,y,x,S;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,e),n=t,(r=[{key:"deinit",value:function(){this.syncService=void 0,this.itemManager=void 0,this.resolveQueue.length=0,this.registeredPredicates.length=0,this.removeItemObserver(),this.removeItemObserver=void 0,this.removeSyncObserver(),this.removeSyncObserver=void 0,m(g(t.prototype),"deinit",this).call(this)}},{key:"popResolveQueue",value:function(){var e=this.resolveQueue.slice();return this.resolveQueue=[],e}},{key:"addObservers",value:function(){var e=this;this.removeItemObserver=this.itemManager.addObserver(i.a.Any,(function(t,n){n.length>0&&(e.resolveQueue=e.resolveQueue.concat(n))})),this.removeSyncObserver=this.syncService.addEventObserver(function(){var t=d(a.a.mark((function t(n){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n!==f.a.DownloadFirstSyncCompleted&&n!==f.a.FullSyncCompleted){t.next=3;break}return t.next=3,e.resolveSingletonsForItems(e.popResolveQueue(),n);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"registerPredicate",value:function(e){this.registeredPredicates.push(e)}},{key:"validItemsMatchingPredicate",value:function(e){return this.itemManager.itemsMatchingPredicate(e).filter((function(e){return!e.errorDecrypting}))}},{key:"resolveSingletonsForItems",value:(S=d(a.a.mark((function e(t,n){var r,i,o,s,u,l,p,h,y,d,v,b=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=b.registeredPredicates[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;if(e.satisfiesPredicate(o))return b.validItemsMatchingPredicate(o)}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}},i=function(e){return e.isSingleton?b.validItemsMatchingPredicate(e.singletonPredicate):null},o=function(e){var t=i(e);return t&&t.length>0?t:r(e)},s=[],u=!0,l=!1,p=void 0,e.prev=7,h=t[Symbol.iterator]();case 9:if(u=(y=h.next()).done){e.next=22;break}if(d=y.value,!s.includes(d)){e.next=13;break}return e.abrupt("continue",19);case 13:if(v=o(d),Object(c.j)(s,v||[]),v&&!(v.length<=1)){e.next=17;break}return e.abrupt("continue",19);case 17:return e.next=19,this.handleStrategy(v,d.singletonStrategy);case 19:u=!0,e.next=9;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(7),l=!0,p=e.t0;case 28:e.prev=28,e.prev=29,u||null==h.return||h.return();case 31:if(e.prev=31,!l){e.next=34;break}throw p;case 34:return e.finish(31);case 35:return e.finish(28);case 36:s.length>0&&n===f.a.FullSyncCompleted&&setTimeout((function(){b.syncService.sync()}));case 37:case"end":return e.stop()}}),e,this,[[7,24,28,36],[29,,31,35]])}))),function(e,t){return S.apply(this,arguments)})},{key:"handleStrategy",value:(x=d(a.a.mark((function e(t,n){var r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n===o.e.KeepEarliest){e.next=2;break}throw"Unhandled singleton strategy";case 2:return r=t.sort((function(e,t){return e.errorDecrypting?1:t.errorDecrypting||e.created_at<t.created_at?-1:1})),i=Object(c.d)(r,0),e.next=6,this.itemManager.setItemsToBeDeleted(Object(p.b)(i));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return x.apply(this,arguments)})},{key:"findOrCreateSingleton",value:(y=d(a.a.mark((function e(t,n,r){var i=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=d(a.a.mark((function e(o){var s,c,f,h,y,d,v;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((s=i.validItemsMatchingPredicate(t)).length>0)){e.next=3;break}return e.abrupt("return",o(s[0]));case 3:if(i.syncService.getLastSyncDate()){e.next=14;break}return c=!1,f=i.itemManager.addObserver(n,(function(e,n){if(n.length>0){var r=i.itemManager.subItemsMatchingPredicates(n,[t]);r.length>0&&(c=!0,o(r[0]))}})),e.next=8,i.syncService.sync();case 8:if(f(),!c){e.next=11;break}return e.abrupt("return");case 11:if(!((h=i.validItemsMatchingPredicate(t)).length>0)){e.next=14;break}return e.abrupt("return",o(h[0]));case 14:return y=i.itemManager.itemsMatchingPredicate(t).filter((function(e){return e.errorDecrypting})),e.next=17,i.itemManager.setItemsToBeDeleted(Object(p.b)(y));case 17:return e.t0=u.e,e.next=20,l.a.GenerateUuid();case 20:return e.t1=e.sent,e.t2=n,e.t3=r,e.t4=new Date,e.t5={uuid:e.t1,content_type:e.t2,content:e.t3,dirty:!0,dirtiedDate:e.t4},d=(0,e.t0)(e.t5),e.next=28,i.itemManager.emitItemFromPayload(d);case 28:if(v=e.sent){e.next=31;break}throw Error("Created singleton item should not be null ".concat(n));case 31:return e.next=33,i.syncService.sync();case 33:return e.abrupt("return",o(v));case 34:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),function(e,t,n){return y.apply(this,arguments)})}])&&v(n.prototype,r),s&&v(n,s),t}(s.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return w}));var r=n(0),a=n.n(r),i=n(2),o=n(16),s=n(90),c=n(3),u=n(8),l=n(1);function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function h(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){p(i,r,a,o,s,"next",e)}function s(e){p(i,r,a,o,s,"throw",e)}o(void 0)}))}}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e,t,n){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var w=function(e){function t(e,n,r,a){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=function(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?d(e):t}(this,b(t).call(this)),g(d(i),"itemManager",void 0),g(d(i),"storageService",void 0),g(d(i),"contentTypes",[]),g(d(i),"timeout",void 0),g(d(i),"historySession",void 0),g(d(i),"removeChangeObserver",void 0),g(d(i),"persistable",!1),g(d(i),"autoOptimize",!1),g(d(i),"saveTimeout",void 0),i.itemManager=e,i.storageService=n,i.contentTypes=r,i.timeout=a,i}var n,r,o,p,w,k,x,S,O,P;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,e),n=t,(r=[{key:"deinit",value:function(){this.itemManager=void 0,this.storageService=void 0,this.contentTypes.length=0,this.historySession=void 0,this.timeout=null,this.removeChangeObserver&&(this.removeChangeObserver(),this.removeChangeObserver=null),v(b(t.prototype),"deinit",this).call(this)}},{key:"initializeFromDisk",value:(P=h(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.getValue(u.b.SessionHistoryPersistable);case 2:return this.persistable=e.sent,e.next=5,this.storageService.getValue(u.b.SessionHistoryRevisions).then((function(e){return s.a.FromJson(e)}));case 5:return this.historySession=e.sent,e.next=8,this.storageService.getValue(u.b.SessionHistoryOptimize);case 8:t=e.sent,Object(l.p)(t)?this.autoOptimize=!0:this.autoOptimize=t,this.addChangeObserver();case 11:case"end":return e.stop()}}),e,this)}))),function(){return P.apply(this,arguments)})},{key:"addChangeObserver",value:function(){var e=this;this.removeChangeObserver=this.itemManager.addObserver(this.contentTypes,(function(t,n,r,a){var i=Object(l.f)(t,n,r);if(a!==c.a.LocalChanged){var o=!0,s=!1,u=void 0;try{for(var f,p=i[Symbol.iterator]();!(o=(f=p.next()).done);o=!0){var h=f.value;try{h.deleted||h.errorDecrypting||e.addHistoryEntryForItem(h)}catch(e){console.error("Unable to add item history entry:",e)}}}catch(e){s=!0,u=e}finally{try{o||null==p.return||p.return()}finally{if(s)throw u}}}}))}},{key:"isDiskEnabled",value:function(){return this.persistable}},{key:"isAutoOptimizeEnabled",value:function(){return this.autoOptimize}},{key:"saveToDisk",value:(O=h(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.persistable){e.next=2;break}return e.abrupt("return");case 2:this.storageService.setValue(u.b.SessionHistoryRevisions,this.historySession);case 3:case"end":return e.stop()}}),e,this)}))),function(){return O.apply(this,arguments)})},{key:"setSessionItemRevisionThreshold",value:function(e){this.historySession.setItemRevisionThreshold(e)}},{key:"addHistoryEntryForItem",value:(S=h(a.a.mark((function e(t){var n,r,o=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(i.f)(t,c.a.SessionHistory),r=this.historySession.addEntryForPayload(n),this.autoOptimize&&this.historySession.optimizeHistoryForItem(t.uuid),r&&this.persistable&&(this.saveTimeout&&(this.timeout.hasOwnProperty("cancel")?this.timeout.cancel(this.saveTimeout):clearTimeout(this.saveTimeout)),this.saveTimeout=this.timeout((function(){o.saveToDisk()}),2e3));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"historyForItem",value:function(e){return this.historySession.historyForItem(e.uuid)}},{key:"clearHistoryForItem",value:(x=h(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.historySession.clearItemHistory(t),e.abrupt("return",this.saveToDisk());case 2:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"clearAllHistory",value:(k=h(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.historySession.clearAllHistory(),e.abrupt("return",this.storageService.removeValue(u.b.SessionHistoryRevisions));case 2:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"toggleDiskSaving",value:(w=h(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.persistable=!this.persistable,!this.persistable){e.next=6;break}this.storageService.setValue(u.b.SessionHistoryPersistable,!0),this.saveToDisk(),e.next=8;break;case 6:return this.storageService.setValue(u.b.SessionHistoryPersistable,!1),e.abrupt("return",this.storageService.removeValue(u.b.SessionHistoryRevisions));case 8:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"toggleAutoOptimize",value:(p=h(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.autoOptimize=!this.autoOptimize,this.autoOptimize?this.storageService.setValue(u.b.SessionHistoryOptimize,!0):this.storageService.setValue(u.b.SessionHistoryOptimize,!1);case 2:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})}])&&y(n.prototype,r),o&&y(n,o),t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return M}));var r=n(0),a=n.n(r),i=n(37),o=n(43),s=n(21),c=n(47),u=n(30),l=n(48),f=n(53),p=n(27),h=n(20),y=n(31),d=n(19),v=n(13),b=n(16),m=n(7),g=n(1),w=n(2),k=n(6),x=n(3),S=n(4);function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function j(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){P(i,r,a,o,s,"next",e)}function s(e){P(i,r,a,o,s,"throw",e)}o(void 0)}))}}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var M=function(e){function t(e){var n,r,a,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?D(e):t}(this,_(t).call(this)),E(D(n),"modelManager",void 0),E(D(n),"unsubChangeObserver",void 0),E(D(n),"observers",[]),E(D(n),"collection",void 0),E(D(n),"systemSmartTags",void 0),n.modelManager=e,n.createCollection(),n.unsubChangeObserver=n.modelManager.addObserver(S.a.Any,n.onPayloadChange.bind(D(n))),n.systemSmartTags=(r=Object(w.e)({uuid:"all-notes",content_type:S.a.SmartTag,content:Object(v.a)({title:"All notes",isSystemTag:!0,isAllTag:!0,predicate:p.a.FromArray(["content_type","=",S.a.Note])})}),a=Object(w.e)({uuid:"archived-notes",content_type:S.a.SmartTag,content:Object(v.a)({title:"Archived",isSystemTag:!0,isArchiveTag:!0,predicate:p.a.FromArray(["archived","=",JSON.stringify(!0)])})}),i=Object(w.e)({uuid:"trashed-notes",content_type:S.a.SmartTag,content:Object(v.a)({title:"Trash",isSystemTag:!0,isTrashTag:!0,predicate:p.a.FromArray(["trashed","=",JSON.stringify(!0)])})}),[Object(d.a)(r),Object(d.a)(a),Object(d.a)(i)]),n}var n,r,b,P,M,R,A,T,K,F,L,N,V,W,U,B,H,z,q,J,G,Q,$,Y,X,Z;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(t,e),n=t,(r=[{key:"setDisplayOptions",value:function(e,t,n,r){this.collection.setDisplayOptions(e,t,n,r)}},{key:"getDisplayableItems",value:function(e){return this.collection.displayElements(e)}},{key:"deinit",value:function(){this.unsubChangeObserver(),this.unsubChangeObserver=void 0,this.modelManager=void 0,this.collection=void 0}},{key:"resetState",value:function(){this.createCollection()}},{key:"createCollection",value:function(){this.collection=new i.b,this.collection.setDisplayOptions(S.a.Note,i.a.CreatedAt,"dsc"),this.collection.setDisplayOptions(S.a.Tag,i.a.Title,"asc"),this.collection.setDisplayOptions(S.a.ItemsKey,i.a.CreatedAt,"asc"),this.collection.setDisplayOptions(S.a.Component,i.a.CreatedAt,"asc"),this.collection.setDisplayOptions(S.a.SmartTag,i.a.Title,"asc")}},{key:"findItem",value:function(e){return this.collection.find(e)}},{key:"findItems",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.collection.findAll(e,t)}},{key:"itemsKeys",value:function(){return this.collection.displayElements(S.a.ItemsKey)}},{key:"addObserver",value:function(e,t){var n=this;Array.isArray(e)||(e=[e]);var r={contentType:e,callback:t};return this.observers.push(r),function(){Object(g.B)(n.observers,r)}}},{key:"itemsReferencingItem",value:function(e){if(!Object(g.s)(e))throw Error("Must use uuid string");var t=this.collection.uuidsThatReferenceUuid(e);return this.findItems(t)}},{key:"referencesForItem",value:function(e){if(!Object(g.s)(e))throw Error("Must use uuid string");var t=this.findItem(e).references.map((function(e){return e.uuid}));return this.findItems(t)}},{key:"onPayloadChange",value:(Z=j(a.a.mark((function e(t,n,r,i,o){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.setPayloads(t,n,r,i,o));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,a){return Z.apply(this,arguments)})},{key:"setPayloads",value:(X=j(a.a.mark((function e(t,n,r,i,o){var s,c,u,l,f,p,h,y,v,b;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=t.map((function(e){return Object(d.a)(e)})),c=n.map((function(e){return Object(d.a)(e)})),(u=s.concat(c)).length>0&&this.collection.set(u),l=r.map((function(e){return Object(d.a)(e)})),f=!0,p=!1,h=void 0,e.prev=8,y=l[Symbol.iterator]();!(f=(v=y.next()).done);f=!0)b=v.value,this.collection.discard(b);e.next=16;break;case 12:e.prev=12,e.t0=e.catch(8),p=!0,h=e.t0;case 16:e.prev=16,e.prev=17,f||null==y.return||y.return();case 19:if(e.prev=19,!p){e.next=22;break}throw h;case 22:return e.finish(19);case 23:return e.finish(16);case 24:return e.next=26,this.notifyObservers(s,c,l,i,o);case 26:case"end":return e.stop()}}),e,this,[[8,12,16,24],[17,,19,23]])}))),function(e,t,n,r,a){return X.apply(this,arguments)})},{key:"notifyObservers",value:(Y=j(a.a.mark((function e(t,n,r,i,o){var s,c,u,l,f,p,h,y,d,v,b;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=function(e,t){return e.filter((function(e){return t.includes(S.a.Any)||t.includes(e.content_type)}))},c=this.observers.slice(),u=!0,l=!1,f=void 0,e.prev=5,p=c[Symbol.iterator]();case 7:if(u=(h=p.next()).done){e.next=19;break}if(y=h.value,d=s(t,y.contentType),v=s(n,y.contentType),b=s(r,y.contentType),0!==d.length||0!==v.length||0!==b.length){e.next=14;break}return e.abrupt("continue",16);case 14:return e.next=16,y.callback(d,v,b,i,o);case 16:u=!0,e.next=7;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(5),l=!0,f=e.t0;case 25:e.prev=25,e.prev=26,u||null==p.return||p.return();case 28:if(e.prev=28,!l){e.next=31;break}throw f;case 31:return e.finish(28);case 32:return e.finish(25);case 33:case"end":return e.stop()}}),e,this,[[5,21,25,33],[26,,28,32]])}))),function(e,t,n,r,a){return Y.apply(this,arguments)})},{key:"changeItem",value:($=j(a.a.mark((function e(t,n){var r,i,o,s,c=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>2&&void 0!==c[2]?c[2]:k.c.UserInteraction,i=c.length>3&&void 0!==c[3]?c[3]:x.a.LocalChanged,o=c.length>4?c[4]:void 0,Object(g.s)(t)){e.next=5;break}throw Error("Invalid uuid for changeItem");case 5:return e.next=7,this.changeItems([t],n,r,i,o);case 7:return s=e.sent,e.abrupt("return",s[0]);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return $.apply(this,arguments)})},{key:"createMutatorForItem",value:function(e,t){return e.content_type===S.a.Note?new l.a(e,t):e.content_type===S.a.Tag?new c.b(e,t):e.content_type===S.a.Component?new m.c(e,t):e.content_type===S.a.ActionsExtension?new f.a(e,t):e.content_type===S.a.ItemsKey?new u.a(e,t):e.content_type===S.a.Privileges?new s.b(e,t):e.content_type===S.a.UserPrefs?new o.b(e,t):new k.b(e,t)}},{key:"changeItems",value:(Q=j(a.a.mark((function e(t,n){var r,i,o,s,c,u,l,f,p,h,y,d,v,b,m=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=m.length>2&&void 0!==m[2]?m[2]:k.c.UserInteraction,i=m.length>3&&void 0!==m[3]?m[3]:x.a.LocalChanged,o=m.length>4?m[4]:void 0,s=this.findItems(t,!0),c=[],u=!0,l=!1,f=void 0,e.prev=8,p=s[Symbol.iterator]();case 10:if(u=(h=p.next()).done){e.next=21;break}if(y=h.value){e.next=14;break}throw Error("Attempting to change non-existant item");case 14:d=this.createMutatorForItem(y,r),n&&n(d),v=d.getResult(),c.push(v);case 18:u=!0,e.next=10;break;case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(8),l=!0,f=e.t0;case 27:e.prev=27,e.prev=28,u||null==p.return||p.return();case 30:if(e.prev=30,!l){e.next=33;break}throw f;case 33:return e.finish(30);case 34:return e.finish(27);case 35:return e.next=37,this.modelManager.emitPayloads(c,i,o);case 37:return b=this.findItems(c.map((function(e){return e.uuid}))),e.abrupt("return",b);case 39:case"end":return e.stop()}}),e,this,[[8,23,27,35],[28,,30,34]])}))),function(e,t){return Q.apply(this,arguments)})},{key:"changeNote",value:(G=j(a.a.mark((function e(t,n){var r,i,o,s,c,u=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>2&&void 0!==u[2]?u[2]:k.c.UserInteraction,i=u.length>3&&void 0!==u[3]?u[3]:x.a.LocalChanged,o=u.length>4?u[4]:void 0,s=this.findItem(t)){e.next=6;break}throw Error("Attempting to change non-existant note");case 6:return c=new l.a(s,r),e.abrupt("return",this.applyTransform(c,n,i,o));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return G.apply(this,arguments)})},{key:"changeComponent",value:(J=j(a.a.mark((function e(t,n){var r,i,o,s,c,u=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>2&&void 0!==u[2]?u[2]:k.c.UserInteraction,i=u.length>3&&void 0!==u[3]?u[3]:x.a.LocalChanged,o=u.length>4?u[4]:void 0,s=this.findItem(t)){e.next=6;break}throw Error("Attempting to change non-existant component");case 6:return c=new m.c(s,r),e.abrupt("return",this.applyTransform(c,n,i,o));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return J.apply(this,arguments)})},{key:"changeActionsExtension",value:(q=j(a.a.mark((function e(t,n){var r,i,o,s,c,u=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>2&&void 0!==u[2]?u[2]:k.c.UserInteraction,i=u.length>3&&void 0!==u[3]?u[3]:x.a.LocalChanged,o=u.length>4?u[4]:void 0,s=this.findItem(t)){e.next=6;break}throw Error("Attempting to change non-existant extension");case 6:return c=new f.a(s,r),e.abrupt("return",this.applyTransform(c,n,i,o));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return q.apply(this,arguments)})},{key:"changeItemsKey",value:(z=j(a.a.mark((function e(t,n){var r,i,o,s,c,l=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>2&&void 0!==l[2]?l[2]:k.c.UserInteraction,i=l.length>3&&void 0!==l[3]?l[3]:x.a.LocalChanged,o=l.length>4?l[4]:void 0,s=this.findItem(t)){e.next=6;break}throw Error("Attempting to change non-existant itemsKey");case 6:return c=new u.a(s,r),e.abrupt("return",this.applyTransform(c,n,i,o));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return z.apply(this,arguments)})},{key:"applyTransform",value:(H=j(a.a.mark((function e(t,n){var r,i,o,s=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:x.a.LocalChanged,i=s.length>3?s[3]:void 0,n(t),o=t.getResult(),e.abrupt("return",this.modelManager.emitPayload(o,r,i));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return H.apply(this,arguments)})},{key:"setItemDirty",value:(B=j(a.a.mark((function e(t){var n,r,i=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],Object(g.s)(t)){e.next=3;break}throw Error("Must use uuid when setting item dirty");case 3:return e.next=5,this.setItemsDirty([t],n);case 5:return r=e.sent,e.abrupt("return",r[0]);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"setItemsDirty",value:(U=j(a.a.mark((function e(t){var n,r=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]&&r[1],Object(g.s)(t[0])){e.next=3;break}throw Error("Must use uuid when setting item dirty");case 3:return e.abrupt("return",this.changeItems(t,void 0,n?k.c.UserInteraction:k.c.Internal));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"getDirtyItems",value:function(){return this.collection.dirtyElements().filter((function(e){return!e.errorDecrypting||e.deleted}))}},{key:"insertItem",value:(W=j(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,e.next=3,this.emitItemFromPayload(n);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return W.apply(this,arguments)})},{key:"duplicateItem",value:(V=j(a.a.mark((function e(t){var n,r,i,o,s,c=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]&&c[1],r=this.findItem(t),i=Object(w.e)(r),e.next=5,Object(y.c)(i,this.modelManager.getMasterCollection(),n);case 5:return o=e.sent,e.next=8,this.modelManager.emitPayloads(o,x.a.LocalChanged);case 8:return s=this.findItem(o[0].uuid),e.abrupt("return",s);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"createItem",value:(N=j(a.a.mark((function e(t,n){var r,i,o,s=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=s.length>2&&void 0!==s[2]&&s[2],i=s.length>3?s[3]:void 0,t){e.next=4;break}throw"Attempting to create item with no contentType";case 4:return e.t0=w.e,e.next=7,h.a.GenerateUuid();case 7:return e.t1=e.sent,e.t2=t,e.t3=n?Object(v.a)(n):void 0,e.t4=r,e.t5={uuid:e.t1,content_type:e.t2,content:e.t3,dirty:e.t4},e.t6=i,o=(0,e.t0)(e.t5,e.t6),e.next=16,this.modelManager.emitPayload(o,x.a.Constructor);case 16:return e.abrupt("return",this.findItem(o.uuid));case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return N.apply(this,arguments)})},{key:"createTemplateItem",value:(L=j(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=w.e,e.next=3,h.a.GenerateUuid();case 3:return e.t1=e.sent,e.t2=t,e.t3=Object(v.a)(n||{}),e.t4={uuid:e.t1,content_type:e.t2,content:e.t3},r=(0,e.t0)(e.t4),e.abrupt("return",Object(d.a)(r));case 9:case"end":return e.stop()}}),e)}))),function(e,t){return L.apply(this,arguments)})},{key:"emitItemFromPayload",value:(F=j(a.a.mark((function e(t){var n,r=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:x.a.Constructor,e.next=3,this.modelManager.emitPayload(t,n);case 3:return e.abrupt("return",this.findItem(t.uuid));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"emitItemsFromPayloads",value:(K=j(a.a.mark((function e(t){var n,r,i=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:x.a.Constructor,e.next=3,this.modelManager.emitPayloads(t,n);case 3:return r=Object(v.b)(t),e.abrupt("return",this.findItems(r));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return K.apply(this,arguments)})},{key:"setItemToBeDeleted",value:(T=j(a.a.mark((function e(t){var n,r,i,o,s,c,u,l,f,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.collection.uuidsThatReferenceUuid(t),r=this.findItem(t),e.next=4,this.changeItem(t,(function(e){e.setDeleted()}));case 4:i=e.sent,o=!0,s=!1,c=void 0,e.prev=8,u=n[Symbol.iterator]();case 10:if(o=(l=u.next()).done){e.next=19;break}if(f=l.value,!(p=this.findItem(f))){e.next=16;break}return e.next=16,this.changeItem(p.uuid,(function(e){e.removeItemAsRelationship(r)}));case 16:o=!0,e.next=10;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(8),s=!0,c=e.t0;case 25:e.prev=25,e.prev=26,o||null==u.return||u.return();case 28:if(e.prev=28,!s){e.next=31;break}throw c;case 31:return e.finish(28);case 32:return e.finish(25);case 33:return e.abrupt("return",i);case 34:case"end":return e.stop()}}),e,this,[[8,21,25,33],[26,,28,32]])}))),function(e){return T.apply(this,arguments)})},{key:"setItemsToBeDeleted",value:(A=j(a.a.mark((function e(t){var n,r,i,o,s,c,u,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=!0,i=!1,o=void 0,e.prev=4,s=t[Symbol.iterator]();case 6:if(r=(c=s.next()).done){e.next=15;break}return u=c.value,e.next=10,this.setItemToBeDeleted(u);case 10:l=e.sent,n.push(l);case 12:r=!0,e.next=6;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),i=!0,o=e.t0;case 21:e.prev=21,e.prev=22,r||null==s.return||s.return();case 24:if(e.prev=24,!i){e.next=27;break}throw o;case 27:return e.finish(24);case 28:return e.finish(21);case 29:return e.abrupt("return",n);case 30:case"end":return e.stop()}}),e,this,[[4,17,21,29],[22,,24,28]])}))),function(e){return A.apply(this,arguments)})},{key:"getItems",value:function(e){return this.collection.all(e)}},{key:"nonErroredItemsForContentType",value:function(e){return this.collection.all(e).filter((function(e){return!e.errorDecrypting&&!e.waitingForKey}))}},{key:"itemsMatchingPredicate",value:function(e){return this.itemsMatchingPredicates([e])}},{key:"itemsMatchingPredicates",value:function(e){return this.subItemsMatchingPredicates(this.items,e)}},{key:"subItemsMatchingPredicates",value:function(e,t){return e.filter((function(e){if(e.deleted)return!1;var n=!0,r=!1,a=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;if(!e.satisfiesPredicate(s))return!1}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return!0}))}},{key:"findTagByTitle",value:function(e){return Object(g.D)(this.tags,{title:e})}},{key:"findOrCreateTagByTitle",value:(R=j(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.findTagByTitle(t),e.t0=n,e.t0){e.next=6;break}return e.next=5,this.createItem(S.a.Tag,Object(v.a)({title:t}),!0);case 5:e.t0=e.sent;case 6:return e.abrupt("return",e.t0);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"notesMatchingSmartTag",value:function(e){var t=[new p.a("content_type","=",S.a.Note),e.predicate];if(!e.isTrashTag){var n=new p.a("content.trashed","=",!1);t.push(n)}return this.itemsMatchingPredicates(t)}},{key:"emptyTrash",value:(M=j(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.trashedItems,e.abrupt("return",this.setItemsToBeDeleted(Object(v.b)(t)));case 2:case"end":return e.stop()}}),e,this)}))),function(){return M.apply(this,arguments)})},{key:"getSmartTags",value:function(){var e=this.collection.displayElements(S.a.SmartTag);return this.systemSmartTags.concat(e)}},{key:"removeAllItemsFromMemory",value:(P=j(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(v.b)(this.items),e.next=3,this.changeItems(t,(function(e){e.setDeleted()}),k.c.NonDirtying);case 3:this.resetState(),this.modelManager.resetState();case 5:case"end":return e.stop()}}),e,this)}))),function(){return P.apply(this,arguments)})},{key:"removeItemLocally",value:function(e){this.collection.discard(e),this.modelManager.removePayloadLocally(e.payload)}},{key:"items",get:function(){return this.collection.all()}},{key:"nonDeletedItems",get:function(){return this.collection.nondeletedElements()}},{key:"invalidItems",get:function(){return this.collection.invalidElements()}},{key:"notes",get:function(){return this.collection.displayElements(S.a.Note)}},{key:"tags",get:function(){return this.collection.displayElements(S.a.Tag)}},{key:"components",get:function(){return this.collection.displayElements(S.a.Component)}},{key:"trashSmartTag",get:function(){return this.systemSmartTags.find((function(e){return e.isTrashTag}))}},{key:"trashedItems",get:function(){return this.notesMatchingSmartTag(this.trashSmartTag)}},{key:"noteCount",get:function(){return this.collection.all(S.a.Note).length}}])&&C(n.prototype,r),b&&C(n,b),t}(b.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return q}));var r={};n.r(r),n.d(r,"Migration20200115",(function(){return T}));var a=n(0),i=n.n(a),o=n(24),s=n(25),c=n(4),u=n(29),l=n(11),f=n(9),p=n(8),h=n(15),y=n(13),d=n(14),v=n(94),b=n(2),m=n(3),g=n(1),w=n(20),k=n(54),x=n(17),S=n(28);function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function _(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){C(i,r,a,o,s,"next",e)}function s(e){C(i,r,a,o,s,"throw",e)}o(void 0)}))}}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var A={WebPasscodeParamsKey:"offlineParams",MobilePasscodeParamsKey:"pc_params",AllAccountKeyParamsKey:"auth_params",WebEncryptedStorageKey:"encryptedStorage",MobileWrappedRootKeyKey:"encrypted_account_keys",AllMigrations:"migrations"},T=function(e){function t(){return D(this,t),E(this,M(t).apply(this,arguments))}var n,r,a,o,v,O,C,T,K,F,L,N,V;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(t,e),n=t,r=[{key:"registerStageHandlers",value:function(){var e=this;this.registerStageHandler(s.a.PreparingForLaunch_0,_(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Object(S.e)(e.services.environment)){t.next=4;break}return t.abrupt("return",e.migrateStorageStructureForWebDesktop());case 4:if(!Object(S.d)(e.services.environment)){t.next=6;break}return t.abrupt("return",e.migrateStorageStructureForMobile());case 6:case"end":return t.stop()}}),t)})))),this.registerStageHandler(s.a.StorageDecrypted_09,_(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.migrateArbitraryRawStorageToManagedStorageAllPlatforms();case 2:return t.next=4,e.migrateSessionStorage();case 4:return t.next=6,e.deleteLegacyStorageValues();case 6:case"end":return t.stop()}}),t)})))),this.registerStageHandler(s.a.LoadingDatabase_11,_(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.createDefaultItemsKeyForAllPlatforms();case 2:e.markDone();case 3:case"end":return t.stop()}}),t)}))))}},{key:"migrateStorageStructureForWebDesktop",value:(V=_(i.a.mark((function e(){var t,n,r,a,o,s,c,l,h,y,v,m,w,k,x,S,O,P,C;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.services.deviceInterface,j(t={},d.e.Wrapped,{}),j(t,d.e.Unwrapped,{}),j(t,d.e.Nonwrapped,{}),r=t,e.next=4,n.getJsonParsedStorageValue(A.AllAccountKeyParamsKey);case 4:return(a=e.sent)&&(r.nonwrapped[p.b.RootKeyParams]=a),e.next=8,n.getJsonParsedStorageValue(A.WebEncryptedStorageKey);case 8:if(!(o=e.sent)){e.next=36;break}return s=Object(b.e)(o),e.next=13,this.webDesktopHelperGetPasscodeKeyAndDecryptEncryptedStorage(s);case 13:if(c=e.sent,l=c.key,h=c.decryptedStoragePayload,y=c.keyParams,r.nonwrapped[p.b.RootKeyWrapperKeyParams]=y.getPortableValue(),v=Object(g.a)(h.contentObject.storage),m=Object(g.v)(v),r.nonwrapped[p.b.RootKeyParams]=m[A.AllAccountKeyParamsKey],w=l,Object(g.p)(m.mk)){e.next=31;break}return e.next=26,this.webDesktopHelperExtractAndWrapAccountKeysFromValueStore(l,m);case 26:k=e.sent,x=k.accountKey,S=k.wrappedKey,w=x,r.nonwrapped[p.b.WrappedRootKey]=S;case 31:return e.next=33,this.webDesktopHelperEncryptStorage(w,h,m);case 33:r.wrapped=e.sent,e.next=55;break;case 36:return e.next=38,this.services.deviceInterface.getRawStorageValue("ak");case 38:return O=e.sent,P=Object(g.p)(O)?f.a.V002:f.a.V003,e.t0=u.a,e.next=43,this.services.deviceInterface.getRawStorageValue("mk");case 43:return e.t1=e.sent,e.next=46,this.services.deviceInterface.getRawStorageValue("pw");case 46:return e.t2=e.sent,e.t3=O,e.t4=P,e.t5={masterKey:e.t1,serverPassword:e.t2,dataAuthenticationKey:e.t3,version:e.t4},e.next=52,e.t0.Create.call(e.t0,e.t5);case 52:return C=e.sent,e.next=55,this.services.deviceInterface.setKeychainValue(C.getPersistableValue());case 55:return e.next=57,this.allPlatformHelperSetStorageStructure(r);case 57:case"end":return e.stop()}}),e,this)}))),function(){return V.apply(this,arguments)})},{key:"allPlatformHelperSetStorageStructure",value:(N=_(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=d.a.defaultValuesObject(t.wrapped,t.unwrapped,t.nonwrapped))[d.e.Unwrapped]=void 0,e.next=4,this.services.deviceInterface.setRawStorageValue(Object(p.c)(this.services.namespace,p.a.StorageObject),JSON.stringify(n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"webDesktopHelperGetPasscodeKeyAndDecryptEncryptedStorage",value:(L=_(i.a.mark((function e(t){var n,r,a,o,s,c,u,l,f,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.deviceInterface.getJsonParsedStorageValue(A.WebPasscodeParamsKey);case 2:n=e.sent,r=this.services.protocolService.createKeyParams(n),o=!0,c=new h.a([h.d.LocalPasscode],h.b.Migration);case 6:if(!o){e.next=23;break}return u={},e.next=10,this.requestChallengeResponse(c,!1,u);case 10:return l=e.sent,f=l.getValueForType(h.d.LocalPasscode),p=f.value,e.next=15,this.services.protocolService.computeRootKey(p,r);case 15:return s=e.sent,e.next=18,this.services.protocolService.payloadByDecryptingPayload(t,s);case 18:a=e.sent,o=a.errorDecrypting,u.orchestrator.setValidationStatus(f,!a.errorDecrypting),e.next=6;break;case 23:return e.abrupt("return",{decryptedStoragePayload:a,key:s,keyParams:r});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"webDesktopHelperExtractAndWrapAccountKeysFromValueStore",value:(F=_(i.a.mark((function e(t,n){var r,a,o,s,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.ak?f.a.V003:f.a.V002,e.next=3,u.a.Create({masterKey:n.mk,serverPassword:n.pw,dataAuthenticationKey:n.ak,version:a});case 3:if(o=e.sent,delete n.mk,delete n.pw,delete n.ak,s=Object(b.e)(o),!t){e.next=12;break}return e.next=11,this.services.protocolService.payloadByEncryptingPayload(s,l.a.LocalStorageEncrypted,t);case 11:c=e.sent;case 12:return e.abrupt("return",{accountKey:o,wrappedKey:null===(r=c)||void 0===r?void 0:r.ejected()});case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return F.apply(this,arguments)})},{key:"webDesktopHelperEncryptStorage",value:(K=_(i.a.mark((function e(t,n,r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.protocolService.payloadByEncryptingPayload(Object(b.b)(n,{content_type:c.a.EncryptedStorage,content:r}),l.a.LocalStoragePreferEncrypted,t);case 2:return a=e.sent,e.abrupt("return",a.ejected());case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return K.apply(this,arguments)})},{key:"migrateStorageStructureForMobile",value:(T=_(i.a.mark((function e(){var t,n,r,a,o,s,v,m,k,x,S,O,P,C,D,I,E,M,R,T,K,F=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.deviceInterface.getJsonParsedStorageValue(A.MobileWrappedRootKeyKey);case 2:return r=e.sent,e.next=5,this.services.deviceInterface.getJsonParsedStorageValue(A.AllAccountKeyParamsKey);case 5:return a=e.sent,e.next=8,this.services.deviceInterface.getJsonParsedStorageValue(A.MobilePasscodeParamsKey);case 8:return o=e.sent,j(n={},d.e.Nonwrapped,(j(t={},p.b.WrappedRootKey,r),j(t,p.b.RootKeyWrapperKeyParams,o),j(t,p.b.RootKeyParams,a),t)),j(n,d.e.Unwrapped,{}),j(n,d.e.Wrapped,{}),s=n,e.next=12,this.services.deviceInterface.getKeychainValue();case 12:if(v=e.sent,!o){e.next=56;break}if(m=this.services.protocolService.createKeyParams(o),k=function(){var e=_(i.a.mark((function e(){var t,n,r,a,o,s,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=v.offline.pw,r=new h.a([h.d.LocalPasscode],h.b.Migration),a={};case 3:if(n&&n.serverPassword===t){e.next=15;break}return e.next=6,F.requestChallengeResponse(r,!1,a);case 6:return o=e.sent,s=o.getValueForType(h.d.LocalPasscode),c=s.value,e.next=11,F.services.protocolService.computeRootKey(c,m);case 11:n=e.sent,a.orchestrator.setValidationStatus(s,n.serverPassword===t),e.next=3;break;case 15:return e.abrupt("return",n);case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=v.offline.timing,s.unwrapped[p.b.MobilePasscodeTiming]=x,!r){e.next=36;break}return e.next=21,k();case 21:return S=e.sent,e.next=24,this.services.protocolService.payloadByDecryptingPayload(Object(b.e)(r),S);case 24:return O=e.sent,P=O.contentObject.accountKeys,C=Object(g.p)(P.ak)?f.a.V002:f.a.V003,D=Object(b.b)(O,{content:{masterKey:P.mk,serverPassword:P.pw,dataAuthenticationKey:P.ak,version:P.version||C,accountKeys:null}}),e.next=30,this.services.protocolService.payloadByEncryptingPayload(D,l.a.LocalStoragePreferEncrypted,S);case 30:return I=e.sent,s.nonwrapped[p.b.WrappedRootKey]=I.ejected(),e.next=34,this.services.deviceInterface.clearKeychainValue();case 34:e.next=54;break;case 36:if(r){e.next=54;break}return e.next=39,k();case 39:return E=e.sent,e.t0=b.e,e.next=43,w.a.GenerateUuid();case 43:return e.t1=e.sent,e.t2=Object(y.a)(s.unwrapped),e.t3=c.a.EncryptedStorage,e.t4={uuid:e.t1,content:e.t2,content_type:e.t3},M=(0,e.t0)(e.t4),e.next=50,this.services.protocolService.payloadByEncryptingPayload(M,l.a.LocalStoragePreferEncrypted,E);case 50:return R=e.sent,s.wrapped=R.ejected(),e.next=54,this.services.deviceInterface.clearKeychainValue();case 54:e.next=64;break;case 56:if(!v||!v.mk){e.next=64;break}return T=Object(g.p)(v.ak)?f.a.V002:f.a.V003,e.next=61,u.a.Create({masterKey:v.mk,serverPassword:v.pw,dataAuthenticationKey:v.ak,version:v.version||T});case 61:return K=e.sent,e.next=64,this.services.deviceInterface.setKeychainValue(K.getPersistableValue());case 64:return e.next=66,this.allPlatformHelperSetStorageStructure(s);case 66:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"migrateArbitraryRawStorageToManagedStorageAllPlatforms",value:(C=_(i.a.mark((function e(){var t,n,r,a,o,s,c,u,l,f,p,h,y,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.deviceInterface.getAllRawStorageKeyValues();case 2:t=e.sent,n=Object(g.x)(A),r=function(e){try{return JSON.parse(e)}catch(t){return e}},a=this.services.namespace,o=!0,s=!1,c=void 0,e.prev=9,u=t[Symbol.iterator]();case 11:if(o=(l=u.next()).done){e.next=25;break}if(f=l.value,p=f.key,h=f.value,y=a&&a.length>0&&p.startsWith(a),!n.includes(p)&&!y){e.next=18;break}return e.abrupt("continue",22);case 18:if(Object(g.p)(h)){e.next=22;break}return d=r(h),e.next=22,this.services.storageService.setValue(p,d);case 22:o=!0,e.next=11;break;case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(9),s=!0,c=e.t0;case 31:e.prev=31,e.prev=32,o||null==u.return||u.return();case 34:if(e.prev=34,!s){e.next=37;break}throw c;case 37:return e.finish(34);case 38:return e.finish(31);case 39:case"end":return e.stop()}}),e,this,[[9,27,31,39],[32,,34,38]])}))),function(){return C.apply(this,arguments)})},{key:"deleteLegacyStorageValues",value:(O=_(i.a.mark((function e(){var t,n,r,a,o,s,c,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=["mk","ak","jwt","ephemeral","cachedThemes"],n=[].concat(P(Object(g.x)(p.b)),P(Object(g.x)(A)),t),r=!0,a=!1,o=void 0,e.prev=5,s=n[Symbol.iterator]();case 7:if(r=(c=s.next()).done){e.next=14;break}return u=c.value,e.next=11,this.services.deviceInterface.removeRawStorageValue(u);case 11:r=!0,e.next=7;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(5),a=!0,o=e.t0;case 20:e.prev=20,e.prev=21,r||null==s.return||s.return();case 23:if(e.prev=23,!a){e.next=26;break}throw o;case 26:return e.finish(23);case 27:return e.finish(20);case 28:case"end":return e.stop()}}),e,this,[[5,16,20,28],[21,,23,27]])}))),function(){return O.apply(this,arguments)})},{key:"migrateSessionStorage",value:(v=_(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.services.storageService.getValue("jwt");case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return");case 6:return n=new k.a(t),e.next=9,this.services.storageService.setValue(p.b.Session,n);case 9:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"createDefaultItemsKeyForAllPlatforms",value:(o=_(i.a.mark((function e(){var t,n,r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.protocolService.getRootKey();case 2:if(!(t=e.sent)){e.next=19;break}return e.next=6,this.services.protocolService.getRootKeyParams();case 6:return n=e.sent,e.t0=b.e,e.next=10,w.a.GenerateUuid();case 10:return e.t1=e.sent,e.t2=c.a.ItemsKey,e.t3=Object(y.a)({itemsKey:t.masterKey,dataAuthenticationKey:t.dataAuthenticationKey,version:n.version}),e.t4=new Date,e.t5={uuid:e.t1,content_type:e.t2,content:e.t3,dirty:!0,dirtiedDate:e.t4},r=(0,e.t0)(e.t5),a=Object(x.f)(r),e.next=19,this.services.itemManager.emitItemFromPayload(a.payloadRepresentation(),m.a.LocalChanged);case 19:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})}],a=[{key:"timestamp",value:function(){return new Date("2020-01-15").getTime()}}],r&&I(n.prototype,r),a&&I(n,a),t}(v.a),K=n(89);function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function N(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){L(i,r,a,o,s,"next",e)}function s(e){L(i,r,a,o,s,"throw",e)}o(void 0)}))}}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e,t,n){return(U="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=B(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var q=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){return!t||"object"!==F(t)&&"function"!=typeof t?W(e):t}(this,B(t).call(this)),z(W(r),"challengeResponder",void 0),z(W(r),"activeMigrations",void 0),z(W(r),"services",void 0),z(W(r),"handledFullSyncStage",!1),r.services=e,r.challengeResponder=n,r}var n,a,c,u,l,f,h,y,d,v,b;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(t,e),n=t,(a=[{key:"deinit",value:function(){this.services=void 0,this.challengeResponder=void 0,this.activeMigrations&&(this.activeMigrations.length=0),U(B(t.prototype),"deinit",this).call(this)}},{key:"initialize",value:(b=N(i.a.mark((function e(){var t,n=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.runBaseMigration();case 2:return e.next=4,this.getRequiredMigrations();case 4:this.activeMigrations=e.sent,this.activeMigrations.length>0&&(t=Object(g.w)(this.activeMigrations)).onDone(N(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.saveLastMigrationTimestamp(t.constructor.timestamp());case 2:case"end":return e.stop()}}),e)}))));case 6:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"handleApplicationStage",value:(v=N(i.a.mark((function e(n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(B(t.prototype),"handleApplicationStage",this).call(this,n);case 2:return e.next=4,this.handleStage(n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"handleApplicationEvent",value:(d=N(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==o.a.SignedIn){e.next=5;break}return e.next=3,this.handleStage(s.a.SignedIn_30);case 3:e.next=10;break;case 5:if(t!==o.a.CompletedFullSync){e.next=10;break}if(this.handledFullSyncStage){e.next=10;break}return this.handledFullSyncStage=!0,e.next=10,this.handleStage(s.a.FullSyncCompleted_13);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"runBaseMigration",value:(y=N(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new K.a(this.services),e.next=3,t.handleStage(s.a.PreparingForLaunch_0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"getRequiredMigrations",value:(h=N(i.a.mark((function e(){var t,n,a,o,s,c,u,l,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLastMigrationTimestamp();case 2:for(t=e.sent,n=[],a=Object.keys(r).map((function(e){return r[e]})).sort((function(e,t){var n=e.timestamp(),r=t.timestamp();return n<r?-1:n>r?1:0})),o=!0,s=!1,c=void 0,e.prev=8,u=a[Symbol.iterator]();!(o=(l=u.next()).done);o=!0)(f=l.value).timestamp()>t&&n.push(new f(this.services,this.challengeResponder));e.next=16;break;case 12:e.prev=12,e.t0=e.catch(8),s=!0,c=e.t0;case 16:e.prev=16,e.prev=17,o||null==u.return||u.return();case 19:if(e.prev=19,!s){e.next=22;break}throw c;case 22:return e.finish(19);case 23:return e.finish(16);case 24:return e.abrupt("return",n);case 25:case"end":return e.stop()}}),e,this,[[8,12,16,24],[17,,19,23]])}))),function(){return h.apply(this,arguments)})},{key:"getTimeStampKey",value:function(){return Object(p.c)(this.services.namespace,p.a.LastMigrationTimestamp)}},{key:"getLastMigrationTimestamp",value:(f=N(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.deviceInterface.getRawStorageValue(this.getTimeStampKey());case 2:if(t=e.sent,!Object(g.p)(t)){e.next=5;break}throw"Timestamp should not be null. Be sure to run base migration first.";case 5:return e.abrupt("return",JSON.parse(t));case 6:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"saveLastMigrationTimestamp",value:(l=N(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.deviceInterface.setRawStorageValue(this.getTimeStampKey(),JSON.stringify(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"handleStage",value:(u=N(i.a.mark((function e(t){var n,r,a,o,s,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,r=!1,a=void 0,e.prev=3,o=this.activeMigrations[Symbol.iterator]();case 5:if(n=(s=o.next()).done){e.next=12;break}return c=s.value,e.next=9,c.handleStage(t);case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),r=!0,a=e.t0;case 18:e.prev=18,e.prev=19,n||null==o.return||o.return();case 21:if(e.prev=21,!r){e.next=24;break}throw a;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))),function(e){return u.apply(this,arguments)})}])&&V(n.prototype,a),c&&V(n,c),t}(n(16).a)},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return c}));var c=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}(this,a(t).call(this,e)),s(i(n),"notes",[]),s(i(n),"data",{}),s(i(n),"url",void 0),s(i(n),"name",void 0),s(i(n),"isDefault",void 0),s(i(n),"systemEditor",void 0),n.url=e.safeContent.url,n.name=e.safeContent.name,n.data=e.safeContent.data||{},n.isDefault=e.safeContent.default,n.systemEditor=e.safeContent.systemEditor,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(t,e),t}(n(6).d)},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(47),a=n(27);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(e){var n,r,c,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?s(e):t}(this,o(t).call(this,e)),r=s(n),u=void 0,(c="predicate")in r?Object.defineProperty(r,c,{value:u,enumerable:!0,configurable:!0,writable:!0}):r[c]=u,e.safeContent.predicate&&(n.predicate=a.a.FromJson(e.safeContent.predicate)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,e),t}(r.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var r=n(0),a=n.n(r),i=n(2),o=n(32),s=n(49),c=n(3),u=n(23),l=n(1);function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function h(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){p(i,r,a,o,s,"next",e)}function s(e){p(i,r,a,o,s,"throw",e)}o(void 0)}))}}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(){return y(this,t),v(this,b(t).apply(this,arguments))}var n,r,o,f,p;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,e),n=t,(r=[{key:"resultingCollection",value:(p=h(a.a.mark((function e(){var t,n,r,o,s,f,p,h,y;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=!0,r=!1,o=void 0,e.prev=4,s=this.applyCollection.all()[Symbol.iterator]();case 6:if(n=(f=s.next()).done){e.next=16;break}return p=f.value,e.next=10,this.payloadsByHandlingPayload(p,t);case 10:h=e.sent,y=h.map((function(e){return Object(i.b)(e,{dirty:!0,dirtiedDate:new Date,deleted:!1})})),Object(l.j)(t,y);case 13:n=!0,e.next=6;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(4),r=!0,o=e.t0;case 22:e.prev=22,e.prev=23,n||null==s.return||s.return();case 25:if(e.prev=25,!r){e.next=28;break}throw o;case 28:return e.finish(25);case 29:return e.finish(22);case 30:return e.abrupt("return",u.a.WithPayloads(t,c.a.FileImport));case 31:case"end":return e.stop()}}),e,this,[[4,18,22,30],[23,,25,29]])}))),function(){return p.apply(this,arguments)})},{key:"payloadsByHandlingPayload",value:(f=h(a.a.mark((function e(t,n){var r,i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=n.find((function(e){return e.contentObject.conflict_of===t.uuid})))||(r=n.find((function(e){return e.uuid===t.uuid}))),r||(r=this.findBasePayload(t.uuid)),r){e.next=5;break}return e.abrupt("return",[t]);case 5:return i=new s.a(this.baseCollection,r,t,c.a.FileImport),e.next=8,i.resultingCollection();case 8:return o=e.sent,e.abrupt("return",o.all());case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})}])&&d(n.prototype,r),o&&d(n,o),t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(0),a=n.n(r),i=n(94),o=n(8),s=n(25),c=n(1);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){l(i,r,a,o,s,"next",e)}function s(e){l(i,r,a,o,s,"throw",e)}o(void 0)}))}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(e){function t(){return p(this,t),y(this,d(t).apply(this,arguments))}var n,r,i,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,e),n=t,r=[{key:"registerStageHandlers",value:function(){var e=this;this.registerStageHandler(s.a.PreparingForLaunch_0,f(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.migrateMigrationTimestampAllPlatforms();case 2:e.markDone();case 3:case"end":return t.stop()}}),t)}))))}},{key:"migrateMigrationTimestampAllPlatforms",value:(u=f(a.a.mark((function e(){var t,n,r,i,s,u,l,f,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!1,n=0,r=["migrations","ephemeral","user","cachedThemes","syncToken","encryptedStorage"];case 3:if(!(n<r.length)){e.next=14;break}return i=r[n],e.next=7,this.services.deviceInterface.getRawStorageValue(i);case 7:if(!e.sent){e.next=11;break}return t=!0,e.abrupt("break",14);case 11:n++,e.next=3;break;case 14:return s=Object(o.c)(this.services.namespace,o.a.LastMigrationTimestamp),e.next=17,this.services.deviceInterface.getRawStorageValue(s);case 17:if(u=e.sent,(l=!Object(c.p)(u))||!t){e.next=25;break}return f=new Date(0).getTime(),e.next=23,this.services.deviceInterface.setRawStorageValue(s,f);case 23:e.next=32;break;case 25:if(l||t){e.next=31;break}return p=(new Date).getTime(),e.next=29,this.services.deviceInterface.setRawStorageValue(s,p);case 29:e.next=32;break;case 31:case 32:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})}],i=[{key:"timestamp",value:function(){return new Date("2020-01-01").getTime()}}],r&&h(n.prototype,r),i&&h(n,i),t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(67);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"content",void 0),i(this,"itemRevisionThreshold",60),this.content=t,this.content||(this.content={itemUUIDToItemHistoryMapping:{}})}var t,n,o;return t=e,o=[{key:"FromJson",value:function(t){if(t){var n=t.content;return Object.keys(n.itemUUIDToItemHistoryMapping).forEach((function(e){var t=n.itemUUIDToItemHistoryMapping[e];n.itemUUIDToItemHistoryMapping[e]=r.a.FromJson(t)})),new e(n)}return new e}}],(n=[{key:"addEntryForPayload",value:function(e){return this.historyForItem(e.uuid).addHistoryEntryForItem(e)}},{key:"historyForItem",value:function(e){var t=this.content.itemUUIDToItemHistoryMapping[e];return t||(t=new r.a,this.content.itemUUIDToItemHistoryMapping[e]=t),t}},{key:"clearItemHistory",value:function(e){this.historyForItem(e.uuid).clear()}},{key:"clearAllHistory",value:function(){this.content.itemUUIDToItemHistoryMapping={}}},{key:"setItemRevisionThreshold",value:function(e){this.itemRevisionThreshold=e}},{key:"optimizeHistoryForItem",value:function(e){var t=this.historyForItem(e);t.entries.length>this.itemRevisionThreshold&&t.optimize()}}])&&a(t.prototype,n),o&&a(t,o),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(1),a=n(2),i=n(17);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"payload",void 0),s(this,"defaultContentKeyToDiffOn","text"),s(this,"textCharDiffLength",0),s(this,"hasPreviousEntry",!1);var n=t.updated_at;Object(r.s)(n)&&(n=new Date(n)),this.payload=Object(a.b)(t,{updated_at:n})}var t,n,c;return t=e,(n=[{key:"setPreviousEntry",value:function(e){this.hasPreviousEntry=null!=e,this.payload.contentObject[this.defaultContentKeyToDiffOn]&&(this.textCharDiffLength=e?this.payload.contentObject[this.defaultContentKeyToDiffOn].length-e.payload.contentObject[this.defaultContentKeyToDiffOn].length:this.payload.contentObject[this.defaultContentKeyToDiffOn].length)}},{key:"operationVector",value:function(){return void 0!==this.textCharDiffLength?this.hasPreviousEntry&&0!==this.textCharDiffLength?this.textCharDiffLength<0?-1:1:0:1}},{key:"deltaSize",value:function(){return void 0!==this.textCharDiffLength?Math.abs(this.textCharDiffLength):1}},{key:"isSameAsEntry",value:function(e){if(!e)return!1;var t=Object(i.f)(this.payload),n=Object(i.f)(e.payload);return t.isItemContentEqualWith(n)}}])&&o(t.prototype,n),c&&o(t,c),e}()},function(e,t,n){"use strict";function r(e,t){return e.sort((function(e,n){var r=new Date(n.updated_at).getTime()-new Date(e.updated_at).getTime(),a=0,i=0;return t&&(a=t.indexOf(e.content_type),i=t.indexOf(n.content_type),-1===a&&(a=t.length),-1===i&&(i=t.length)),a===i?r:a<i?-1:1}))}n.d(t,"a",(function(){return r}))},function(e,t,n){var r=n(125),a=n(131)((function(e,t,n){r(e,t,n)}));e.exports=a},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(0),a=n.n(r);function i(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){i(o,r,a,s,c,"next",e)}function c(e){i(o,r,a,s,c,"throw",e)}s(void 0)}))}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,"services",void 0),c(this,"challengeResponder",void 0),c(this,"stageHandlers",{}),c(this,"onDoneHandler",void 0),this.services=t,this.challengeResponder=n,this.registerStageHandlers()}var t,n,r,i,u;return t=e,n=[{key:"registerStageHandler",value:function(e,t){this.stageHandlers[e]=t}},{key:"markDone",value:function(){this.onDoneHandler&&this.onDoneHandler(),this.onDoneHandler=void 0}},{key:"onDone",value:function(e){this.onDoneHandler=e}},{key:"handleStage",value:(u=o(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.stageHandlers[t])){e.next=4;break}return e.next=4,n();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"requestChallengeResponse",value:(i=o(a.a.mark((function e(t,n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.challengeResponder(t,n,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})}],r=[{key:"timestamp",value:function(){throw"Must override"}}],n&&s(t.prototype,n),r&&s(t,r),e}()},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=n(143),i=n(199),o=n(110),s=n(34),c=n(210);e.exports=function(e){return"function"==typeof e?e:null==e?o:"object"==r(e)?s(e)?i(e[0],e[1]):a(e):c(e)}},function(e,t,n){var r=n(70),a=n(150),i=n(151),o=n(152),s=n(153),c=n(154);function u(e){var t=this.__data__=new r(e);this.size=t.size}u.prototype.clear=a,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=s,u.prototype.set=c,e.exports=u},function(e,t,n){var r=n(50)(n(36),"Map");e.exports=r},function(e,t,n){var r=n(56),a=n(39);e.exports=function(e){if(!a(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t,n){var r=n(161),a=n(168),i=n(170),o=n(171),s=n(172);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=a,c.prototype.get=i,c.prototype.has=o,c.prototype.set=s,e.exports=c},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},function(e,t,n){var r=n(119),a=n(192),i=n(62);e.exports=function(e){return i(e)?r(e):a(e)}},function(e,t,n){var r=n(187),a=n(51),i=Object.prototype,o=i.hasOwnProperty,s=i.propertyIsEnumerable,c=r(function(){return arguments}())?r:function(e){return a(e)&&o.call(e,"callee")&&!s.call(e,"callee")};e.exports=c},function(e,t,n){(function(e){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=n(36),i=n(188),o="object"==r(t)&&t&&!t.nodeType&&t,s=o&&"object"==r(e)&&e&&!e.nodeType&&e,c=s&&s.exports===o?a.Buffer:void 0,u=(c?c.isBuffer:void 0)||i;e.exports=u}).call(this,n(68)(e))},function(e,t,n){var r=n(189),a=n(190),i=n(191),o=i&&i.isTypedArray,s=o?a(o):r;e.exports=s},function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t,n){var r=n(108),a=n(63);e.exports=function(e,t){for(var n=0,i=(t=r(t,e)).length;null!=e&&n<i;)e=e[a(t[n++])];return n&&n==i?e:void 0}},function(e,t,n){var r=n(34),a=n(109),i=n(201),o=n(204);e.exports=function(e,t){return r(e)?e:a(e,t)?[e]:i(o(e))}},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=n(34),i=n(76),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;e.exports=function(e,t){if(a(e))return!1;var n=r(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!i(e))||(s.test(e)||!o.test(e)||null!=t&&e in Object(t))}},function(e,t){e.exports=function(e){return e}},function(e,t,n){var r=n(127);e.exports=function(e,t,n){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},function(e,t,n){(function(t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r="object"==(void 0===t?"undefined":n(t))&&t&&t.Object===Object&&t;e.exports=r}).call(this,n(69))},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,n){var r=n(173),a=n(51);e.exports=function e(t,n,i,o,s){return t===n||(null==t||null==n||!a(t)&&!a(n)?t!=t&&n!=n:r(t,n,i,o,e,s))}},function(e,t,n){var r=n(116),a=n(176),i=n(117);e.exports=function(e,t,n,o,s,c){var u=1&n,l=e.length,f=t.length;if(l!=f&&!(u&&f>l))return!1;var p=c.get(e);if(p&&c.get(t))return p==t;var h=-1,y=!0,d=2&n?new r:void 0;for(c.set(e,t),c.set(t,e);++h<l;){var v=e[h],b=t[h];if(o)var m=u?o(b,v,h,t,e,c):o(v,b,h,e,t,c);if(void 0!==m){if(m)continue;y=!1;break}if(d){if(!a(t,(function(e,t){if(!i(d,t)&&(v===e||s(v,e,n,o,c)))return d.push(t)}))){y=!1;break}}else if(v!==b&&!s(v,b,n,o,c)){y=!1;break}}return c.delete(e),c.delete(t),y}},function(e,t,n){var r=n(99),a=n(174),i=n(175);function o(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new r;++t<n;)this.add(e[t])}o.prototype.add=o.prototype.push=a,o.prototype.has=i,e.exports=o},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,n){var r=n(36).Uint8Array;e.exports=r},function(e,t,n){var r=n(186),a=n(102),i=n(34),o=n(103),s=n(75),c=n(104),u=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=i(e),l=!n&&a(e),f=!n&&!l&&o(e),p=!n&&!l&&!f&&c(e),h=n||l||f||p,y=h?r(e.length,String):[],d=y.length;for(var v in e)!t&&!u.call(e,v)||h&&("length"==v||f&&("offset"==v||"parent"==v)||p&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||s(v,d))||y.push(v);return y}},function(e,t){e.exports=function(e,t){return function(n){return e(t(n))}}},function(e,t,n){var r=n(50)(n(36),"Set");e.exports=r},function(e,t,n){var r=n(39);e.exports=function(e){return e==e&&!r(e)}},function(e,t){e.exports=function(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}}},function(e,t){e.exports=function(e,t,n,r){for(var a=e.length,i=n+(r?1:-1);r?i--:++i<a;)if(t(e[i],i,e))return i;return-1}},function(e,t,n){var r=n(96),a=n(126),i=n(223),o=n(225),s=n(39),c=n(130),u=n(129);e.exports=function e(t,n,l,f,p){t!==n&&i(n,(function(i,c){if(p||(p=new r),s(i))o(t,n,c,l,e,f,p);else{var h=f?f(u(t,c),i,c+"",t,n,p):void 0;void 0===h&&(h=i),a(t,c,h)}}),c)}},function(e,t,n){var r=n(111),a=n(61);e.exports=function(e,t,n){(void 0===n||a(e[t],n))&&(void 0!==n||t in e)||r(e,t,n)}},function(e,t,n){var r=n(50),a=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=a},function(e,t,n){var r=n(120)(Object.getPrototypeOf,Object);e.exports=r},function(e,t){e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},function(e,t,n){var r=n(119),a=n(237),i=n(62);e.exports=function(e){return i(e)?r(e,!0):a(e)}},function(e,t,n){var r=n(239),a=n(246);e.exports=function(e){return r((function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,s=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,s&&a(n[0],n[1],s)&&(o=i<3?void 0:o,i=1),t=Object(t);++r<i;){var c=n[r];c&&e(t,c,r,o)}return t}))}},function(e,t,n){var r=n(116),a=n(247),i=n(251),o=n(117),s=n(252),c=n(100);e.exports=function(e,t,n){var u=-1,l=a,f=e.length,p=!0,h=[],y=h;if(n)p=!1,l=i;else if(f>=200){var d=t?null:s(e);if(d)return c(d);p=!1,l=o,y=new r}else y=t?[]:h;e:for(;++u<f;){var v=e[u],b=t?t(v):v;if(v=n||0!==v?v:0,p&&b==b){for(var m=y.length;m--;)if(y[m]===b)continue e;t&&y.push(b),h.push(v)}else l(y,b,n)||(y!==h&&y.push(b),h.push(v))}return h}},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,a=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(a.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new i(a.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(254),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(69))},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(0),a=n.n(r),i=n(1);function o(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,"timeout",void 0),c(this,"interval",void 0),c(this,"namespace",void 0),this.namespace=t,this.timeout=n||setTimeout.bind(Object(i.m)()),this.interval=r||setInterval.bind(Object(i.m)())}var t,n,r,u,l;return t=e,(n=[{key:"deinit",value:function(){this.timeout=null,this.interval=null}},{key:"getJsonParsedStorageValue",value:(u=a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRawStorageValue(t);case 2:return n=e.sent,e.abrupt("return",n?JSON.parse(n):n);case 4:case"end":return e.stop()}}),e,this)})),l=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=u.apply(e,t);function i(e){o(a,n,r,i,s,"next",e)}function s(e){o(a,n,r,i,s,"throw",e)}i(void 0)}))},function(e){return l.apply(this,arguments)})}])&&s(t.prototype,n),r&&s(t,r),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(0),a=n.n(r);function i(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"item",void 0),s(this,"removeObserver",void 0),this.item=n.findItem(t),r&&r(this.item),this.removeObserver=n.streamItems(this.item.content_type,function(){var e,n=(e=a.a.mark((function e(n){var i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(i=n.find((function(e){return e.uuid===t})))&&(o.item=i,r&&r(o.item));case 2:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){i(o,r,a,s,c,"next",e)}function c(e){i(o,r,a,s,c,"throw",e)}s(void 0)}))});return function(e){return n.apply(this,arguments)}}())}var t,n,r;return t=e,(n=[{key:"deinit",value:function(){this.removeObserver(),this.removeObserver=void 0}}])&&o(t.prototype,n),r&&o(t,r),e}()},function(e,t){},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var r=n(0),a=n.n(r),i=n(16),o=n(24);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){c(i,r,a,o,s,"next",e)}function s(e){c(i,r,a,o,s,"throw",e)}o(void 0)}))}}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t,n){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(t){function n(t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),r=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?f(e):t}(this,h(n).call(this)),d(f(r),"application",void 0),d(f(r),"unsubApp",void 0),r.application=t,e((function(){r.addAppEventObserver()})),r}var r,i,c,v,b,m;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(n,t),r=n,(i=[{key:"deinit",value:function(){this.application=void 0,this.unsubApp(),this.unsubApp=void 0,p(h(n.prototype),"deinit",this).call(this)}},{key:"addAppEventObserver",value:function(){var e=this;this.application.isStarted()&&this.onAppStart(),this.application.isLaunched()&&this.onAppLaunch(),this.unsubApp=this.application.addEventObserver(function(){var t=u(a.a.mark((function t(n){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.onAppEvent(n),n!==o.a.Started){t.next=6;break}return t.next=4,e.onAppStart();case 4:t.next=12;break;case 6:if(n!==o.a.Launched){t.next=11;break}return t.next=9,e.onAppLaunch();case 9:t.next=12;break;case 11:n===o.a.CompletedFullSync?e.onAppFullSync():n===o.a.CompletedIncrementalSync?e.onAppIncrementalSync():n===o.a.KeyStatusChanged&&e.onAppKeyChange();case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"onAppEvent",value:function(e){}},{key:"onAppStart",value:(m=u(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return m.apply(this,arguments)})},{key:"onAppLaunch",value:(b=u(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return b.apply(this,arguments)})},{key:"onAppKeyChange",value:(v=u(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return v.apply(this,arguments)})},{key:"onAppIncrementalSync",value:function(){}},{key:"onAppFullSync",value:function(){}}])&&l(r.prototype,i),c&&l(r,c),n}(i.a)}).call(this,n(133).setImmediate)},function(e,t,n){"use strict";n.d(t,"a",(function(){return Q}));var r=n(0),a=n.n(r),i=n(13),o=n(25),s=n(24),c=n(20),u=n(6),l=n(15),f=n(1),p=n(4),h=n(2),y=n(3),d=n(19),v=n(14),b=n(77),m=n(78),g=n(79),w=n(80),k=n(52),x=n(81),S=n(82),O=n(60),P=n(11);function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function _(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){C(i,r,a,o,s,"next",e)}function s(e){C(i,r,a,o,s,"throw",e)}o(void 0)}))}}function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e,t,n){return(E="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=M(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=function(e){function t(e,n,r,a,i,o,s){var c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c=function(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?I(e):t}(this,M(t).call(this)),A(I(c),"alertService",void 0),A(I(c),"httpService",void 0),A(I(c),"modelManager",void 0),A(I(c),"itemManager",void 0),A(I(c),"protocolService",void 0),A(I(c),"syncService",void 0),A(I(c),"previousPasswords",[]),c.itemManager=e,c.alertService=n,c.deviceInterface=r,c.httpService=a,c.modelManager=i,c.protocolService=o,c.syncService=s,c.previousPasswords=[],c}var n,r,i,o,s,c,u,l,f,d,v,b;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(t,e),n=t,(r=[{key:"deinit",value:function(){this.itemManager=void 0,this.alertService=void 0,this.deviceInterface=void 0,this.httpService=void 0,this.modelManager=void 0,this.protocolService=void 0,this.syncService=void 0,this.previousPasswords.length=0,E(M(t.prototype),"deinit",this).call(this)}},{key:"getExtensions",value:function(){return this.itemManager.nonErroredItemsForContentType(p.a.ActionsExtension)}},{key:"extensionsInContextOfItem",value:function(e){return this.getExtensions().filter((function(t){return t.supported_types.includes(e.content_type)||t.actionsWithContextForItem(e).length>0}))}},{key:"loadExtensionInContextOfItem",value:(b=_(a.a.mark((function e(t,n){var r,i=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={content_type:n.content_type,item_uuid:n.uuid},e.abrupt("return",this.httpService.getAbsolute(t.url,r).then((function(e){var n=e.description||t.description,r=e.supported_types||t.supported_types,a=e.actions?e.actions.map((function(e){return new O.a(e)})):[];return i.itemManager.changeActionsExtension(t.uuid,(function(e){e.description=n,e.supported_types=r,e.actions=a})),t})).catch((function(e){return console.error("Error loading extension",e),null})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"runAction",value:(v=_(a.a.mark((function e(t,n,r){var i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.running=!0,e.t0=t.verb,e.next="get"===e.t0?4:"render"===e.t0?8:"show"===e.t0?12:"post"===e.t0?16:20;break;case 4:return e.next=6,this.handleGetAction(t,r);case 6:return i=e.sent,e.abrupt("break",21);case 8:return e.next=10,this.handleRenderAction(t,r);case 10:return i=e.sent,e.abrupt("break",21);case 12:return e.next=14,this.handleShowAction(t);case 14:return i=e.sent,e.abrupt("break",21);case 16:return e.next=18,this.handlePostAction(t,n);case 18:return i=e.sent,e.abrupt("break",21);case 20:return e.abrupt("break",21);case 21:return t.lastExecuted=new Date,t.running=!1,e.abrupt("return",i);case 24:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return v.apply(this,arguments)})},{key:"handleGetAction",value:(d=_(a.a.mark((function e(t,n){var r=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){r.alertService.confirm("Are you sure you want to replace the current note contents with this action's results?",void 0,void 0,void 0,(function(){r.runConfirmedGetAction(t,n).then((function(t){e(t)}))}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return d.apply(this,arguments)})},{key:"runConfirmedGetAction",value:(f=_(a.a.mark((function e(t,n){var r,i,o=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpService.getAbsolute(t.url).catch((function(e){var n=e&&e.error||{message:"An issue occurred while processing this action. Please try again."};return o.alertService.alert(n.message),t.error=!0,{error:n}}));case 2:if(!(r=e.sent).error){e.next=5;break}return e.abrupt("return",{response:r});case 5:return t.error=!1,e.next=8,this.payloadByDecryptingResponse(r,n);case 8:return i=e.sent,e.next=11,this.modelManager.emitPayload(Object(h.b)(i,{dirty:!0,dirtiedDate:new Date}),y.a.RemoteActionRetrieved);case 11:return this.syncService.sync(),e.abrupt("return",{response:r,item:r.item});case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"handleRenderAction",value:(l=_(a.a.mark((function e(t,n){var r,i=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpService.getAbsolute(t.url).then(function(){var e=_(a.a.mark((function e(r){var o,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.error=!1,e.next=3,i.payloadByDecryptingResponse(r,n);case 3:if(!(o=e.sent)){e.next=7;break}return s=i.itemManager.createItem(o.content_type,o.contentObject),e.abrupt("return",{response:r,item:s});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){var n=e&&e.error||{message:"An issue occurred while processing this action. Please try again."};return i.alertService.alert(n.message),t.error=!0,{error:n}}));case 2:return r=e.sent,e.abrupt("return",{response:r});case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"payloadByDecryptingResponse",value:(u=_(a.a.mark((function e(t,n,r){var i,o,s,c,u,l,f,p,y,d,v,b;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(h.e)(t.item),e.next=3,this.protocolService.payloadByDecryptingPayload(i,r);case 3:if((o=e.sent).errorDecrypting){e.next=6;break}return e.abrupt("return",o);case 6:if(t.auth_params){e.next=9;break}return this.alertService.alert("We were unable to decrypt this revision using your current keys, \n        and this revision is missing metadata that would allow us to try different \n        keys to decrypt it. This can likely be fixed with some manual intervention. \n        Please email hello@standardnotes.org for assistance."),e.abrupt("return",void 0);case 9:s=[],c=!0,u=!1,l=void 0,e.prev=13,f=this.previousPasswords[Symbol.iterator]();case 15:if(c=(p=f.next()).done){e.next=33;break}if(y=p.value,!s.includes(y)){e.next=19;break}return e.abrupt("continue",30);case 19:return s.push(y),e.next=22,this.protocolService.computeRootKey(y,t.auth_params);case 22:if(d=e.sent){e.next=25;break}return e.abrupt("continue",30);case 25:return e.next=27,this.payloadByDecryptingResponse(t,n,d);case 27:if(!(v=e.sent)){e.next=30;break}return e.abrupt("return",v);case 30:c=!0,e.next=15;break;case 33:e.next=39;break;case 35:e.prev=35,e.t0=e.catch(13),u=!0,l=e.t0;case 39:e.prev=39,e.prev=40,c||null==f.return||f.return();case 42:if(e.prev=42,!u){e.next=45;break}throw l;case 45:return e.finish(42);case 46:return e.finish(39);case 47:return e.next=49,n();case 49:return b=e.sent,this.previousPasswords.push(b),e.abrupt("return",this.payloadByDecryptingResponse(t,n,r));case 52:case"end":return e.stop()}}),e,this,[[13,35,39,47],[40,,42,46]])}))),function(e,t,n){return u.apply(this,arguments)})},{key:"handlePostAction",value:(c=_(a.a.mark((function e(t,n){var r,i,o,s=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="decrypted"===t.access_type,e.next=3,this.outgoingPayloadForItem(n,r);case 3:return i=e.sent,o={items:[i]},e.abrupt("return",this.httpService.postAbsolute(t.url,o).then((function(e){return t.error=!1,{response:e}})).catch((function(e){return t.error=!0,console.error("Action error response:",e),s.alertService.alert("An issue occurred while processing this action. Please try again."),{response:e}})));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"handleShowAction",value:(s=_(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.deviceInterface.openUrl(t.url),e.abrupt("return",{response:void 0});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"outgoingPayloadForItem",value:(o=_(a.a.mark((function e(t){var n,r,i,o=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]&&o[1],r=n?P.a.FileDecrypted:P.a.FileEncrypted,e.next=4,this.protocolService.payloadByEncryptingPayload(t.payloadRepresentation(),r);case 4:return i=e.sent,e.abrupt("return",i.ejected());case 6:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})}])&&D(n.prototype,r),i&&D(n,i),t}(n(16).a),K=n(85),F=n(58),L=n(83),N=n(57),V=(n(10),n(84)),W=n(40),U=n(64);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){G(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function z(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function q(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){z(i,r,a,o,s,"next",e)}function s(e){z(i,r,a,o,s,"throw",e)}o(void 0)}))}}function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Q=function(){function e(t,n,r,a,i,o,s){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),G(this,"environment",void 0),G(this,"platform",void 0),G(this,"namespace",void 0),G(this,"swapClasses",void 0),G(this,"skipClasses",void 0),G(this,"crypto",void 0),G(this,"deviceInterface",void 0),G(this,"migrationService",void 0),G(this,"alertService",void 0),G(this,"httpService",void 0),G(this,"modelManager",void 0),G(this,"protocolService",void 0),G(this,"storageService",void 0),G(this,"apiService",void 0),G(this,"sessionManager",void 0),G(this,"syncService",void 0),G(this,"challengeService",void 0),G(this,"singletonManager",void 0),G(this,"componentManager",void 0),G(this,"privilegesService",void 0),G(this,"actionsManager",void 0),G(this,"historyManager",void 0),G(this,"itemManager",void 0),G(this,"eventHandlers",[]),G(this,"services",[]),G(this,"streamRemovers",[]),G(this,"serviceObservers",[]),G(this,"managedSubscribers",[]),G(this,"autoSyncInterval",void 0),G(this,"createdNewDatabase",!1),G(this,"started",!1),G(this,"launched",!1),G(this,"dealloced",!1),!r)throw"Device Interface must be supplied.";if(!t)throw"Environment must be supplied when creating an application.";if(!n)throw"Platform must be supplied when creating an application.";if(!a)throw"Crypto has to be supplied when creating an application.";this.environment=t,this.platform=n,this.namespace=i||"",this.deviceInterface=r,this.crypto=a,this.swapClasses=o,this.skipClasses=s,this.constructServices()}var t,n,r,O,P,j,C,_,D,I,E,M,R,A,B,z,Q,$,Y,X,Z,ee,te,ne,re,ae,ie,oe,se,ce,ue,le,fe,pe,he,ye,de,ve,be,me,ge,we,ke,xe,Se,Oe,Pe,je,Ce,_e,De,Ie,Ee,Me,Re;return t=e,(n=[{key:"prepareForLaunch",value:(Re=q(a.a.mark((function e(t){var n,r=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setLaunchCallback(t),e.next=3,this.deviceInterface.openDatabase().catch((function(e){r.notifyEvent(s.a.LocalDatabaseReadError,e)}));case 3:return n=e.sent,this.createdNewDatabase=(null==n?void 0:n.isNewDatabase)||!1,e.next=7,this.migrationService.initialize();case 7:return e.next=9,this.handleStage(o.a.PreparingForLaunch_0);case 9:return e.next=11,this.storageService.initializeFromDisk();case 11:return e.next=13,this.protocolService.initialize();case 13:return e.next=15,this.handleStage(o.a.ReadyForLaunch_05);case 15:return this.started=!0,e.next=18,this.notifyEvent(s.a.Started);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return Re.apply(this,arguments)})},{key:"setLaunchCallback",value:function(e){this.challengeService.challengeHandler=e.receiveChallenge}},{key:"launch",value:(Me=q(a.a.mark((function e(){var t,n,r,i,c,u=this,l=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]&&l[0],this.launched=!1,e.next=4,this.challengeService.getLaunchChallenge();case 4:if(!(n=e.sent)){e.next=11;break}return e.next=8,this.challengeService.promptForChallengeResponse(n);case 8:return r=e.sent,e.next=11,this.handleLaunchChallengeResponse(r);case 11:if(!this.storageService.isStorageWrapped()){e.next=14;break}return e.next=14,this.storageService.decryptStorage();case 14:return e.next=16,this.handleStage(o.a.StorageDecrypted_09);case 16:return e.next=18,this.apiService.loadHost();case 18:return e.next=20,this.sessionManager.initializeFromDisk();case 20:return this.historyManager.initializeFromDisk(),this.launched=!0,e.next=24,this.notifyEvent(s.a.Launched);case 24:return e.next=26,this.handleStage(o.a.Launched_10);case 26:return e.next=28,this.syncService.getDatabasePayloads();case 28:return i=e.sent,e.next=31,this.handleStage(o.a.LoadingDatabase_11);case 31:if(!this.createdNewDatabase){e.next=34;break}return e.next=34,this.syncService.onNewDatabaseCreated();case 34:if(c=this.syncService.loadDatabasePayloads(i).then(q(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u.dealloced){e.next=2;break}throw"Application has been destroyed.";case 2:return e.next=4,u.handleStage(o.a.LoadedDatabase_12);case 4:return u.beginAutoSyncTimer(),e.abrupt("return",u.syncService.sync({mode:W.b.DownloadFirst}));case 6:case"end":return e.stop()}}),e)})))),!t){e.next=38;break}return e.next=38,c;case 38:case"end":return e.stop()}}),e,this)}))),function(){return Me.apply(this,arguments)})},{key:"handleLaunchChallengeResponse",value:(Ee=q(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.challenge.types.includes(l.d.LocalPasscode)){e.next=9;break}if(n=t.artifacts.wrappingKey){e.next=7;break}return r=t.getValueForType(l.d.LocalPasscode),e.next=6,this.protocolService.computeWrappingKey(r.value);case 6:n=e.sent;case 7:return e.next=9,this.protocolService.unwrapRootKey(n);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return Ee.apply(this,arguments)})},{key:"beginAutoSyncTimer",value:function(){var e=this;this.autoSyncInterval=this.deviceInterface.interval((function(){e.syncService.log("Syncing from autosync"),e.sync()}),3e4)}},{key:"getMigrationChallengeResponder",value:function(){var e=this;return(function(){var t=q(a.a.mark((function t(n,r,i){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.challengeService.promptForChallengeResponse(n,r,i));case 1:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}())}},{key:"handleStage",value:(Ie=q(a.a.mark((function e(t){var n,r,i,o,s,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,r=!1,i=void 0,e.prev=3,o=this.services[Symbol.iterator]();case 5:if(n=(s=o.next()).done){e.next=12;break}return c=s.value,e.next=9,c.handleApplicationStage(t);case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),r=!0,i=e.t0;case 18:e.prev=18,e.prev=19,n||null==o.return||o.return();case 21:if(e.prev=21,!r){e.next=24;break}throw i;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))),function(e){return Ie.apply(this,arguments)})},{key:"addEventObserver",value:function(e,t){var n=this,r={callback:e,singleEvent:t};return this.eventHandlers.push(r),function(){Object(f.B)(n.eventHandlers,r)}}},{key:"addSingleEventObserver",value:function(e,t){var n=function(){var n=q(a.a.mark((function n(r){return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r===e&&t(e);case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return this.addEventObserver(n,e)}},{key:"notifyEvent",value:(De=q(a.a.mark((function e(t,n){var r,i,o,s,c,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!0,i=!1,o=void 0,e.prev=3,s=this.eventHandlers.slice()[Symbol.iterator]();case 5:if(r=(c=s.next()).done){e.next=18;break}if(!(u=c.value).singleEvent||u.singleEvent!==t){e.next=12;break}return e.next=10,u.callback(t,n||{});case 10:e.next=15;break;case 12:if(u.singleEvent){e.next=15;break}return e.next=15,u.callback(t,n||{});case 15:r=!0,e.next=5;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(3),i=!0,o=e.t0;case 24:e.prev=24,e.prev=25,r||null==s.return||s.return();case 27:if(e.prev=27,!i){e.next=30;break}throw o;case 30:return e.finish(27);case 31:return e.finish(24);case 32:this.migrationService.handleApplicationEvent(t);case 33:case"end":return e.stop()}}),e,this,[[3,20,24,32],[25,,27,31]])}))),function(e,t){return De.apply(this,arguments)})},{key:"isDatabaseLoaded",value:function(){return this.syncService.isDatabaseLoaded()}},{key:"savePayload",value:(_e=q(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(h.b)(t,{dirty:!0,dirtiedDate:new Date}),e.next=3,this.modelManager.emitPayload(n,y.a.LocalChanged);case 3:return e.next=5,this.syncService.sync();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return _e.apply(this,arguments)})},{key:"findItem",value:function(e){return this.itemManager.findItem(e)}},{key:"allItems",value:function(){return this.itemManager.items}},{key:"findItems",value:function(e){return this.itemManager.itemsMatchingPredicate(e)}},{key:"getAll",value:function(e){return this.itemManager.findItems(e)}},{key:"mergeItem",value:(Ce=q(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.itemManager.emitItemFromPayload(t.payloadRepresentation(),n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ce.apply(this,arguments)})},{key:"createManagedItem",value:(je=q(a.a.mark((function e(t,n){var r,i,o,s=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]&&s[2],i=s.length>3?s[3]:void 0,e.next=4,this.itemManager.createItem(t,n,r,i);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return je.apply(this,arguments)})},{key:"createTemplateItem",value:(Pe=q(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.itemManager.createTemplateItem(t,n);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return Pe.apply(this,arguments)})},{key:"createItemFromPayload",value:function(e){return Object(d.a)(e)}},{key:"createPayloadFromObject",value:function(e){return Object(h.e)(e)}},{key:"getLastSyncDate",value:function(){return this.syncService.getLastSyncDate()}},{key:"getSyncStatus",value:function(){return this.syncService.getStatus()}},{key:"setItemNeedsSync",value:(Oe=q(a.a.mark((function e(t){var n,r=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]&&r[1],e.abrupt("return",this.itemManager.setItemDirty(t.uuid,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return Oe.apply(this,arguments)})},{key:"setItemsNeedsSync",value:(Se=q(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.itemManager.setItemsDirty(Object(i.b)(t)));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return Se.apply(this,arguments)})},{key:"deleteItem",value:(xe=q(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.itemManager.setItemToBeDeleted(t.uuid);case 2:return e.abrupt("return",this.sync());case 3:case"end":return e.stop()}}),e,this)}))),function(e){return xe.apply(this,arguments)})},{key:"deleteItemLocally",value:(ke=q(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.itemManager.removeItemLocally(t);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return ke.apply(this,arguments)})},{key:"emptyTrash",value:(we=q(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.itemManager.emptyTrash();case 2:return e.abrupt("return",this.sync());case 3:case"end":return e.stop()}}),e,this)}))),function(){return we.apply(this,arguments)})},{key:"getTrashedItems",value:function(){return this.itemManager.trashedItems}},{key:"setDisplayOptions",value:function(e,t,n,r){this.itemManager.setDisplayOptions(e,t,n,r)}},{key:"getDisplayableItems",value:function(e){return this.itemManager.getDisplayableItems(e)}},{key:"insertItem",value:(ge=q(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.itemManager.insertItem(t);case 2:return n=e.sent,e.next=5,this.itemManager.changeItems([n.uuid]);case 5:return e.abrupt("return",this.findItem(t.uuid));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return ge.apply(this,arguments)})},{key:"saveItem",value:(me=q(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.itemManager.findItem(t)){e.next=3;break}throw Error("Attempting to save non-inserted item");case 3:if(n.dirty){e.next=6;break}return e.next=6,this.itemManager.changeItem(t);case 6:return e.next=8,this.syncService.sync();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return me.apply(this,arguments)})},{key:"changeAndSaveItem",value:(be=q(a.a.mark((function e(t,n){var r,i,o,s=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=s.length>2&&void 0!==s[2]&&s[2],i=s.length>3?s[3]:void 0,o=s.length>4?s[4]:void 0,Object(f.s)(t)){e.next=5;break}throw Error("Must use uuid to change item");case 5:return e.next=7,this.itemManager.changeItems([t],n,r?u.c.UserInteraction:void 0,i);case 7:return e.next=9,this.syncService.sync(o);case 9:return e.abrupt("return",this.findItem(t));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return be.apply(this,arguments)})},{key:"changeAndSaveItems",value:(ve=q(a.a.mark((function e(t,n){var r,i,o,s=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]&&s[2],i=s.length>3?s[3]:void 0,o=s.length>4?s[4]:void 0,e.next=5,this.itemManager.changeItems(t,n,r?u.c.UserInteraction:void 0,i);case 5:return e.next=7,this.syncService.sync(o);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return ve.apply(this,arguments)})},{key:"changeItem",value:(de=q(a.a.mark((function e(t,n){var r,i=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>2&&void 0!==i[2]&&i[2],Object(f.s)(t)){e.next=3;break}throw Error("Must use uuid to change item");case 3:return e.next=5,this.itemManager.changeItems([t],n,r?u.c.UserInteraction:void 0);case 5:return e.abrupt("return",this.findItem(t));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return de.apply(this,arguments)})},{key:"changeItems",value:(ye=q(a.a.mark((function e(t,n){var r,i=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]&&i[2],e.abrupt("return",this.itemManager.changeItems(t,n,r?u.c.UserInteraction:void 0));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return ye.apply(this,arguments)})},{key:"getItems",value:function(e){return this.itemManager.getItems(e)}},{key:"notesMatchingSmartTag",value:function(e){return this.itemManager.notesMatchingSmartTag(e)}},{key:"referencesForItem",value:function(e,t){var n=this.itemManager.referencesForItem(e.uuid);return t&&(n=n.filter((function(e){return(null==e?void 0:e.content_type)===t}))),n}},{key:"referencingForItem",value:function(e,t){var n=this.itemManager.itemsReferencingItem(e.uuid);return t&&(n=n.filter((function(e){return(null==e?void 0:e.content_type)===t}))),n}},{key:"findTagByTitle",value:function(e){return this.itemManager.findTagByTitle(e)}},{key:"findOrCreateTag",value:(he=q(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.itemManager.findOrCreateTagByTitle(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return he.apply(this,arguments)})},{key:"getSmartTags",value:function(){return this.itemManager.getSmartTags()}},{key:"getNoteCount",value:function(){return this.itemManager.noteCount}},{key:"streamItems",value:function(e,t){var n=this,r=this.itemManager.addObserver(e,(function(e,n,r,a){var i=e.concat(n).concat(r);t(i,a)})),a=this.itemManager.getItems(e);return a.length>0&&t(a),this.streamRemovers.push(r),function(){r(),Object(f.B)(n.streamRemovers,r)}}},{key:"setHost",value:(pe=q(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.apiService.setHost(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return pe.apply(this,arguments)})},{key:"getHost",value:(fe=q(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.apiService.getHost());case 1:case"end":return e.stop()}}),e,this)}))),function(){return fe.apply(this,arguments)})},{key:"getUser",value:function(){if(!this.launched)throw"Attempting to access user before application unlocked";return this.sessionManager.getUser()}},{key:"getUserVersion",value:(le=q(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.protocolService.getUserVersion());case 1:case"end":return e.stop()}}),e,this)}))),function(){return le.apply(this,arguments)})},{key:"protocolUpgradeAvailable",value:(ue=q(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.protocolService.upgradeAvailable());case 1:case"end":return e.stop()}}),e,this)}))),function(){return ue.apply(this,arguments)})},{key:"isEncryptionAvailable",value:(ce=q(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!Object(f.p)(this.getUser())||this.hasPasscode());case 1:case"end":return e.stop()}}),e,this)}))),function(){return ce.apply(this,arguments)})},{key:"upgradeProtocolVersion",value:(se=q(a.a.mark((function e(){var t,n,r,i,o,s,c,u,f,p,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.hasPasscode(),n=!this.noAccount(),r=[],t&&r.push(l.d.LocalPasscode),n&&r.push(l.d.AccountPassword),i=new l.a(r,l.b.ProtocolUpgrade),e.next=8,this.challengeService.promptForChallengeResponse(i);case 8:if(o=e.sent){e.next=11;break}return e.abrupt("return");case 11:if(s=[],!t){e.next=17;break}return u=o.getValueForType(l.d.LocalPasscode),c=u.value,e.next=17,this.changePasscode(c);case 17:if(!n){e.next=24;break}return f=o.getValueForType(l.d.AccountPassword),p=f.value,e.next=22,this.changePassword(p,p,c);case 22:(null==(h=e.sent)?void 0:h.error)&&s.push(h.error);case 24:return e.abrupt("return",s);case 25:case"end":return e.stop()}}),e,this)}))),function(){return se.apply(this,arguments)})},{key:"noAccount",value:function(){var e=this.getUser();return Object(f.p)(e)}},{key:"importData",value:(oe=q(a.a.mark((function e(t,n){var r,i,o,s,c,u,l=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>2&&void 0!==l[2]&&l[2],e.next=3,this.protocolService.payloadsByDecryptingBackupFile(t,n);case 3:return i=e.sent,o=i.filter((function(e){return!e.errorDecrypting})).map((function(e){return e.content_type===p.a.Component&&e.safeContent.active?Object(h.b)(e,{content:H({},e.safeContent,{active:!1})}):e})),e.next=7,this.modelManager.importPayloads(o);case 7:if(s=e.sent,c=this.sync(),!r){e.next=12;break}return e.next=12,c;case 12:return u=this.getAll(s),e.abrupt("return",{affectedItems:u,errorCount:i.length-o.length});case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return oe.apply(this,arguments)})},{key:"createBackupFile",value:(ie=q(a.a.mark((function e(t,n){var r,i=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]&&i[2],e.abrupt("return",this.protocolService.createBackupFile(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return ie.apply(this,arguments)})},{key:"isEphemeralSession",value:function(){return this.storageService.isEphemeralSession()}},{key:"lockSyncing",value:function(){this.syncService.lockSyncing()}},{key:"unlockSyncing",value:function(){this.syncService.unlockSyncing()}},{key:"sync",value:(ae=q(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.syncService.sync(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return ae.apply(this,arguments)})},{key:"isOutOfSync",value:(re=q(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.syncService.isOutOfSync());case 1:case"end":return e.stop()}}),e,this)}))),function(){return re.apply(this,arguments)})},{key:"resolveOutOfSync",value:(ne=q(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.syncService.resolveOutOfSync());case 1:case"end":return e.stop()}}),e,this)}))),function(){return ne.apply(this,arguments)})},{key:"setValue",value:(te=q(a.a.mark((function e(t,n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageService.setValue(t,n,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return te.apply(this,arguments)})},{key:"getValue",value:(ee=q(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageService.getValue(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return ee.apply(this,arguments)})},{key:"removeValue",value:(Z=q(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageService.removeValue(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return Z.apply(this,arguments)})},{key:"clearDatabase",value:(X=q(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageService.clearAllPayloads());case 1:case"end":return e.stop()}}),e,this)}))),function(){return X.apply(this,arguments)})},{key:"rewriteItemsKeys",value:(Y=q(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.itemManager.itemsKeys(),n=t.map((function(e){return e.payloadRepresentation()})),e.next=4,this.storageService.deletePayloads(n);case 4:return e.next=6,this.syncService.persistPayloads(n);case 6:case"end":return e.stop()}}),e,this)}))),function(){return Y.apply(this,arguments)})},{key:"prepareForDeinit",value:($=q(a.a.mark((function e(){var t,n,r=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:0,n=Promise.all(this.services.map((function(e){return e.blockDeinit()}))),0!==t){e.next=7;break}return e.next=5,n;case 5:e.next=9;break;case 7:return e.next=9,Promise.race([n,Object(f.E)(t)]);case 9:case"end":return e.stop()}}),e,this)}))),function(){return $.apply(this,arguments)})},{key:"deinit",value:function(){clearInterval(this.autoSyncInterval);var e=!0,t=!1,n=void 0;try{for(var r,a=this.serviceObservers[Symbol.iterator]();!(e=(r=a.next()).done);e=!0)(0,r.value)()}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}var i=!0,o=!1,s=void 0;try{for(var c,u=this.managedSubscribers[Symbol.iterator]();!(i=(c=u.next()).done);i=!0)(0,c.value)()}catch(e){o=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw s}}var l=!0,f=!1,p=void 0;try{for(var h,y=this.services[Symbol.iterator]();!(l=(h=y.next()).done);l=!0)h.value.deinit()}catch(e){f=!0,p=e}finally{try{l||null==y.return||y.return()}finally{if(f)throw p}}this.deviceInterface.deinit(),this.deviceInterface=void 0,this.crypto=void 0,this.createdNewDatabase=!1,this.services.length=0,this.serviceObservers.length=0,this.managedSubscribers.length=0,this.streamRemovers.length=0,this.clearServices(),this.dealloced=!0,this.started=!1}},{key:"getWrappingKeyIfNecessary",value:(Q=q(a.a.mark((function e(t){var n,r,i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasPasscode()){e.next=2;break}return e.abrupt("return",{});case 2:if(t){e.next=11;break}return n=new l.a([l.d.LocalPasscode],l.b.ResaveRootKey),e.next=6,this.challengeService.promptForChallengeResponse(n);case 6:if(r=e.sent){e.next=9;break}return e.abrupt("return",{canceled:!0});case 9:i=r.getValueForType(l.d.LocalPasscode),t=i.value;case 11:return e.next=13,this.protocolService.computeWrappingKey(t);case 13:return o=e.sent,e.abrupt("return",{wrappingKey:o});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return Q.apply(this,arguments)})},{key:"register",value:(z=q(a.a.mark((function e(t,n){var r,i,o,c,u,l=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>2&&void 0!==l[2]&&l[2],i=!(l.length>3&&void 0!==l[3])||l[3],e.next=4,this.getWrappingKeyIfNecessary();case 4:if(o=e.sent,c=o.wrappingKey,!o.canceled){e.next=9;break}return e.abrupt("return");case 9:return this.lockSyncing(),e.next=12,this.sessionManager.register(t,n);case 12:if((u=e.sent).response.error){e.next=35;break}return e.next=16,this.protocolService.setNewRootKey(u.rootKey,u.keyParams,c);case 16:return this.syncService.resetSyncState(),e.next=19,this.storageService.setPersistencePolicy(r?v.c.Ephemeral:v.c.Default);case 19:if(!i){e.next=24;break}return e.next=22,this.syncService.markAllItemsAsNeedingSync(!0);case 22:e.next=27;break;case 24:return this.itemManager.removeAllItemsFromMemory(),e.next=27,this.clearDatabase();case 27:return e.next=29,this.notifyEvent(s.a.SignedIn);case 29:return this.unlockSyncing(),e.next=32,this.syncService.sync({mode:W.b.DownloadFirst,queueStrategy:W.c.ForceSpawnNew});case 32:this.protocolService.decryptErroredItems(),e.next=36;break;case 35:this.unlockSyncing();case 36:return e.abrupt("return",u.response);case 37:case"end":return e.stop()}}),e,this)}))),function(e,t){return z.apply(this,arguments)})},{key:"signIn",value:(B=q(a.a.mark((function e(t,n){var r,i,o,c,u,l,f,p,h,y,d=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.length>2&&void 0!==d[2]&&d[2],i=d.length>3&&void 0!==d[3]&&d[3],o=d.length>4?d[4]:void 0,c=d.length>5?d[5]:void 0,u=!(d.length>6&&void 0!==d[6])||d[6],l=d.length>7&&void 0!==d[7]&&d[7],e.next=8,this.getWrappingKeyIfNecessary();case 8:if(f=e.sent,p=f.wrappingKey,!f.canceled){e.next=13;break}return e.abrupt("return");case 13:return this.lockSyncing(),e.next=16,this.sessionManager.signIn(t,n,r,o,c);case 16:if((h=e.sent).response.error){e.next=45;break}return e.next=20,this.protocolService.setNewRootKey(h.rootKey,h.keyParams,p);case 20:return this.syncService.resetSyncState(),e.next=23,this.storageService.setPersistencePolicy(i?v.c.Ephemeral:v.c.Default);case 23:if(!u){e.next=28;break}return e.next=26,this.syncService.markAllItemsAsNeedingSync(!0);case 26:e.next=31;break;case 28:return this.itemManager.removeAllItemsFromMemory(),e.next=31,this.clearDatabase();case 31:return e.next=33,this.notifyEvent(s.a.SignedIn);case 33:if(this.unlockSyncing(),y=this.syncService.sync({mode:W.b.DownloadFirst,checkIntegrity:!0,queueStrategy:W.c.ForceSpawnNew,awaitAll:l}),!l){e.next=42;break}return e.next=38,y;case 38:return e.next=40,this.protocolService.decryptErroredItems();case 40:e.next=43;break;case 42:this.protocolService.decryptErroredItems();case 43:e.next=46;break;case 45:this.unlockSyncing();case 46:return e.abrupt("return",h.response);case 47:case"end":return e.stop()}}),e,this)}))),function(e,t){return B.apply(this,arguments)})},{key:"changePassword",value:(A=q(a.a.mark((function e(t,n,r){var i,o,s,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWrappingKeyIfNecessary(r);case 2:if(i=e.sent,o=i.wrappingKey,!i.canceled){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.protocolService.getRootKeyParams();case 9:return s=e.sent,this.lockSyncing(),e.next=13,this.sessionManager.changePassword(t,s,n);case 13:if((c=e.sent).response.error){e.next=24;break}return e.next=17,this.protocolService.setNewRootKey(c.rootKey,c.keyParams,o);case 17:return e.next=19,this.protocolService.createNewDefaultItemsKey();case 19:return this.unlockSyncing(),e.next=22,this.syncService.sync();case 22:e.next=25;break;case 24:this.unlockSyncing();case 25:return e.abrupt("return",c.response);case 26:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return A.apply(this,arguments)})},{key:"signOut",value:(R=q(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionManager.signOut();case 2:return e.next=4,this.protocolService.clearLocalKeyState();case 4:return e.next=6,this.storageService.clearAllData();case 6:return e.next=8,this.notifyEvent(s.a.SignedOut);case 8:return e.next=10,this.prepareForDeinit();case 10:this.deinit();case 11:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)})},{key:"validateAccountPassword",value:(M=q(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.protocolService.validateAccountPassword(t);case 2:return n=e.sent,r=n.valid,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"isStarted",value:function(){return this.started}},{key:"isLaunched",value:function(){return this.launched}},{key:"hasPasscode",value:function(){return this.protocolService.hasPasscode()}},{key:"isLocked",value:(E=q(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.started){e.next=2;break}return e.abrupt("return",!0);case 2:return e.abrupt("return",this.challengeService.isPasscodeLocked());case 3:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"lock",value:(I=q(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.prepareForDeinit(500);case 3:return e.abrupt("return",this.deinit());case 4:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"setPasscode",value:(D=q(a.a.mark((function e(t){var n,r,i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.generateUuid();case 2:return n=e.sent,e.next=5,this.protocolService.createRootKey(n,t);case 5:return r=e.sent,i=r.key,o=r.keyParams,e.next=10,this.protocolService.setNewRootKeyWrapper(i,o);case 10:return e.next=12,this.rewriteItemsKeys();case 12:return e.next=14,this.syncService.sync();case 14:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"removePasscode",value:(_=q(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.protocolService.removeRootKeyWrapper();case 2:return e.next=4,this.rewriteItemsKeys();case 4:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"changePasscode",value:(C=q(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.removePasscode();case 2:return e.abrupt("return",this.setPasscode(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"setStorageEncryptionPolicy",value:(j=q(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.setEncryptionPolicy(t);case 2:return e.abrupt("return",this.protocolService.repersistAllItems());case 3:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"generateUuid",value:(P=q(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c.a.GenerateUuid());case 1:case"end":return e.stop()}}),e)}))),function(){return P.apply(this,arguments)})},{key:"changeDeviceInterface",value:(O=q(a.a.mark((function e(t){var n,r,i,o,s,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.deviceInterface=t,n=!0,r=!1,i=void 0,e.prev=4,o=this.services[Symbol.iterator]();!(n=(s=o.next()).done);n=!0)(c=s.value).deviceInterface&&(c.deviceInterface=t);e.next=12;break;case 8:e.prev=8,e.t0=e.catch(4),r=!0,i=e.t0;case 12:e.prev=12,e.prev=13,n||null==o.return||o.return();case 15:if(e.prev=15,!r){e.next=18;break}throw i;case 18:return e.finish(15);case 19:return e.finish(12);case 20:case"end":return e.stop()}}),e,this,[[4,8,12,20],[13,,15,19]])}))),function(e){return O.apply(this,arguments)})},{key:"constructServices",value:function(){this.createModelManager(),this.createItemManager(),this.createStorageManager(),this.createProtocolService();var e={payloadByEncryptingPayload:this.protocolService.payloadByEncryptingPayload.bind(this.protocolService),payloadByDecryptingPayload:this.protocolService.payloadByDecryptingPayload.bind(this.protocolService)};this.storageService.encryptionDelegate=e,this.createMigrationService(),this.createAlertManager(),this.createHttpManager(),this.createApiService(),this.createSessionManager(),this.createSyncManager(),this.createChallengeService(),this.createSingletonManager(),this.createComponentManager(),this.createPrivilegesService(),this.createHistoryManager(),this.createActionsManager()}},{key:"clearServices",value:function(){this.migrationService=void 0,this.alertService=void 0,this.httpService=void 0,this.modelManager=void 0,this.protocolService=void 0,this.storageService=void 0,this.apiService=void 0,this.sessionManager=void 0,this.syncService=void 0,this.challengeService=void 0,this.singletonManager=void 0,this.componentManager=void 0,this.privilegesService=void 0,this.actionsManager=void 0,this.historyManager=void 0,this.itemManager=void 0,this.services=[]}},{key:"createMigrationService",value:function(){this.migrationService=new K.a({protocolService:this.protocolService,deviceInterface:this.deviceInterface,storageService:this.storageService,itemManager:this.itemManager,environment:this.environment,namespace:this.namespace},this.getMigrationChallengeResponder()),this.services.push(this.migrationService)}},{key:"createAlertManager",value:function(){this.shouldSkipClass(b.a)||(this.alertService=new(this.getClass(b.a))(this.deviceInterface),this.services.push(this.alertService))}},{key:"createApiService",value:function(){this.apiService=new g.a(this.httpService,this.storageService),this.services.push(this.apiService)}},{key:"createItemManager",value:function(){this.itemManager=new V.a(this.modelManager),this.services.push(this.itemManager)}},{key:"createComponentManager",value:function(){this.shouldSkipClass(w.a)||(this.componentManager=new w.a(this.itemManager,this.syncService,this.alertService,this.environment,this.platform,this.deviceInterface.timeout),this.services.push(this.componentManager))}},{key:"createHttpManager",value:function(){this.httpService=new k.b,this.services.push(this.httpService)}},{key:"createModelManager",value:function(){this.modelManager=new x.a,this.services.push(this.modelManager)}},{key:"createSingletonManager",value:function(){this.singletonManager=new S.a(this.itemManager,this.syncService),this.services.push(this.singletonManager)}},{key:"createStorageManager",value:function(){this.storageService=new v.a(this.deviceInterface,this.namespace),this.services.push(this.storageService)}},{key:"createProtocolService",value:function(){var e=this;this.protocolService=new F.b(this.itemManager,this.modelManager,this.deviceInterface,this.storageService,this.crypto),this.protocolService.onKeyStatusChange(q(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.notifyEvent(s.a.KeyStatusChanged);case 2:case"end":return t.stop()}}),t)})))),this.services.push(this.protocolService)}},{key:"createSessionManager",value:function(){this.sessionManager=new m.a(this.storageService,this.apiService,this.alertService,this.protocolService),this.services.push(this.sessionManager)}},{key:"createSyncManager",value:function(){var e=this;this.syncService=new W.a(this.itemManager,this.sessionManager,this.protocolService,this.storageService,this.modelManager,this.apiService,this.deviceInterface.interval);var t=function(){var t=q(a.a.mark((function t(n){var r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=Object(s.c)(n))){t.next=4;break}return t.next=4,e.notifyEvent(r);case 4:return t.next=6,e.protocolService.onSyncEvent(n);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),n=this.syncService.addEventObserver(t);this.serviceObservers.push(n),this.services.push(this.syncService)}},{key:"createChallengeService",value:function(){this.challengeService=new U.b(this.storageService,this.protocolService),this.services.push(this.challengeService)}},{key:"createPrivilegesService",value:function(){this.privilegesService=new N.b(this.itemManager,this.syncService,this.singletonManager,this.protocolService,this.storageService,this.sessionManager),this.services.push(this.privilegesService)}},{key:"createHistoryManager",value:function(){this.historyManager=new L.a(this.itemManager,this.storageService,[p.a.Note],this.deviceInterface.timeout),this.services.push(this.historyManager)}},{key:"createActionsManager",value:function(){this.actionsManager=new T(this.itemManager,this.alertService,this.deviceInterface,this.httpService,this.modelManager,this.protocolService,this.syncService),this.services.push(this.actionsManager)}},{key:"shouldSkipClass",value:function(e){return this.skipClasses&&this.skipClasses.includes(e)}},{key:"getClass",value:function(e){var t=this.swapClasses&&this.swapClasses.find((function(t){return t.swap===e}));return t?t.with:e}}])&&J(t.prototype,n),r&&J(t,r),e}()},function(e,t,n){var r=n(125),a=n(131)((function(e,t,n,a){r(e,t,n,a)}));e.exports=a},function(e,t,n){var r=n(132);e.exports=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?r(e,void 0,t):[]}},function(e,t,n){"use strict";n.r(t);var r=n(138);n.d(t,"SNApplication",(function(){return r.a}));var a=n(58);n.d(t,"SNProtocolService",(function(){return a.b})),n.d(t,"KeyMode",(function(){return a.a}));var i=n(46);n.d(t,"SNProtocolOperator001",(function(){return i.a}));var o=n(45);n.d(t,"SNProtocolOperator002",(function(){return o.a}));var s=n(44);n.d(t,"SNProtocolOperator003",(function(){return s.a}));var c=n(59);n.d(t,"SNProtocolOperator004",(function(){return c.a}));var u=n(134);n.d(t,"DeviceInterface",(function(){return u.a}));var l=n(17);n.d(t,"SNItem",(function(){return l.l})),n.d(t,"ItemMutator",(function(){return l.g})),n.d(t,"AppDataField",(function(){return l.b})),n.d(t,"SNItemsKey",(function(){return l.m})),n.d(t,"SNPredicate",(function(){return l.o})),n.d(t,"SNNote",(function(){return l.n})),n.d(t,"NoteMutator",(function(){return l.h})),n.d(t,"SNTag",(function(){return l.q})),n.d(t,"SNSmartTag",(function(){return l.p})),n.d(t,"SNActionsExtension",(function(){return l.i})),n.d(t,"Action",(function(){return l.a})),n.d(t,"SNTheme",(function(){return l.r})),n.d(t,"SNComponent",(function(){return l.j})),n.d(t,"ComponentAction",(function(){return l.c})),n.d(t,"ComponentMutator",(function(){return l.d})),n.d(t,"SNEditor",(function(){return l.k})),n.d(t,"SNUserPrefs",(function(){return l.s})),n.d(t,"UserPrefsMutator",(function(){return l.t})),n.d(t,"WebPrefKey",(function(){return l.u}));var f=n(6);n.d(t,"MutationType",(function(){return f.c}));var p=n(7);n.d(t,"ComponentArea",(function(){return p.b}));var h=n(135);n.d(t,"LiveItem",(function(){return h.a}));var y=n(80);n.d(t,"SNComponentManager",(function(){return y.a}));var d=n(90);n.d(t,"HistorySession",(function(){return d.a}));var v=n(67);n.d(t,"ItemHistory",(function(){return v.a}));var b=n(91);n.d(t,"ItemHistoryEntry",(function(){return b.a}));var m=n(21);n.d(t,"SNPrivileges",(function(){return m.d})),n.d(t,"ProtectedAction",(function(){return m.c})),n.d(t,"PrivilegeCredential",(function(){return m.a}));var g=n(136);for(var w in g)["SNApplication","SNProtocolService","KeyMode","SNProtocolOperator001","SNProtocolOperator002","SNProtocolOperator003","SNProtocolOperator004","DeviceInterface","SNItem","ItemMutator","AppDataField","SNItemsKey","SNPredicate","SNNote","NoteMutator","SNTag","SNSmartTag","SNActionsExtension","Action","SNTheme","SNComponent","ComponentAction","ComponentMutator","SNEditor","SNUserPrefs","UserPrefsMutator","WebPrefKey","MutationType","ComponentArea","LiveItem","SNComponentManager","HistorySession","ItemHistory","ItemHistoryEntry","SNPrivileges","ProtectedAction","PrivilegeCredential","PayloadManager","ItemManager","SNHttpService","ChallengeService","ChallengeOrchestrator","PureService","ApplicationService","SNStorageService","StoragePersistencePolicies","StorageEncryptionPolicies","StorageValueModes","ValueModesKeys","Challenge","ChallengeReason","ChallengeResponse","ChallengeType","challengeTypeToString","ChallengeValue","SNSyncService","SyncSources","SyncModes","SyncQueueStrategy","SortPayloadsByRecentAndContentPriority","SNSessionManager","SNMigrationService","SNAlertService","SNHistoryManager","SNPrivilegesService","SNSingletonManager","SNApiService","Copy","findInArray","isNullOrUndefined","deepMerge","extendArray","removeFromIndex","subtractFromArray","arrayByDifference","uniqCombineObjArrays","greaterOfTwoDates","getGlobalScope","removeFromArray","addIfUnique","dictToArray","truncateHexString","jsonParseEmbeddedKeys","topLevelCompare","Uuid","EncryptionIntent","isLocalStorageIntent","isFileIntent","isDecryptedIntent","intentRequiresEncryption","ContentType","CreateItemFromPayload","Uuids","FillItemContent","ApplicationEvent","Environment","Platform","isEnvironmentWebOrDesktop","isEnvironmentMobile","platformFromString","SyncEvent","MutableCollection","ImmutablePayloadCollection","ItemCollection","CollectionSort","CreateMaxPayloadFromAnyObject","CreateSourcedPayloadFromObject","CreateIntentPayloadFromObject","CreateEncryptionParameters","PayloadByMerging","CopyPayload","PayloadSource","isPayloadSourceRetrieved","ProtocolVersion","PayloadFormat","PurePayload","PayloadField","StorageKey","BaseMigration","PrivilegeSessionLength","default"].indexOf(w)<0&&function(e){n.d(t,e,(function(){return g[e]}))}(w);var k=n(81);n.d(t,"PayloadManager",(function(){return k.a}));var x=n(84);n.d(t,"ItemManager",(function(){return x.a}));var S=n(52);n.d(t,"SNHttpService",(function(){return S.b}));var O=n(64);n.d(t,"ChallengeService",(function(){return O.b})),n.d(t,"ChallengeOrchestrator",(function(){return O.a}));var P=n(16);n.d(t,"PureService",(function(){return P.a}));var j=n(137);n.d(t,"ApplicationService",(function(){return j.a}));var C=n(14);n.d(t,"SNStorageService",(function(){return C.a})),n.d(t,"StoragePersistencePolicies",(function(){return C.c})),n.d(t,"StorageEncryptionPolicies",(function(){return C.b})),n.d(t,"StorageValueModes",(function(){return C.d})),n.d(t,"ValueModesKeys",(function(){return C.e}));var _=n(15);n.d(t,"Challenge",(function(){return _.a})),n.d(t,"ChallengeReason",(function(){return _.b})),n.d(t,"ChallengeResponse",(function(){return _.c})),n.d(t,"ChallengeType",(function(){return _.d})),n.d(t,"challengeTypeToString",(function(){return _.f})),n.d(t,"ChallengeValue",(function(){return _.e}));var D=n(40);n.d(t,"SNSyncService",(function(){return D.a})),n.d(t,"SyncSources",(function(){return D.d})),n.d(t,"SyncModes",(function(){return D.b})),n.d(t,"SyncQueueStrategy",(function(){return D.c}));var I=n(92);n.d(t,"SortPayloadsByRecentAndContentPriority",(function(){return I.a}));var E=n(78);n.d(t,"SNSessionManager",(function(){return E.a}));var M=n(85);n.d(t,"SNMigrationService",(function(){return M.a}));var R=n(77);n.d(t,"SNAlertService",(function(){return R.a}));var A=n(83);n.d(t,"SNHistoryManager",(function(){return A.a}));var T=n(57);n.d(t,"SNPrivilegesService",(function(){return T.b}));var K=n(82);n.d(t,"SNSingletonManager",(function(){return K.a}));var F=n(79);n.d(t,"SNApiService",(function(){return F.a}));var L=n(1);n.d(t,"Copy",(function(){return L.a})),n.d(t,"findInArray",(function(){return L.l})),n.d(t,"isNullOrUndefined",(function(){return L.p})),n.d(t,"deepMerge",(function(){return L.h})),n.d(t,"extendArray",(function(){return L.j})),n.d(t,"removeFromIndex",(function(){return L.C})),n.d(t,"subtractFromArray",(function(){return L.G})),n.d(t,"arrayByDifference",(function(){return L.c})),n.d(t,"uniqCombineObjArrays",(function(){return L.J})),n.d(t,"greaterOfTwoDates",(function(){return L.n})),n.d(t,"getGlobalScope",(function(){return L.m})),n.d(t,"removeFromArray",(function(){return L.B})),n.d(t,"addIfUnique",(function(){return L.b})),n.d(t,"dictToArray",(function(){return L.i})),n.d(t,"truncateHexString",(function(){return L.I})),n.d(t,"jsonParseEmbeddedKeys",(function(){return L.v})),n.d(t,"topLevelCompare",(function(){return L.H}));var N=n(20);n.d(t,"Uuid",(function(){return N.a}));var V=n(11);n.d(t,"EncryptionIntent",(function(){return V.a})),n.d(t,"isLocalStorageIntent",(function(){return V.e})),n.d(t,"isFileIntent",(function(){return V.d})),n.d(t,"isDecryptedIntent",(function(){return V.c})),n.d(t,"intentRequiresEncryption",(function(){return V.b}));var W=n(4);n.d(t,"ContentType",(function(){return W.a}));var U=n(19);n.d(t,"CreateItemFromPayload",(function(){return U.a}));var B=n(13);n.d(t,"Uuids",(function(){return B.b})),n.d(t,"FillItemContent",(function(){return B.a}));var H=n(24);n.d(t,"ApplicationEvent",(function(){return H.a}));var z=n(28);n.d(t,"Environment",(function(){return z.a})),n.d(t,"Platform",(function(){return z.b})),n.d(t,"isEnvironmentWebOrDesktop",(function(){return z.e})),n.d(t,"isEnvironmentMobile",(function(){return z.d})),n.d(t,"platformFromString",(function(){return z.f}));var q=n(10);n.d(t,"SyncEvent",(function(){return q.a}));var J=n(41);n.d(t,"MutableCollection",(function(){return J.a}));var G=n(23);n.d(t,"ImmutablePayloadCollection",(function(){return G.a}));var Q=n(37);n.d(t,"ItemCollection",(function(){return Q.b})),n.d(t,"CollectionSort",(function(){return Q.a}));var $=n(2);n.d(t,"CreateMaxPayloadFromAnyObject",(function(){return $.e})),n.d(t,"CreateSourcedPayloadFromObject",(function(){return $.f})),n.d(t,"CreateIntentPayloadFromObject",(function(){return $.d})),n.d(t,"CreateEncryptionParameters",(function(){return $.c})),n.d(t,"PayloadByMerging",(function(){return $.g})),n.d(t,"CopyPayload",(function(){return $.b}));var Y=n(3);n.d(t,"PayloadSource",(function(){return Y.a})),n.d(t,"isPayloadSourceRetrieved",(function(){return Y.b}));var X=n(9);n.d(t,"ProtocolVersion",(function(){return X.a}));var Z=n(12);n.d(t,"PayloadFormat",(function(){return Z.a}));var ee=n(66);n.d(t,"PurePayload",(function(){return ee.a}));var te=n(5);n.d(t,"PayloadField",(function(){return te.a}));var ne=n(8);n.d(t,"StorageKey",(function(){return ne.b}));var re=n(89);n.d(t,"BaseMigration",(function(){return re.a})),n.d(t,"PrivilegeSessionLength",(function(){return T.a}))},function(e,t,n){(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=function(e){"use strict";var n=Object.prototype,r=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function c(e,t,n,r){var a=t&&t.prototype instanceof f?t:f,i=Object.create(a.prototype),o=new S(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return P()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=w(o,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=u(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,o),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function f(){}function p(){}function h(){}var y={};y[i]=function(){return this};var d=Object.getPrototypeOf,v=d&&d(d(O([])));v&&v!==n&&r.call(v,i)&&(y=v);var b=h.prototype=f.prototype=Object.create(y);function m(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function g(e,n){var a;this._invoke=function(i,o){function s(){return new n((function(a,s){!function a(i,o,s,c){var l=u(e[i],e,o);if("throw"!==l.type){var f=l.arg,p=f.value;return p&&"object"===t(p)&&r.call(p,"__await")?n.resolve(p.__await).then((function(e){a("next",e,s,c)}),(function(e){a("throw",e,s,c)})):n.resolve(p).then((function(e){f.value=e,s(f)}),(function(e){return a("throw",e,s,c)}))}c(l.arg)}(i,o,a,s)}))}return a=a?a.then(s,s):s()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function O(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:P}}function P(){return{value:void 0,done:!0}}return p.prototype=b.constructor=h,h.constructor=p,h[s]=p.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},m(g.prototype),g.prototype[o]=function(){return this},e.AsyncIterator=g,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new g(c(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},m(b),b[s]="Generator",b[i]=function(){return this},b.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=O,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:O(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}("object"===t(e)?e.exports:{});try{regeneratorRuntime=n}catch(e){Function("r","regeneratorRuntime = r")(n)}}).call(this,n(68)(e))},function(e,t,n){var r=n(144),a=n(198),i=n(123);e.exports=function(e){var t=a(e);return 1==t.length&&t[0][2]?i(t[0][0],t[0][1]):function(n){return n===e||r(n,e,t)}}},function(e,t,n){var r=n(96),a=n(114);e.exports=function(e,t,n,i){var o=n.length,s=o,c=!i;if(null==e)return!s;for(e=Object(e);o--;){var u=n[o];if(c&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++o<s;){var l=(u=n[o])[0],f=e[l],p=u[1];if(c&&u[2]){if(void 0===f&&!(l in e))return!1}else{var h=new r;if(i)var y=i(f,p,l,e,t,h);if(!(void 0===y?a(p,f,3,i,h):y))return!1}}return!0}},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){var r=n(71),a=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0)&&(n==t.length-1?t.pop():a.call(t,n,1),--this.size,!0)}},function(e,t,n){var r=n(71);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},function(e,t,n){var r=n(71);e.exports=function(e){return r(this.__data__,e)>-1}},function(e,t,n){var r=n(71);e.exports=function(e,t){var n=this.__data__,a=r(n,e);return a<0?(++this.size,n.push([e,t])):n[a][1]=t,this}},function(e,t,n){var r=n(70);e.exports=function(){this.__data__=new r,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){var r=n(70),a=n(97),i=n(99);e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var o=n.__data__;if(!a||o.length<199)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new i(o)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){var r=n(98),a=n(158),i=n(39),o=n(113),s=/^\[object .+?Constructor\]$/,c=Function.prototype,u=Object.prototype,l=c.toString,f=u.hasOwnProperty,p=RegExp("^"+l.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!i(e)||a(e))&&(r(e)?p:s).test(o(e))}},function(e,t,n){var r=n(72),a=Object.prototype,i=a.hasOwnProperty,o=a.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var t=i.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch(e){}var a=o.call(e);return r&&(t?e[s]=n:delete e[s]),a}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t,n){var r,a=n(159),i=(r=/[^.]+$/.exec(a&&a.keys&&a.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!i&&i in e}},function(e,t,n){var r=n(36)["__core-js_shared__"];e.exports=r},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,n){var r=n(162),a=n(70),i=n(97);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(i||a),string:new r}}},function(e,t,n){var r=n(163),a=n(164),i=n(165),o=n(166),s=n(167);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=a,c.prototype.get=i,c.prototype.has=o,c.prototype.set=s,e.exports=c},function(e,t,n){var r=n(73);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,n){var r=n(73),a=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return a.call(t,e)?t[e]:void 0}},function(e,t,n){var r=n(73),a=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:a.call(t,e)}},function(e,t,n){var r=n(73);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},function(e,t,n){var r=n(74);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){var t=n(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){var r=n(74);e.exports=function(e){return r(this,e).get(e)}},function(e,t,n){var r=n(74);e.exports=function(e){return r(this,e).has(e)}},function(e,t,n){var r=n(74);e.exports=function(e,t){var n=r(this,e),a=n.size;return n.set(e,t),this.size+=n.size==a?0:1,this}},function(e,t,n){var r=n(96),a=n(115),i=n(177),o=n(179),s=n(194),c=n(34),u=n(103),l=n(104),f="[object Object]",p=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,h,y,d){var v=c(e),b=c(t),m=v?"[object Array]":s(e),g=b?"[object Array]":s(t),w=(m="[object Arguments]"==m?f:m)==f,k=(g="[object Arguments]"==g?f:g)==f,x=m==g;if(x&&u(e)){if(!u(t))return!1;v=!0,w=!1}if(x&&!w)return d||(d=new r),v||l(e)?a(e,t,n,h,y,d):i(e,t,m,n,h,y,d);if(!(1&n)){var S=w&&p.call(e,"__wrapped__"),O=k&&p.call(t,"__wrapped__");if(S||O){var P=S?e.value():e,j=O?t.value():t;return d||(d=new r),y(P,j,n,h,d)}}return!!x&&(d||(d=new r),o(e,t,n,h,y,d))}},function(e,t){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}},function(e,t,n){var r=n(72),a=n(118),i=n(61),o=n(115),s=n(178),c=n(100),u=r?r.prototype:void 0,l=u?u.valueOf:void 0;e.exports=function(e,t,n,r,u,f,p){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!f(new a(e),new a(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return i(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var h=s;case"[object Set]":var y=1&r;if(h||(h=c),e.size!=t.size&&!y)return!1;var d=p.get(e);if(d)return d==t;r|=2,p.set(e,t);var v=o(h(e),h(t),r,u,f,p);return p.delete(e),v;case"[object Symbol]":if(l)return l.call(e)==l.call(t)}return!1}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}},function(e,t,n){var r=n(180),a=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,i,o,s){var c=1&n,u=r(e),l=u.length;if(l!=r(t).length&&!c)return!1;for(var f=l;f--;){var p=u[f];if(!(c?p in t:a.call(t,p)))return!1}var h=s.get(e);if(h&&s.get(t))return h==t;var y=!0;s.set(e,t),s.set(t,e);for(var d=c;++f<l;){var v=e[p=u[f]],b=t[p];if(i)var m=c?i(b,v,p,t,e,s):i(v,b,p,e,t,s);if(!(void 0===m?v===b||o(v,b,n,i,s):m)){y=!1;break}d||(d="constructor"==p)}if(y&&!d){var g=e.constructor,w=t.constructor;g!=w&&"constructor"in e&&"constructor"in t&&!("function"==typeof g&&g instanceof g&&"function"==typeof w&&w instanceof w)&&(y=!1)}return s.delete(e),s.delete(t),y}},function(e,t,n){var r=n(181),a=n(183),i=n(101);e.exports=function(e){return r(e,i,a)}},function(e,t,n){var r=n(182),a=n(34);e.exports=function(e,t,n){var i=t(e);return a(e)?i:r(i,n(e))}},function(e,t){e.exports=function(e,t){for(var n=-1,r=t.length,a=e.length;++n<r;)e[a+n]=t[n];return e}},function(e,t,n){var r=n(184),a=n(185),i=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,s=o?function(e){return null==e?[]:(e=Object(e),r(o(e),(function(t){return i.call(e,t)})))}:a;e.exports=s},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,a=0,i=[];++n<r;){var o=e[n];t(o,n,e)&&(i[a++]=o)}return i}},function(e,t){e.exports=function(){return[]}},function(e,t){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},function(e,t,n){var r=n(56),a=n(51);e.exports=function(e){return a(e)&&"[object Arguments]"==r(e)}},function(e,t){e.exports=function(){return!1}},function(e,t,n){var r=n(56),a=n(105),i=n(51),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,e.exports=function(e){return i(e)&&a(e.length)&&!!o[r(e)]}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,n){(function(e){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=n(112),i="object"==r(t)&&t&&!t.nodeType&&t,o=i&&"object"==r(e)&&e&&!e.nodeType&&e,s=o&&o.exports===i&&a.process,c=function(){try{var e=o&&o.require&&o.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=c}).call(this,n(68)(e))},function(e,t,n){var r=n(106),a=n(193),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return a(e);var t=[];for(var n in Object(e))i.call(e,n)&&"constructor"!=n&&t.push(n);return t}},function(e,t,n){var r=n(120)(Object.keys,Object);e.exports=r},function(e,t,n){var r=n(195),a=n(97),i=n(196),o=n(121),s=n(197),c=n(56),u=n(113),l=u(r),f=u(a),p=u(i),h=u(o),y=u(s),d=c;(r&&"[object DataView]"!=d(new r(new ArrayBuffer(1)))||a&&"[object Map]"!=d(new a)||i&&"[object Promise]"!=d(i.resolve())||o&&"[object Set]"!=d(new o)||s&&"[object WeakMap]"!=d(new s))&&(d=function(e){var t=c(e),n="[object Object]"==t?e.constructor:void 0,r=n?u(n):"";if(r)switch(r){case l:return"[object DataView]";case f:return"[object Map]";case p:return"[object Promise]";case h:return"[object Set]";case y:return"[object WeakMap]"}return t}),e.exports=d},function(e,t,n){var r=n(50)(n(36),"DataView");e.exports=r},function(e,t,n){var r=n(50)(n(36),"Promise");e.exports=r},function(e,t,n){var r=n(50)(n(36),"WeakMap");e.exports=r},function(e,t,n){var r=n(122),a=n(101);e.exports=function(e){for(var t=a(e),n=t.length;n--;){var i=t[n],o=e[i];t[n]=[i,o,r(o)]}return t}},function(e,t,n){var r=n(114),a=n(200),i=n(207),o=n(109),s=n(122),c=n(123),u=n(63);e.exports=function(e,t){return o(e)&&s(t)?c(u(e),t):function(n){var o=a(n,e);return void 0===o&&o===t?i(n,e):r(t,o,3)}}},function(e,t,n){var r=n(107);e.exports=function(e,t,n){var a=null==e?void 0:r(e,t);return void 0===a?n:a}},function(e,t,n){var r=n(202),a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,o=r((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(a,(function(e,n,r,a){t.push(r?a.replace(i,"$1"):n||e)})),t}));e.exports=o},function(e,t,n){var r=n(203);e.exports=function(e){var t=r(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}},function(e,t,n){var r=n(99);function a(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,a=t?t.apply(this,r):r[0],i=n.cache;if(i.has(a))return i.get(a);var o=e.apply(this,r);return n.cache=i.set(a,o)||i,o};return n.cache=new(a.Cache||r),n}a.Cache=r,e.exports=a},function(e,t,n){var r=n(205);e.exports=function(e){return null==e?"":r(e)}},function(e,t,n){var r=n(72),a=n(206),i=n(34),o=n(76),s=r?r.prototype:void 0,c=s?s.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(i(t))return a(t,e)+"";if(o(t))return c?c.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,a=Array(r);++n<r;)a[n]=t(e[n],n,e);return a}},function(e,t,n){var r=n(208),a=n(209);e.exports=function(e,t){return null!=e&&a(e,t,r)}},function(e,t){e.exports=function(e,t){return null!=e&&t in Object(e)}},function(e,t,n){var r=n(108),a=n(102),i=n(34),o=n(75),s=n(105),c=n(63);e.exports=function(e,t,n){for(var u=-1,l=(t=r(t,e)).length,f=!1;++u<l;){var p=c(t[u]);if(!(f=null!=e&&n(e,p)))break;e=e[p]}return f||++u!=l?f:!!(l=null==e?0:e.length)&&s(l)&&o(p,l)&&(i(e)||a(e))}},function(e,t,n){var r=n(211),a=n(212),i=n(109),o=n(63);e.exports=function(e){return i(e)?r(o(e)):a(e)}},function(e,t){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},function(e,t,n){var r=n(107);e.exports=function(e){return function(t){return r(t,e)}}},function(e,t,n){var r=n(214),a=n(75),i=Array.prototype.splice;e.exports=function(e,t){for(var n=e?t.length:0,o=n-1;n--;){var s=t[n];if(n==o||s!==c){var c=s;a(s)?i.call(e,s,1):r(e,s)}}return e}},function(e,t,n){var r=n(108),a=n(215),i=n(216),o=n(63);e.exports=function(e,t){return t=r(t,e),null==(e=i(e,t))||delete e[o(a(t))]}},function(e,t){e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}},function(e,t,n){var r=n(107),a=n(217);e.exports=function(e,t){return t.length<2?e:r(e,a(t,0,-1))}},function(e,t){e.exports=function(e,t,n){var r=-1,a=e.length;t<0&&(t=-t>a?0:a+t),(n=n>a?a:n)<0&&(n+=a),a=t>n?0:n-t>>>0,t>>>=0;for(var i=Array(a);++r<a;)i[r]=e[r+t];return i}},function(e,t,n){var r=n(95),a=n(62),i=n(101);e.exports=function(e){return function(t,n,o){var s=Object(t);if(!a(t)){var c=r(n,3);t=i(t),n=function(e){return c(s[e],e,s)}}var u=e(t,n,o);return u>-1?s[c?t[u]:u]:void 0}}},function(e,t,n){var r=n(124),a=n(95),i=n(220),o=Math.max;e.exports=function(e,t,n){var s=null==e?0:e.length;if(!s)return-1;var c=null==n?0:i(n);return c<0&&(c=o(s+c,0)),r(e,a(t,3),c)}},function(e,t,n){var r=n(221);e.exports=function(e){var t=r(e),n=t%1;return t==t?n?t-n:t:0}},function(e,t,n){var r=n(222);e.exports=function(e){return e?(e=r(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},function(e,t,n){var r=n(39),a=n(76),i=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(a(e))return NaN;if(r(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=r(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(i,"");var n=s.test(e);return n||c.test(e)?u(e.slice(2),n?2:8):o.test(e)?NaN:+e}},function(e,t,n){var r=n(224)();e.exports=r},function(e,t){e.exports=function(e){return function(t,n,r){for(var a=-1,i=Object(t),o=r(t),s=o.length;s--;){var c=o[e?s:++a];if(!1===n(i[c],c,i))break}return t}}},function(e,t,n){var r=n(126),a=n(226),i=n(227),o=n(229),s=n(230),c=n(102),u=n(34),l=n(232),f=n(103),p=n(98),h=n(39),y=n(233),d=n(104),v=n(129),b=n(234);e.exports=function(e,t,n,m,g,w,k){var x=v(e,n),S=v(t,n),O=k.get(S);if(O)r(e,n,O);else{var P=w?w(x,S,n+"",e,t,k):void 0,j=void 0===P;if(j){var C=u(S),_=!C&&f(S),D=!C&&!_&&d(S);P=S,C||_||D?u(x)?P=x:l(x)?P=o(x):_?(j=!1,P=a(S,!0)):D?(j=!1,P=i(S,!0)):P=[]:y(S)||c(S)?(P=x,c(x)?P=b(x):h(x)&&!p(x)||(P=s(S))):j=!1}j&&(k.set(S,P),g(P,S,m,w,k),k.delete(S)),r(e,n,P)}}},function(e,t,n){(function(e){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=n(36),i="object"==r(t)&&t&&!t.nodeType&&t,o=i&&"object"==r(e)&&e&&!e.nodeType&&e,s=o&&o.exports===i?a.Buffer:void 0,c=s?s.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=c?c(n):new e.constructor(n);return e.copy(r),r}}).call(this,n(68)(e))},function(e,t,n){var r=n(228);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}},function(e,t,n){var r=n(118);e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},function(e,t){e.exports=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}},function(e,t,n){var r=n(231),a=n(128),i=n(106);e.exports=function(e){return"function"!=typeof e.constructor||i(e)?{}:r(a(e))}},function(e,t,n){var r=n(39),a=Object.create,i=function(){function e(){}return function(t){if(!r(t))return{};if(a)return a(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=i},function(e,t,n){var r=n(62),a=n(51);e.exports=function(e){return a(e)&&r(e)}},function(e,t,n){var r=n(56),a=n(128),i=n(51),o=Function.prototype,s=Object.prototype,c=o.toString,u=s.hasOwnProperty,l=c.call(Object);e.exports=function(e){if(!i(e)||"[object Object]"!=r(e))return!1;var t=a(e);if(null===t)return!0;var n=u.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&c.call(n)==l}},function(e,t,n){var r=n(235),a=n(130);e.exports=function(e){return r(e,a(e))}},function(e,t,n){var r=n(236),a=n(111);e.exports=function(e,t,n,i){var o=!n;n||(n={});for(var s=-1,c=t.length;++s<c;){var u=t[s],l=i?i(n[u],e[u],u,n,e):void 0;void 0===l&&(l=e[u]),o?a(n,u,l):r(n,u,l)}return n}},function(e,t,n){var r=n(111),a=n(61),i=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var o=e[t];i.call(e,t)&&a(o,n)&&(void 0!==n||t in e)||r(e,t,n)}},function(e,t,n){var r=n(39),a=n(106),i=n(238),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=a(e),n=[];for(var s in e)("constructor"!=s||!t&&o.call(e,s))&&n.push(s);return n}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},function(e,t,n){var r=n(110),a=n(240),i=n(242);e.exports=function(e,t){return i(a(e,t,r),e+"")}},function(e,t,n){var r=n(241),a=Math.max;e.exports=function(e,t,n){return t=a(void 0===t?e.length-1:t,0),function(){for(var i=arguments,o=-1,s=a(i.length-t,0),c=Array(s);++o<s;)c[o]=i[t+o];o=-1;for(var u=Array(t+1);++o<t;)u[o]=i[o];return u[t]=n(c),r(e,this,u)}}},function(e,t){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},function(e,t,n){var r=n(243),a=n(245)(r);e.exports=a},function(e,t,n){var r=n(244),a=n(127),i=n(110),o=a?function(e,t){return a(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:i;e.exports=o},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t){var n=Date.now;e.exports=function(e){var t=0,r=0;return function(){var a=n(),i=16-(a-r);if(r=a,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=n(61),i=n(62),o=n(75),s=n(39);e.exports=function(e,t,n){if(!s(n))return!1;var c=r(t);return!!("number"==c?i(n)&&o(t,n.length):"string"==c&&t in n)&&a(n[t],e)}},function(e,t,n){var r=n(248);e.exports=function(e,t){return!!(null==e?0:e.length)&&r(e,t,0)>-1}},function(e,t,n){var r=n(124),a=n(249),i=n(250);e.exports=function(e,t,n){return t==t?i(e,t,n):r(e,a,n)}},function(e,t){e.exports=function(e){return e!=e}},function(e,t){e.exports=function(e,t,n){for(var r=n-1,a=e.length;++r<a;)if(e[r]===t)return r;return-1}},function(e,t){e.exports=function(e,t,n){for(var r=-1,a=null==e?0:e.length;++r<a;)if(n(t,e[r]))return!0;return!1}},function(e,t,n){var r=n(121),a=n(253),i=n(100),o=r&&1/i(new r([,-0]))[1]==1/0?function(e){return new r(e)}:a;e.exports=o},function(e,t){e.exports=function(){}},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,a,i,o,s,c=1,u={},l=!1,f=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);p=p&&p.setTimeout?p:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){y(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((i=new MessageChannel).port1.onmessage=function(e){y(e.data)},r=function(e){i.port2.postMessage(e)}):f&&"onreadystatechange"in f.createElement("script")?(a=f.documentElement,r=function(e){var t=f.createElement("script");t.onreadystatechange=function(){y(e),t.onreadystatechange=null,a.removeChild(t),t=null},a.appendChild(t)}):r=function(e){setTimeout(y,0,e)}:(o="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&y(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),r=function(t){e.postMessage(o+t,"*")}),p.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var a={callback:e,args:t};return u[c]=a,r(c),c++},p.clearImmediate=h}function h(e){delete u[e]}function y(e){if(l)setTimeout(y,0,e);else{var t=u[e];if(t){l=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{h(e),l=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(69),n(255))},function(e,t){var n,r,a=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var c,u=[],l=!1,f=-1;function p(){l&&c&&(l=!1,c.length?u=c.concat(u):f=-1,u.length&&h())}function h(){if(!l){var e=s(p);l=!0;for(var t=u.length;t;){for(c=u,u=[];++f<t;)c&&c[f].run();f=-1,t=u.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function y(e,t){this.fun=e,this.array=t}function d(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new y(e,t)),1!==u.length||l||s(h)},y.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=d,a.addListener=d,a.once=d,a.off=d,a.removeListener=d,a.removeAllListeners=d,a.emit=d,a.prependListener=d,a.prependOnceListener=d,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}}])}));