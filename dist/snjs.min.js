!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("SNLibrary",[],t):"object"==typeof exports?exports.SNLibrary=t():e.SNLibrary=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s=209)}([function(e,t,r){"use strict";(function(e){r.d(t,"h",(function(){return f})),r.d(t,"o",(function(){return y})),r.d(t,"g",(function(){return h})),r.d(t,"m",(function(){return v})),r.d(t,"k",(function(){return d})),r.d(t,"l",(function(){return m})),r.d(t,"n",(function(){return g})),r.d(t,"i",(function(){return b})),r.d(t,"z",(function(){return w})),r.d(t,"q",(function(){return k})),r.d(t,"f",(function(){return x})),r.d(t,"x",(function(){return S})),r.d(t,"u",(function(){return R})),r.d(t,"b",(function(){return P})),r.d(t,"v",(function(){return O})),r.d(t,"c",(function(){return _})),r.d(t,"s",(function(){return j})),r.d(t,"r",(function(){return I})),r.d(t,"p",(function(){return D})),r.d(t,"a",(function(){return C})),r.d(t,"e",(function(){return E})),r.d(t,"t",(function(){return A})),r.d(t,"d",(function(){return T})),r.d(t,"j",(function(){return M})),r.d(t,"y",(function(){return K})),r.d(t,"w",(function(){return F}));var n=r(3),o=r.n(n),a=r(89),i=r.n(a),s=r(90),u=r.n(s);function c(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){c(a,n,o,i,s,"next",e)}function s(e){c(a,n,o,i,s,"throw",e)}i(void 0)}))}}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(){return"undefined"!=typeof window?window:void 0!==e?e:null}function y(){return null!==f()}function h(e,t,r){return e.find((function(e){return e[t]===r}))}function v(e){return null!==e&&("function"==typeof e||"object"===p(e))}function d(e){return null!==e&&"function"==typeof e}function m(e){return null==e}function g(e){return"string"==typeof e||e instanceof String}function b(e,t){return e>t?e:t}function w(e,t,r){return u()(e.concat(t),(function(e,t){var n=!0,o=!1,a=void 0;try{for(var i,s=r[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var u=i.value;if(e[u]!==t[u])return!1}}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return!0}))}function k(e){return e[e.length-1]}function x(e,t){var r=!0,n=!1,o=void 0;try{for(var a,i=t[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value;e.push(s)}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}}function S(e,t){var r=!0,n=!1,o=void 0;try{for(var a,i=t[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value;e.splice(e.indexOf(s),1)}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}}function R(e,t){e.splice(e.indexOf(t),1)}function P(e,t){return e.filter((function(e){return!t.includes(e)})).concat(t.filter((function(t){return!e.includes(t)})))}function O(e,t){e.splice(t,1)}function _(e,t){var r=e.slice();return O(r,t),r}function j(e,t){if(e){var r=!0,n=!1,o=void 0;try{for(var a,i=t[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){delete e[a.value]}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}}}function I(e,t){var r=Object.assign({},e),n=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){delete r[i.value]}}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}function D(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.map((function(e,t){return 0===t?e.trim().replace(/[\/]*$/g,""):e.trim().replace(/(^[\/]*|[\/]*$)/g,"")})).filter((function(e){return e.length})).join("/")}function C(e){return JSON.parse(JSON.stringify(e))}function E(e,t){if(!e||!t)throw"Attempting to deepMerge with null values";return i()(e,t,(function(e,t){if(o()(e))return t})),e}function A(e,t){var r={},n=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var u=i.value;r[u]=e[u]}}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return C(r)}function T(e){var t=Object.getOwnPropertyNames(e),r=!0,n=!1,o=void 0;try{for(var a,i=t[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value,u=e[s];e[s]=u&&"object"===p(u)?T(u):u}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}return Object.freeze(e)}function M(e,t){var r=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t);return r&&!m(r.get)}function K(e,t){var r=t/4;return e.substring(0,r)}function F(e){return L.apply(this,arguments)}function L(){return(L=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.warn("Sleeping for",t),e.abrupt("return",new Promise((function(e,r){setTimeout((function(){e()}),t)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}).call(this,r(53))},function(e,t,r){var n=r(16),o=r(184);e.exports=function(e,t){var r=[];if(!e||!e.length)return r;var a=-1,i=[],s=e.length;for(t=n(t,3);++a<s;){var u=e[a];t(u,a,e)&&(r.push(u),i.push(a))}return o(e,i),r}},function(e,t,r){var n=r(70)(r(181));e.exports=n},function(e,t){var r=Array.isArray;e.exports=r},function(e,t,r){var n=r(176)(r(177));e.exports=n},function(e,t,r){(function(e){var r,n,o,a;function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window,a=function(){return function(e){function t(t){for(var r,o,a=t[0],i=t[1],s=0,u=[];s<a.length;s++)o=a[s],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&u.push(n[o][0]),n[o]=0;for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);for(c&&c(t);u.length;)u.shift()()}var r={},n={1:0,2:0};function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(e){var t=[],r=n[e];if(0!==r)if(r)t.push(r[2]);else{var a=new Promise((function(t,o){r=n[e]=[t,o]}));t.push(r[2]=a);var i,s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(e){return o.p+""+({0:"libsodium",3:"vendors~libsodium"}[e]||e)+".bundle.js"}(e);var u=new Error;i=function(t){s.onerror=s.onload=null,clearTimeout(c);var r=n[e];if(0!==r){if(r){var o=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+o+": "+a+")",u.name="ChunkLoadError",u.type=o,u.request=a,r[1](u)}n[e]=void 0}};var c=setTimeout((function(){i({type:"timeout",target:s})}),12e4);s.onerror=s.onload=i,document.head.appendChild(s)}return Promise.all(t)},o.m=e,o.c=r,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==i(e)&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/dist/",o.oe=function(e){throw console.error(e),e};var a=window.webpackJsonpSNCrypto=window.webpackJsonpSNCrypto||[],s=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var c=s;return o(o.s=8)}([function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return o})),r.d(t,"j",(function(){return a})),r.d(t,"o",(function(){return i})),r.d(t,"k",(function(){return s})),r.d(t,"i",(function(){return u})),r.d(t,"n",(function(){return c})),r.d(t,"p",(function(){return l})),r.d(t,"d",(function(){return p})),r.d(t,"c",(function(){return f})),r.d(t,"l",(function(){return y})),r.d(t,"g",(function(){return h})),r.d(t,"b",(function(){return v})),r.d(t,"m",(function(){return d})),r.d(t,"h",(function(){return m})),r.d(t,"f",(function(){return g})),r.d(t,"e",(function(){return b})),r.d(t,"q",(function(){return w}));var n=r(4),o=r(1).Buffer;function a(){return"undefined"!=typeof window?window:void 0!==e?e:null}function i(){return!("undefined"!=typeof document&&document.documentMode||/Edge/.test(navigator.userAgent))&&a().crypto&&!!a().crypto.subtle}function s(){return a().crypto?a().crypto.subtle:null}function u(){var e=a(),t=e.crypto||e.msCrypto;if(t){var r=new Uint32Array(4);t.getRandomValues(r);var n=-1;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){n++;var t=r[n>>3]>>n%8*4&15;return("x"===e?t:3&t|8).toString(16)}))}var o=(new Date).getTime();return e.performance&&"function"==typeof e.performance.now&&(o+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(o+16*Math.random())%16|0;return o=Math.floor(o/16),("x"===e?t:3&t|8).toString(16)}))}function c(e){return"string"==typeof e||e instanceof String}function l(e){return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){var n=new Blob([e]),o=new FileReader;o.onload=function(e){t(e.target.result)},o.readAsArrayBuffer(n)})));case 1:case"end":return t.stop()}}))}function p(e){return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){var n=new Blob([e]),o=new FileReader;o.onload=function(e){t(e.target.result)},o.readAsText(n)})));case 1:case"end":return t.stop()}}))}function f(e){var t,r,n,o;return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:for(t=new Uint8Array(e),r="",o=0;o<t.byteLength;o++)(n=t[o].toString(16)).length<2&&(n="0"+n),r+=n;return a.abrupt("return",r);case 4:case"end":return a.stop()}}))}function y(e){var t,r;return regeneratorRuntime.async((function(n){for(;;)switch(n.prev=n.next){case 0:for(t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return n.abrupt("return",new Uint8Array(t));case 3:case"end":return n.stop()}}))}function h(e){var t,r,n,o;return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,regeneratorRuntime.awrap(b(e));case 2:for(t=a.sent,r=t.length,n=new Uint8Array(r),o=0;o<r;o++)n[o]=t.charCodeAt(o);return a.abrupt("return",n.buffer);case 7:case"end":return a.stop()}}))}function v(e){return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){var n=new Blob([e],{type:"application/octet-binary"}),o=new FileReader;o.onload=function(e){var r=e.target.result;t(r.substr(r.indexOf(",")+1))},o.readAsDataURL(n)})));case 1:case"end":return t.stop()}}))}function d(e){var t;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return t=o.from(e,"hex"),r.abrupt("return",t.toString("base64"));case 2:case"end":return r.stop()}}))}function m(e){var t;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return t=o.from(e,"base64"),r.abrupt("return",t.toString("hex"));case 2:case"end":return r.stop()}}))}function g(e){return a().btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})))}function b(e){return a().atob(e)}function w(e){var t,r=arguments;return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(t=r.length>1&&void 0!==r[1]?r[1]:"binary",!o.isBuffer(e)){a.next=5;break}return a.abrupt("return",e);case 5:if(null!==e){a.next=9;break}return a.abrupt("return",null);case 9:if("string"!=typeof e){a.next=13;break}return a.abrupt("return",o.from(e,t));case 13:if(!(e instanceof Uint8Array)){a.next=17;break}return a.abrupt("return",n(e));case 17:if(!(e instanceof Promise)){a.next=21;break}return a.abrupt("return",e);case 21:throw new TypeError("Invalid type; string or buffer expected");case 22:case"end":return a.stop()}}))}}).call(this,r(2))},function(e,t,r){"use strict";(function(e){
/*!
       * The buffer module from node.js, for the browser.
       *
       * @author   Feross Aboukhadijeh <http://feross.org>
       * @license  MIT
       */
var n=r(5),o=r(6),a=r(3);function i(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(i()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return p(this,e)}return c(this,e,t,r)}function c(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=f(e,t),e}(e,t,r,n):"string"==typeof t?function(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|h(t,r),o=(e=s(e,n)).write(t,r);return o!==n&&(e=e.slice(0,o)),e}(e,t,r):function(e,t){if(u.isBuffer(t)){var r=0|y(t.length);return 0===(e=s(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?s(e,0):f(e,t);if("Buffer"===t.type&&a(t.data))return f(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function p(e,t){if(l(t),e=s(e,t<0?0:0|y(t)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function f(e,t){var r=t.length<0?0:0|y(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function y(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function h(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return V(e).length;default:if(n)return B(e).length;t=(""+t).toLowerCase(),n=!0}}function v(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return D(this,t,r);case"utf8":case"utf-8":return O(this,t,r);case"ascii":return j(this,t,r);case"latin1":case"binary":return I(this,t,r);case"base64":return P(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function d(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,o){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=o?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:g(e,t,r,n,o);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):g(e,[t],r,n,o);throw new TypeError("val must be string, number or Buffer")}function g(e,t,r,n,o){var a,i=1,s=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;i=2,s/=2,u/=2,r/=2}function c(e,t){return 1===i?e[t]:e.readUInt16BE(t*i)}if(o){var l=-1;for(a=r;a<s;a++)if(c(e,a)===c(t,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===u)return l*i}else-1!==l&&(a-=a-l),l=-1}else for(r+u>s&&(r=s-u),a=r;a>=0;a--){for(var p=!0,f=0;f<u;f++)if(c(e,a+f)!==c(t,f)){p=!1;break}if(p)return a}return-1}function b(e,t,r,n){r=Number(r)||0;var o=e.length-r;n?(n=Number(n))>o&&(n=o):n=o;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var i=0;i<n;++i){var s=parseInt(t.substr(2*i,2),16);if(isNaN(s))return i;e[r+i]=s}return i}function w(e,t,r,n){return H(B(t,e.length-r),e,r,n)}function k(e,t,r,n){return H(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function x(e,t,r,n){return k(e,t,r,n)}function S(e,t,r,n){return H(V(t),e,r,n)}function R(e,t,r,n){return H(function(e,t){for(var r,n,o,a=[],i=0;i<e.length&&!((t-=2)<0);++i)n=(r=e.charCodeAt(i))>>8,o=r%256,a.push(o),a.push(n);return a}(t,e.length-r),e,r,n)}function P(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function O(e,t,r){r=Math.min(e.length,r);for(var n=[],o=t;o<r;){var a,i,s,u,c=e[o],l=null,p=c>239?4:c>223?3:c>191?2:1;if(o+p<=r)switch(p){case 1:c<128&&(l=c);break;case 2:128==(192&(a=e[o+1]))&&(u=(31&c)<<6|63&a)>127&&(l=u);break;case 3:a=e[o+1],i=e[o+2],128==(192&a)&&128==(192&i)&&(u=(15&c)<<12|(63&a)<<6|63&i)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:a=e[o+1],i=e[o+2],s=e[o+3],128==(192&a)&&128==(192&i)&&128==(192&s)&&(u=(15&c)<<18|(63&a)<<12|(63&i)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,p=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),o+=p}return function(e){var t=e.length;if(t<=_)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=_));return r}(n)}t.Buffer=u,t.SlowBuffer=function(e){return+e!=e&&(e=0),u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=i(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,r){return c(null,e,t,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,r){return function(e,t,r,n){return l(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}(null,e,t,r)},u.allocUnsafe=function(e){return p(null,e)},u.allocUnsafeSlow=function(e){return p(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,o=0,a=Math.min(r,n);o<a;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=u.allocUnsafe(t),o=0;for(r=0;r<e.length;++r){var i=e[r];if(!u.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,o),o+=i.length}return n},u.byteLength=h,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)d(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)d(this,t,t+3),d(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)d(this,t,t+7),d(this,t+1,t+6),d(this,t+2,t+5),d(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?O(this,0,e):v.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,r,n,o){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),t<0||r>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&t>=r)return 0;if(n>=o)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(o>>>=0)-(n>>>=0),i=(r>>>=0)-(t>>>=0),s=Math.min(a,i),c=this.slice(n,o),l=e.slice(t,r),p=0;p<s;++p)if(c[p]!==l[p]){a=c[p],i=l[p];break}return a<i?-1:i<a?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)},u.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var o=this.length-t;if((void 0===r||r>o)&&(r=o),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return b(this,e,t,r);case"utf8":case"utf-8":return w(this,e,t,r);case"ascii":return k(this,e,t,r);case"latin1":case"binary":return x(this,e,t,r);case"base64":return S(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var _=4096;function j(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(127&e[o]);return n}function I(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(e[o]);return n}function D(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var o="",a=t;a<r;++a)o+=U(e[a]);return o}function C(e,t,r){for(var n=e.slice(t,r),o="",a=0;a<n.length;a+=2)o+=String.fromCharCode(n[a]+256*n[a+1]);return o}function E(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function A(e,t,r,n,o,a){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function T(e,t,r,n){t<0&&(t=65535+t+1);for(var o=0,a=Math.min(e.length-r,2);o<a;++o)e[r+o]=(t&255<<8*(n?o:1-o))>>>8*(n?o:1-o)}function M(e,t,r,n){t<0&&(t=4294967295+t+1);for(var o=0,a=Math.min(e.length-r,4);o<a;++o)e[r+o]=t>>>8*(n?o:3-o)&255}function K(e,t,r,n,o,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function F(e,t,r,n,a){return a||K(e,0,r,4),o.write(e,t,r,n,23,4),r+4}function L(e,t,r,n,a){return a||K(e,0,r,8),o.write(e,t,r,n,52,8),r+8}u.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=u.prototype;else{var o=t-e;r=new u(o,void 0);for(var a=0;a<o;++a)r[a]=this[a+e]}return r},u.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||E(e,t,this.length);for(var n=this[e],o=1,a=0;++a<t&&(o*=256);)n+=this[e+a]*o;return n},u.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||E(e,t,this.length);for(var n=this[e+--t],o=1;t>0&&(o*=256);)n+=this[e+--t]*o;return n},u.prototype.readUInt8=function(e,t){return t||E(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||E(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||E(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||E(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||E(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||E(e,t,this.length);for(var n=this[e],o=1,a=0;++a<t&&(o*=256);)n+=this[e+a]*o;return n>=(o*=128)&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||E(e,t,this.length);for(var n=t,o=1,a=this[e+--n];n>0&&(o*=256);)a+=this[e+--n]*o;return a>=(o*=128)&&(a-=Math.pow(2,8*t)),a},u.prototype.readInt8=function(e,t){return t||E(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||E(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(e,t){t||E(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(e,t){return t||E(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||E(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||E(e,4,this.length),o.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||E(e,4,this.length),o.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||E(e,8,this.length),o.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||E(e,8,this.length),o.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,r,n){e=+e,t|=0,r|=0,n||A(this,e,t,r,Math.pow(2,8*r)-1,0);var o=1,a=0;for(this[t]=255&e;++a<r&&(o*=256);)this[t+a]=e/o&255;return t+r},u.prototype.writeUIntBE=function(e,t,r,n){e=+e,t|=0,r|=0,n||A(this,e,t,r,Math.pow(2,8*r)-1,0);var o=r-1,a=1;for(this[t+o]=255&e;--o>=0&&(a*=256);)this[t+o]=e/a&255;return t+r},u.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||A(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||A(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):T(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||A(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):T(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||A(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):M(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||A(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var o=Math.pow(2,8*r-1);A(this,e,t,r,o-1,-o)}var a=0,i=1,s=0;for(this[t]=255&e;++a<r&&(i*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/i>>0)-s&255;return t+r},u.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var o=Math.pow(2,8*r-1);A(this,e,t,r,o-1,-o)}var a=r-1,i=1,s=0;for(this[t+a]=255&e;--a>=0&&(i*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/i>>0)-s&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||A(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||A(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):T(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||A(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):T(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||A(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):M(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||A(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,r){return F(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return F(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return L(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return L(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var o,a=n-r;if(this===e&&r<t&&t<n)for(o=a-1;o>=0;--o)e[o+t]=this[o+r];else if(a<1e3||!u.TYPED_ARRAY_SUPPORT)for(o=0;o<a;++o)e[o+t]=this[o+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},u.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var i=u.isBuffer(e)?e:B(new u(e,n).toString()),s=i.length;for(a=0;a<r-t;++a)this[a+t]=i[a%s]}return this};var N=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var r;t=t||1/0;for(var n=e.length,o=null,a=[],i=0;i<n;++i){if((r=e.charCodeAt(i))>55295&&r<57344){if(!o){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(i+1===n){(t-=3)>-1&&a.push(239,191,189);continue}o=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&(t-=3)>-1&&a.push(239,191,189);if(o=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function V(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(N,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function H(e,t,r,n){for(var o=0;o<n&&!(o+r>=t.length||o>=e.length);++o)t[o+r]=e[o];return o}}).call(this,r(2))},function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==i(Symbol.iterator)?function(e){return i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":i(e)})(e)}var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"===("undefined"==typeof window?"undefined":r(window))&&(n=window)}e.exports=n},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){(function(t){var n=r(7).strict;e.exports=function(e){if(n(e)){var r=t.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(r=r.slice(e.byteOffset,e.byteOffset+e.byteLength)),r}return t.from(e)}}).call(this,r(1).Buffer)},function(e,t,r){"use strict";t.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,n=c(e),i=n[0],s=n[1],u=new a(function(e,t,r){return 3*(t+r)/4-r}(0,i,s)),l=0,p=s>0?i-4:i;for(r=0;r<p;r+=4)t=o[e.charCodeAt(r)]<<18|o[e.charCodeAt(r+1)]<<12|o[e.charCodeAt(r+2)]<<6|o[e.charCodeAt(r+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;return 2===s&&(t=o[e.charCodeAt(r)]<<2|o[e.charCodeAt(r+1)]>>4,u[l++]=255&t),1===s&&(t=o[e.charCodeAt(r)]<<10|o[e.charCodeAt(r+1)]<<4|o[e.charCodeAt(r+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t),u},t.fromByteArray=function(e){for(var t,r=e.length,o=r%3,a=[],i=0,s=r-o;i<s;i+=16383)a.push(l(e,i,i+16383>s?s:i+16383));return 1===o?(t=e[r-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===o&&(t=(e[r-2]<<8)+e[r-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),a.join("")};for(var n=[],o=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=i.length;s<u;++s)n[s]=i[s],o[i.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,r){for(var o,a,i=[],s=t;s<r;s+=3)o=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),i.push(n[(a=o)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return i.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,o){var a,i,s=8*o-n-1,u=(1<<s)-1,c=u>>1,l=-7,p=r?o-1:0,f=r?-1:1,y=e[t+p];for(p+=f,a=y&(1<<-l)-1,y>>=-l,l+=s;l>0;a=256*a+e[t+p],p+=f,l-=8);for(i=a&(1<<-l)-1,a>>=-l,l+=n;l>0;i=256*i+e[t+p],p+=f,l-=8);if(0===a)a=1-c;else{if(a===u)return i?NaN:1/0*(y?-1:1);i+=Math.pow(2,n),a-=c}return(y?-1:1)*i*Math.pow(2,a-n)},t.write=function(e,t,r,n,o,a){var i,s,u,c=8*a-o-1,l=(1<<c)-1,p=l>>1,f=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,y=n?0:a-1,h=n?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,i=l):(i=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-i))<1&&(i--,u*=2),(t+=i+p>=1?f/u:f*Math.pow(2,1-p))*u>=2&&(i++,u/=2),i+p>=l?(s=0,i=l):i+p>=1?(s=(t*u-1)*Math.pow(2,o),i+=p):(s=t*Math.pow(2,p-1)*Math.pow(2,o),i=0));o>=8;e[r+y]=255&s,y+=h,s/=256,o-=8);for(i=i<<o|s,c+=o;c>0;e[r+y]=255&i,y+=h,i/=256,c-=8);e[r+y-h]|=128*v}},function(e,t){e.exports=o,o.strict=a,o.loose=i;var r=Object.prototype.toString,n={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function o(e){return a(e)||i(e)}function a(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function i(e){return n[r.call(e)]}},function(e,t,r){"use strict";r.r(t);var n=r(0);function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,(r=[{key:"generateUUIDSync",value:function(){return Object(n.i)()}},{key:"generateUUID",value:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(n.i)());case 1:case"end":return e.stop()}}))}},{key:"timingSafeEqual",value:function(e,t){var r=String(e),n=String(t),o=r.length,a=0;o!==n.length&&(n=r,a=1);for(var i=0;i<o;i++)a|=r.charCodeAt(i)^n.charCodeAt(i);return 0===a}}])&&o(t.prototype,r),e}();function s(e){return(s="function"==typeof Symbol&&"symbol"==i(Symbol.iterator)?function(e){return i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":i(e)})(e)}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=n.k(),y="AES-CBC",h="SHA-256",v="PBKDF2",d="HMAC",m=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=c(this,l(t).call(this))).ready=Promise.all([r.e(3),r.e(0)]).then(r.bind(null,166)).then((function(t){return e.sodium=t,e.sodium.ready})),e}var o,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,e),o=t,(a=[{key:"pbkdf2",value:function(e,t,r,n){var o;return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,regeneratorRuntime.awrap(this.webCryptoImportKey(e,v,["deriveBits"]));case 2:if(o=a.sent){a.next=6;break}return console.error("Key is null, unable to continue"),a.abrupt("return",null);case 6:return a.abrupt("return",this.webCryptoDeriveBits(o,t,r,n));case 7:case"end":return a.stop()}}),null,this)}},{key:"generateRandomKey",value:function(e){var t,r;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return t=e/8,r=n.j().crypto.getRandomValues(new Uint8Array(t)),o.abrupt("return",n.c(r));case 3:case"end":return o.stop()}}))}},{key:"aes256CbcEncrypt",value:function(e,t,r){var o,a,i,s,u,c,l;return regeneratorRuntime.async((function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,regeneratorRuntime.awrap(n.l(r));case 2:return o=p.sent,p.next=5,regeneratorRuntime.awrap(n.l(t));case 5:return a=p.sent,i={name:y,iv:a},p.next=9,regeneratorRuntime.awrap(this.webCryptoImportKey(o,i.name,["encrypt"]));case 9:return s=p.sent,p.next=12,regeneratorRuntime.awrap(n.p(e));case 12:return u=p.sent,p.next=15,regeneratorRuntime.awrap(crypto.subtle.encrypt(i,s,u));case 15:return c=p.sent,p.next=18,regeneratorRuntime.awrap(n.b(c));case 18:return l=p.sent,p.abrupt("return",l);case 20:case"end":return p.stop()}}),null,this)}},{key:"aes256CbcDecrypt",value:function(e,t,r){var o,a,i,s,u;return regeneratorRuntime.async((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,regeneratorRuntime.awrap(n.l(r));case 2:return o=c.sent,c.next=5,regeneratorRuntime.awrap(n.l(t));case 5:return a=c.sent,i={name:y,iv:a},c.next=9,regeneratorRuntime.awrap(this.webCryptoImportKey(o,i.name,["decrypt"]));case 9:return s=c.sent,c.next=12,regeneratorRuntime.awrap(n.g(e));case 12:return u=c.sent,c.abrupt("return",crypto.subtle.decrypt(i,s,u).then((function(e){return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",n.d(e));case 1:case"end":return t.stop()}}))})).catch((function(e){return console.error("Error performing AES-CBC decryption:",e),null})));case 14:case"end":return c.stop()}}),null,this)}},{key:"hmac256",value:function(e,t){var r,o,a;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,regeneratorRuntime.awrap(n.l(t));case 2:return r=i.sent,i.next=5,regeneratorRuntime.awrap(this.webCryptoImportKey(r,d,["sign"],{name:h}));case 5:return o=i.sent,i.next=8,regeneratorRuntime.awrap(n.p(e));case 8:return a=i.sent,i.abrupt("return",crypto.subtle.sign({name:d},o,a).then((function(e){return n.c(e)})).catch((function(e){return console.error("Error computing HMAC:",e),null})));case 10:case"end":return i.stop()}}),null,this)}},{key:"sha256",value:function(e){var t,r;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,regeneratorRuntime.awrap(n.p(e));case 2:return t=o.sent,o.next=5,regeneratorRuntime.awrap(crypto.subtle.digest(h,t));case 5:return r=o.sent,o.abrupt("return",n.c(r));case 7:case"end":return o.stop()}}))}},{key:"unsafeSha1",value:function(e){var t,r;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,regeneratorRuntime.awrap(n.p(e));case 2:return t=o.sent,o.next=5,regeneratorRuntime.awrap(crypto.subtle.digest("SHA-1",t));case 5:return r=o.sent,o.abrupt("return",n.c(r));case 7:case"end":return o.stop()}}))}},{key:"webCryptoImportKey",value:function(e,t,r,o){var a;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(!n.n(e)){i.next=6;break}return i.next=3,regeneratorRuntime.awrap(n.p(e));case 3:i.t0=i.sent,i.next=7;break;case 6:i.t0=e;case 7:return a=i.t0,i.abrupt("return",f.importKey("raw",a,{name:t,hash:o},!1,r).then((function(e){return e})).catch((function(e){return console.error(e),null})));case 9:case"end":return i.stop()}}))}},{key:"webCryptoDeriveBits",value:function(e,t,r,o){var a;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=v,i.next=3,regeneratorRuntime.awrap(n.p(t));case 3:return i.t1=i.sent,i.t2=r,i.t3={name:"SHA-512"},a={name:i.t0,salt:i.t1,iterations:i.t2,hash:i.t3},i.abrupt("return",f.deriveBits(a,e,o).then((function(e){return n.c(new Uint8Array(e))})).catch((function(e){return console.error(e),null})));case 8:case"end":return i.stop()}}))}},{key:"argon2",value:function(e,t,r,o,a){var i;return regeneratorRuntime.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,regeneratorRuntime.awrap(this.ready);case 2:return s.t0=this.sodium,s.t1=a,s.next=6,regeneratorRuntime.awrap(n.q(e,"binary"));case 6:return s.t2=s.sent,s.next=9,regeneratorRuntime.awrap(n.q(t,"hex"));case 9:return s.t3=s.sent,s.t4=r,s.t5=o,s.t6=this.sodium.crypto_pwhash_ALG_DEFAULT,i=s.t0.crypto_pwhash.call(s.t0,s.t1,s.t2,s.t3,s.t4,s.t5,s.t6,"hex"),s.abrupt("return",i);case 15:case"end":return s.stop()}}),null,this)}},{key:"xchacha20Encrypt",value:function(e,t,r,o){return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,regeneratorRuntime.awrap(this.ready);case 2:if(48===t.length){a.next=4;break}throw"Nonce must be 24 bytes";case 4:return a.t0=this.sodium,a.next=7,regeneratorRuntime.awrap(n.q(e));case 7:return a.t1=a.sent,a.next=10,regeneratorRuntime.awrap(n.q(o));case 10:return a.t2=a.sent,a.next=13,regeneratorRuntime.awrap(n.q(t,"hex"));case 13:return a.t3=a.sent,a.next=16,regeneratorRuntime.awrap(n.q(r,"hex"));case 16:return a.t4=a.sent,a.abrupt("return",a.t0.crypto_aead_xchacha20poly1305_ietf_encrypt.call(a.t0,a.t1,a.t2,null,a.t3,a.t4,"base64"));case 18:case"end":return a.stop()}}),null,this)}},{key:"xchacha20Decrypt",value:function(e,t,r,o){return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,regeneratorRuntime.awrap(this.ready);case 2:if(48===t.length){a.next=4;break}throw"Nonce must be 24 bytes";case 4:return a.prev=4,a.t0=this.sodium,a.next=8,regeneratorRuntime.awrap(n.q(e,"base64"));case 8:return a.t1=a.sent,a.next=11,regeneratorRuntime.awrap(n.q(o));case 11:return a.t2=a.sent,a.next=14,regeneratorRuntime.awrap(n.q(t,"hex"));case 14:return a.t3=a.sent,a.next=17,regeneratorRuntime.awrap(n.q(r,"hex"));case 17:return a.t4=a.sent,a.abrupt("return",a.t0.crypto_aead_xchacha20poly1305_ietf_decrypt.call(a.t0,null,a.t1,a.t2,a.t3,a.t4,"text"));case 21:return a.prev=21,a.t5=a.catch(4),a.abrupt("return",null);case 24:case"end":return a.stop()}}),null,this,[[4,21]])}}])&&u(o.prototype,a),t}(a);r.d(t,"SNPureCrypto",(function(){return a})),r.d(t,"SNWebCrypto",(function(){return m})),r.d(t,"isWebCryptoAvailable",(function(){return n.o})),r.d(t,"Buffer",(function(){return n.a})),r.d(t,"base64Encode",(function(){return n.f})),r.d(t,"base64Decode",(function(){return n.e})),r.d(t,"base64ToHex",(function(){return n.h})),r.d(t,"hexToBase64",(function(){return n.m}))}])},"object"==i(t)&&"object"==i(e)?e.exports=a():(n=[],void 0===(o="function"==typeof(r=a)?r.apply(t,n):r)||(e.exports=o))}).call(this,r(25)(e))},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=r(55),a="object"==("undefined"==typeof self?"undefined":n(self))&&self&&self.Object===Object&&self,i=o||a||Function("return this")();e.exports=i},function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){var t=r(e);return null!=e&&("object"==t||"function"==t)}},function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){return null!=e&&"object"==r(e)}},function(e,t,r){var n=r(103),o=r(108);e.exports=function(e,t){var r=o(e,t);return n(r)?r:void 0}},function(e,t,r){var n=r(36),o=r(43);e.exports=function(e){return null!=e&&o(e.length)&&!n(e)}},function(e,t,r){var n=r(12),o=r(104),a=r(105),i=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?o(e):a(e)}},function(e,t,r){var n=r(6).Symbol;e.exports=n},function(e,t,r){var n=r(67),o=r(38);e.exports=function(e,t,r,a){var i=!r;r||(r={});for(var s=-1,u=t.length;++s<u;){var c=t[s],l=a?a(r[c],e[c],c,r,e):void 0;void 0===l&&(l=e[c]),i?o(r,c,l):n(r,c,l)}return r}},function(e,t,r){var n=r(68),o=r(153),a=r(10);e.exports=function(e){return a(e)?n(e):o(e)}},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=r(145),a=r(159),i=r(46),s=r(3),u=r(169);e.exports=function(e){return"function"==typeof e?e:null==e?i:"object"==n(e)?s(e)?a(e[0],e[1]):o(e):u(e)}},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=r(11),a=r(8);e.exports=function(e){return"symbol"==n(e)||a(e)&&"[object Symbol]"==o(e)}},function(e,t,r){var n=r(17);e.exports=function(e){if("string"==typeof e||n(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},function(e,t,r){var n=r(73);e.exports=function(e){return e&&e.length?n(e):[]}},function(e,t,r){var n=r(21),o=r(98),a=r(99),i=r(100),s=r(101),u=r(102);function c(e){var t=this.__data__=new n(e);this.size=t.size}c.prototype.clear=o,c.prototype.delete=a,c.prototype.get=i,c.prototype.has=s,c.prototype.set=u,e.exports=c},function(e,t,r){var n=r(93),o=r(94),a=r(95),i=r(96),s=r(97);function u(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}u.prototype.clear=n,u.prototype.delete=o,u.prototype.get=a,u.prototype.has=i,u.prototype.set=s,e.exports=u},function(e,t,r){var n=r(15);e.exports=function(e,t){for(var r=e.length;r--;)if(n(e[r][0],t))return r;return-1}},function(e,t,r){var n=r(9)(Object,"create");e.exports=n},function(e,t,r){var n=r(117);e.exports=function(e,t){var r=e.__data__;return n(t)?r["string"==typeof t?"string":"hash"]:r.map}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){var n=r(124),o=r(8),a=Object.prototype,i=a.hasOwnProperty,s=a.propertyIsEnumerable,u=n(function(){return arguments}())?n:function(e){return o(e)&&i.call(e,"callee")&&!s.call(e,"callee")};e.exports=u},function(e,t,r){(function(e){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=r(6),a=r(126),i="object"==n(t)&&t&&!t.nodeType&&t,s=i&&"object"==n(e)&&e&&!e.nodeType&&e,u=s&&s.exports===i?o.Buffer:void 0,c=(u?u.isBuffer:void 0)||a;e.exports=c}).call(this,r(25)(e))},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,r){var n=r(68),o=r(130),a=r(10);e.exports=function(e){return a(e)?n(e,!0):o(e)}},function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var o=r(e);return!!(t=null==t?9007199254740991:t)&&("number"==o||"symbol"!=o&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o}},function(e,t,r){var n=r(155),o=r(35),a=r(156),i=r(78),s=r(157),u=r(11),c=r(56),l=c(n),p=c(o),f=c(a),y=c(i),h=c(s),v=u;(n&&"[object DataView]"!=v(new n(new ArrayBuffer(1)))||o&&"[object Map]"!=v(new o)||a&&"[object Promise]"!=v(a.resolve())||i&&"[object Set]"!=v(new i)||s&&"[object WeakMap]"!=v(new s))&&(v=function(e){var t=u(e),r="[object Object]"==t?e.constructor:void 0,n=r?c(r):"";if(n)switch(n){case l:return"[object DataView]";case p:return"[object Map]";case f:return"[object Promise]";case y:return"[object Set]";case h:return"[object WeakMap]"}return t}),e.exports=v},function(e,t,r){var n=r(3),o=r(51),a=r(161),i=r(164);e.exports=function(e,t){return n(e)?e:o(e,t)?[e]:a(i(e))}},function(e,t,r){var n=r(54),o=r(69)((function(e,t,r){n(e,t,r)}));e.exports=o},function(e,t,r){var n=r(9)(r(6),"Map");e.exports=n},function(e,t,r){var n=r(11),o=r(7);e.exports=function(e){if(!o(e))return!1;var t=n(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t,r){var n=r(109),o=r(116),a=r(118),i=r(119),s=r(120);function u(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}u.prototype.clear=n,u.prototype.delete=o,u.prototype.get=a,u.prototype.has=i,u.prototype.set=s,e.exports=u},function(e,t,r){var n=r(58);e.exports=function(e,t,r){"__proto__"==t&&n?n(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}},function(e,t,r){var n=r(62);e.exports=function(e){var t=new e.constructor(e.byteLength);return new n(t).set(new n(e)),t}},function(e,t){e.exports=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}},function(e,t,r){var n=r(64)(Object.getPrototypeOf,Object);e.exports=n},function(e,t){var r=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||r)}},function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},function(e,t,r){var n=r(127),o=r(28),a=r(45),i=a&&a.isTypedArray,s=i?o(i):n;e.exports=s},function(e,t,r){(function(e){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=r(55),a="object"==n(t)&&t&&!t.nodeType&&t,i=a&&"object"==n(e)&&e&&!e.nodeType&&e,s=i&&i.exports===a&&o.process,u=function(){try{var e=i&&i.require&&i.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=u}).call(this,r(25)(e))},function(e,t){e.exports=function(e){return e}},function(e,t){e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}},function(e,t){e.exports=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}},function(e,t,r){var n=r(152),o=r(83),a=Object.prototype.propertyIsEnumerable,i=Object.getOwnPropertySymbols,s=i?function(e){return null==e?[]:(e=Object(e),n(i(e),(function(t){return a.call(e,t)})))}:o;e.exports=s},function(e,t,r){var n=r(33),o=r(18);e.exports=function(e,t){for(var r=0,a=(t=n(t,e)).length;null!=e&&r<a;)e=e[o(t[r++])];return r&&r==a?e:void 0}},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=r(3),a=r(17),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;e.exports=function(e,t){if(o(e))return!1;var r=n(e);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!a(e))||(s.test(e)||!i.test(e)||null!=t&&e in Object(t))}},function(e,t,r){var n=r(16),o=r(208);e.exports=function(e,t,r){return o(e,t,n(r,2))}},function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"===("undefined"==typeof window?"undefined":r(window))&&(n=window)}e.exports=n},function(e,t,r){var n=r(20),o=r(57),a=r(59),i=r(122),s=r(7),u=r(29),c=r(66);e.exports=function e(t,r,l,p,f){t!==r&&a(r,(function(a,u){if(f||(f=new n),s(a))i(t,r,u,l,e,p,f);else{var y=p?p(c(t,u),a,u+"",t,r,f):void 0;void 0===y&&(y=a),o(t,u,y)}}),u)}},function(e,t,r){(function(t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n="object"==(void 0===t?"undefined":r(t))&&t&&t.Object===Object&&t;e.exports=n}).call(this,r(53))},function(e,t){var r=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return r.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,r){var n=r(38),o=r(15);e.exports=function(e,t,r){(void 0===r||o(e[t],r))&&(void 0!==r||t in e)||n(e,t,r)}},function(e,t,r){var n=r(9),o=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=o},function(e,t,r){var n=r(121)();e.exports=n},function(e,t,r){(function(e){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=r(6),a="object"==n(t)&&t&&!t.nodeType&&t,i=a&&"object"==n(e)&&e&&!e.nodeType&&e,s=i&&i.exports===a?o.Buffer:void 0,u=s?s.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=u?u(r):new e.constructor(r);return e.copy(n),n}}).call(this,r(25)(e))},function(e,t,r){var n=r(39);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}},function(e,t,r){var n=r(6).Uint8Array;e.exports=n},function(e,t,r){var n=r(123),o=r(41),a=r(42);e.exports=function(e){return"function"!=typeof e.constructor||a(e)?{}:n(o(e))}},function(e,t){e.exports=function(e,t){return function(r){return e(t(r))}}},function(e,t,r){var n=r(11),o=r(41),a=r(8),i=Function.prototype,s=Object.prototype,u=i.toString,c=s.hasOwnProperty,l=u.call(Object);e.exports=function(e){if(!a(e)||"[object Object]"!=n(e))return!1;var t=o(e);if(null===t)return!0;var r=c.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&u.call(r)==l}},function(e,t){e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},function(e,t,r){var n=r(38),o=r(15),a=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){var i=e[t];a.call(e,t)&&o(i,r)&&(void 0!==r||t in e)||n(e,t,r)}},function(e,t,r){var n=r(129),o=r(26),a=r(3),i=r(27),s=r(30),u=r(44),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=a(e),l=!r&&o(e),p=!r&&!l&&i(e),f=!r&&!l&&!p&&u(e),y=r||l||p||f,h=y?n(e.length,String):[],v=h.length;for(var d in e)!t&&!c.call(e,d)||y&&("length"==d||p&&("offset"==d||"parent"==d)||f&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||s(d,v))||h.push(d);return h}},function(e,t,r){var n=r(70),o=r(136);e.exports=function(e){return n((function(t,r){var n=-1,a=r.length,i=a>1?r[a-1]:void 0,s=a>2?r[2]:void 0;for(i=e.length>3&&"function"==typeof i?(a--,i):void 0,s&&o(r[0],r[1],s)&&(i=a<3?void 0:i,a=1),t=Object(t);++n<a;){var u=r[n];u&&e(t,u,n,i)}return t}))}},function(e,t,r){var n=r(46),o=r(71),a=r(72);e.exports=function(e,t){return a(o(e,t,n),e+"")}},function(e,t,r){var n=r(132),o=Math.max;e.exports=function(e,t,r){return t=o(void 0===t?e.length-1:t,0),function(){for(var a=arguments,i=-1,s=o(a.length-t,0),u=Array(s);++i<s;)u[i]=a[t+i];i=-1;for(var c=Array(t+1);++i<t;)c[i]=a[i];return c[t]=r(u),n(e,this,c)}}},function(e,t,r){var n=r(133),o=r(135)(n);e.exports=o},function(e,t,r){var n=r(74),o=r(139),a=r(142),i=r(77),s=r(143),u=r(47);e.exports=function(e,t,r){var c=-1,l=o,p=e.length,f=!0,y=[],h=y;if(r)f=!1,l=a;else if(p>=200){var v=t?null:s(e);if(v)return u(v);f=!1,l=i,h=new n}else h=t?[]:y;e:for(;++c<p;){var d=e[c],m=t?t(d):d;if(d=r||0!==d?d:0,f&&m==m){for(var g=h.length;g--;)if(h[g]===m)continue e;t&&h.push(m),y.push(d)}else l(h,m,r)||(h!==y&&h.push(m),y.push(d))}return y}},function(e,t,r){var n=r(37),o=r(137),a=r(138);function i(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new n;++t<r;)this.add(e[t])}i.prototype.add=i.prototype.push=o,i.prototype.has=a,e.exports=i},function(e,t,r){var n=r(76),o=r(140),a=r(141);e.exports=function(e,t,r){return t==t?a(e,t,r):n(e,o,r)}},function(e,t){e.exports=function(e,t,r,n){for(var o=e.length,a=r+(n?1:-1);n?a--:++a<o;)if(t(e[a],a,e))return a;return-1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,r){var n=r(9)(r(6),"Set");e.exports=n},function(e,t,r){var n=r(147),o=r(8);e.exports=function e(t,r,a,i,s){return t===r||(null==t||null==r||!o(t)&&!o(r)?t!=t&&r!=r:n(t,r,a,i,e,s))}},function(e,t,r){var n=r(74),o=r(148),a=r(77);e.exports=function(e,t,r,i,s,u){var c=1&r,l=e.length,p=t.length;if(l!=p&&!(c&&p>l))return!1;var f=u.get(e);if(f&&u.get(t))return f==t;var y=-1,h=!0,v=2&r?new n:void 0;for(u.set(e,t),u.set(t,e);++y<l;){var d=e[y],m=t[y];if(i)var g=c?i(m,d,y,t,e,u):i(d,m,y,e,t,u);if(void 0!==g){if(g)continue;h=!1;break}if(v){if(!o(t,(function(e,t){if(!a(v,t)&&(d===e||s(d,e,r,i,u)))return v.push(t)}))){h=!1;break}}else if(d!==m&&!s(d,m,r,i,u)){h=!1;break}}return u.delete(e),u.delete(t),h}},function(e,t,r){var n=r(82),o=r(49),a=r(14);e.exports=function(e){return n(e,a,o)}},function(e,t,r){var n=r(48),o=r(3);e.exports=function(e,t,r){var a=t(e);return o(e)?a:n(a,r(e))}},function(e,t){e.exports=function(){return[]}},function(e,t,r){var n=r(7);e.exports=function(e){return e==e&&!n(e)}},function(e,t){e.exports=function(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}}},function(e,t,r){var n=r(33),o=r(185),a=r(186),i=r(18);e.exports=function(e,t){return t=n(t,e),null==(e=a(e,t))||delete e[i(o(t))]}},function(e,t,r){var n=r(48),o=r(41),a=r(49),i=r(83),s=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)n(t,a(e)),e=o(e);return t}:i;e.exports=s},function(e,t,r){var n=r(82),o=r(87),a=r(29);e.exports=function(e){return n(e,a,o)}},function(e,t,r){var n=r(54),o=r(69)((function(e,t,r,o){n(e,t,r,o)}));e.exports=o},function(e,t,r){var n=r(73);e.exports=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?n(e,void 0,t):[]}},function(e,t,r){var n=r(31),o=r(16),a=r(172),i=r(3);e.exports=function(e,t){return(i(e)?n:a)(e,o(t,3))}},function(e,t,r){var n=r(31),o=r(188),a=r(86),i=r(33),s=r(13),u=r(203),c=r(204),l=r(88),p=c((function(e,t){var r={};if(null==e)return r;var c=!1;t=n(t,(function(t){return t=i(t,e),c||(c=t.length>1),t})),s(e,l(e),r),c&&(r=o(r,7,u));for(var p=t.length;p--;)a(r,t[p]);return r}));e.exports=p},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,r){var n=r(22),o=Array.prototype.splice;e.exports=function(e){var t=this.__data__,r=n(t,e);return!(r<0)&&(r==t.length-1?t.pop():o.call(t,r,1),--this.size,!0)}},function(e,t,r){var n=r(22);e.exports=function(e){var t=this.__data__,r=n(t,e);return r<0?void 0:t[r][1]}},function(e,t,r){var n=r(22);e.exports=function(e){return n(this.__data__,e)>-1}},function(e,t,r){var n=r(22);e.exports=function(e,t){var r=this.__data__,o=n(r,e);return o<0?(++this.size,r.push([e,t])):r[o][1]=t,this}},function(e,t,r){var n=r(21);e.exports=function(){this.__data__=new n,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,r){var n=r(21),o=r(35),a=r(37);e.exports=function(e,t){var r=this.__data__;if(r instanceof n){var i=r.__data__;if(!o||i.length<199)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new a(i)}return r.set(e,t),this.size=r.size,this}},function(e,t,r){var n=r(36),o=r(106),a=r(7),i=r(56),s=/^\[object .+?Constructor\]$/,u=Function.prototype,c=Object.prototype,l=u.toString,p=c.hasOwnProperty,f=RegExp("^"+l.call(p).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!a(e)||o(e))&&(n(e)?f:s).test(i(e))}},function(e,t,r){var n=r(12),o=Object.prototype,a=o.hasOwnProperty,i=o.toString,s=n?n.toStringTag:void 0;e.exports=function(e){var t=a.call(e,s),r=e[s];try{e[s]=void 0;var n=!0}catch(e){}var o=i.call(e);return n&&(t?e[s]=r:delete e[s]),o}},function(e,t){var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},function(e,t,r){var n,o=r(107),a=(n=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!a&&a in e}},function(e,t,r){var n=r(6)["__core-js_shared__"];e.exports=n},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,r){var n=r(110),o=r(21),a=r(35);e.exports=function(){this.size=0,this.__data__={hash:new n,map:new(a||o),string:new n}}},function(e,t,r){var n=r(111),o=r(112),a=r(113),i=r(114),s=r(115);function u(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}u.prototype.clear=n,u.prototype.delete=o,u.prototype.get=a,u.prototype.has=i,u.prototype.set=s,e.exports=u},function(e,t,r){var n=r(23);e.exports=function(){this.__data__=n?n(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,r){var n=r(23),o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(n){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return o.call(t,e)?t[e]:void 0}},function(e,t,r){var n=r(23),o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return n?void 0!==t[e]:o.call(t,e)}},function(e,t,r){var n=r(23);e.exports=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=n&&void 0===t?"__lodash_hash_undefined__":t,this}},function(e,t,r){var n=r(24);e.exports=function(e){var t=n(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){var t=r(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,r){var n=r(24);e.exports=function(e){return n(this,e).get(e)}},function(e,t,r){var n=r(24);e.exports=function(e){return n(this,e).has(e)}},function(e,t,r){var n=r(24);e.exports=function(e,t){var r=n(this,e),o=r.size;return r.set(e,t),this.size+=r.size==o?0:1,this}},function(e,t){e.exports=function(e){return function(t,r,n){for(var o=-1,a=Object(t),i=n(t),s=i.length;s--;){var u=i[e?s:++o];if(!1===r(a[u],u,a))break}return t}}},function(e,t,r){var n=r(57),o=r(60),a=r(61),i=r(40),s=r(63),u=r(26),c=r(3),l=r(125),p=r(27),f=r(36),y=r(7),h=r(65),v=r(44),d=r(66),m=r(128);e.exports=function(e,t,r,g,b,w,k){var x=d(e,r),S=d(t,r),R=k.get(S);if(R)n(e,r,R);else{var P=w?w(x,S,r+"",e,t,k):void 0,O=void 0===P;if(O){var _=c(S),j=!_&&p(S),I=!_&&!j&&v(S);P=S,_||j||I?c(x)?P=x:l(x)?P=i(x):j?(O=!1,P=o(S,!0)):I?(O=!1,P=a(S,!0)):P=[]:h(S)||u(S)?(P=x,u(x)?P=m(x):y(x)&&!f(x)||(P=s(S))):O=!1}O&&(k.set(S,P),b(P,S,g,w,k),k.delete(S)),n(e,r,P)}}},function(e,t,r){var n=r(7),o=Object.create,a=function(){function e(){}return function(t){if(!n(t))return{};if(o)return o(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();e.exports=a},function(e,t,r){var n=r(11),o=r(8);e.exports=function(e){return o(e)&&"[object Arguments]"==n(e)}},function(e,t,r){var n=r(10),o=r(8);e.exports=function(e){return o(e)&&n(e)}},function(e,t){e.exports=function(){return!1}},function(e,t,r){var n=r(11),o=r(43),a=r(8),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1,e.exports=function(e){return a(e)&&o(e.length)&&!!i[n(e)]}},function(e,t,r){var n=r(13),o=r(29);e.exports=function(e){return n(e,o(e))}},function(e,t){e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},function(e,t,r){var n=r(7),o=r(42),a=r(131),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return a(e);var t=o(e),r=[];for(var s in e)("constructor"!=s||!t&&i.call(e,s))&&r.push(s);return r}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},function(e,t){e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},function(e,t,r){var n=r(134),o=r(58),a=r(46),i=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:a;e.exports=i},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t){var r=Date.now;e.exports=function(e){var t=0,n=0;return function(){var o=r(),a=16-(o-n);if(n=o,a>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=r(15),a=r(10),i=r(30),s=r(7);e.exports=function(e,t,r){if(!s(r))return!1;var u=n(t);return!!("number"==u?a(r)&&i(t,r.length):"string"==u&&t in r)&&o(r[t],e)}},function(e,t){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,r){var n=r(75);e.exports=function(e,t){return!!(null==e?0:e.length)&&n(e,t,0)>-1}},function(e,t){e.exports=function(e){return e!=e}},function(e,t){e.exports=function(e,t,r){for(var n=r-1,o=e.length;++n<o;)if(e[n]===t)return n;return-1}},function(e,t){e.exports=function(e,t,r){for(var n=-1,o=null==e?0:e.length;++n<o;)if(r(t,e[n]))return!0;return!1}},function(e,t,r){var n=r(78),o=r(144),a=r(47),i=n&&1/a(new n([,-0]))[1]==1/0?function(e){return new n(e)}:o;e.exports=i},function(e,t){e.exports=function(){}},function(e,t,r){var n=r(146),o=r(158),a=r(85);e.exports=function(e){var t=o(e);return 1==t.length&&t[0][2]?a(t[0][0],t[0][1]):function(r){return r===e||n(r,e,t)}}},function(e,t,r){var n=r(20),o=r(79);e.exports=function(e,t,r,a){var i=r.length,s=i,u=!a;if(null==e)return!s;for(e=Object(e);i--;){var c=r[i];if(u&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++i<s;){var l=(c=r[i])[0],p=e[l],f=c[1];if(u&&c[2]){if(void 0===p&&!(l in e))return!1}else{var y=new n;if(a)var h=a(p,f,l,e,t,y);if(!(void 0===h?o(f,p,3,a,y):h))return!1}}return!0}},function(e,t,r){var n=r(20),o=r(80),a=r(149),i=r(151),s=r(32),u=r(3),c=r(27),l=r(44),p="[object Object]",f=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,y,h,v){var d=u(e),m=u(t),g=d?"[object Array]":s(e),b=m?"[object Array]":s(t),w=(g="[object Arguments]"==g?p:g)==p,k=(b="[object Arguments]"==b?p:b)==p,x=g==b;if(x&&c(e)){if(!c(t))return!1;d=!0,w=!1}if(x&&!w)return v||(v=new n),d||l(e)?o(e,t,r,y,h,v):a(e,t,g,r,y,h,v);if(!(1&r)){var S=w&&f.call(e,"__wrapped__"),R=k&&f.call(t,"__wrapped__");if(S||R){var P=S?e.value():e,O=R?t.value():t;return v||(v=new n),h(P,O,r,y,v)}}return!!x&&(v||(v=new n),i(e,t,r,y,h,v))}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}},function(e,t,r){var n=r(12),o=r(62),a=r(15),i=r(80),s=r(150),u=r(47),c=n?n.prototype:void 0,l=c?c.valueOf:void 0;e.exports=function(e,t,r,n,c,p,f){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!p(new o(e),new o(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return a(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var y=s;case"[object Set]":var h=1&n;if(y||(y=u),e.size!=t.size&&!h)return!1;var v=f.get(e);if(v)return v==t;n|=2,f.set(e,t);var d=i(y(e),y(t),n,c,p,f);return f.delete(e),d;case"[object Symbol]":if(l)return l.call(e)==l.call(t)}return!1}},function(e,t){e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}},function(e,t,r){var n=r(81),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,a,i,s){var u=1&r,c=n(e),l=c.length;if(l!=n(t).length&&!u)return!1;for(var p=l;p--;){var f=c[p];if(!(u?f in t:o.call(t,f)))return!1}var y=s.get(e);if(y&&s.get(t))return y==t;var h=!0;s.set(e,t),s.set(t,e);for(var v=u;++p<l;){var d=e[f=c[p]],m=t[f];if(a)var g=u?a(m,d,f,t,e,s):a(d,m,f,e,t,s);if(!(void 0===g?d===m||i(d,m,r,a,s):g)){h=!1;break}v||(v="constructor"==f)}if(h&&!v){var b=e.constructor,w=t.constructor;b!=w&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof w&&w instanceof w)&&(h=!1)}return s.delete(e),s.delete(t),h}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var i=e[r];t(i,r,e)&&(a[o++]=i)}return a}},function(e,t,r){var n=r(42),o=r(154),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return o(e);var t=[];for(var r in Object(e))a.call(e,r)&&"constructor"!=r&&t.push(r);return t}},function(e,t,r){var n=r(64)(Object.keys,Object);e.exports=n},function(e,t,r){var n=r(9)(r(6),"DataView");e.exports=n},function(e,t,r){var n=r(9)(r(6),"Promise");e.exports=n},function(e,t,r){var n=r(9)(r(6),"WeakMap");e.exports=n},function(e,t,r){var n=r(84),o=r(14);e.exports=function(e){for(var t=o(e),r=t.length;r--;){var a=t[r],i=e[a];t[r]=[a,i,n(i)]}return t}},function(e,t,r){var n=r(79),o=r(160),a=r(166),i=r(51),s=r(84),u=r(85),c=r(18);e.exports=function(e,t){return i(e)&&s(t)?u(c(e),t):function(r){var i=o(r,e);return void 0===i&&i===t?a(r,e):n(t,i,3)}}},function(e,t,r){var n=r(50);e.exports=function(e,t,r){var o=null==e?void 0:n(e,t);return void 0===o?r:o}},function(e,t,r){var n=r(162),o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,a=/\\(\\)?/g,i=n((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(o,(function(e,r,n,o){t.push(n?o.replace(a,"$1"):r||e)})),t}));e.exports=i},function(e,t,r){var n=r(163);e.exports=function(e){var t=n(e,(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t}},function(e,t,r){var n=r(37);function o(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function r(){var n=arguments,o=t?t.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var i=e.apply(this,n);return r.cache=a.set(o,i)||a,i};return r.cache=new(o.Cache||n),r}o.Cache=n,e.exports=o},function(e,t,r){var n=r(165);e.exports=function(e){return null==e?"":n(e)}},function(e,t,r){var n=r(12),o=r(31),a=r(3),i=r(17),s=n?n.prototype:void 0,u=s?s.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(a(t))return o(t,e)+"";if(i(t))return u?u.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r}},function(e,t,r){var n=r(167),o=r(168);e.exports=function(e,t){return null!=e&&o(e,t,n)}},function(e,t){e.exports=function(e,t){return null!=e&&t in Object(e)}},function(e,t,r){var n=r(33),o=r(26),a=r(3),i=r(30),s=r(43),u=r(18);e.exports=function(e,t,r){for(var c=-1,l=(t=n(t,e)).length,p=!1;++c<l;){var f=u(t[c]);if(!(p=null!=e&&r(e,f)))break;e=e[f]}return p||++c!=l?p:!!(l=null==e?0:e.length)&&s(l)&&i(f,l)&&(a(e)||o(e))}},function(e,t,r){var n=r(170),o=r(171),a=r(51),i=r(18);e.exports=function(e){return a(e)?n(i(e)):o(e)}},function(e,t){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},function(e,t,r){var n=r(50);e.exports=function(e){return function(t){return n(t,e)}}},function(e,t,r){var n=r(173),o=r(10);e.exports=function(e,t){var r=-1,a=o(e)?Array(e.length):[];return n(e,(function(e,n,o){a[++r]=t(e,n,o)})),a}},function(e,t,r){var n=r(174),o=r(175)(n);e.exports=o},function(e,t,r){var n=r(59),o=r(14);e.exports=function(e,t){return e&&n(e,t,o)}},function(e,t,r){var n=r(10);e.exports=function(e,t){return function(r,o){if(null==r)return r;if(!n(r))return e(r,o);for(var a=r.length,i=t?a:-1,s=Object(r);(t?i--:++i<a)&&!1!==o(s[i],i,s););return r}}},function(e,t,r){var n=r(16),o=r(10),a=r(14);e.exports=function(e){return function(t,r,i){var s=Object(t);if(!o(t)){var u=n(r,3);t=a(t),r=function(e){return u(s[e],e,s)}}var c=e(t,r,i);return c>-1?s[u?t[c]:c]:void 0}}},function(e,t,r){var n=r(76),o=r(16),a=r(178),i=Math.max;e.exports=function(e,t,r){var s=null==e?0:e.length;if(!s)return-1;var u=null==r?0:a(r);return u<0&&(u=i(s+u,0)),n(e,o(t,3),u)}},function(e,t,r){var n=r(179);e.exports=function(e){var t=n(e),r=t%1;return t==t?r?t-r:t:0}},function(e,t,r){var n=r(180);e.exports=function(e){return e?(e=n(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},function(e,t,r){var n=r(7),o=r(17),a=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,u=/^0o[0-7]+$/i,c=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return NaN;if(n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(a,"");var r=s.test(e);return r||u.test(e)?c(e.slice(2),r?2:8):i.test(e)?NaN:+e}},function(e,t,r){var n=r(182);e.exports=function(e,t){return e&&e.length&&t&&t.length?n(e,t):e}},function(e,t,r){var n=r(31),o=r(75),a=r(183),i=r(28),s=r(40),u=Array.prototype.splice;e.exports=function(e,t,r,c){var l=c?a:o,p=-1,f=t.length,y=e;for(e===t&&(t=s(t)),r&&(y=n(e,i(r)));++p<f;)for(var h=0,v=t[p],d=r?r(v):v;(h=l(y,d,h,c))>-1;)y!==e&&u.call(y,h,1),u.call(e,h,1);return e}},function(e,t){e.exports=function(e,t,r,n){for(var o=r-1,a=e.length;++o<a;)if(n(e[o],t))return o;return-1}},function(e,t,r){var n=r(86),o=r(30),a=Array.prototype.splice;e.exports=function(e,t){for(var r=e?t.length:0,i=r-1;r--;){var s=t[r];if(r==i||s!==u){var u=s;o(s)?a.call(e,s,1):n(e,s)}}return e}},function(e,t){e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}},function(e,t,r){var n=r(50),o=r(187);e.exports=function(e,t){return t.length<2?e:n(e,o(t,0,-1))}},function(e,t){e.exports=function(e,t,r){var n=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(r=r>o?o:r)<0&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;for(var a=Array(o);++n<o;)a[n]=e[n+t];return a}},function(e,t,r){var n=r(20),o=r(189),a=r(67),i=r(190),s=r(191),u=r(60),c=r(40),l=r(192),p=r(193),f=r(81),y=r(88),h=r(32),v=r(194),d=r(195),m=r(63),g=r(3),b=r(27),w=r(199),k=r(7),x=r(201),S=r(14),R={};R["[object Arguments]"]=R["[object Array]"]=R["[object ArrayBuffer]"]=R["[object DataView]"]=R["[object Boolean]"]=R["[object Date]"]=R["[object Float32Array]"]=R["[object Float64Array]"]=R["[object Int8Array]"]=R["[object Int16Array]"]=R["[object Int32Array]"]=R["[object Map]"]=R["[object Number]"]=R["[object Object]"]=R["[object RegExp]"]=R["[object Set]"]=R["[object String]"]=R["[object Symbol]"]=R["[object Uint8Array]"]=R["[object Uint8ClampedArray]"]=R["[object Uint16Array]"]=R["[object Uint32Array]"]=!0,R["[object Error]"]=R["[object Function]"]=R["[object WeakMap]"]=!1,e.exports=function e(t,r,P,O,_,j){var I,D=1&r,C=2&r,E=4&r;if(P&&(I=_?P(t,O,_,j):P(t)),void 0!==I)return I;if(!k(t))return t;var A=g(t);if(A){if(I=v(t),!D)return c(t,I)}else{var T=h(t),M="[object Function]"==T||"[object GeneratorFunction]"==T;if(b(t))return u(t,D);if("[object Object]"==T||"[object Arguments]"==T||M&&!_){if(I=C||M?{}:m(t),!D)return C?p(t,s(I,t)):l(t,i(I,t))}else{if(!R[T])return _?t:{};I=d(t,T,D)}}j||(j=new n);var K=j.get(t);if(K)return K;j.set(t,I),x(t)?t.forEach((function(n){I.add(e(n,r,P,n,t,j))})):w(t)&&t.forEach((function(n,o){I.set(o,e(n,r,P,o,t,j))}));var F=E?C?y:f:C?keysIn:S,L=A?void 0:F(t);return o(L||t,(function(n,o){L&&(n=t[o=n]),a(I,o,e(n,r,P,o,t,j))})),I}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}},function(e,t,r){var n=r(13),o=r(14);e.exports=function(e,t){return e&&n(t,o(t),e)}},function(e,t,r){var n=r(13),o=r(29);e.exports=function(e,t){return e&&n(t,o(t),e)}},function(e,t,r){var n=r(13),o=r(49);e.exports=function(e,t){return n(e,o(e),t)}},function(e,t,r){var n=r(13),o=r(87);e.exports=function(e,t){return n(e,o(e),t)}},function(e,t){var r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&r.call(e,"index")&&(n.index=e.index,n.input=e.input),n}},function(e,t,r){var n=r(39),o=r(196),a=r(197),i=r(198),s=r(61);e.exports=function(e,t,r){var u=e.constructor;switch(t){case"[object ArrayBuffer]":return n(e);case"[object Boolean]":case"[object Date]":return new u(+e);case"[object DataView]":return o(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(e,r);case"[object Map]":return new u;case"[object Number]":case"[object String]":return new u(e);case"[object RegExp]":return a(e);case"[object Set]":return new u;case"[object Symbol]":return i(e)}}},function(e,t,r){var n=r(39);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}},function(e,t){var r=/\w*$/;e.exports=function(e){var t=new e.constructor(e.source,r.exec(e));return t.lastIndex=e.lastIndex,t}},function(e,t,r){var n=r(12),o=n?n.prototype:void 0,a=o?o.valueOf:void 0;e.exports=function(e){return a?Object(a.call(e)):{}}},function(e,t,r){var n=r(200),o=r(28),a=r(45),i=a&&a.isMap,s=i?o(i):n;e.exports=s},function(e,t,r){var n=r(32),o=r(8);e.exports=function(e){return o(e)&&"[object Map]"==n(e)}},function(e,t,r){var n=r(202),o=r(28),a=r(45),i=a&&a.isSet,s=i?o(i):n;e.exports=s},function(e,t,r){var n=r(32),o=r(8);e.exports=function(e){return o(e)&&"[object Set]"==n(e)}},function(e,t,r){var n=r(65);e.exports=function(e){return n(e)?void 0:e}},function(e,t,r){var n=r(205),o=r(71),a=r(72);e.exports=function(e){return a(o(e,void 0,n),e+"")}},function(e,t,r){var n=r(206);e.exports=function(e){return(null==e?0:e.length)?n(e,1):[]}},function(e,t,r){var n=r(48),o=r(207);e.exports=function e(t,r,a,i,s){var u=-1,c=t.length;for(a||(a=o),s||(s=[]);++u<c;){var l=t[u];r>0&&a(l)?r>1?e(l,r-1,a,i,s):n(s,l):i||(s[s.length]=l)}return s}},function(e,t,r){var n=r(12),o=r(26),a=r(3),i=n?n.isConcatSpreadable:void 0;e.exports=function(e){return a(e)||o(e)||!!(i&&e&&e[i])}},function(e,t,r){var n=r(17),o=Math.floor,a=Math.min;e.exports=function(e,t,r,i){t=r(t);for(var s=0,u=null==e?0:e.length,c=t!=t,l=null===t,p=n(t),f=void 0===t;s<u;){var y=o((s+u)/2),h=r(e[y]),v=void 0!==h,d=null===h,m=h==h,g=n(h);if(c)var b=i||m;else b=f?m&&(i||v):l?m&&v&&(i||!d):p?m&&v&&!d&&(i||!g):!d&&!g&&(i?h<=t:h<t);b?s=y+1:u=y}return a(u,4294967294)}},function(e,t,r){"use strict";r.r(t),r.d(t,"SNApplication",(function(){return ll})),r.d(t,"SNProtocolService",(function(){return cu})),r.d(t,"SNProtocolOperator001",(function(){return ke})),r.d(t,"SNProtocolOperator002",(function(){return Ee})),r.d(t,"SNProtocolOperator003",(function(){return Be})),r.d(t,"SNProtocolOperator004",(function(){return Xe})),r.d(t,"DeviceInterface",(function(){return vl})),r.d(t,"SNItem",(function(){return H})),r.d(t,"SNItemsKey",(function(){return it})),r.d(t,"SNPredicate",(function(){return y})),r.d(t,"SNNote",(function(){return ir})),r.d(t,"SNTag",(function(){return Zt})),r.d(t,"SNSmartTag",(function(){return Or})),r.d(t,"SNActionsExtension",(function(){return qt})),r.d(t,"Action",(function(){return Nt})),r.d(t,"SNTheme",(function(){return Ar})),r.d(t,"SNEncryptedStorage",(function(){return Vr})),r.d(t,"SNComponent",(function(){return bt})),r.d(t,"SNEditor",(function(){return Tt})),r.d(t,"SNComponentManager",(function(){return Ri})),r.d(t,"HistorySession",(function(){return Ru})),r.d(t,"ItemHistory",(function(){return xu})),r.d(t,"ItemHistoryEntry",(function(){return pu})),r.d(t,"SNPrivileges",(function(){return wr})),r.d(t,"SNWebCrypto",(function(){return ae.SNWebCrypto})),r.d(t,"SNReactNativeCrypto",(function(){return ae.SNReactNativeCrypto})),r.d(t,"SNModelManager",(function(){return zi})),r.d(t,"SNHttpService",(function(){return Ai})),r.d(t,"DeviceAuthService",(function(){return al})),r.d(t,"ChallengeResponse",(function(){return dl})),r.d(t,"PureService",(function(){return ya})),r.d(t,"SNStorageService",(function(){return Ps})),r.d(t,"StoragePersistencePolicies",(function(){return ks})),r.d(t,"StorageEncryptionPolicies",(function(){return xs})),r.d(t,"StorageValueModes",(function(){return Ss})),r.d(t,"ValueModesKeys",(function(){return Rs})),r.d(t,"Challenges",(function(){return C})),r.d(t,"SNSyncService",(function(){return $c})),r.d(t,"SyncSources",(function(){return Qc})),r.d(t,"SyncModes",(function(){return Gc})),r.d(t,"TIMING_STRATEGY_RESOLVE_ON_NEXT",(function(){return Yc})),r.d(t,"TIMING_STRATEGY_FORCE_SPAWN_NEW",(function(){return Jc})),r.d(t,"SNSessionManager",(function(){return Ea})),r.d(t,"SNMigrationService",(function(){return Zs})),r.d(t,"SNAlertService",(function(){return ka})),r.d(t,"SNHistoryManager",(function(){return Eu})),r.d(t,"SNPrivilegesService",(function(){return qu})),r.d(t,"SNSingletonManager",(function(){return Zi})),r.d(t,"SNKeyManager",(function(){return oc})),r.d(t,"KEY_MODE_ROOT_KEY_NONE",(function(){return ec})),r.d(t,"KEY_MODE_ROOT_KEY_ONLY",(function(){return tc})),r.d(t,"KEY_MODE_ROOT_KEY_PLUS_WRAPPER",(function(){return rc})),r.d(t,"KEY_MODE_WRAPPER_ONLY",(function(){return nc})),r.d(t,"SNApiService",(function(){return Qa})),r.d(t,"findInArray",(function(){return o.g})),r.d(t,"isNullOrUndefined",(function(){return o.l})),r.d(t,"deepMerge",(function(){return o.e})),r.d(t,"extendArray",(function(){return o.f})),r.d(t,"removeFromIndex",(function(){return o.v})),r.d(t,"subtractFromArray",(function(){return o.x})),r.d(t,"arrayByDifference",(function(){return o.b})),r.d(t,"uniqCombineObjArrays",(function(){return o.z})),r.d(t,"greaterOfTwoDates",(function(){return o.i})),r.d(t,"getGlobalScope",(function(){return o.h})),r.d(t,"truncateHexString",(function(){return o.y})),r.d(t,"Uuid",(function(){return L})),r.d(t,"EncryptionIntents",(function(){return q})),r.d(t,"isLocalStorageIntent",(function(){return Y})),r.d(t,"isFileIntent",(function(){return J})),r.d(t,"isDecryptedIntent",(function(){return G})),r.d(t,"intentRequiresEncryption",(function(){return Q})),r.d(t,"ContentTypes",(function(){return i})),r.d(t,"ApplicationEvents",(function(){return d})),r.d(t,"Environments",(function(){return O})),r.d(t,"Platforms",(function(){return _})),r.d(t,"isEnvironmentWebOrDesktop",(function(){return I})),r.d(t,"isEnvironmentMobile",(function(){return D})),r.d(t,"platformFromString",(function(){return j})),r.d(t,"SyncEvents",(function(){return h})),r.d(t,"SNPureItemPayload",(function(){return pn})),r.d(t,"SNStorageItemPayload",(function(){return gn})),r.d(t,"PayloadCollection",(function(){return c})),r.d(t,"CreateMaxPayloadFromAnyObject",(function(){return ra})),r.d(t,"CreateSourcedPayloadFromObject",(function(){return oa})),r.d(t,"PayloadSources",(function(){return en})),r.d(t,"isPayloadSourceRetrieved",(function(){return tn})),r.d(t,"ProtocolVersions",(function(){return W})),r.d(t,"PayloadFormats",(function(){return oe})),r.d(t,"StorageKeys",(function(){return E})),r.d(t,"BaseMigration",(function(){return Ws})),r.d(t,"ProtectedActions",(function(){return Uu})),r.d(t,"PrivilegeCredentials",(function(){return Bu})),r.d(t,"PRIVILEGE_SESSION_LENGTH_NONE",(function(){return Vu})),r.d(t,"PRIVILEGE_SESSION_LENGTH_FIVE_MINUTES",(function(){return Hu})),r.d(t,"PRIVILEGE_SESSION_LENGTH_ONE_HOUR",(function(){return Wu})),r.d(t,"PRIVILEGE_SESSION_LENGTH_ONE_WEEK",(function(){return zu}));var n={};r.r(n),r.d(n,"Migration20200115",(function(){return Ms}));var o=r(0);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i={Item:"SF|Item",RootKey:"SN|RootKey|NoSync",ItemsKey:"SN|ItemsKey",EncryptedStorage:"SN|EncryptedStorage",Note:"Note",Tag:"Tag",SmartTag:"SN|SmartTag",Component:"SN|Component",Editor:"SN|Editor",ActionsExtension:"Extension",UserPrefs:"SN|UserPreferences",Privileges:"SN|Privileges",HistorySession:"SN|HistorySession",Theme:"SN|Theme",Mfa:"SF|MFA",ServerExtension:"SF|Extension",FilesafeCredentials:"SN|FileSafe|Credentials",FilesafeFileMetadata:"SN|FileSafe|FileMetadata",FilesafeIntegration:"SN|FileSafe|Integration",ExtensionRepo:"SN|ExtensionRepo"};function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.payloads,n=void 0===r?[]:r,o=t.source;s(this,e),this.source=o,this.payloadMap={},this.allPayloads=n;var a=!0,i=!1,u=void 0;try{for(var c,l=n[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var p=c.value;this.payloadMap[p.uuid]=p}}catch(e){i=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(i)throw u}}Object.freeze(this)}var t,r,n;return t=e,(r=[{key:"findPayload",value:function(e){return this.payloadMap[e]}},{key:"concat",value:function(t){var r=t.allPayloads.slice(),n=!0,a=!1,i=void 0;try{for(var s,u=this.allPayloads[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var c=s.value;Object(o.g)(t.allPayloads,"uuid",c.uuid)||r.push(c)}}catch(e){a=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw i}}return new e({payloads:r,source:this.source})}},{key:"payloadsThatReferencePayload",value:function(e){for(var t=[],r=0,n=Object.keys(this.payloadMap);r<n.length;r++){var a=n[r],i=this.findPayload(a);i.errorDecrypting||Object(o.g)(i.content.references,"uuid",e.uuid)&&t.push(i)}return t}}])&&u(t.prototype,r),n&&u(t,n),e}();function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=function(){function e(t){var r=t.collections;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.collections=r,Object.freeze(this)}var t,r,n;return t=e,(r=[{key:"collectionForSource",value:function(e){return this.collections.find((function(t){return t.source===e}))}}])&&l(t.prototype,r),n&&l(t,n),e}();function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var y=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keypath=t,this.operator=r,this.value=n,e.IsRecursiveOperator(this.operator)&&(this.value=this.value.map((function(t){return Array.isArray(t)?e.FromArray(t):t})))}var t,r,n;return t=e,n=[{key:"CompoundPredicate",value:function(t){return new e("ignored","and",t)}},{key:"FromArray",value:function(t){return new e(t[0],t[1],t[2])}},{key:"ObjectSatisfiesPredicate",value:function(t,r){if(Array.isArray(r)&&(r=this.FromArray(r)),e.IsRecursiveOperator(r.operator)){if("and"===r.operator){var n=!0,o=!1,a=void 0;try{for(var i,s=r.value[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var u=i.value;if(!this.ObjectSatisfiesPredicate(t,u))return!1}}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return!0}if("or"===r.operator){var c=!0,l=!1,p=void 0;try{for(var f,y=r.value[Symbol.iterator]();!(c=(f=y.next()).done);c=!0){var h=f.value;if(this.ObjectSatisfiesPredicate(t,h))return!0}}catch(e){l=!0,p=e}finally{try{c||null==y.return||y.return()}finally{if(l)throw p}}return!1}}var v=r.value;"string"==typeof v&&v.includes(".ago")&&(v=this.DateFromString(v));var d=r.keypath.split(".").reduce((function(e,t){return e&&e[t]}),t),m=[!1,"",null,void 0,NaN];return void 0===d?"!="===r.operator?!m.includes(r.value):m.includes(r.value):"="===r.operator?Array.isArray(d)?JSON.stringify(d)===JSON.stringify(v):d===v:"!="===r.operator?Array.isArray(d)?JSON.stringify(d)!==JSON.stringify(v):d!==v:"<"===r.operator?d<v:">"===r.operator?d>v:"<="===r.operator?d<=v:">="===r.operator?d>=v:"startsWith"===r.operator?d.startsWith(v):"in"===r.operator?-1!==v.indexOf(d):"includes"===r.operator?this.resolveIncludesPredicate(d,v):"matches"===r.operator&&new RegExp(v).test(d)}},{key:"resolveIncludesPredicate",value:function(t,r){if("string"==typeof r)return t.includes(r);var n;n=Array.isArray(r)?e.FromArray(r):r;var o=!0,a=!1,i=void 0;try{for(var s,u=t[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var c=s.value;if(this.ObjectSatisfiesPredicate(c,n))return!0}}catch(e){a=!0,i=e}finally{try{o||null==u.return||u.return()}finally{if(a)throw i}}return!1}},{key:"ItemSatisfiesPredicate",value:function(t,r){return Array.isArray(r)&&(r=e.FromArray(r)),this.ObjectSatisfiesPredicate(t,r)}},{key:"ItemSatisfiesPredicates",value:function(e,t){var r=!0,n=!1,o=void 0;try{for(var a,i=t[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value;if(!this.ItemSatisfiesPredicate(e,s))return!1}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}return!0}},{key:"DateFromString",value:function(e){var t=e.split("."),r=t[1],n=new Date,o=parseInt(t[0]);return"days"===r?n.setDate(n.getDate()-o):"hours"===r&&n.setHours(n.getHours()-o),n}},{key:"IsRecursiveOperator",value:function(e){return["and","or"].includes(e)}}],(r=null)&&f(t.prototype,r),n&&f(t,n),e}(),h={FullSyncCompleted:"sync:full-completed",SingleSyncCompleted:"sync:single-completed",DownloadFirstSyncCompleted:"sync:initial-completed",SyncTakingTooLong:"sync:taking-too-long",SyncError:"sync:error",SyncException:"sync:sync-exception",InvalidSession:"sync:invalid-session",MajorDataChange:"major-data-change",LocalDataIncrementalLoad:"local-data-incremental-load",EnterOutOfSync:"enter-out-of-sync",ExitOutOfSync:"exit-out-of-sync"};function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var d={SignedIn:2,SignedOut:3,CompletedSync:5,FailedSync:6,HighLatencySync:7,EnteredOutOfSync:8,ExitedOutOfSync:9,Started:10,Launched:11,KeyStatusChanged:12};var m=0,g=.5,b=.9,w=1,k=1.1,x=1.2,S=1.3,R=3;function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var O={Web:1,Desktop:2,Mobile:3},_={Ios:1,Android:2,MacWeb:3,MacDesktop:4,WindowsWeb:5,WindowsDesktop:6,LinuxWeb:7,LinuxDesktop:8};function j(e){return{"mac-web":_.MacWeb,"mac-desktop":_.MacDesktop,"linux-web":_.LinuxWeb,"linux-desktop":_.LinuxDesktop,"windows-web":_.WindowsWeb,"windows-desktop":_.WindowsDesktop,ios:_.Ios,android:_.Android}[e]}function I(e){return e===O.Web||e===O.Desktop}function D(e){return e===O.Mobile}var C={LocalPasscode:1,AccountPassword:2,Biometric:3},E={RootKeyParams:"ROOT_KEY_PARAMS",WrappedRootKey:"WRAPPED_ROOT_KEY",RootKeyWrapperKeyParams:"ROOT_KEY_WRAPPER_KEY_PARAMS",Session:"session",User:"user",ServerHost:"server",LegacyUuid:"uuid",LastSyncToken:"syncToken",PaginationToken:"cursorToken",StorageObject:"storage",BiometricPrefs:"biometrics_prefs",MobilePasscodeTiming:"passcode_timing",PrivilegesExpirey:"SessionExpiresAtKey",PrivilegesSessionLength:"SessionLengthKey",SessionHistoryPersistable:"sessionHistory_persist",SessionHistoryRevisions:"sessionHistory_revisions",SessionHistoryOptimize:"sessionHistory_autoOptimize"};function A(e,t){return e?"".concat(e,"-").concat(t):t}function T(e){var t=e.leftContent,r=e.rightContent,n=e.keysToIgnore,a=e.appDataKeysToIgnore;if((t=JSON.parse(JSON.stringify(t))).appData){var i=t.appData["org.standardnotes.sn"];Object(o.s)(i,a),i?0===Object.keys(i).length&&delete t.appData:delete t.appData}if(Object(o.s)(t,n),(r=JSON.parse(JSON.stringify(r))).appData){var s=r.appData["org.standardnotes.sn"];Object(o.s)(s,a),s?0===Object.keys(s).length&&delete r.appData:delete r.appData}return Object(o.s)(r,n),JSON.stringify(t)===JSON.stringify(r)}function M(e,t,r){return r||(r=[]),!T({leftContent:e.content,rightContent:t.content,keysToIgnore:e.contentKeysToIgnoreWhenCheckingEquality().concat(r),appDataKeysToIgnore:e.appDatacontentKeysToIgnoreWhenCheckingEquality()})}function K(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function F(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var L=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n,a,i;return t=e,r=null,n=[{key:"SetGenerators",value:function(e){var t=e.syncImpl,r=e.asyncImpl;this.syncUuidFunc=t,this.asyncUuidFunc=r}},{key:"canGenSync",value:function(){return!Object(o.l)(this.syncUuidFunc)}},{key:"GenerateUuid",value:(a=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.syncUuidFunc){e.next=4;break}return e.abrupt("return",this.syncUuidFunc());case 4:return e.abrupt("return",this.asyncUuidFunc());case 5:case"end":return e.stop()}}),e,this)})),i=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=a.apply(e,t);function i(e){K(o,r,n,i,s,"next",e)}function s(e){K(o,r,n,i,s,"throw",e)}i(void 0)}))},function(){return i.apply(this,arguments)})},{key:"GenerateUuidSynchronously",value:function(){return this.syncUuidFunc()}}],r&&F(t.prototype,r),n&&F(t,n),e}();function N(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function U(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function B(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var V=1,H=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.content={references:[],appData:U({},"org.standardnotes.sn",{})},this.resetLocalReferencePointers(),t){if(!t.isPayload)throw"Attempting to construct SNItem from non-payload object ".concat(t,".");this.updateFromPayload(t)}this.uuid||L.canGenSync()&&(this.uuid=L.GenerateUuidSynchronously())}var t,r,n,a,i;return t=e,(r=[{key:"payloadRepresentation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.override;return ra({object:this,override:t})}},{key:"populateDefaultContentValues",value:function(){this.errorDecrypting||this.deleted||(this.content.references||(this.content.references=[]),this.content.appData||(this.content.appData=U({},"org.standardnotes.sn",{})))}},{key:"initUUID",value:(a=regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.uuid){t.next=4;break}return t.next=3,e.GenerateUuid();case 3:this.uuid=t.sent;case 4:case"end":return t.stop()}}),t,this)})),i=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=a.apply(e,t);function i(e){N(o,r,n,i,s,"next",e)}function s(e){N(o,r,n,i,s,"throw",e)}i(void 0)}))},function(){return i.apply(this,arguments)})},{key:"updateFromPayload",value:function(e){if(e){var t=[ce.Content],r=!0,n=!1,a=void 0;try{for(var i,s=e.fields()[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var u=i.value;if(!Object(o.j)(this,u)){var c=e[u];if(t.includes(u)){var l=Object(o.a)(c||null);this[u]=l}else this[u]=c}}}catch(e){n=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}this.content?this.mapContentToLocalProperties(this.content):!0===e.deleted&&this.handleDeletedContent(),this.dirtiedDate&&"string"==typeof this.dirtiedDate&&(this.dirtiedDate=new Date(this.dirtiedDate)),this.lastSyncBegan&&"string"==typeof this.lastSyncBegan&&(this.lastSyncBegan=new Date(this.lastSyncBegan)),this.lastSyncEnd&&"string"==typeof this.lastSyncEnd&&(this.lastSyncEnd=new Date(this.lastSyncEnd)),this.created_at?this.created_at=new Date(this.created_at):this.created_at=new Date,this.updated_at?this.updated_at=new Date(this.updated_at):this.updated_at=new Date(0),this._client_updated_at=null,this.populateDefaultContentValues()}}},{key:"mapContentToLocalProperties",value:function(e){}},{key:"collapseContent",value:function(){var e=this.structureParams();return Object(o.e)(this.content,e),e}},{key:"structureParams",value:function(){return this.getContentCopy()}},{key:"handleDeletedContent",value:function(){}},{key:"setDirty",value:function(e){var t=e.dirty,r=e.updateClientDate;if(!e.authorized)throw"Do not call setDirty directly. Use modelManager.setItemDirty";this.dirty=t,this.dirtiedDate=new Date,t&&r?this.client_updated_at=new Date:this.hasRawClientUpdatedAtValue()||(this.client_updated_at=new Date(this.updated_at)),this.collapseContent()}},{key:"updateLocalRelationships",value:function(){for(var e=this.content.references.map((function(e){return e.uuid})),t=0,r=Object.keys(this._referencedItems);t<r.length;t++){var n=r[t],o=this._referencedItems[n];e.includes(o.uuid)||(delete this._referencedItems[n],o.setIsNoLongerReferencedBy(this))}}},{key:"addItemAsRelationship",value:function(e){if(e.setIsBeingReferencedBy(this),this._referencedItems[e.uuid]||(this._referencedItems[e.uuid]=e),!this.hasRelationshipWithItem(e)){var t=this.content.references||[];t.push({uuid:e.uuid,content_type:e.content_type}),this.content.references=t}}},{key:"removeItemAsRelationship",value:function(e){e.setIsNoLongerReferencedBy(this),this.removeReferenceWithUuid(e.uuid),delete this._referencedItems[e.uuid]}},{key:"setIsBeingReferencedBy",value:function(e){this._referencingItems[e.uuid]||(this._referencingItems[e.uuid]=e)}},{key:"setIsNoLongerReferencedBy",value:function(e){delete this._referencingItems[e.uuid]}},{key:"removeReferenceWithUuid",value:function(e){var t=this.content.references||[];t=t.filter((function(t){return t.uuid!==e})),this.content.references=t,delete this._referencedItems[e]}},{key:"hasRelationshipWithItem",value:function(e){var t=this.content.references.find((function(t){return t.uuid===e.uuid}));return!Object(o.l)(t)}},{key:"isBeingRemovedLocally",value:function(){for(var e=0,t=Object.keys(this._referencedItems);e<t.length;e++){var r=t[e];this._referencedItems[r].setIsNoLongerReferencedBy(this)}}},{key:"resetLocalReferencePointers",value:function(){this._referencingItems={},this._referencedItems={}}},{key:"didCompleteMapping",value:function(e){}},{key:"setDomainDataItem",value:function(e,t,r){if(r){if(!this.errorDecrypting){this.content.appData||(this.content.appData={});var n=this.content.appData[r];n||(n={}),n[e]=t,this.content.appData[r]=n}}else console.error("DEFAULT_APP_DOMAIN needs to be set.")}},{key:"getDomainDataItem",value:function(e,t){if(t){if(!this.errorDecrypting){this.content.appData||(this.content.appData={});var r=this.content.appData[t];return r?r[e]:null}}else console.error("DEFAULT_APP_DOMAIN needs to be set.")}},{key:"setAppDataItem",value:function(e,t){this.setDomainDataItem(e,t,"org.standardnotes.sn")}},{key:"getAppDataItem",value:function(e){return this.getDomainDataItem(e,"org.standardnotes.sn")}},{key:"hasRawClientUpdatedAtValue",value:function(){return null!=this.getAppDataItem("client_updated_at")}},{key:"contentKeysToIgnoreWhenCheckingEquality",value:function(){return["conflict_of"]}},{key:"appDatacontentKeysToIgnoreWhenCheckingEquality",value:function(){return["client_updated_at"]}},{key:"getContentCopy",value:function(){return JSON.parse(JSON.stringify(this.content))}},{key:"strategyWhenConflictingWithItem",value:function(e){var t=e.item;return this.errorDecrypting?no.KeepLeftDuplicateRight:this.isSingleton?no.KeepLeft:this.deleted||t.deleted?no.KeepRight:M(this,t)?M(this,t,["references"])?no.KeepLeftDuplicateRight:no.KeepLeftMergeRefs:no.KeepRight}},{key:"isItemContentEqualWith",value:function(e){return T({leftContent:this.content,rightContent:e.content,keysToIgnore:this.contentKeysToIgnoreWhenCheckingEquality(),appDataKeysToIgnore:this.appDatacontentKeysToIgnoreWhenCheckingEquality()})}},{key:"satisfiesPredicate",value:function(e){return y.ItemSatisfiesPredicate(this,e)}},{key:"createdAtString",value:function(){return this.dateToLocalizedString(this.created_at)}},{key:"updatedAtString",value:function(){return this.dateToLocalizedString(this.client_updated_at)}},{key:"updatedAtTimestamp",value:function(){return this.updated_at.getTime()}},{key:"dateToLocalizedString",value:function(t){if("undefined"!=typeof Intl&&Intl.DateTimeFormat){if(!e.sharedDateFormatter){var r=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language;e.sharedDateFormatter=new Intl.DateTimeFormat(r,{year:"numeric",month:"short",day:"2-digit",weekday:"long",hour:"2-digit",minute:"2-digit"})}return e.sharedDateFormatter.format(t)}return t.toDateString()+" "+t.toLocaleTimeString()}},{key:"isItem",get:function(){return!0}},{key:"referencedItemsCount",get:function(){return Object.keys(this._referencedItems).length}},{key:"referencingItemsCount",get:function(){return Object.keys(this._referencingItems).length}},{key:"allReferencingItems",get:function(){var e=this;return Object.keys(this._referencingItems).map((function(t){return e._referencingItems[t]}))}},{key:"pinned",get:function(){return this.getAppDataItem("pinned")}},{key:"archived",get:function(){return this.getAppDataItem("archived")}},{key:"locked",get:function(){return this.getAppDataItem("locked")}},{key:"client_updated_at",get:function(){if(!this._client_updated_at){var e=this.getAppDataItem("client_updated_at");this._client_updated_at=e?new Date(e):new Date(this.updated_at)}return this._client_updated_at},set:function(e){this._client_updated_at=e,this.setAppDataItem("client_updated_at",e)}},{key:"neverSynced",get:function(){return!this.updated_at||0===this.updated_at.getTime()}},{key:"isSingleton",get:function(){return!1}},{key:"singletonPredicate",get:function(){throw"Must override SNItem.singletonPredicate"}},{key:"singletonStrategy",get:function(){return V}}])&&B(t.prototype,r),n&&B(t,n),e}(),W={V000Base64Decrypted:"000",V001:"001",V002:"002",V003:"003",V004:"004",VersionLength:3};function z(e,t){return Number(e)-Number(t)}var q={Sync:0,SyncDecrypted:1,LocalStorageEncrypted:2,LocalStorageDecrypted:3,LocalStoragePreferEncrypted:4,FileEncrypted:5,FileDecrypted:6,FilePreferEncrypted:7};function Y(e){return e===q.LocalStorageEncrypted||e===q.LocalStorageDecrypted||e===q.LocalStoragePreferEncrypted}function J(e){return e===q.FileEncrypted||e===q.FileDecrypted||e===q.FilePreferEncrypted}function G(e){return e===q.SyncDecrypted||e===q.LocalStorageDecrypted||e===q.FileDecrypted}function Q(e){return e===q.Sync||e===q.LocalStorageEncrypted||e===q.FileEncrypted}function $(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function X(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Z(e,t,r){return t&&X(e.prototype,t),r&&X(e,r),e}var ee=function(){var e,t;function r(e){var t=e.uuid,n=e.content;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.uuid=t,this.content=Object(o.a)(n),this.content.version||(this.content.dataAuthenticationKey?this.content.version=W.V002:this.content.version=W.V001),!this.content.version)throw"Attempting to create key without version.";Object.freeze(this)}return Z(r,null,[{key:"Create",value:(e=regeneratorRuntime.mark((function e(t){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.uuid,o=t.content,n){e.next=5;break}return e.next=4,L.GenerateUuid();case 4:n=e.sent;case 5:return e.abrupt("return",new r({uuid:n,content:o}));case 6:case"end":return e.stop()}}),e)})),t=function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){$(a,n,o,i,s,"next",e)}function s(e){$(a,n,o,i,s,"throw",e)}i(void 0)}))},function(e){return t.apply(this,arguments)})}]),Z(r,[{key:"compare",value:function(e){if(this.version!==e.version)return!1;var t=this.serverPassword&&e.serverPassword;return this.masterKey===e.masterKey&&(!t||this.serverPassword===e.serverPassword)}},{key:"getPersistableValue",value:function(){var e={version:this.version};return this.masterKey&&(e.masterKey=this.masterKey),this.dataAuthenticationKey&&(e.dataAuthenticationKey=this.dataAuthenticationKey),e}},{key:"version",get:function(){return this.content.version}},{key:"isRootKey",get:function(){return!0}},{key:"itemsKey",get:function(){return this.masterKey}},{key:"masterKey",get:function(){return this.content.masterKey}},{key:"serverPassword",get:function(){return this.content.serverPassword}},{key:"dataAuthenticationKey",get:function(){return this.content.dataAuthenticationKey}}],[{key:"contentType",value:function(){return i.RootKey}}]),r}();function te(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function re(e){return new ne(e)}var ne=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!Object(o.m)(t)||t.isKeyParamsObject)throw"Attempting to construct root key params with non-object";this.content=t}var t,r,n;return t=e,(r=[{key:"getPortableValue",value:function(){return z(this.version,W.V003)>=0?Object(o.r)(this.content,["pw_cost"]):this.content}},{key:"isKeyParamsObject",get:function(){return!0}},{key:"kdfIterations",get:function(){return this.content.pw_cost}},{key:"seed",get:function(){return this.content.pw_nonce}},{key:"identifier",get:function(){return this.content.identifier||this.content.email}},{key:"salt",get:function(){return this.content.pw_salt}},{key:"version",get:function(){return this.content.version}}])&&te(t.prototype,r),n&&te(t,n),e}(),oe={EncryptedString:0,DecryptedBareObject:1,DecryptedBase64String:2},ae=r(5);function ie(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function se(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){ie(a,n,o,i,s,"next",e)}function s(e){ie(a,n,o,i,s,"throw",e)}i(void 0)}))}}function ue(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ce={Uuid:"uuid",ContentType:"content_type",ItemsKeyId:"items_key_id",EncItemKey:"enc_item_key",Content:"content",CreatedAt:"created_at",UpdatedAt:"updated_at",Deleted:"deleted",Legacy003AuthHash:"auth_hash",Legacy003AuthParams:"auth_params",Dirty:"dirty",DirtiedDate:"dirtiedDate",WaitingForKey:"waitingForKey",ErrorDecrypting:"errorDecrypting",ErrorDecryptingChanged:"errorDecryptingValueChanged",Dummy:"dummy",LastSyncBegan:"lastSyncBegan",LastSyncEnd:"lastSyncEnd"};function le(e){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fe(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function ye(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){fe(a,n,o,i,s,"next",e)}function s(e){fe(a,n,o,i,s,"throw",e)}i(void 0)}))}}function he(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ve(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function de(e,t){return!t||"object"!==le(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function me(e,t,r){return(me="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ge(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function be(e,t){return(be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var we="00000000000000000000000000000000",ke=function(e){function t(){return he(this,t),de(this,ge(t).apply(this,arguments))}var r,n,o,a,i,s,u,c,l,p,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&be(e,t)}(t,e),r=t,n=[{key:"generateNewItemsKeyContent",value:(f=ye(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.crypto.generateRandomKey(256);case 3:return t=e.sent,r=this.constructor.versionString(),e.abrupt("return",{itemsKey:t,version:r});case 6:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"createRootKey",value:(p=ye(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.identifier,n=t.password,o=this.constructor.pwCost(),e.next=4,this.crypto.generateRandomKey(128);case 4:return a=e.sent,e.next=7,this.crypto.unsafeSha1(r+"SN"+a);case 7:return i=e.sent,e.next=10,this.deriveKey({password:n,pwSalt:i,pwCost:o});case 10:return s=e.sent,u=re({email:r,pw_cost:o,pw_nonce:a,pw_salt:i,version:W.V001}),e.abrupt("return",{key:s,keyParams:u});case 13:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"computeRootKey",value:(l=ye(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.password,(n=t.keyParams).isKeyParamsObject){e.next=3;break}throw"Attempting to compute root key with non params object.";case 3:return e.next=5,this.deriveKey({password:r,pwSalt:n.salt,pwCost:n.kdfIterations});case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"decryptString",value:(c=ye(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.crypto.aes256CbcDecrypt(t,we,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"encryptString",value:(u=ye(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.crypto.aes256CbcEncrypt(t,we,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"generateEncryptionParameters",value:(s=ye(regeneratorRuntime.mark((function e(r){var n,o,a,i,s,u,c,l,p,f,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.payload,a=r.key,(i=r.format)!==oe.DecryptedBareObject&&i!==oe.DecryptedBase64String){e.next=3;break}return e.abrupt("return",me(ge(t.prototype),"generateEncryptionParameters",this).call(this,{payload:o,key:a,format:i}));case 3:if(i===oe.EncryptedString){e.next=5;break}throw"Unsupport format for generateEncryptionParameters ".concat(i);case 5:if(a&&a.itemsKey){e.next=7;break}throw"Attempting to generateEncryptionParameters with no itemsKey.";case 7:return e.next=9,this.crypto.generateRandomKey(512);case 9:return s=e.sent,e.next=12,this.encryptString(s,a.itemsKey);case 12:return u=e.sent,e.next=15,this.firstHalfOfKey(s);case 15:return c=e.sent,e.next=18,this.secondHalfOfKey(s);case 18:return l=e.sent,e.next=21,this.encryptString(JSON.stringify(o.content),c);case 21:return p=e.sent,f=a.version+p,e.next=25,this.crypto.hmac256(f,l);case 25:return y=e.sent,e.abrupt("return",sa((pe(n={},ce.ItemsKeyId,a.isItemsKey?a.uuid:null),pe(n,ce.Content,f),pe(n,ce.EncItemKey,u),pe(n,ce.Legacy003AuthHash,y),n)));case 27:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"generateDecryptedParameters",value:(i=ye(regeneratorRuntime.mark((function e(r){var n,o,a,i,s,u,c,l,p,f,y,h,v,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.encryptedParameters,o=r.key,(a=n.getContentFormat())!==oe.DecryptedBareObject&&a!==oe.DecryptedBase64String){e.next=4;break}return e.abrupt("return",me(ge(t.prototype),"generateDecryptedParameters",this).call(this,{encryptedParameters:n,key:o}));case 4:if(n.enc_item_key){e.next=7;break}return console.error("Missing item encryption key, skipping decryption."),e.abrupt("return",n);case 7:if(i=n.enc_item_key,i=W.V001+i,!(s=this.encryptionComponentsFromString(i,o.itemsKey)).uuid||s.uuid===n.uuid){e.next=13;break}return console.error("Item key params UUID does not match item UUID"),e.abrupt("return",ua({encryptionParameters:n,override:(u={},pe(u,ce.ErrorDecrypting,!0),pe(u,ce.ErrorDecryptingChanged,!n.errorDecrypting),u)}));case 13:return e.next=15,this.decryptString(s.contentCiphertext,s.encryptionKey);case 15:if(c=e.sent){e.next=19;break}return console.error("Error decrypting parameters",n),e.abrupt("return",ua({encryptionParameters:n,override:(l={},pe(l,ce.ErrorDecrypting,!0),pe(l,ce.ErrorDecryptingChanged,!n.errorDecrypting),l)}));case 19:return e.next=21,this.firstHalfOfKey(c);case 21:if(p=e.sent,!(f=this.encryptionComponentsFromString(n.content,p)).uuid||f.uuid===n.uuid){e.next=25;break}return e.abrupt("return",ua({encryptionParameters:n,override:(y={},pe(y,ce.ErrorDecrypting,!0),pe(y,ce.ErrorDecryptingChanged,!n.errorDecrypting),y)}));case 25:return e.next=27,this.decryptString(f.contentCiphertext,f.encryptionKey);case 27:if(h=e.sent){e.next=32;break}return e.abrupt("return",ua({encryptionParameters:n,override:(v={},pe(v,ce.ErrorDecrypting,!0),pe(v,ce.ErrorDecryptingChanged,!n.errorDecrypting),v)}));case 32:return e.abrupt("return",ua({encryptionParameters:n,override:(d={},pe(d,ce.Content,JSON.parse(h)),pe(d,ce.ErrorDecrypting,!1),pe(d,ce.ErrorDecryptingChanged,!0===n.errorDecrypting),pe(d,ce.WaitingForKey,!1),d)}));case 33:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"encryptionComponentsFromString",value:function(e,t){var r=e.substring(0,W.VersionLength);return{contentCiphertext:e.substring(W.VersionLength,e.length),encryptionVersion:r,encryptionKey:t}}},{key:"deriveKey",value:(a=ye(regeneratorRuntime.mark((function e(){var t,r,n,o,a,i,s,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},r=t.password,n=t.pwSalt,o=t.pwCost,e.next=3,this.crypto.pbkdf2(r,n,o,512);case 3:return a=e.sent,e.next=6,this.splitKey({key:a,numParts:2});case 6:return i=e.sent,e.next=9,ee.Create({content:{serverPassword:i[0],masterKey:i[1],version:this.constructor.versionString()}});case 9:return s=e.sent,e.abrupt("return",s);case 11:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})}],o=[{key:"pwCost",value:function(){return 3e3}},{key:"versionString",value:function(){return W.V001}}],n&&ve(r.prototype,n),o&&ve(r,o),t}(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.crypto=t}var t,r,n,o,a,i,s,u,c,l;return t=e,(r=[{key:"firstHalfOfKey",value:(l=se(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.substring(0,t.length/2));case 1:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"secondHalfOfKey",value:(c=se(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.substring(t.length/2,t.length));case 1:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"splitKey",value:(u=se(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=t.key,n=t.numParts,o=r.length,a=o/n,i=[],s=0;s<n;s++)u=r.slice(a*s,a*(s+1)),i.push(u);return e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})},{key:"generateNewItemsKeyContent",value:(s=se(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override generateNewItemsKeyContent";case 1:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)})},{key:"createItemsKey",value:(i=se(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.generateNewItemsKeyContent();case 2:return t=e.sent,r=ra({object:{content:t}}),n=new it(r),e.next=7,n.initUUID();case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"generateEncryptionParameters",value:(a=se(regeneratorRuntime.mark((function e(t){var r,n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.payload,t.key,(n=t.format)!==oe.DecryptedBareObject){e.next=5;break}return e.abrupt("return",sa({content:r.content}));case 5:if(n!==oe.DecryptedBase64String){e.next=14;break}return o=JSON.stringify(r.content),e.next=9,Object(ae.base64Encode)(o);case 9:return a=e.sent,i=W.V000Base64Decrypted+a,e.abrupt("return",sa({content:i}));case 14:throw"Must override generateEncryptionParameters to handle format ".concat(n,".");case 15:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"generateDecryptedParameters",value:(o=se(regeneratorRuntime.mark((function e(t){var r,n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.encryptedParameters,t.key,r.isEncryptionParameters){e.next=3;break}throw"Atempting to generate decrypted parameters from non-parameters object.";case 3:if((n=r.getContentFormat())!==oe.DecryptedBareObject){e.next=8;break}return e.abrupt("return",sa(r));case 8:if(n!==oe.DecryptedBase64String){e.next=23;break}return o=r.content.substring(W.VersionLength,r.content.length),e.prev=10,e.next=13,Object(ae.base64Decode)(o);case 13:i=e.sent,a=JSON.parse(i),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(10),a=r.content;case 20:return e.abrupt("return",ua({encryptionParameters:r,override:{content:a}}));case 23:throw"Must override generateDecryptedParameters to handle format ".concat(n,".");case 24:case"end":return e.stop()}}),e,null,[[10,17]])}))),function(e){return o.apply(this,arguments)})}])&&ue(t.prototype,r),n&&ue(t,n),e}());function xe(e){return(xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Se(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Re(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Pe(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Re(a,n,o,i,s,"next",e)}function s(e){Re(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function je(e,t){return!t||"object"!==xe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ie(e,t,r){return(Ie="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=De(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function De(e){return(De=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ce(e,t){return(Ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ee=function(e){function t(){return Oe(this,t),je(this,De(t).apply(this,arguments))}var r,n,o,a,i,s,u,c,l,p,f,y,h;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ce(e,t)}(t,e),r=t,n=[{key:"generateNewItemsKeyContent",value:(h=Pe(regeneratorRuntime.mark((function e(){var t,r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=256,e.next=3,this.crypto.generateRandomKey(t);case 3:return r=e.sent,e.next=6,this.crypto.generateRandomKey(t);case 6:return n=e.sent,o=this.constructor.versionString(),e.abrupt("return",{itemsKey:r,dataAuthenticationKey:n,version:o});case 9:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"createRootKey",value:(y=Pe(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.identifier,n=t.password,o=this.constructor.pwCost(),e.next=4,this.crypto.generateRandomKey(128);case 4:return a=e.sent,e.next=7,this.crypto.unsafeSha1(r+":"+a);case 7:return i=e.sent,e.next=10,this.deriveKey({password:n,pwSalt:i,pwCost:o});case 10:return s=e.sent,u=re({email:r,pw_cost:o,pw_nonce:a,pw_salt:i,version:W.V002}),e.abrupt("return",{key:s,keyParams:u});case 13:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"computeRootKey",value:(f=Pe(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.password,(n=t.keyParams).isKeyParamsObject){e.next=3;break}throw"Attempting to compute root key with non params object.";case 3:return e.next=5,this.deriveKey({password:r,pwSalt:n.salt,pwCost:n.kdfIterations});case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"decryptString",value:(p=Pe(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.crypto.aes256CbcDecrypt(t,n,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return p.apply(this,arguments)})},{key:"encryptString",value:(l=Pe(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.crypto.aes256CbcEncrypt(t,n,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return l.apply(this,arguments)})},{key:"encryptTextParams",value:(c=Pe(regeneratorRuntime.mark((function e(t,r,n,o,a){var i,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.crypto.generateRandomKey(128);case 2:return i=e.sent,e.next=5,this.encryptString(t,r,i);case 5:return s=e.sent,u=[a,o,i,s].join(":"),e.next=9,this.crypto.hmac256(u,n);case 9:return c=e.sent,l=[a,c,o,i,s].join(":"),e.abrupt("return",l);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,o){return c.apply(this,arguments)})},{key:"decryptTextParams",value:(u=Pe(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ciphertextToAuth,n=t.contentCiphertext,o=t.encryptionKey,a=t.iv,i=t.authHash,s=t.authKey,o){e.next=3;break}throw"Attempting to decryptTextParams with null encryptionKey";case 3:return e.next=5,this.crypto.hmac256(r,s);case 5:if(u=e.sent,!1!==this.crypto.timingSafeEqual(i,u)){e.next=9;break}return console.error("Auth hash does not match, returning null."),e.abrupt("return",null);case 9:return e.abrupt("return",this.decryptString(n,o,a));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"generateEncryptionParameters",value:(s=Pe(regeneratorRuntime.mark((function e(r){var n,o,a,i,s,u,c,l,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.payload,a=r.key,(i=r.format)!==oe.DecryptedBareObject&&i!==oe.DecryptedBase64String){e.next=3;break}return e.abrupt("return",Ie(De(t.prototype),"generateEncryptionParameters",this).call(this,{payload:o,key:a,format:i}));case 3:if(i===oe.EncryptedString){e.next=5;break}throw"Unsupport format for generateEncryptionParameters ".concat(i);case 5:if(a&&a.itemsKey){e.next=7;break}throw"Attempting to generateEncryptionParameters with no itemsKey.";case 7:return e.next=9,this.crypto.generateRandomKey(512);case 9:return s=e.sent,e.next=12,this.encryptTextParams(s,a.itemsKey,a.dataAuthenticationKey,o.uuid,a.version);case 12:return u=e.sent,e.next=15,this.firstHalfOfKey(s);case 15:return c=e.sent,e.next=18,this.secondHalfOfKey(s);case 18:return l=e.sent,e.next=21,this.encryptTextParams(JSON.stringify(o.content),c,l,o.uuid,a.version);case 21:return p=e.sent,e.abrupt("return",sa((Se(n={},ce.ItemsKeyId,a.isItemsKey?a.uuid:null),Se(n,ce.Content,p),Se(n,ce.EncItemKey,u),n)));case 23:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"generateDecryptedParameters",value:(i=Pe(regeneratorRuntime.mark((function e(r){var n,o,a,i,s,u,c,l,p,f,y,h,v,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.encryptedParameters,o=r.key,(a=n.getContentFormat())!==oe.DecryptedBareObject&&a!==oe.DecryptedBase64String){e.next=4;break}return e.abrupt("return",Ie(De(t.prototype),"generateDecryptedParameters",this).call(this,{encryptedParameters:n,key:o}));case 4:if(n.enc_item_key){e.next=7;break}return console.error("Missing item encryption key, skipping decryption."),e.abrupt("return",n);case 7:if(o&&o.itemsKey){e.next=9;break}throw"Attempting to generateDecryptedParameters with no itemsKey.";case 9:return i=n.enc_item_key,s=this.encryptionComponentsFromString(i,o.itemsKey,o.dataAuthenticationKey),e.next=13,this.decryptTextParams(s);case 13:if(u=e.sent){e.next=17;break}return console.error("Error decrypting item_key parameters",n),e.abrupt("return",ua({encryptionParameters:n,override:(c={},Se(c,ce.ErrorDecrypting,!0),Se(c,ce.ErrorDecryptingChanged,!n.errorDecrypting),c)}));case 17:return e.next=19,this.firstHalfOfKey(u);case 19:return l=e.sent,e.next=22,this.secondHalfOfKey(u);case 22:return p=e.sent,f=this.encryptionComponentsFromString(n.content,l,p),e.next=26,this.decryptTextParams(f);case 26:if(y=e.sent){e.next=31;break}return e.abrupt("return",ua({encryptionParameters:n,override:(h={},Se(h,ce.ErrorDecrypting,!0),Se(h,ce.ErrorDecryptingChanged,!n.errorDecrypting),h)}));case 31:return e.prev=31,e.t0=JSON,e.next=35,Object(ae.base64Decode)(f.authParams);case 35:e.t1=e.sent,d=e.t0.parse.call(e.t0,e.t1),e.next=41;break;case 39:e.prev=39,e.t2=e.catch(31);case 41:return e.abrupt("return",ua({encryptionParameters:n,override:(v={},Se(v,ce.Content,JSON.parse(y)),Se(v,ce.Legacy003AuthParams,d),Se(v,ce.ErrorDecrypting,!1),Se(v,ce.ErrorDecryptingChanged,!0===n.errorDecrypting),Se(v,ce.WaitingForKey,!1),v)}));case 42:case"end":return e.stop()}}),e,this,[[31,39]])}))),function(e){return i.apply(this,arguments)})},{key:"deriveKey",value:(a=Pe(regeneratorRuntime.mark((function e(){var t,r,n,o,a,i,s,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:{},r=t.password,n=t.pwSalt,(o=t.pwCost)&&n&&r){e.next=3;break}throw"Attempting to 003.deriveKey with invalid parameters";case 3:return e.next=5,this.crypto.pbkdf2(r,n,o,768);case 5:return a=e.sent,e.next=8,this.splitKey({key:a,numParts:3});case 8:return i=e.sent,e.next=11,ee.Create({content:{serverPassword:i[0],masterKey:i[1],dataAuthenticationKey:i[2],version:this.constructor.versionString()}});case 11:return s=e.sent,e.abrupt("return",s);case 13:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"encryptionComponentsFromString",value:function(e,t,r){var n=e.split(":");return{encryptionVersion:n[0],authHash:n[1],uuid:n[2],iv:n[3],contentCiphertext:n[4],ciphertextToAuth:[n[0],n[2],n[3],n[4]].join(":"),encryptionKey:t,authKey:r}}}],o=[{key:"pwCost",value:function(){return 3e3}},{key:"versionString",value:function(){return W.V002}}],n&&_e(r.prototype,n),o&&_e(r,o),t}(ke);function Ae(e){return(Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Te(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Me(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Te(a,n,o,i,s,"next",e)}function s(e){Te(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Ke(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Le(e,t){return!t||"object"!==Ae(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ne(e){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ue(e,t){return(Ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Be=function(e){function t(){return Ke(this,t),Le(this,Ne(t).apply(this,arguments))}var r,n,o,a,i,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ue(e,t)}(t,e),r=t,n=[{key:"computeRootKey",value:(s=Me(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.password,(n=t.keyParams).isKeyParamsObject){e.next=3;break}throw"Attempting to compute root key with non params object.";case 3:return o=this.constructor.pwCost(),a=this.constructor.versionString(),e.next=7,this.generateSalt(n.identifier,a,o,n.seed);case 7:return i=e.sent,e.next=10,this.deriveKey({password:r,pwSalt:i,pwCost:o});case 10:return s=e.sent,e.abrupt("return",s);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"createRootKey",value:(i=Me(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.identifier,n=t.password,o=this.constructor.versionString(),a=this.constructor.pwCost(),e.next=5,this.crypto.generateRandomKey(256);case 5:return i=e.sent,e.next=8,this.generateSalt(r,o,a,i);case 8:return s=e.sent,e.next=11,this.deriveKey({password:n,pwSalt:s,pwCost:a});case 11:return u=e.sent,c=re({identifier:r,pw_cost:a,pw_nonce:i,version:o}),e.abrupt("return",{key:u,keyParams:c});case 14:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"generateSalt",value:(a=Me(regeneratorRuntime.mark((function e(t,r,n,o){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.crypto.sha256([t,"SF",r,n,o].join(":"));case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return a.apply(this,arguments)})}],o=[{key:"pwCost",value:function(){return 11e4}},{key:"versionString",value:function(){return W.V003}}],n&&Fe(r.prototype,n),o&&Fe(r,o),t}(Ee);function Ve(e){return(Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function He(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function We(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function ze(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){We(a,n,o,i,s,"next",e)}function s(e){We(a,n,o,i,s,"throw",e)}i(void 0)}))}}function qe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ye(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Je(e,t){return!t||"object"!==Ve(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ge(e,t,r){return(Ge="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Qe(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Qe(e){return(Qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $e(e,t){return($e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xe=function(e){function t(){return qe(this,t),Je(this,Qe(t).apply(this,arguments))}var r,n,a,i,s,u,c,l,p,f,y,h,v;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$e(e,t)}(t,e),r=t,n=[{key:"generateNewItemsKeyContent",value:(v=ze(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.crypto.generateRandomKey(256);case 2:return t=e.sent,r=this.constructor.versionString(),e.abrupt("return",{itemsKey:t,version:r});case 5:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"generateSalt",value:(h=ze(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.identifier,n=t.seed,e.next=3,this.crypto.sha256([r,n].join(":"));case 3:return a=e.sent,e.abrupt("return",Object(o.y)(a,128));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"computeRootKey",value:(y=ze(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.password,(n=t.keyParams).isKeyParamsObject){e.next=3;break}throw"Attempting to compute root key with non params object.";case 3:return e.next=5,this.generateSalt({identifier:n.identifier,seed:n.seed});case 5:return o=e.sent,e.next=8,this.deriveKey({password:r,salt:o,iterations:this.constructor.kdfIterations()});case 8:return a=e.sent,e.abrupt("return",a);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"createRootKey",value:(f=ze(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.identifier,n=t.password,o=this.constructor.versionString(),a=this.constructor.kdfIterations(),e.next=5,this.crypto.generateRandomKey(256);case 5:return i=e.sent,e.next=8,this.generateSalt({identifier:r,seed:i});case 8:return s=e.sent,e.next=11,this.deriveKey({password:n,salt:s,iterations:a});case 11:return u=e.sent,c=re({identifier:r,pw_cost:a,pw_nonce:i,version:o}),e.abrupt("return",{key:u,keyParams:c});case 14:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"encryptString",value:(p=ze(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.plaintext,n=t.rawKey,o=t.nonce,a=t.aad,o){e.next=3;break}throw"encryptString null nonce";case 3:if(n){e.next=5;break}throw"encryptString null rawKey";case 5:return e.abrupt("return",this.crypto.xchacha20Encrypt(r,o,n,JSON.stringify(a)));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"decryptString",value:(l=ze(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.ciphertext,n=t.rawKey,o=t.nonce,a=t.aad,e.abrupt("return",this.crypto.xchacha20Decrypt(r,o,n,JSON.stringify(a)));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"generateEncryptedProtocolString",value:(c=ze(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.plaintext,n=t.rawKey,o=t.itemUuid,e.next=3,this.crypto.generateRandomKey(192);case 3:return a=e.sent,i=this.constructor.versionString(),e.next=7,this.encryptString({plaintext:r,rawKey:n,nonce:a,aad:{u:o,v:i}});case 7:return s=e.sent,u=[i,a,s].join(":"),e.abrupt("return",u);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"generateEncryptionParameters",value:(u=ze(regeneratorRuntime.mark((function e(r){var n,o,a,i,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.payload,a=r.key,(i=r.format)!==oe.DecryptedBareObject&&i!==oe.DecryptedBase64String){e.next=3;break}return e.abrupt("return",Ge(Qe(t.prototype),"generateEncryptionParameters",this).call(this,{payload:o,key:a,format:i}));case 3:if(i===oe.EncryptedString){e.next=5;break}throw"Unsupport format for generateEncryptionParameters ".concat(i);case 5:if(a&&a.itemsKey){e.next=7;break}throw"Attempting to generateEncryptionParameters with no itemsKey.";case 7:return e.next=9,this.crypto.generateRandomKey(256);case 9:return s=e.sent,u=JSON.stringify(o.content),e.next=13,this.generateEncryptedProtocolString({plaintext:u,rawKey:s});case 13:return c=e.sent,e.next=16,this.generateEncryptedProtocolString({plaintext:s,rawKey:a.itemsKey});case 16:return l=e.sent,e.abrupt("return",sa((He(n={},ce.ItemsKeyId,a.isItemsKey?a.uuid:null),He(n,ce.Content,c),He(n,ce.EncItemKey,l),n)));case 18:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"generateDecryptedParameters",value:(s=ze(regeneratorRuntime.mark((function e(r){var n,o,a,i,s,u,c,l,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.encryptedParameters,o=r.key,(a=n.getContentFormat())!==oe.DecryptedBareObject&&a!==oe.DecryptedBase64String){e.next=4;break}return e.abrupt("return",Ge(Qe(t.prototype),"generateDecryptedParameters",this).call(this,{encryptedParameters:n,key:o}));case 4:if(o&&o.itemsKey){e.next=6;break}throw"Attempting to generateDecryptedParameters with no itemsKey.";case 6:return i=this.deconstructEncryptedPayloadString(n.enc_item_key),e.next=9,this.decryptString({ciphertext:i.ciphertext,rawKey:o.itemsKey,nonce:i.nonce,aad:{u:i.uuid,v:i.version}});case 9:if(s=e.sent){e.next=13;break}return console.error("Error decrypting itemKey parameters",n),e.abrupt("return",ua({encryptionParameters:n,override:(u={},He(u,ce.ErrorDecrypting,!0),He(u,ce.ErrorDecryptingChanged,!n.errorDecrypting),u)}));case 13:return c=this.deconstructEncryptedPayloadString(n.content),e.next=16,this.decryptString({ciphertext:c.ciphertext,rawKey:s,nonce:c.nonce,aad:{u:c.uuid,v:c.version}});case 16:if(l=e.sent){e.next=21;break}return e.abrupt("return",ua({encryptionParameters:n,override:(p={},He(p,ce.ErrorDecrypting,!0),He(p,ce.ErrorDecryptingChanged,!n.errorDecrypting),p)}));case 21:return e.abrupt("return",ua({encryptionParameters:n,override:(f={},He(f,ce.Content,JSON.parse(l)),He(f,ce.ErrorDecrypting,!1),He(f,ce.ErrorDecryptingChanged,!0===n.errorDecrypting),He(f,ce.WaitingForKey,!1),f)}));case 22:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"deconstructEncryptedPayloadString",value:function(e){var t=e.split(":");return{version:t[0],nonce:t[1],ciphertext:t[2]}}},{key:"deriveKey",value:(i=ze(regeneratorRuntime.mark((function e(){var t,r,n,o,a,i,s,u,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]?c[0]:{},r=t.password,n=t.salt,(o=t.iterations)&&n&&r){e.next=3;break}throw"Attempting to 004.deriveKey with invalid parameters";case 3:return e.next=5,this.crypto.argon2(r,n,o,67108864,64);case 5:return a=e.sent,e.next=8,this.splitKey({key:a,numParts:2});case 8:return i=e.sent,s=i[0],u=i[1],e.abrupt("return",ee.Create({content:{masterKey:s,serverPassword:u,version:this.constructor.versionString()}}));case 12:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})}],a=[{key:"versionString",value:function(){return W.V004}},{key:"kdfIterations",value:function(){return 5}}],n&&Ye(r.prototype,n),a&&Ye(r,a),t}(Be);function Ze(e){return(Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function et(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function rt(e,t){return!t||"object"!==Ze(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function nt(e,t,r){return(nt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ot(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function ot(e){return(ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function at(e,t){return(at=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var it=function(e){function t(){return et(this,t),rt(this,ot(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&at(e,t)}(t,e),r=t,o=[{key:"FromRaw",value:function(e){return new t(ra({object:{content:e}}))}}],(n=[{key:"strategyWhenConflictingWithItem",value:function(e){var r=e.item;return this.errorDecrypting?nt(ot(t.prototype),"strategyWhenConflictingWithItem",this).call(this,{item:r}):no.KeepLeft}},{key:"content_type",get:function(){return i.ItemsKey}},{key:"version",get:function(){return this.content.version}},{key:"isItemsKey",get:function(){return!0}},{key:"isDefault",get:function(){return this.content.isDefault}},{key:"itemsKey",get:function(){return this.content.itemsKey}},{key:"dataAuthenticationKey",get:function(){if(this.version===W.V004)throw"Attempting to access legacy data authentication key.";return this.content.dataAuthenticationKey}}])&&tt(r.prototype,n),o&&tt(r,o),t}(H);function st(e){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ut(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ct(e,t){return!t||"object"!==st(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function lt(e,t,r){return(lt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=pt(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function pt(e){return(pt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ft(e,t){return(ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var yt="editor-editor",ht="themes",vt="editor-stack",dt="note-tags",mt="rooms",gt="modal",bt=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=ct(this,pt(t).call(this,e))).componentData||(r.componentData={}),r.disassociatedItemIds||(r.disassociatedItemIds=[]),r.associatedItemIds||(r.associatedItemIds=[]),r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ft(e,t)}(t,e),r=t,o=[{key:"associativeAreas",value:function(){return[yt]}}],(n=[{key:"mapContentToLocalProperties",value:function(e){lt(pt(t.prototype),"mapContentToLocalProperties",this).call(this,e),e.hosted_url||(this.legacy_url=e.url),this.local_url=e.local_url,this.hosted_url=e.hosted_url||e.url,this.offlineOnly=e.offlineOnly,this.name=e.name,this.autoupdateDisabled=e.autoupdateDisabled,this.package_info=e.package_info,this.area=e.area,this.active=e.active,this.permissions=e.permissions,this.permissions||(this.permissions=[]),e.valid_until&&(this.valid_until=new Date(e.valid_until)),this.componentData=e.componentData||{},this.disassociatedItemIds=e.disassociatedItemIds||[],this.associatedItemIds=e.associatedItemIds||[]}},{key:"handleDeletedContent",value:function(){lt(pt(t.prototype),"handleDeletedContent",this).call(this),this.active=!1}},{key:"structureParams",value:function(){var e={legacy_url:this.legacy_url,hosted_url:this.hosted_url,local_url:this.local_url,valid_until:this.valid_until,offlineOnly:this.offlineOnly,name:this.name,area:this.area,package_info:this.package_info,permissions:this.permissions,active:this.active,autoupdateDisabled:this.autoupdateDisabled,componentData:this.componentData,disassociatedItemIds:this.disassociatedItemIds,associatedItemIds:this.associatedItemIds},r=lt(pt(t.prototype),"structureParams",this).call(this);return Object.assign(r,e),r}},{key:"strategyWhenConflictingWithItem",value:function(e){var r=e.item;return this.errorDecrypting?lt(pt(t.prototype),"strategyWhenConflictingWithItem",this).call(this,{item:r}):no.KeepLeft}},{key:"isEditor",value:function(){return this.area===yt}},{key:"isTheme",value:function(){return this.content_type===i.Theme||this.area===ht}},{key:"isDefaultEditor",value:function(){return!0===this.getAppDataItem("defaultEditor")}},{key:"setLastSize",value:function(e){this.setAppDataItem("lastSize",e)}},{key:"getLastSize",value:function(){return this.getAppDataItem("lastSize")}},{key:"acceptsThemes",value:function(){return!this.content.package_info||!0===this.content.package_info.acceptsThemes}},{key:"getClientDataKey",value:function(){return this.legacy_url?this.legacy_url:this.uuid}},{key:"hasValidHostedUrl",value:function(){return this.hosted_url||this.legacy_url}},{key:"contentKeysToIgnoreWhenCheckingEquality",value:function(){return["active","disassociatedItemIds","associatedItemIds"].concat(lt(pt(t.prototype),"contentKeysToIgnoreWhenCheckingEquality",this).call(this))}},{key:"isAssociative",value:function(){return t.associativeAreas().includes(this.area)}},{key:"associateWithItem",value:function(e){this.associatedItemIds.push(e.uuid)}},{key:"isExplicitlyEnabledForItem",value:function(e){return-1!==this.associatedItemIds.indexOf(e.uuid)}},{key:"isExplicitlyDisabledForItem",value:function(e){return-1!==this.disassociatedItemIds.indexOf(e.uuid)}},{key:"content_type",get:function(){return i.Component}}])&&ut(r.prototype,n),o&&ut(r,o),t}(H),wt=r(91),kt=r.n(wt),xt=r(4),St=r.n(xt),Rt=r(2),Pt=r.n(Rt),Ot=r(1),_t=r.n(Ot);function jt(e){return(jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function It(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Dt(e,t){return!t||"object"!==jt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ct(e,t,r){return(Ct="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Et(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Et(e){return(Et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function At(e,t){return(At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Tt=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Dt(this,Et(t).call(this,e))).notes||(r.notes=[]),r.data||(r.data={}),r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(t,e),r=t,(n=[{key:"mapContentToLocalProperties",value:function(e){Ct(Et(t.prototype),"mapContentToLocalProperties",this).call(this,e),this.url=e.url,this.name=e.name,this.data=e.data||{},this.default=e.default,this.systemEditor=e.systemEditor}},{key:"structureParams",value:function(){var e={url:this.url,name:this.name,data:this.data,default:this.default,systemEditor:this.systemEditor},r=Ct(Et(t.prototype),"structureParams",this).call(this);return Object.assign(r,e),r}},{key:"referenceParams",value:function(){return kt()(this.notes,(function(e){return{uuid:e.uuid,content_type:e.content_type}}))}},{key:"addItemAsRelationship",value:function(e){e.content_type===i.Note&&(St()(this.notes,e)||this.notes.push(e)),Ct(Et(t.prototype),"addItemAsRelationship",this).call(this,e)}},{key:"removeItemAsRelationship",value:function(e){e.content_type===i.Note&&Pt()(this.notes,e),Ct(Et(t.prototype),"removeItemAsRelationship",this).call(this,e)}},{key:"removeAndDirtyAllRelationships",value:function(){Ct(Et(t.prototype),"removeAndDirtyAllRelationships",this).call(this),this.notes=[]}},{key:"removeReferencesNotPresentIn",value:function(e){var r=this;Ct(Et(t.prototype),"removeReferencesNotPresentIn",this).call(this,e);var n=e.map((function(e){return e.uuid}));this.notes.forEach((function(e){n.includes(e.uuid)||_t()(r.notes,{uuid:e.uuid})}))}},{key:"setData",value:function(e,t){return!(JSON.stringify(this.data[e])===JSON.stringify(t)||(this.data[e]=t,0))}},{key:"dataForKey",value:function(e){return this.data[e]||{}}},{key:"content_type",get:function(){return i.Editor}}])&&It(r.prototype,n),o&&It(r,o),t}(H),Mt=r(92),Kt=r.n(Mt),Ft=r(34),Lt=r.n(Ft);var Nt=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Lt()(this,t),this.running=!1,this.error=!1,this.lastExecuted&&(this.lastExecuted=new Date(this.lastExecuted))};function Ut(e){return(Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Vt(e,t){return!t||"object"!==Ut(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ht(e,t,r){return(Ht="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Wt(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Wt(e){return(Wt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zt(e,t){return(zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qt=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=Vt(this,Wt(t).call(this,e)),e.actions&&(r.actions=e.actions.map((function(e){return new Nt(e)}))),r.actions||(r.actions=[]),r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zt(e,t)}(t,e),r=t,(n=[{key:"actionsWithContextForItem",value:function(e){return this.actions.filter((function(t){return t.context===e.content_type||"Item"===t.context}))}},{key:"mapContentToLocalProperties",value:function(e){Ht(Wt(t.prototype),"mapContentToLocalProperties",this).call(this,e),this.description=e.description,this.url=e.url,this.name=e.name,this.package_info=e.package_info,this.supported_types=e.supported_types,e.actions&&(this.actions=e.actions.map((function(e){return new Nt(e)})))}},{key:"structureParams",value:function(){var e={name:this.name,url:this.url,package_info:this.package_info,description:this.description,actions:this.actions.map((function(e){return Kt()(e,["subrows","subactions"])})),supported_types:this.supported_types},r=Ht(Wt(t.prototype),"structureParams",this).call(this);return Object.assign(r,e),r}},{key:"content_type",get:function(){return i.ActionsExtension}}])&&Bt(r.prototype,n),o&&Bt(r,o),t}(H);function Yt(e){return(Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Gt(e,t){return!t||"object"!==Yt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Qt(e,t,r){return(Qt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=$t(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function $t(e){return($t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xt(e,t){return(Xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Zt=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Gt(this,$t(t).call(this,e))).content_type||(r.content_type=i.Tag),r.notes||(r.notes=[]),r}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xt(e,t)}(t,e),r=t,a=[{key:"arrayToDisplayString",value:function(e){return e.sort((function(e,t){return e.title>t.title})).map((function(e,t){return"#"+e.title})).join(" ")}}],(n=[{key:"mapContentToLocalProperties",value:function(e){Qt($t(t.prototype),"mapContentToLocalProperties",this).call(this,e),this.title=e.title}},{key:"structureParams",value:function(){var e={title:this.title},r=Qt($t(t.prototype),"structureParams",this).call(this);return Object.assign(r,e),r}},{key:"addItemAsRelationship",value:function(e){e.content_type===i.Note&&(Object(o.g)(this.notes,"uuid",e.uuid)||this.notes.push(e)),Qt($t(t.prototype),"addItemAsRelationship",this).call(this,e)}},{key:"removeItemAsRelationship",value:function(e){e.content_type===i.Note&&_t()(this.notes,{uuid:e.uuid}),Qt($t(t.prototype),"removeItemAsRelationship",this).call(this,e)}},{key:"updateLocalRelationships",value:function(){var e=this,t=this.content.references.map((function(e){return e.uuid}));this.notes.slice().forEach((function(r){t.includes(r.uuid)||(_t()(e.notes,{uuid:r.uuid}),r.setIsNoLongerReferencedBy(e))}))}},{key:"isBeingRemovedLocally",value:function(){var e=this;this.notes.forEach((function(t){t.setIsNoLongerReferencedBy(e)})),this.notes.length=0,Qt($t(t.prototype),"isBeingRemovedLocally",this).call(this)}},{key:"didCompleteMapping",value:function(e){var t=!0,r=!1,n=void 0;try{for(var o,a=this.notes[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)o.value.tagDidCompleteMapping(this)}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}},{key:"isSmartTag",value:function(){return this.content_type===i.SmartTag}}])&&Jt(r.prototype,n),a&&Jt(r,a),t}(H);function er(e){return(er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function rr(e,t){return!t||"object"!==er(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function nr(e,t,r){return(nr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=or(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function or(e){return(or=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ar(e,t){return(ar=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ir=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=rr(this,or(t).call(this,e))).text||(r.text=""),r.tags||(r.tags=[]),r}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ar(e,t)}(t,e),r=t,a=[{key:"filterDummyNotes",value:function(e){return e.filter((function(e){return!e.dummy}))}}],(n=[{key:"mapContentToLocalProperties",value:function(e){nr(or(t.prototype),"mapContentToLocalProperties",this).call(this,e),this.title=e.title,this.text=e.text}},{key:"structureParams",value:function(){var e={title:this.title,text:this.text},r=nr(or(t.prototype),"structureParams",this).call(this);return Object.assign(r,e),r}},{key:"addItemAsRelationship",value:function(e){e.content_type===i.Tag&&e.addItemAsRelationship(this),nr(or(t.prototype),"addItemAsRelationship",this).call(this,e)}},{key:"setIsBeingReferencedBy",value:function(e){e.content_type===i.Tag&&(Object(o.g)(this.tags,"uuid",e.uuid)||this.tags.push(e)),nr(or(t.prototype),"setIsBeingReferencedBy",this).call(this,e),this.clearSavedTagsString()}},{key:"setIsNoLongerReferencedBy",value:function(e){nr(or(t.prototype),"setIsNoLongerReferencedBy",this).call(this,e),e.content_type===i.Tag&&Object(o.u)(this.tags,e),e.content_type===i.Tag&&this.hasRelationshipWithItem(e)&&this.removeReferenceWithUuid(e.uuid),this.clearSavedTagsString()}},{key:"tagDidCompleteMapping",value:function(e){this.clearSavedTagsString()}},{key:"safeText",value:function(){return this.text||""}},{key:"safeTitle",value:function(){return this.title||""}},{key:"clearSavedTagsString",value:function(){this.savedTagsString=null}},{key:"tagsString",value:function(){return this.savedTagsString=Zt.arrayToDisplayString(this.tags),this.savedTagsString}},{key:"content_type",get:function(){return i.Note}}])&&tr(r.prototype,n),a&&tr(r,a),t}(H);function sr(e){return(sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ur(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function lr(e,t){return!t||"object"!==sr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function pr(e){return(pr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fr(e,t){return(fr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var yr=function(e){function t(){return ur(this,t),lr(this,pr(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fr(e,t)}(t,e),r=t,o=[{key:"contentType",value:function(){return i.UserPrefs}}],(n=[{key:"isSingleton",get:function(){return!0}},{key:"singletonPredicate",get:function(){return new y("content_type","=",this.content_type)}}])&&cr(r.prototype,n),o&&cr(r,o),t}(H);function hr(e){return(hr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vr(e,t){return!t||"object"!==hr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function dr(e){return(dr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function gr(e,t,r){return t&&mr(e.prototype,t),r&&mr(e,r),e}function br(e,t){return(br=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var wr=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=vr(this,dr(t).call(this,e))).errorDecrypting||r.content.desktopPrivileges||(r.content.desktopPrivileges={}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&br(e,t)}(t,e),gr(t,null,[{key:"contentType",value:function(){return i.Privileges}}]),gr(t,[{key:"setCredentialsForAction",value:function(e,t){this.content.desktopPrivileges[e]=t}},{key:"getCredentialsForAction",value:function(e){return this.content.desktopPrivileges[e]||[]}},{key:"toggleCredentialForAction",value:function(e,t){this.isCredentialRequiredForAction(e,t)?this.removeCredentialForAction(e,t):this.addCredentialForAction(e,t)}},{key:"removeCredentialForAction",value:function(e,t){Pt()(this.content.desktopPrivileges[e],t)}},{key:"addCredentialForAction",value:function(e,t){var r=this.getCredentialsForAction(e);r.push(t),this.setCredentialsForAction(e,r)}},{key:"isCredentialRequiredForAction",value:function(e,t){return this.getCredentialsForAction(e).includes(t)}},{key:"isSingleton",get:function(){return!0}},{key:"singletonPredicate",get:function(){return new y("content_type","=",this.content_type)}}]),t}(H);function kr(e){return(kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Sr(e,t){return!t||"object"!==kr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Rr(e){return(Rr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pr(e,t){return(Pr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Or=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Sr(this,Rr(t).call(this,e))).content_type=i.SmartTag,r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pr(e,t)}(t,e),r=t,o=[{key:"systemSmartTags",value:function(){var e=ra({object:{uuid:"all-notes",dummy:!0,content:{title:"All notes",isSystemTag:!0,isAllTag:!0,predicate:new y.FromArray(["content_type","=",i.Note])}}}),r=ra({object:{uuid:"archived-notes",dummy:!0,content:{title:"Archived",isSystemTag:!0,isArchiveTag:!0,predicate:new y.FromArray(["archived","=",!0])}}}),n=ra({object:{uuid:"trashed-notes",dummy:!0,content:{title:"Trash",isSystemTag:!0,isTrashTag:!0,predicate:new y.FromArray(["content.trashed","=",!0])}}});return[new t(e),new t(r),new t(n)]}}],(n=null)&&xr(r.prototype,n),o&&xr(r,o),t}(Zt);function _r(e){return(_r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function jr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ir(e,t){return!t||"object"!==_r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Dr(e,t,r){return(Dr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Cr(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Cr(e){return(Cr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Er(e,t){return(Er=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ar=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Ir(this,Cr(t).call(this,e))).area="themes",r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Er(e,t)}(t,e),r=t,(n=[{key:"isLayerable",value:function(){return this.package_info&&this.package_info.layerable}},{key:"strategyWhenConflictingWithItem",value:function(e){var r=e.item;return this.errorDecrypting?Dr(Cr(t.prototype),"strategyWhenConflictingWithItem",this).call(this,{item:r}):no.KeepLeft}},{key:"setMobileRules",value:function(e){this.setAppDataItem("mobileRules",e)}},{key:"getMobileRules",value:function(){return this.getAppDataItem("mobileRules")||{constants:{},rules:{}}}},{key:"hasMobileRules",value:function(){return this.getAppDataItem("mobileRules")}},{key:"setNotAvailOnMobile",value:function(e){this.setAppDataItem("notAvailableOnMobile",e)}},{key:"getNotAvailOnMobile",value:function(){return this.getAppDataItem("notAvailableOnMobile")}},{key:"setMobileActive",value:function(e){this.setAppDataItem("mobileActive",e)}},{key:"isMobileActive",value:function(){return this.getAppDataItem("mobileActive")}},{key:"content_type",get:function(){return i.Theme}}])&&jr(r.prototype,n),o&&jr(r,o),t}(bt);function Tr(e){return(Tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Kr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Fr(e,t){return!t||"object"!==Tr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Lr(e,t,r){return(Lr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Nr(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Nr(e){return(Nr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ur(e,t){return(Ur=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Br,Vr=function(e){function t(){return Mr(this,t),Fr(this,Nr(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ur(e,t)}(t,e),r=t,(n=[{key:"mapContentToLocalProperties",value:function(e){Lr(Nr(t.prototype),"mapContentToLocalProperties",this).call(this,e),this.storage=e.storage}},{key:"content_type",get:function(){return i.EncryptedStorage}}])&&Kr(r.prototype,n),o&&Kr(r,o),t}(H);function Hr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Wr=(Hr(Br={},i.Note,ir),Hr(Br,i.Tag,Zt),Hr(Br,i.ItemsKey,it),Hr(Br,i.SmartTag,Or),Hr(Br,i.ActionsExtension,qt),Hr(Br,i.Editor,Tt),Hr(Br,i.Theme,Ar),Hr(Br,i.Component,bt),Hr(Br,i.Privileges,wr),Hr(Br,i.UserPrefs,yr),Br);function zr(e){if(!e.isPayload)throw"Attempting to create item from non-payload object.";return new(Wr[e.content_type]||H)(e)}function qr(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Yr(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){qr(a,n,o,i,s,"next",e)}function s(e){qr(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Jr(e){return Gr.apply(this,arguments)}function Gr(){return(Gr=Yr(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payload,n=t.baseCollection,a=t.isConflict,i=[],e.next=4,L.GenerateUuid();case 4:return e.t0=e.sent,s={uuid:e.t0,dirty:!0,dirtiedDate:null,lastSyncBegan:null,lastSyncEnd:null},a&&(s.content={conflict_of:r.uuid}),u=ia({payload:r,override:s}),i.push(u),c=n.payloadsThatReferencePayload(r),e.next=12,Xr({payloads:c,add:[{uuid:u.uuid,content_type:u.content_type}]});case 12:return l=e.sent,Object(o.f)(i,l),e.abrupt("return",i);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qr(e){return $r.apply(this,arguments)}function $r(){return($r=Yr(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payload,n=t.baseCollection,a=[],e.t0=ia,e.t1=r,e.next=6,L.GenerateUuid();case 6:return e.t2=e.sent,e.t3={uuid:e.t2,dirty:!0},e.t4={payload:e.t1,override:e.t3},i=(0,e.t0)(e.t4),a.push(i),s=n.payloadsThatReferencePayload(r),e.next=14,Xr({payloads:s,add:[{uuid:i.uuid,content_type:i.content_type}],removeIds:[r.uuid]});case 14:return u=e.sent,Object(o.f)(a,u),c=ia({payload:r,override:{deleted:!0,dirty:!1,content:{references:[]}}}),a.push(c),e.abrupt("return",a);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xr(e){return Zr.apply(this,arguments)}function Zr(){return(Zr=Yr(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c,l,p,f,y,h,v,d,m,g,b,w,k,x,S,R,P;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.payloads,n=t.add,o=t.removeIds,a=[],i=!0,s=!1,u=void 0,e.prev=5,c=r[Symbol.iterator]();case 7:if(i=(l=c.next()).done){e.next=55;break}if(p=l.value,f=p.content.references.slice(),!n){e.next=30;break}for(y=!0,h=!1,v=void 0,e.prev=14,d=n[Symbol.iterator]();!(y=(m=d.next()).done);y=!0)g=m.value,f.push(g);e.next=22;break;case 18:e.prev=18,e.t0=e.catch(14),h=!0,v=e.t0;case 22:e.prev=22,e.prev=23,y||null==d.return||d.return();case 25:if(e.prev=25,!h){e.next=28;break}throw v;case 28:return e.finish(25);case 29:return e.finish(22);case 30:if(!o){e.next=50;break}for(b=!0,w=!1,k=void 0,e.prev=34,x=o[Symbol.iterator]();!(b=(S=x.next()).done);b=!0)R=S.value,_t()(f,{uuid:R});e.next=42;break;case 38:e.prev=38,e.t1=e.catch(34),w=!0,k=e.t1;case 42:e.prev=42,e.prev=43,b||null==x.return||x.return();case 45:if(e.prev=45,!w){e.next=48;break}throw k;case 48:return e.finish(45);case 49:return e.finish(42);case 50:P=ia({payload:p,override:{dirty:!0,content:{references:f}}}),a.push(P);case 52:i=!0,e.next=7;break;case 55:e.next=61;break;case 57:e.prev=57,e.t2=e.catch(5),s=!0,u=e.t2;case 61:e.prev=61,e.prev=62,i||null==c.return||c.return();case 64:if(e.prev=64,!s){e.next=67;break}throw u;case 67:return e.finish(64);case 68:return e.finish(61);case 69:return e.abrupt("return",a);case 70:case"end":return e.stop()}}),e,null,[[5,57,61,69],[14,18,22,30],[23,,25,29],[34,38,42,50],[43,,45,49],[62,,64,68]])})))).apply(this,arguments)}var en={RemoteRetrieved:1,RemoteSaved:2,LocalSaved:3,LocalRetrieved:4,LocalDirtied:5,ComponentRetrieved:6,DesktopInstalled:7,RemoteActionRetrieved:8,FileImport:9,RemoteConflict:10,ImportConflict:11,SaveOrSaving:12,DecryptedTransient:13,ConflictUuid:14,ConflictData:15};function tn(e){return[en.RemoteRetrieved,en.ComponentRetrieved,en.RemoteActionRetrieved].includes(e)}function rn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var nn=function(){function e(t,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.isItem)throw"Cannot create payload from item directly";if(!r)throw"Do not construct payloads directly. Use generator functions";var n=!0,a=!1,i=void 0;try{for(var s,u=this.constructor.fields()[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var c=s.value,l=t[c];Object(o.l)(l)||(this[c]=l)}}catch(e){a=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw i}}}var t,r,n;return t=e,n=[{key:"fields",value:function(){throw"Must override PurePayload.fields"}}],(r=[{key:"mergedWith",value:function(e){return ia({payload:this,override:e})}},{key:"fields",value:function(){return this.constructor.fields()}},{key:"getFormat",value:function(){if(Object(o.n)(this.content))return this.content.startsWith(W.V000Base64Decrypted)?oe.DecryptedBase64String:oe.EncryptedString;if(Object(o.m)(this.content))return oe.DecryptedBareObject;throw"Unhandle content format for payload.getFormat()"}},{key:"version",get:function(){return Object(o.n)(this.content)?this.content.substring(0,W.VersionLength):this.content.version}},{key:"isPayload",get:function(){return!0}}])&&rn(t.prototype,r),n&&rn(t,n),e}();function on(e){return(on="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function an(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function un(e,t){return!t||"object"!==on(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function cn(e){return(cn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ln(e,t){return(ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pn=function(e){function t(){return an(this,t),un(this,cn(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ln(e,t)}(t,e),r=t,o=[{key:"fields",value:function(){throw"Must override SNPureItemPayload.fields"}}],(n=[{key:"compareContentFields",value:function(e){var t=new H(this),r=new H(e);return t.isItemContentEqualWith(r)}},{key:"version",get:function(){return this.content.substring(0,W.VersionLength)}},{key:"discardable",get:function(){return this.deleted&&!this.dirty}}])&&sn(r.prototype,n),o&&sn(r,o),t}(nn);function fn(e){return(fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function hn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vn(e,t){return!t||"object"!==fn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function dn(e){return(dn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mn(e,t){return(mn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var gn=function(e){function t(){return yn(this,t),vn(this,dn(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mn(e,t)}(t,e),r=t,o=[{key:"fields",value:function(){return[ce.Uuid,ce.ContentType,ce.ItemsKeyId,ce.EncItemKey,ce.Content,ce.CreatedAt,ce.UpdatedAt,ce.Deleted,ce.Legacy003AuthHash,ce.Legacy003AuthParams,ce.Dirty,ce.DirtiedDate,ce.ErrorDecrypting,ce.WaitingForKey]}}],(n=null)&&hn(r.prototype,n),o&&hn(r,o),t}(pn);function bn(e){return(bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function xn(e,t){return!t||"object"!==bn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Sn(e){return(Sn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Rn(e,t){return(Rn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pn=function(e){function t(){return wn(this,t),xn(this,Sn(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rn(e,t)}(t,e),r=t,o=[{key:"fields",value:function(){return[ce.Uuid,ce.ContentType,ce.ItemsKeyId,ce.EncItemKey,ce.Content,ce.CreatedAt,ce.UpdatedAt,ce.Deleted,ce.Legacy003AuthHash]}}],(n=null)&&kn(r.prototype,n),o&&kn(r,o),t}(pn);function On(e){return(On="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function In(e,t){return!t||"object"!==On(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Dn(e){return(Dn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Cn(e,t){return(Cn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var En=function(e){function t(){return _n(this,t),In(this,Dn(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Cn(e,t)}(t,e),r=t,o=[{key:"fields",value:function(){return[ce.Uuid,ce.ContentType,ce.ItemsKeyId,ce.EncItemKey,ce.Content,ce.CreatedAt,ce.UpdatedAt,ce.Legacy003AuthHash]}}],(n=null)&&jn(r.prototype,n),o&&jn(r,o),t}(pn);function An(e){return(An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Tn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Mn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Kn(e,t){return!t||"object"!==An(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Fn(e){return(Fn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ln(e,t){return(Ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Nn=function(e){function t(){return Tn(this,t),Kn(this,Fn(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ln(e,t)}(t,e),r=t,o=[{key:"fields",value:function(){return[ce.Uuid,ce.ContentType,ce.ItemsKeyId,ce.EncItemKey,ce.Content,ce.CreatedAt,ce.UpdatedAt,ce.Deleted,ce.Legacy003AuthHash,ce.Legacy003AuthParams,ce.Dirty,ce.DirtiedDate,ce.ErrorDecrypting,ce.ErrorDecryptingChanged,ce.WaitingForKey,ce.Dummy,ce.LastSyncBegan,ce.LastSyncEnd]}}],(n=null)&&Mn(r.prototype,n),o&&Mn(r,o),t}(pn);function Un(e){return(Un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Vn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Hn(e,t){return!t||"object"!==Un(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Wn(e){return(Wn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zn(e,t){return(zn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qn=function(e){function t(){return Bn(this,t),Hn(this,Wn(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zn(e,t)}(t,e),r=t,o=[{key:"fields",value:function(){return[ce.Uuid,ce.ContentType,ce.UpdatedAt,ce.Deleted,ce.Dirty,ce.LastSyncEnd]}}],(n=null)&&Vn(r.prototype,n),o&&Vn(r,o),t}(pn);function Yn(e){return(Yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Gn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Qn(e,t){return!t||"object"!==Yn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $n(e){return($n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xn(e,t){return(Xn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Zn=function(e){function t(){return Jn(this,t),Qn(this,$n(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xn(e,t)}(t,e),r=t,o=[{key:"fields",value:function(){return[ce.ItemsKeyId,ce.EncItemKey,ce.Content,ce.Legacy003AuthHash,ce.ErrorDecrypting,ce.ErrorDecryptingChanged,ce.WaitingForKey]}}],(n=[{key:"getContentFormat",value:function(){return"string"==typeof this.content?this.content.startsWith(W.V000Base64Decrypted)?oe.DecryptedBase64String:oe.EncryptedString:oe.DecryptedBareObject}},{key:"isEncryptionParameters",get:function(){return!0}}])&&Gn(r.prototype,n),o&&Gn(r,o),t}(nn);function eo(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function to(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ro=function(){function e(t){var r=t.baseCollection,n=t.applyCollection,o=t.relatedCollectionSet;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.baseCollection=r,this.applyCollection=n,this.relatedCollectionSet=o}var t,r,n,o,a;return t=e,(r=[{key:"resultingCollection",value:(o=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override PayloadDelta.resultingCollection.";case 1:case"end":return e.stop()}}),e)})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=o.apply(e,t);function i(e){eo(a,r,n,i,s,"next",e)}function s(e){eo(a,r,n,i,s,"throw",e)}i(void 0)}))},function(){return a.apply(this,arguments)})},{key:"findBasePayload",value:function(e){var t=e.id;return this.baseCollection.findPayload(t)}},{key:"findRelatedPayload",value:function(e){var t=e.id,r=e.source;return this.relatedCollectionSet.collectionForSource(r).findPayload(t)}}])&&to(t.prototype,r),n&&to(t,n),e}(),no={KeepLeft:1,KeepRight:2,KeepLeftDuplicateRight:3,DuplicateLeftKeepRight:4,KeepLeftMergeRefs:5};function oo(e){return(oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ao(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function io(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){ao(a,n,o,i,s,"next",e)}function s(e){ao(a,n,o,i,s,"throw",e)}i(void 0)}))}}function so(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function uo(e,t){return!t||"object"!==oo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function co(e){return(co=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function lo(e,t){return(lo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var po=function(e){function t(e){var r,n=e.baseCollection,o=e.basePayload,a=e.applyPayload,i=e.source;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=uo(this,co(t).call(this,{baseCollection:n}))).basePayload=o,r.applyPayload=a,r.source=i,r}var r,n,a,i,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lo(e,t)}(t,e),r=t,(n=[{key:"resultingCollection",value:(s=io(regeneratorRuntime.mark((function e(){var t,r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=zr(this.basePayload),r=zr(this.applyPayload),n=t.strategyWhenConflictingWithItem({item:r}),e.next=5,this.payloadsByHandlingStrategy({strategy:n});case 5:return o=e.sent,e.abrupt("return",new c({payloads:o,source:this.source}));case 7:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"payloadsByHandlingStrategy",value:(i=io(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,u,c,l,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.strategy)!==no.KeepLeft){e.next=3;break}return e.abrupt("return",[this.basePayload]);case 3:if(r!==no.KeepRight){e.next=5;break}return e.abrupt("return",[this.applyPayload]);case 5:if(r!==no.KeepLeftDuplicateRight){e.next=12;break}return n=Object(o.i)(this.basePayload.updated_at,this.applyPayload.updated_at),a=ia({payload:this.basePayload,override:{updated_at:n,dirty:!0}}),e.next=10,Jr({payload:this.applyPayload,baseCollection:this.baseCollection,isConflict:!0});case 10:return i=e.sent,e.abrupt("return",[a].concat(i));case 12:if(r!==no.DuplicateLeftKeepRight){e.next=18;break}return e.next=15,Jr({payload:this.basePayload,baseCollection:this.baseCollection,isConflict:!0});case 15:return s=e.sent,u=this.applyPayload,e.abrupt("return",s.concat([u]));case 18:if(r!==no.KeepLeftMergeRefs){e.next=23;break}return c=Object(o.z)(this.basePayload.content.references,this.applyPayload.content.references,["uuid","content_type"]),l=Object(o.i)(this.basePayload.updated_at,this.applyPayload.updated_at),p=ia({payload:this.basePayload,override:{updated_at:l,dirty:!0,content:{references:c}}}),e.abrupt("return",[p]);case 23:throw"Unhandled strategy";case 24:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})}])&&so(r.prototype,n),a&&so(r,a),t}(ro);function fo(e){return(fo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yo(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function ho(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){yo(a,n,o,i,s,"next",e)}function s(e){yo(a,n,o,i,s,"throw",e)}i(void 0)}))}}function vo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function mo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function go(e,t){return!t||"object"!==fo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function bo(e){return(bo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wo(e,t){return(wo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ko=function(e){function t(){return vo(this,t),go(this,bo(t).apply(this,arguments))}var r,n,a,i,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wo(e,t)}(t,e),r=t,(n=[{key:"resultingCollection",value:(s=ho(regeneratorRuntime.mark((function e(){var t,r,n,a,i,s,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=!0,n=!1,a=void 0,e.prev=4,i=this.applyCollection.allPayloads[Symbol.iterator]();case 6:if(r=(s=i.next()).done){e.next=15;break}return u=s.value,e.next=10,this.payloadsByHandlingPayload({payload:u,currentResults:t});case 10:l=e.sent,Object(o.f)(t,l);case 12:r=!0,e.next=6;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),n=!0,a=e.t0;case 21:e.prev=21,e.prev=22,r||null==i.return||i.return();case 24:if(e.prev=24,!n){e.next=27;break}throw a;case 27:return e.finish(24);case 28:return e.finish(21);case 29:return e.abrupt("return",new c({payloads:t,source:en.FileImport}));case 30:case"end":return e.stop()}}),e,this,[[4,17,21,29],[22,,24,28]])}))),function(){return s.apply(this,arguments)})},{key:"payloadsByHandlingPayload",value:(i=ho(regeneratorRuntime.mark((function e(t){var r,n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.payload,n=t.currentResults,(o=n.find((function(e){return e.content.conflict_of===r.uuid})))||(o=n.find((function(e){return e.uuid===r.uuid}))),o||(o=this.findBasePayload({id:r.uuid})),o){e.next=6;break}return e.abrupt("return",[r]);case 6:return a=new po({baseCollection:this.baseCollection,basePayload:o,applyPayload:r}),e.next=9,a.resultingCollection();case 9:return i=e.sent,e.abrupt("return",i.allPayloads);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})}])&&mo(r.prototype,n),a&&mo(r,a),t}(ro);function xo(e){return(xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function So(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Ro(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Po(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Oo(e,t){return!t||"object"!==xo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _o(e){return(_o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function jo(e,t){return(jo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Io=function(e){function t(){return Ro(this,t),Oo(this,_o(t).apply(this,arguments))}var r,n,a,i,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jo(e,t)}(t,e),r=t,(n=[{key:"resultingCollection",value:(i=regeneratorRuntime.mark((function e(){var t,r,n,a,i,s,u,l,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=!0,n=!1,a=void 0,e.prev=4,i=this.applyCollection.allPayloads[Symbol.iterator]();case 6:if(r=(s=i.next()).done){e.next=22;break}if(u=s.value,t.push(u),l=this.findBasePayload({id:u.uuid})){e.next=12;break}return e.abrupt("continue",19);case 12:if(f=l,y=void 0,h=void 0,y=zr(u),h=zr(f),!y.isItemContentEqualWith(h)){e.next=15;break}return e.abrupt("continue",19);case 15:return e.next=17,Jr({payload:l,baseCollection:this.baseCollection,isConflict:!0});case 17:p=e.sent,Object(o.f)(t,p);case 19:r=!0,e.next=6;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(4),n=!0,a=e.t0;case 28:e.prev=28,e.prev=29,r||null==i.return||i.return();case 31:if(e.prev=31,!n){e.next=34;break}throw a;case 34:return e.finish(31);case 35:return e.finish(28);case 36:return e.abrupt("return",new c({payloads:t,source:en.RemoteRetrieved}));case 37:case"end":return e.stop()}var f,y,h}),e,this,[[4,24,28,36],[29,,31,35]])})),s=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=i.apply(e,t);function a(e){So(o,r,n,a,s,"next",e)}function s(e){So(o,r,n,a,s,"throw",e)}a(void 0)}))},function(){return s.apply(this,arguments)})}])&&Po(r.prototype,n),a&&Po(r,a),t}(ro);function Do(e){return(Do="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Co(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Eo(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Co(a,n,o,i,s,"next",e)}function s(e){Co(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Ao(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function To(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Mo(e,t){return!t||"object"!==Do(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ko(e){return(Ko=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fo(e,t){return(Fo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Lo=function(e){function t(){return Ao(this,t),Mo(this,Ko(t).apply(this,arguments))}var r,n,a,i,s,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fo(e,t)}(t,e),r=t,(n=[{key:"resultingCollection",value:(u=Eo(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.applyCollection.source!==en.ConflictUuid){e.next=4;break}return e.abrupt("return",this.collectionsByHandlingUuidConflicts());case 4:if(this.applyCollection.source!==en.ConflictData){e.next=8;break}return e.abrupt("return",this.collectionsByHandlingDataConflicts());case 8:throw"Unhandled conflict type ".concat(this.applyCollection.source);case 9:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"collectionsByHandlingDataConflicts",value:(s=Eo(regeneratorRuntime.mark((function e(){var t,r,n,a,i,s,u,l,p,f,y,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=!0,n=!1,a=void 0,e.prev=4,i=this.applyCollection.allPayloads[Symbol.iterator]();case 6:if(r=(s=i.next()).done){e.next=27;break}if(u=s.value,l=this.findBasePayload({id:u.uuid})){e.next=12;break}return t.push(u),e.abrupt("continue",24);case 12:if(p=this.findRelatedPayload({id:u.uuid,source:en.DecryptedTransient})){e.next=18;break}if(u.deleted){e.next=16;break}throw"Unable to find decrypted counterpart for data conflict.";case 16:return t.push(u),e.abrupt("continue",24);case 18:return f=new po({baseCollection:this.baseCollection,basePayload:l,applyPayload:p}),e.next=21,f.resultingCollection();case 21:y=e.sent,h=y.allPayloads,Object(o.f)(t,h);case 24:r=!0,e.next=6;break;case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(4),n=!0,a=e.t0;case 33:e.prev=33,e.prev=34,r||null==i.return||i.return();case 36:if(e.prev=36,!n){e.next=39;break}throw a;case 39:return e.finish(36);case 40:return e.finish(33);case 41:return e.abrupt("return",new c({payloads:t,source:en.RemoteRetrieved}));case 42:case"end":return e.stop()}}),e,this,[[4,29,33,41],[34,,36,40]])}))),function(){return s.apply(this,arguments)})},{key:"collectionsByHandlingUuidConflicts",value:(i=Eo(regeneratorRuntime.mark((function e(){var t,r,n,a,i,s,u,l,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=!0,n=!1,a=void 0,e.prev=4,i=this.applyCollection.allPayloads[Symbol.iterator]();case 6:if(r=(s=i.next()).done){e.next=16;break}return u=s.value,l=this.findRelatedPayload({id:u.uuid,source:en.DecryptedTransient}),e.next=11,Qr({baseCollection:this.baseCollection,payload:l});case 11:p=e.sent,Object(o.f)(t,p);case 13:r=!0,e.next=6;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(4),n=!0,a=e.t0;case 22:e.prev=22,e.prev=23,r||null==i.return||i.return();case 25:if(e.prev=25,!n){e.next=28;break}throw a;case 28:return e.finish(25);case 29:return e.finish(22);case 30:return e.abrupt("return",new c({payloads:t,source:en.RemoteRetrieved}));case 31:case"end":return e.stop()}}),e,this,[[4,18,22,30],[23,,25,29]])}))),function(){return i.apply(this,arguments)})}])&&To(r.prototype,n),a&&To(r,a),t}(ro);function No(e){return(No="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Uo(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Bo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Vo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ho(e,t){return!t||"object"!==No(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Wo(e){return(Wo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zo(e,t){return(zo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qo=function(e){function t(){return Bo(this,t),Ho(this,Wo(t).apply(this,arguments))}var r,n,a,i,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zo(e,t)}(t,e),r=t,(n=[{key:"resultingCollection",value:(i=regeneratorRuntime.mark((function e(){var t,r,n,a,i,s,u,l,p,f,y,h,v,d,m,g,b,w;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=[],n=!0,a=!1,i=void 0,e.prev=5,s=this.applyCollection.allPayloads[Symbol.iterator]();case 7:if(n=(u=s.next()).done){e.next=27;break}if(l=u.value,p=this.findRelatedPayload({id:l.uuid,source:en.SavedOrSaving}),f=this.findRelatedPayload({id:l.uuid,source:en.DecryptedTransient})){e.next=16;break}if(l.deleted){e.next=14;break}throw"Cannot find decrypted for non-deleted payload.";case 14:return t.push(l),e.abrupt("continue",24);case 16:if(!p){e.next=19;break}return r.push(f),e.abrupt("continue",24);case 19:if(!(y=this.findBasePayload({id:l.uuid}))||!y.dirty){e.next=23;break}return r.push(f),e.abrupt("continue",24);case 23:t.push(f);case 24:n=!0,e.next=7;break;case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(5),a=!0,i=e.t0;case 33:e.prev=33,e.prev=34,n||null==s.return||s.return();case 36:if(e.prev=36,!a){e.next=39;break}throw i;case 39:return e.finish(36);case 40:return e.finish(33);case 41:h=[],v=0,d=r;case 43:if(!(v<d.length)){e.next=60;break}if(m=d[v],g=this.findRelatedPayload({id:m.uuid,source:en.DecryptedTransient})){e.next=48;break}return e.abrupt("continue",57);case 48:if(b=this.findBasePayload({id:m.uuid})){e.next=51;break}return e.abrupt("continue",57);case 51:if(b.compareContentFields(g)){e.next=57;break}return e.next=55,Jr({payload:g,baseCollection:this.baseCollection,isConflict:!0});case 55:w=e.sent,Object(o.f)(h,w);case 57:v++,e.next=43;break;case 60:return e.abrupt("return",new c({payloads:t.concat(h),source:en.RemoteRetrieved}));case 61:case"end":return e.stop()}}),e,this,[[5,29,33,41],[34,,36,40]])})),s=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=i.apply(e,t);function a(e){Uo(o,r,n,a,s,"next",e)}function s(e){Uo(o,r,n,a,s,"throw",e)}a(void 0)}))},function(){return s.apply(this,arguments)})}])&&Vo(r.prototype,n),a&&Vo(r,a),t}(ro);function Yo(e){return(Yo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jo(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Go(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Qo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Xo(e,t){return!t||"object"!==Yo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Zo(e){return(Zo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ea(e,t){return(ea=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ta=function(e){function t(){return Qo(this,t),Xo(this,Zo(t).apply(this,arguments))}var r,n,o,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ea(e,t)}(t,e),r=t,(n=[{key:"resultingCollection",value:(a=regeneratorRuntime.mark((function e(){var t,r,n,o,a,i,s,u,l,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=[],r=!0,n=!1,o=void 0,e.prev=4,a=this.applyCollection.allPayloads[Symbol.iterator]();!(r=(i=a.next()).done);r=!0)u=i.value,l=this.findBasePayload({id:u.uuid}),p=l?l.deleted:u.deleted,f=oa({object:u,source:en.RemoteSaved,override:(s={},Jo(s,ce.LastSyncEnd,new Date),Jo(s,ce.Deleted,p),s)}),t.push(f);e.next=12;break;case 8:e.prev=8,e.t0=e.catch(4),n=!0,o=e.t0;case 12:e.prev=12,e.prev=13,r||null==a.return||a.return();case 15:if(e.prev=15,!n){e.next=18;break}throw o;case 18:return e.finish(15);case 19:return e.finish(12);case 20:return e.abrupt("return",new c({payloads:t,source:en.RemoteSaved}));case 21:case"end":return e.stop()}}),e,this,[[4,8,12,20],[13,,15,19]])})),i=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=a.apply(e,t);function i(e){Go(o,r,n,i,s,"next",e)}function s(e){Go(o,r,n,i,s,"throw",e)}i(void 0)}))},function(){return i.apply(this,arguments)})}])&&$o(r.prototype,n),o&&$o(r,o),t}(ro);function ra(e){var t=e.object,r=e.source,n=e.intent,a=e.override;if(!Object(o.l)(r))throw"Use CreateSourcedPayloadFromObject if creating payload with source.";if(!Object(o.l)(n))throw"Use CreateIntentPayloadFromObject if creating payload with intent.";return aa({object:t,payloadClass:Nn,override:a})}function na(e){var t=e.object,r=e.intent,n=e.override;return aa({object:t,payloadClass:function(e){if(e===q.FileEncrypted||e===q.FileDecrypted||e===q.FilePreferEncrypted)return En;if(e===q.LocalStoragePreferEncrypted||e===q.LocalStorageDecrypted||e===q.LocalStorageEncrypted)return gn;if(e===q.Sync||e===q.SyncDecrypted)return Pn;throw"No item payload class found for intent ".concat(e)}(r),override:n})}function oa(e){var t=e.object,r=e.source,n=e.override;return aa({object:t,payloadClass:ca(r),override:n})}function aa(e){var t=e.object,r=e.payloadClass,n=e.override,a=Object(o.t)(t,r.fields());if(n){if(!Object(o.m)(n))throw"Attempting to override payload with non-object";Object(o.e)(a,Object(o.a)(n))}return Object(o.d)(new r(a,!0))}function ia(e){var t=e.payload,r=e.override,n=Object(o.t)(t,t.fields());return r&&Object(o.e)(n,Object(o.a)(r)),Object(o.d)(new t.constructor(n,!0))}function sa(e){var t=Object(o.a)(e);return Object(o.d)(new Zn(t,!0))}function ua(e){var t=e.encryptionParameters,r=e.override;if(!t.isEncryptionParameters)throw"Attempting to copy encryption parameters from non-parameters object.";var n=Object(o.t)(t,Zn.fields());return r&&Object(o.e)(n,Object(o.a)(r)),Object(o.d)(new Zn(n,!0))}function ca(e){if(e===en.FileImport)return En;if(e===en.LocalRetrieved||e===en.LocalDirtied)return gn;if(e===en.RemoteRetrieved||e===en.ConflictData||e===en.ConflictUuid)return Pn;if(e===en.LocalSaved||e===en.RemoteSaved)return qn;throw"No item payload class found for source ".concat(e)}function la(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function pa(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){la(a,n,o,i,s,"next",e)}function s(e){la(a,n,o,i,s,"throw",e)}i(void 0)}))}}function fa(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ya=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.eventObservers=[]}var t,r,n,o,a,i;return t=e,(r=[{key:"addEventObserver",value:function(e){var t=this;return this.eventObservers.push(e),function(){Pt()(t.eventObservers,e)}}},{key:"notifyEvent",value:(i=pa(regeneratorRuntime.mark((function e(t,r){var n,o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,o=!1,a=void 0,e.prev=3,i=this.eventObservers[Symbol.iterator]();case 5:if(n=(s=i.next()).done){e.next=12;break}return u=s.value,e.next=9,u(t,r||{});case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),o=!0,a=e.t0;case 18:e.prev=18,e.prev=19,n||null==i.return||i.return();case 21:if(e.prev=21,!o){e.next=24;break}throw a;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))),function(e,t){return i.apply(this,arguments)})},{key:"deinit",value:(a=pa(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})},{key:"handleApplicationStage",value:(o=pa(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"log",value:function(e){if(this.loggingEnabled){for(var t,r=new Date,n=r.toLocaleTimeString().replace(" PM","").replace(" AM",""),o="".concat(n,".").concat(r.getMilliseconds()),a=arguments.length,i=new Array(a>1?a-1:0),s=1;s<a;s++)i[s-1]=arguments[s];i?(t=console).log.apply(t,[o,e].concat(i)):console.log(o,e)}}}])&&fa(t.prototype,r),n&&fa(t,n),e}();function ha(e){return(ha="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function va(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function da(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){va(a,n,o,i,s,"next",e)}function s(e){va(a,n,o,i,s,"throw",e)}i(void 0)}))}}function ma(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ga(e,t){return!t||"object"!==ha(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ba(e){return(ba=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wa(e,t){return(wa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ka=function(e){function t(e){var r,n=e.deviceInterface;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=ga(this,ba(t).call(this))).deviceInterface=n,r}var r,n,o,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wa(e,t)}(t,e),r=t,(n=[{key:"alert",value:(i=da(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){window.alert(t.text),e()})));case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"confirm",value:(a=da(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){window.confirm(t.text)?e():r()})));case 1:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})}])&&ma(r.prototype,n),o&&ma(r,o),t}(ya);var xa=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.token=t};function Sa(e){return"\n          Your password must be at least ".concat(e," characters in length.\n          For your security, please choose a longer password or,\n          ideally, a passphrase, and try again.\n         ")}function Ra(e,t){return"\n          Strict sign in refused server sign in parameters.\n          The latest security version is ".concat(t,", but your account is\n          reported to have version ").concat(e,". If you'd like to proceed\n          with sign in anyway, please disable strict sign in and try again.\n          ")}function Pa(e){return(Pa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Oa(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function _a(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Oa(a,n,o,i,s,"next",e)}function s(e){Oa(a,n,o,i,s,"throw",e)}i(void 0)}))}}function ja(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ia(e,t){return!t||"object"!==Pa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Da(e){return(Da=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ca(e,t){return(Ca=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ea=function(e){function t(e){var r,n=e.storageService,o=e.apiService,a=e.alertService,i=e.protocolService;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!n||!i)throw"Invalid SessionManager construction";return(r=Ia(this,Da(t).call(this))).protocolService=i,r.storageService=n,r.apiService=o,r.alertService=a||new ka,r}var r,n,a,i,s,u,c,l,p,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ca(e,t)}(t,e),r=t,(n=[{key:"initializeFromDisk",value:(f=_a(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.getValue(E.User);case 2:if(this.user=e.sent,this.user){e.next=8;break}return e.next=6,this.storageService.getValue(E.LegacyUuid);case 6:(t=e.sent)&&(this.user={uuid:t});case 8:return e.next=10,this.storageService.getValue(E.Session);case 10:if(!(r=e.sent)){e.next=14;break}return e.next=14,this.setSession(new xa(r));case 14:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"setSession",value:(p=_a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.session=t,this.apiService.setSession(this.session);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"online",value:function(){return!this.offline()}},{key:"offline",value:function(){return Object(o.l)(this.session)}},{key:"getUser",value:function(){return this.user}},{key:"signOut",value:(l=_a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.user=null,this.session=null;case 2:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"register",value:(c=_a(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.email,!((n=t.password).length<8)){e.next=3;break}return e.abrupt("return",this.apiService.error(Sa(8)));case 3:return e.next=5,this.protocolService.createRootKey({identifier:r,password:n});case 5:return o=e.sent,a=o.key.serverPassword,i=o.keyParams,s=o.key,e.abrupt("return",this.apiService.register({email:r,serverPassword:a,keyParams:i}).then(function(){var e=_a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.handleAuthResponse(t);case 2:return e.abrupt("return",{response:t,keyParams:i,rootKey:s});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"signIn",value:(u=_a(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c,l,p,f,y,h=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.email,n=t.password,o=t.strict,a=t.mfaKeyPath,i=t.mfaCode,e.next=3,this.apiService.getAccountKeyParams({email:r,mfaKeyPath:a,mfaCode:i}).then((function(e){return{keyParams:h.protocolService.createKeyParams(e)}}));case 3:if(!(s=e.sent).error){e.next=6;break}return e.abrupt("return",s);case 6:if((u=s.keyParams)&&u.version){e.next=9;break}return e.abrupt("return",this.apiService.error("Invalid email or password."));case 9:if(this.protocolService.supportedVersions().includes(u.version)){e.next=15;break}if(!this.protocolService.isVersionNewerThanLibraryVersion(u.version)){e.next=14;break}return e.abrupt("return",this.apiService.error("This version of the application does not support your\n                                                      newer account type. Please upgrade to the latest version\n                                                      of Standard Notes to sign in."));case 14:return e.abrupt("return",this.apiService.error("The protocol version associated with your account is\n                                                      outdated and no longer supported by this application.\n                                                      Please visit standardnotes.org/help/security for more\n                                                      information."));case 15:if(!this.protocolService.isProtocolVersionOutdated(u.version)){e.next=26;break}if(c=this.protocolService.costMinimumForVersion(u.version),!(u.kdfIterations<c)){e.next=19;break}return e.abrupt("return",this.apiService.error("Unable to login due to insecure password parameters.\n                                                      Please visit standardnotes.org/help/security for\n                                                      more information."));case 19:return e.next=23,this.alertService.confirm({title:"Update Recommended",text:"The encryption version for your account is outdated and\n                                                      requires upgrade. You may proceed with login, but are\n                                                      advised to perform a security update using the web or\n                                                      desktop application. Please visit\n                                                      standardnotes.org/help/security for more information.",confirmButtonText:"Sign In"}).catch((function(){}));case 23:if(e.sent){e.next=26;break}return e.abrupt("return",this.apiService.error());case 26:if(this.protocolService.platformSupportsKeyDerivation(u)){e.next=28;break}return e.abrupt("return",this.apiService.error("Your account was created on a platform with higher security\n                                                      capabilities than this browser supports. If we attempted\n                                                      to generate your login keys here, it would take hours. Please\n                                                      use a browser with more up to date security capabilities,\n                                                      like Google Chrome or Firefox, to log in."));case 28:if(!o){e.next=32;break}if(l=this.protocolService.getLatestVersion(),u.version===l){e.next=32;break}return e.abrupt("return",this.apiService.error(Ra(u.version,l)));case 32:return e.next=34,this.protocolService.computeRootKey({password:n,keyParams:u}).then((function(e){return{rootKey:e,serverPassword:e.serverPassword}}));case 34:return p=e.sent,f=p.rootKey,y=p.serverPassword,e.abrupt("return",this.apiService.signIn({email:r,serverPassword:y,mfaKeyPath:a,mfaCode:i}).then(function(){var e=_a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.handleAuthResponse(t);case 2:return e.abrupt("return",{response:t,keyParams:u,rootKey:f});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 38:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"changePassword",value:(s=_a(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c,l,p=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.email,n=t.currentPassword,o=t.currentKeyParams,!((a=t.newPassword).length<8)){e.next=3;break}return e.abrupt("return",this.apiService.error(Sa(8)));case 3:return e.next=5,this.protocolService.computeRootKey({password:n,keyParams:o}).then((function(e){return e.serverPassword}));case 5:return i=e.sent,e.next=8,this.protocolService.createRootKey({identifier:r,password:a}).then((function(e){return{newRootKey:e.key,newServerPassword:e.key.serverPassword,newKeyParams:e.keyParams}}));case 8:return s=e.sent,u=s.newServerPassword,c=s.newRootKey,l=s.newKeyParams,e.abrupt("return",this.apiService.changePassword({email:r,currentServerPassword:i,newServerPassword:u,newKeyParams:l}).then(function(){var e=_a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.handleAuthResponse(t);case 2:return e.abrupt("return",{response:t,keyParams:l,rootKey:c});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"handleAuthResponse",value:(i=_a(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.user,this.user=r,e.next=4,this.storageService.setValue(E.User,r);case 4:return n=new xa(t.token),e.next=7,this.storageService.setValue(E.Session,n);case 7:return e.next=9,this.setSession(n);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})}])&&ja(r.prototype,n),a&&ja(r,a),t}(ya),Aa="sync_token",Ta="cursor_token",Ma="compute_integrity",Ka="integrity_hash",Fa="limit",La="items",Na="api";function Ua(e){return(Ua="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ba(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Va(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ba(Object(r),!0).forEach((function(t){Ha(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ba(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ha(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Wa(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function za(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Wa(a,n,o,i,s,"next",e)}function s(e){Wa(a,n,o,i,s,"throw",e)}i(void 0)}))}}function qa(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ya(e,t){return!t||"object"!==Ua(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ja(e){return(Ja=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ga(e,t){return(Ga=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qa=function(e){function t(e){var r,n=e.httpService,o=e.storageService,a=e.host;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Ya(this,Ja(t).call(this))).httpService=n,r.storageService=o,r.host=a,r}var r,n,a,i,s,u,c,l,p,f,y;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ga(e,t)}(t,e),r=t,(n=[{key:"setHost",value:(y=za(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.host=t,e.next=3,this.storageService.setValue(E.ServerHost,t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"getHost",value:(f=za(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host){e.next=5;break}return e.next=3,this.storageService.getValue(E.ServerHost);case 3:t=e.sent,this.host=t||window._default_sf_server;case 5:return e.abrupt("return",this.host);case 6:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"setSession",value:function(e){this.session=e}},{key:"path",value:(p=za(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getHost();case 2:if(r=e.sent){e.next=5;break}throw"Attempting to build path ".concat(t," with no host.");case 5:if(t){e.next=7;break}throw"Attempting to build path with null path.";case 7:return e.abrupt("return",Object(o.p)(r,t));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"params",value:function(e){var t=Lt()(e,Ha({},Na,"20190520"));return t}},{key:"error",value:function(e){return{response:{error:{message:e}}}}},{key:"errorResponse",value:function(e,t){return this.log("".concat(t,": ").concat(e)),Object(o.m)(e)?e:Object(o.n)(e)?this.error(e):this.error(t)}},{key:"getAccountKeyParams",value:(l=za(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.email,n=t.mfaKeyPath,o=t.mfaCode,e.next=3,this.path("/auth/params");case 3:return a=e.sent,i=this.params(Ha({email:r},n,o)),e.next=7,this.httpService.getAbsolute({url:a,params:i}).catch((function(e){return u.errorResponse(e,"A server error occurred while trying to sign in. Please try again.")}));case 7:return s=e.sent,e.abrupt("return",s);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"register",value:(c=za(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.email,n=t.serverPassword,o=t.keyParams,!this.registering){e.next=3;break}return e.abrupt("return",this.error("An existing registration request is already in progress."));case 3:return this.registering=!0,e.next=6,this.path("/auth");case 6:return a=e.sent,i=this.params(Va({password:n,email:r},o.getPortableValue())),e.next=10,this.httpService.postAbsolute({url:a,params:i}).catch((function(e){return u.errorResponse(e,"A server error occurred while trying to register. Please try again.")}));case 10:return s=e.sent,this.registering=!1,e.abrupt("return",s);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"signIn",value:(u=za(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.email,n=t.serverPassword,o=t.mfaKeyPath,a=t.mfaCode,!this.authenticating){e.next=3;break}return e.abrupt("return",this.error("An existing sign in request is already in progress."));case 3:return this.authenticating=!0,e.next=6,this.path("/auth/sign_in");case 6:return i=e.sent,s=this.params(Ha({email:r,password:n},o,a)),e.next=10,this.httpService.postAbsolute({url:i,params:s}).catch((function(e){return c.errorResponse(e,"A server error occurred while trying to sign in. Please try again.")}));case 10:return u=e.sent,this.authenticating=!1,e.abrupt("return",u);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"changePassword",value:(s=za(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.email,r=t.currentServerPassword,n=t.newServerPassword,o=t.newKeyParams,!this.changing){e.next=3;break}return e.abrupt("return",this.error("An existing change password request is already in progress."));case 3:return this.changing=!0,e.next=6,this.path("/auth/change_pw");case 6:return a=e.sent,i=Va({current_password:r,new_password:n},o.getPortableValue()),e.next=10,this.httpService.postAbsolute({url:a,params:i,authentication:this.session.token}).catch((function(e){return u.errorResponse(e,"Something went wrong while changing your password.\n                                                      Your password was not changed. Please try again.")}));case 10:return s=e.sent,this.changing=!1,e.abrupt("return",s);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"sync",value:(i=za(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c,l,p,f,y=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payloads,o=t.lastSyncToken,a=t.paginationToken,i=t.limit,s=t.checkIntegrity,u=t.contentType,c=t.customEvent,e.next=3,this.path("/items/sync");case 3:return l=e.sent,p=this.params((Ha(r={},La,n),Ha(r,Aa,o),Ha(r,Ta,a),Ha(r,Ma,s),Ha(r,Fa,i),Ha(r,"content_type",u),Ha(r,"event",c),r)),e.next=7,this.httpService.postAbsolute({url:l,params:p,authentication:this.session.token}).catch((function(e){return y.errorResponse(e,"Could not connect to server.")}));case 7:return f=e.sent,e.abrupt("return",f);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})}])&&qa(r.prototype,n),a&&qa(r,a),t}(ya),$a=r(19),Xa=r.n($a);function Za(e){return(Za="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ei(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function ti(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){ei(a,n,o,i,s,"next",e)}function s(e){ei(a,n,o,i,s,"throw",e)}i(void 0)}))}}function ri(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ni(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oi(e,t,r){return(oi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ai(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function ai(e){return(ai=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ii(e,t){return(ii=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function si(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ui="stream-items",ci="stream-context-item",li="save-items",pi="associate-item",fi="deassociate-item",yi="create-item",hi="create-items",vi="delete-items",di="set-component-data",mi="install-local-component",gi="toggle-activate-component",bi="request-permissions",wi="duplicate-item",ki="component-registered",xi="themes",Si="reply",Ri=function(e){function t(e){var r,n=e.modelManager,o=e.syncService,a=e.alertService,i=e.timeout,s=e.environment,u=e.platform;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){return!t||"object"!==Za(t)&&"function"!=typeof t?ni(e):t}(this,ai(t).call(this)),si(ni(r),"detectFocusChange",(function(){var e=!0,t=!1,n=void 0;try{for(var o,a=function(){var e=o.value;if(document.activeElement===r.iframeForComponent(e))return r.timeout((function(){r.focusChangedForComponent(e)})),"break"},i=r.activeComponents[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){if("break"===a())break}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}})),si(ni(r),"onWindowMessage",(function(e){r.log("Web app: received message",e),e.data.sessionKey&&r.handleMessage(r.componentForSessionKey(e.data.sessionKey),e.data)})),t.ClientDataDomain="org.standardnotes.sn.components",r.timeout=i||setTimeout.bind(window),r.modelManager=n,r.syncService=o,r.alertService=a,r.environment=s,r.platform=u,r.isDesktop=r.environment===O.Desktop,r.isMobile=r.environment===O.Mobile,r.streamObservers=[],r.contextStreamObservers=[],r.activeComponents=[],r.permissionDialogs=[],r.handlers=[],r.configureForGeneralUsage(),s!==O.Mobile&&r.configureForNonMobileUsage(),r}var r,n,s,u,c,l,p,f,y,h,v;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ii(e,t)}(t,e),r=t,(n=[{key:"setDesktopManager",value:function(e){this.desktopManager=e,this.configureForDesktop()}},{key:"configureForGeneralUsage",value:function(){var e=this;this.modelManager.addMappingObserver("*",function(){var t=ti(regeneratorRuntime.mark((function t(r,n,o,a,s){var u,c,l,p,f,y,h,v,d,m,g,b,w,k,x,S,R,P,O,_,j;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(u=r.filter((function(e){return e.content_type===i.Component||e.content_type===i.Theme}))).length>0&&a!==en.RemoteSaved&&e.isDesktop&&e.desktopManager.syncComponentsInstallation(u),c=!0,l=!1,p=void 0,t.prev=5,f=u[Symbol.iterator]();case 7:if(c=(y=f.next()).done){t.next=21;break}if(h=y.value,v=St()(e.activeComponents,{uuid:h.uuid}),!h.active||h.deleted||v){t.next=15;break}return t.next=13,e.activateComponent(h);case 13:t.next=18;break;case 15:if(h.active||!v){t.next=18;break}return t.next=18,e.deactivateComponent(h);case 18:c=!0,t.next=7;break;case 21:t.next=27;break;case 23:t.prev=23,t.t0=t.catch(5),l=!0,p=t.t0;case 27:t.prev=27,t.prev=28,c||null==f.return||f.return();case 30:if(t.prev=30,!l){t.next=33;break}throw p;case 33:return t.finish(30);case 34:return t.finish(27);case 35:d=!0,m=!1,g=void 0,t.prev=38,b=function(){var t=k.value;if(s&&s===t.component.uuid)return"continue";var n=r.filter((function(e){return-1!==t.contentTypes.indexOf(e.content_type)}));if(0===n.length)return"continue";var o=[{name:ui,content_types:t.contentTypes.sort()}];e.runWithPermissions(t.component,o,(function(){e.sendItemsInReply(t.component,n,t.originalMessage)}))},w=e.streamObservers[Symbol.iterator]();case 41:if(d=(k=w.next()).done){t.next=48;break}if("continue"!==b()){t.next=45;break}return t.abrupt("continue",45);case 45:d=!0,t.next=41;break;case 48:t.next=54;break;case 50:t.prev=50,t.t1=t.catch(38),m=!0,g=t.t1;case 54:t.prev=54,t.prev=55,d||null==w.return||w.return();case 57:if(t.prev=57,!m){t.next=60;break}throw g;case 60:return t.finish(57);case 61:return t.finish(54);case 62:x=[{name:ci}],S=!0,R=!1,P=void 0,t.prev=66,O=function(){var t=j.value;if(s&&s===t.component.uuid)return"continue";var n=!0,o=!1,i=void 0;try{for(var u,c=e.handlers[Symbol.iterator]();!(n=(u=c.next()).done);n=!0){var l=u.value;if((l.areas.includes(t.component.area)||l.areas.includes("*"))&&l.contextRequestHandler){var p=l.contextRequestHandler(t.component);p&&function(){var n=St()(r,{uuid:p.uuid});n&&e.runWithPermissions(t.component,x,(function(){e.sendContextItemInReply(t.component,n,t.originalMessage,a)}))}()}}}catch(e){o=!0,i=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}},_=e.contextStreamObservers[Symbol.iterator]();case 69:if(S=(j=_.next()).done){t.next=76;break}if("continue"!==O()){t.next=73;break}return t.abrupt("continue",73);case 73:S=!0,t.next=69;break;case 76:t.next=82;break;case 78:t.prev=78,t.t2=t.catch(66),R=!0,P=t.t2;case 82:t.prev=82,t.prev=83,S||null==_.return||_.return();case 85:if(t.prev=85,!R){t.next=88;break}throw P;case 88:return t.finish(85);case 89:return t.finish(82);case 90:case"end":return t.stop()}}),t,null,[[5,23,27,35],[28,,30,34],[38,50,54,62],[55,,57,61],[66,78,82,90],[83,,85,89]])})));return function(e,r,n,o,a){return t.apply(this,arguments)}}())}},{key:"isNativeExtension",value:function(e){var t=[window._extensions_manager_location,window._batch_manager_location],r=e.content.hosted_url,n=e.content.local_url&&e.content.local_url.replace("sn://","");return t.includes(r)||t.includes(n)}},{key:"deinit",value:(v=ti(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:oi(ai(t.prototype),"deinit",this).call(this),window&&(window.removeEventListener("focus",this.detectFocusChange,!0),window.removeEventListener("blur",this.detectFocusChange,!0),window.removeEventListener("message",this.onWindowMessage));case 2:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"configureForNonMobileUsage",value:function(){window.addEventListener?window.addEventListener("focus",this.detectFocusChange,!0):window.attachEvent("onfocusout",this.detectFocusChange),window.addEventListener?window.addEventListener("blur",this.detectFocusChange,!0):window.attachEvent("onblur",this.detectFocusChange),window.addEventListener("message",this.onWindowMessage)}},{key:"configureForDesktop",value:function(){var e=this;this.desktopManager.registerUpdateObserver((function(t){t.active&&t.isTheme()&&e.postActiveThemesToAllComponents()}))}},{key:"postActiveThemesToAllComponents",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,o=this.components[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var a=n.value;!a.isTheme()&&a.active&&a.window&&this.postActiveThemesToComponent(a)}}catch(e){t=!0,r=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw r}}}},{key:"getActiveThemes",value:function(){return this.componentsForArea(ht).filter((function(e){return e.active}))}},{key:"urlsForActiveThemes",value:function(){var e=this;return this.getActiveThemes().map((function(t){return e.urlForComponent(t)}))}},{key:"postActiveThemesToComponent",value:function(e){var t={themes:this.urlsForActiveThemes()};this.sendMessageToComponent(e,{action:xi,data:t})}},{key:"contextItemDidChangeInArea",value:function(e){var t=!0,r=!1,n=void 0;try{for(var o,a=this.handlers[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var i=o.value;if(!1!==i.areas.includes(e)||i.areas.includes("*")){var s=this.contextStreamObservers.filter((function(t){return t.component.area===e})),u=!0,c=!1,l=void 0;try{for(var p,f=s[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var y=p.value;if(i.contextRequestHandler){var h=i.contextRequestHandler(y.component);h&&this.sendContextItemInReply(y.component,h,y.originalMessage)}}}catch(e){c=!0,l=e}finally{try{u||null==f.return||f.return()}finally{if(c)throw l}}}}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}},{key:"setComponentHidden",value:function(e,t){if(t)e.hidden=!0;else if(e.hidden){e.hidden=!1;var r=St()(this.contextStreamObservers,{identifier:e.uuid});r&&this.handleStreamContextItemMessage(e,r.originalMessage);var n=St()(this.streamObservers,{identifier:e.uuid});n&&this.handleStreamItemsMessage(e,n.originalMessage)}}},{key:"jsonForItem",value:function(e,r,n){var o={uuid:e.uuid,content_type:e.content_type,created_at:e.created_at,updated_at:e.updated_at,deleted:e.deleted};return o.content=e.collapseContent(),o.clientData=e.getDomainDataItem(r.getClientDataKey(),t.ClientDataDomain)||{},!n||n!==en.RemoteSaved&&n!==en.LocalSaved||(o.isMetadataUpdate=!0),this.removePrivatePropertiesFromResponseItems([o],r),o}},{key:"sendItemsInReply",value:function(e,t,r,n){var o=this;this.log("Web|componentManager|sendItemsInReply",e,t,r);var a={items:{}},i=t.map((function(t){return o.jsonForItem(t,e,n)}));a.items=i,this.replyToMessage(e,r,a)}},{key:"sendContextItemInReply",value:function(e,t,r,n){this.log("Web|componentManager|sendContextItemInReply",e,t,r);var o={item:this.jsonForItem(t,e,n)};this.replyToMessage(e,r,o)}},{key:"replyToMessage",value:function(e,t,r){var n={action:Si,original:t,data:r};this.sendMessageToComponent(e,n)}},{key:"sendMessageToComponent",value:function(e,t){var r=[ki,xi];if(!e.hidden||r.includes(t.action)){this.log("Web|sendMessageToComponent",e,t);var n=this.urlForComponent(e);n.startsWith("http")||n.startsWith("file")||(n=window.location.href+n),e.window||this.alertService.alert({text:"Standard Notes is trying to communicate with ".concat(e.name,", \n        but an error is occurring. Please restart this extension and try again.")}),this.isMobile&&(t=JSON.stringify(t)),e.window.postMessage(t,n)}else this.log("Component disabled for current item, ignoring messages.",e.name)}},{key:"componentsForArea",value:function(e){return this.components.filter((function(t){return t.area===e}))}},{key:"urlForComponent",value:function(e){if(e.offlineOnly&&!this.isDesktop)return null;if(e.offlineOnly||this.isDesktop&&e.local_url)return e.local_url&&e.local_url.replace("sn://",this.desktopManager.getExtServerHost());var t=e.hosted_url||e.legacy_url;if(this.isMobile){var r=this.platform===_.Ios?"localhost":"10.0.2.2";t=t.replace("localhost",r).replace("sn.local",r)}return t}},{key:"componentForUrl",value:function(e){return this.components.filter((function(t){return t.hosted_url===e||t.legacy_url===e}))[0]}},{key:"componentForSessionKey",value:function(e){var t=St()(this.components,{sessionKey:e});if(!t){var r=!0,n=!1,o=void 0;try{for(var a,i=this.handlers[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value;if(s.componentForSessionKeyHandler&&(t=s.componentForSessionKeyHandler(e)))break}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}}return t}},{key:"handleMessage",value:function(e,t){var r=this;if(!e)return this.log("Component not defined for message, returning",t),void this.alertService.alert({text:"An extension is trying to communicate with Standard Notes,but there is an error establishing a bridge. Please restart the app and try again."});var n=[li,pi,fi,yi,hi,vi,di];if(e.readonly&&n.includes(t.action))this.alertService.alert({text:"The extension ".concat(e.name," is trying to save, but it is in a locked state and cannot accept changes.")});else{if(t.action===ui)this.handleStreamItemsMessage(e,t);else if(t.action===ci)this.handleStreamContextItemMessage(e,t);else if(t.action===di)this.handleSetComponentDataMessage(e,t);else if(t.action===vi)this.handleDeleteItemsMessage(e,t);else if(t.action===hi||t.action===yi)this.handleCreateItemsMessage(e,t);else if(t.action===li)this.handleSaveItemsMessage(e,t);else if(t.action===gi){var o=this.modelManager.findItem(t.data.uuid);this.handleToggleComponentMessage(e,o,t)}else t.action===bi?this.handleRequestPermissionsMessage(e,t):t.action===mi?this.handleInstallLocalComponentMessage(e,t):t.action===wi&&this.handleDuplicateItemMessage(e,t);var a=!0,i=!1,s=void 0;try{for(var u,c=function(){var n=u.value;n.actionHandler&&(n.areas.includes(e.area)||n.areas.includes("*"))&&r.timeout((function(){n.actionHandler(e,t.action,t.data)}))},l=this.handlers[Symbol.iterator]();!(a=(u=l.next()).done);a=!0)c()}catch(e){i=!0,s=e}finally{try{a||null==l.return||l.return()}finally{if(i)throw s}}}}},{key:"removePrivatePropertiesFromResponseItems",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r.incoming){var n=["updated_at"],o=!0,a=!1,i=void 0;try{for(var s,u=e[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var c=s.value;if(c.isItem)console.error("Attempting to pass object. Use JSON.");else{var l=!0,p=!1,f=void 0;try{for(var y,h=n[Symbol.iterator]();!(l=(y=h.next()).done);l=!0){var v=y.value;delete c[v]}}catch(e){p=!0,f=e}finally{try{l||null==h.return||h.return()}finally{if(p)throw f}}}}}catch(e){a=!0,i=e}finally{try{o||null==u.return||u.return()}finally{if(a)throw i}}}if(!t||!this.isNativeExtension(t)){var d=["autoupdateDisabled","permissions","active"];r&&r.includeUrls&&(d=d.concat(["url","hosted_url","local_url"]));var m=!0,g=!1,b=void 0;try{for(var w,k=e[Symbol.iterator]();!(m=(w=k.next()).done);m=!0){var x=w.value;if(x.isItem)console.error("Attempting to pass object. Use JSON.");else{var S=!0,R=!1,P=void 0;try{for(var O,_=d[Symbol.iterator]();!(S=(O=_.next()).done);S=!0){var j=O.value;delete x.content[j]}}catch(e){R=!0,P=e}finally{try{S||null==_.return||_.return()}finally{if(R)throw P}}}}}catch(e){g=!0,b=e}finally{try{m||null==k.return||k.return()}finally{if(g)throw b}}}}},{key:"handleStreamItemsMessage",value:function(e,t){var r=this,n=[{name:ui,content_types:t.data.content_types.sort()}];this.runWithPermissions(e,n,(function(){St()(r.streamObservers,{identifier:e.uuid})||r.streamObservers.push({identifier:e.uuid,component:e,originalMessage:t,contentTypes:t.data.content_types});var n=[],o=!0,a=!1,i=void 0;try{for(var s,u=t.data.content_types[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var c=s.value;n=n.concat(r.modelManager.validItemsForContentType(c))}}catch(e){a=!0,i=e}finally{try{o||null==u.return||u.return()}finally{if(a)throw i}}r.sendItemsInReply(e,n,t)}))}},{key:"handleStreamContextItemMessage",value:function(e,t){var r=this,n=[{name:ci}];this.runWithPermissions(e,n,(function(){St()(r.contextStreamObservers,{identifier:e.uuid})||r.contextStreamObservers.push({identifier:e.uuid,component:e,originalMessage:t});var n=!0,o=!1,a=void 0;try{for(var i,s=r.handlersForArea(e.area)[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var u=i.value;if(u.contextRequestHandler){var c=u.contextRequestHandler(e);c&&r.sendContextItemInReply(e,c,t)}}}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}}))}},{key:"isItemIdWithinComponentContextJurisdiction",value:function(e,t){return this.itemIdsInContextJurisdictionForComponent(t).includes(e)}},{key:"itemIdsInContextJurisdictionForComponent",value:function(e){var t=[],r=!0,n=!1,o=void 0;try{for(var a,i=this.handlersForArea(e.area)[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value;if(s.contextRequestHandler){var u=s.contextRequestHandler(e);u&&t.push(u.uuid)}}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}return t}},{key:"handlersForArea",value:function(e){return this.handlers.filter((function(t){return t.areas.includes(e)}))}},{key:"handleSaveItemsMessage",value:(h=ti(regeneratorRuntime.mark((function e(r,n){var o,a,i,s,u,c,l,p,f,y,h,v=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=n.data.items,a=[],i=this.itemIdsInContextJurisdictionForComponent(r),s=o.slice(),u=!0,c=!1,l=void 0,e.prev=7,p=o.slice()[Symbol.iterator]();case 9:if(u=(f=p.next()).done){e.next=18;break}if(y=f.value,!i.includes(y.uuid)){e.next=15;break}return a.push({name:ci}),Pt()(s,y),e.abrupt("break",18);case 15:u=!0,e.next=9;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(7),c=!0,l=e.t0;case 24:e.prev=24,e.prev=25,u||null==p.return||p.return();case 27:if(e.prev=27,!c){e.next=30;break}throw l;case 30:return e.finish(27);case 31:return e.finish(24);case 32:s.length>0&&(h=Xa()(s.map((function(e){return e.content_type}))).sort(),a.push({name:ui,content_types:h})),this.runWithPermissions(r,a,ti(regeneratorRuntime.mark((function e(){var a,i,s,u,c,l,p,f,y,h,d,m,g,b,w,k,x,S,R,P;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(v.removePrivatePropertiesFromResponseItems(o,r,{includeUrls:!0,incoming:!0}),a=o.map((function(e){return e.uuid})),i=v.modelManager.findItems(a),s=0,u=!0,c=!1,l=void 0,e.prev=7,p=i[Symbol.iterator]();!(u=(f=p.next()).done);u=!0)(y=f.value).locked&&(_t()(o,{uuid:y.uuid}),s++);e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),c=!0,l=e.t0;case 15:e.prev=15,e.prev=16,u||null==p.return||p.return();case 18:if(e.prev=18,!c){e.next=21;break}throw l;case 21:return e.finish(18);case 22:return e.finish(15);case 23:return s>0&&(h=1===s?"item":"items",d=1===s?"is":"are",v.alertService.alert({title:"Items Locked",text:"".concat(s," ").concat(h," you are attempting to save ").concat(d," locked and cannot be edited.")})),m=o.map((function(e){return ra({object:e})})),e.next=27,v.modelManager.mapPayloadsToLocalItems({paylods:m,source:en.ComponentRetrieved,sourceKey:r.uuid});case 27:g=e.sent,b=!0,w=!1,k=void 0,e.prev=31,x=o[Symbol.iterator]();case 33:if(b=(S=x.next()).done){e.next=46;break}if(R=S.value,P=St()(g,{uuid:R.uuid})){e.next=39;break}return v.alertService.alert({text:"The extension ".concat(r.name," is trying to save an item with type")+"".concat(R.content_type,", but that item does not exist. Please restart this extension and try again.")}),e.abrupt("continue",43);case 39:if(P.locked){e.next=43;break}return R.clientData&&P.setDomainDataItem(r.getClientDataKey(),R.clientData,t.ClientDataDomain),e.next=43,v.modelManager.setItemDirty(P,!0,!0,en.ComponentRetrieved,r.uuid);case 43:b=!0,e.next=33;break;case 46:e.next=52;break;case 48:e.prev=48,e.t1=e.catch(31),w=!0,k=e.t1;case 52:e.prev=52,e.prev=53,b||null==x.return||x.return();case 55:if(e.prev=55,!w){e.next=58;break}throw k;case 58:return e.finish(55);case 59:return e.finish(52);case 60:v.syncService.sync().then((function(e){var t=Object.assign({},n);t.action=e&&e.error?"save-error":"save-success",v.replyToMessage(r,n,{error:e&&e.error}),v.handleMessage(r,t)}));case 61:case"end":return e.stop()}}),e,null,[[7,11,15,23],[16,,18,22],[31,48,52,60],[53,,55,59]])}))));case 34:case"end":return e.stop()}}),e,this,[[7,20,24,32],[25,,27,31]])}))),function(e,t){return h.apply(this,arguments)})},{key:"handleDuplicateItemMessage",value:function(e,t){var r=this,n=t.data.item,o=this.modelManager.findItem(n.uuid),a=[{name:ui,content_types:[o.content_type]}];this.runWithPermissions(e,a,ti(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.modelManager.duplicateItem({item:o});case 2:a=n.sent,r.syncService.sync(),r.replyToMessage(e,t,{item:r.jsonForItem(a,e)});case 5:case"end":return n.stop()}}),n)}))))}},{key:"handleCreateItemsMessage",value:function(e,r){var n=this,o=r.data.item?[r.data.item]:r.data.items,a=Xa()(o.map((function(e){return e.content_type}))),i=[{name:ui,content_types:a}];this.runWithPermissions(e,i,ti(regeneratorRuntime.mark((function a(){var i,s,u,c,l,p,f,y,h,v;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n.removePrivatePropertiesFromResponseItems(o,e,{incoming:!0}),i=[],s=!0,u=!1,c=void 0,a.prev=5,l=o[Symbol.iterator]();case 7:if(s=(p=l.next()).done){a.next=21;break}return f=p.value,y=oa({object:f,source:en.RemoteRetrieved}),h=zr(y),f.clientData&&h.setDomainDataItem(e.getClientDataKey(),f.clientData,t.ClientDataDomain),n.modelManager.addItem(h),a.next=15,n.modelManager.resolveReferencesForItem(h,!0);case 15:return a.next=17,n.modelManager.setItemDirty(h,!0);case 17:i.push(h);case 18:s=!0,a.next=7;break;case 21:a.next=27;break;case 23:a.prev=23,a.t0=a.catch(5),u=!0,c=a.t0;case 27:a.prev=27,a.prev=28,s||null==l.return||l.return();case 30:if(a.prev=30,!u){a.next=33;break}throw c;case 33:return a.finish(30);case 34:return a.finish(27);case 35:n.syncService.sync(),v=r.action===yi?{item:n.jsonForItem(i[0],e)}:{items:i.map((function(t){return n.jsonForItem(t,e)}))},n.replyToMessage(e,r,v);case 38:case"end":return a.stop()}}),a,null,[[5,23,27,35],[28,,30,34]])}))))}},{key:"handleDeleteItemsMessage",value:function(e,t){var r=this,n=Xa()(t.data.items.map((function(e){return e.content_type}))).sort(),o=[{name:ui,content_types:n}];this.runWithPermissions(e,o,ti(regeneratorRuntime.mark((function n(){var o,a,s,u,c,l,p,f,y,h,v;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=t.data.items,a=1===o.length?"item":"items",s=null,u=!0,n.next=6,r.alertService.confirm({text:"Are you sure you want to delete ".concat(o.length," ").concat(a,"?")}).catch((function(){u=!1}));case 6:if(!u){n.next=45;break}c=!0,l=!1,p=void 0,n.prev=10,f=o[Symbol.iterator]();case 12:if(c=(y=f.next()).done){n.next=27;break}if(h=y.value,v=r.modelManager.findItem(h.uuid)){n.next=18;break}return r.alertService.alert({text:"The item you are trying to delete cannot be found."}),n.abrupt("continue",24);case 18:if(![i.Component,i.Theme].includes(v.content_type)){n.next=21;break}return n.next=21,r.deactivateComponent(v,!0);case 21:return n.next=23,r.modelManager.setItemToBeDeleted(v);case 23:r.modelManager.notifyMappingObservers([v],en.RemoteSaved);case 24:c=!0,n.next=12;break;case 27:n.next=33;break;case 29:n.prev=29,n.t0=n.catch(10),l=!0,p=n.t0;case 33:n.prev=33,n.prev=34,c||null==f.return||f.return();case 36:if(n.prev=36,!l){n.next=39;break}throw p;case 39:return n.finish(36);case 40:return n.finish(33);case 41:r.syncService.sync(),s={deleted:!0},n.next=46;break;case 45:s={deleted:!1};case 46:r.replyToMessage(e,t,s);case 47:case"end":return n.stop()}}),n,null,[[10,29,33,41],[34,,36,40]])}))))}},{key:"handleRequestPermissionsMessage",value:function(e,t){var r=this;this.runWithPermissions(e,t.data.permissions,(function(){r.replyToMessage(e,t,{approved:!0})}))}},{key:"handleSetComponentDataMessage",value:function(e,t){var r=this;this.runWithPermissions(e,[],ti(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.componentData=t.data.componentData,n.next=3,r.modelManager.setItemDirty(e,!0);case 3:r.syncService.sync();case 4:case"end":return n.stop()}}),n)}))))}},{key:"handleToggleComponentMessage",value:function(e,t,r){this.toggleComponent(t)}},{key:"toggleComponent",value:(y=ti(regeneratorRuntime.mark((function e(t){var r,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.area!==gt){e.next=4;break}this.openModalComponent(t),e.next=18;break;case 4:if(!t.active){e.next=9;break}return e.next=7,this.deactivateComponent(t);case 7:e.next=18;break;case 9:if(t.content_type!==i.Theme){e.next=16;break}return r=this.getActiveThemes(),e.next=13,this.activateComponent(t);case 13:t.isLayerable()||setTimeout(ti(regeneratorRuntime.mark((function e(){var t,o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,o=!1,a=void 0,e.prev=3,i=r[Symbol.iterator]();case 5:if(t=(s=i.next()).done){e.next=13;break}if(!(u=s.value)||u.isLayerable()){e.next=10;break}return e.next=10,n.deactivateComponent(u);case 10:t=!0,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),o=!0,a=e.t0;case 19:e.prev=19,e.prev=20,t||null==i.return||i.return();case 22:if(e.prev=22,!o){e.next=25;break}throw a;case 25:return e.finish(22);case 26:return e.finish(19);case 27:case"end":return e.stop()}}),e,null,[[3,15,19,27],[20,,22,26]])}))),10),e.next=18;break;case 16:return e.next=18,this.activateComponent(t);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"handleInstallLocalComponentMessage",value:function(e,t){if(this.isNativeExtension(e)){var r=this.modelManager.findItem(t.data.uuid);this.desktopManager.installComponent(r)}}},{key:"runWithPermissions",value:function(e,t,r){e.permissions||(e.permissions=[]),t=Object(o.a)(t);var n=e.permissions,a=!0,i=!1,s=void 0;try{for(var u,c=function(){var e=u.value,r=n.find((function(t){return t.name===e.name}));if(!r)return"continue";var o=e.content_types;if(!o)return Pt()(t,e),"continue";var a=!0,i=!1,s=void 0;try{for(var c,l=r.content_types[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var p=c.value;Pt()(o,p)}}catch(e){i=!0,s=e}finally{try{a||null==l.return||l.return()}finally{if(i)throw s}}0===o.length&&Pt()(t,e)},l=t.slice()[Symbol.iterator]();!(a=(u=l.next()).done);a=!0)c()}catch(e){i=!0,s=e}finally{try{a||null==l.return||l.return()}finally{if(i)throw s}}t.length>0?this.promptForPermissions(e,t,(function(e){e&&r()})):r()}},{key:"promptForPermissions",value:function(e,t,r){var n=this,o={};o.component=e,o.permissions=t,o.permissionsString=this.permissionsStringForPermissions(t,e),o.actionBlock=r,o.callback=function(){var r=ti(regeneratorRuntime.mark((function r(a){var i,s,u,c,l,p;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!a){r.next=24;break}for(i=!0,s=!1,u=void 0,r.prev=4,c=function(){var t=p.value,r=e.permissions.find((function(e){return e.name===t.name}));if(r){var n=r.content_types||[];r.content_types=Xa()(n.concat(t.content_types))}else e.permissions.push(t)},l=t[Symbol.iterator]();!(i=(p=l.next()).done);i=!0)c();r.next=13;break;case 9:r.prev=9,r.t0=r.catch(4),s=!0,u=r.t0;case 13:r.prev=13,r.prev=14,i||null==l.return||l.return();case 16:if(r.prev=16,!s){r.next=19;break}throw u;case 19:return r.finish(16);case 20:return r.finish(13);case 21:return r.next=23,n.modelManager.setItemDirty(e,!0);case 23:n.syncService.sync();case 24:n.permissionDialogs=n.permissionDialogs.filter((function(r){return r===o?(r.actionBlock&&r.actionBlock(a),!1):!!(r.component!==e||r.permissions!==t&&(n=t,r.permissions.some((function(e){return!n.find((function(t){return JSON.stringify(t)===JSON.stringify(e)}))}))))||(a&&r.actionBlock&&r.actionBlock(a),!1);var n})),n.permissionDialogs.length>0&&n.presentPermissionsDialog(n.permissionDialogs[0]);case 26:case"end":return r.stop()}}),r,null,[[4,9,13,21],[14,,16,20]])})));return function(e){return r.apply(this,arguments)}}();var a=St()(this.permissionDialogs,{component:e});this.permissionDialogs.push(o),a?this.log("Existing dialog, not presenting."):this.presentPermissionsDialog(o)}},{key:"presentPermissionsDialog",value:function(e){throw"Must override SNComponentManager.presentPermissionsDialog"}},{key:"openModalComponent",value:function(e){throw"Must override SNComponentManager.presentPermissionsDialog"}},{key:"registerHandler",value:function(e){this.handlers.push(e)}},{key:"deregisterHandler",value:function(e){var t=St()(this.handlers,{identifier:e});t?this.handlers.splice(this.handlers.indexOf(t),1):this.log("Attempting to deregister non-existing handler")}},{key:"registerComponentWindow",value:(f=ti(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.window===r&&this.log("Web|componentManager","attempting to re-register same component window."),this.log("Web|componentManager|registerComponentWindow",t),t.window=r,e.next=5,L.GenerateUuid();case 5:t.sessionKey=e.sent,this.sendMessageToComponent(t,{action:ki,sessionKey:t.sessionKey,componentData:t.componentData,data:{uuid:t.uuid,environment:(a=this.environment,i=void 0,(P(i={},O.Web,"web"),P(i,O.Desktop,"desktop"),P(i,O.Mobile,"mobile"),i)[a]),platform:(n=this.platform,o=void 0,(P(o={},_.MacWeb,"mac-web"),P(o,_.MacDesktop,"mac-desktop"),P(o,_.LinuxWeb,"linux-web"),P(o,_.LinuxDesktop,"linux-desktop"),P(o,_.WindowsWeb,"windows-web"),P(o,_.WindowsDesktop,"windows-desktop"),P(o,_.Ios,"ios"),P(o,_.Android,"android"),o)[n]),activeThemeUrls:this.urlsForActiveThemes()}}),this.postActiveThemesToComponent(t),this.desktopManager&&this.desktopManager.notifyComponentActivation(t);case 9:case"end":return e.stop()}var n,o,a,i}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"activateComponent",value:(p=ti(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=l.length>1&&void 0!==l[1]&&l[1],n=!0!==t.active,t.active=!0,o=!0,a=!1,i=void 0,e.prev=6,s=this.handlers[Symbol.iterator]();!(o=(u=s.next()).done);o=!0)((c=u.value).areas.includes(t.area)||c.areas.includes("*"))&&c.activationHandler&&c.activationHandler(t);e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),a=!0,i=e.t0;case 14:e.prev=14,e.prev=15,o||null==s.return||s.return();case 17:if(e.prev=17,!a){e.next=20;break}throw i;case 20:return e.finish(17);case 21:return e.finish(14);case 22:if(!n||r){e.next=26;break}return e.next=25,this.modelManager.setItemDirty(t,!0);case 25:this.syncService.sync();case 26:this.activeComponents.includes(t)||this.activeComponents.push(t),t.area===ht&&this.postActiveThemesToAllComponents();case 28:case"end":return e.stop()}}),e,this,[[6,10,14,22],[15,,17,21]])}))),function(e){return p.apply(this,arguments)})},{key:"deactivateComponent",value:(l=ti(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=l.length>1&&void 0!==l[1]&&l[1],n=!1!==t.active,t.active=!1,t.sessionKey=null,o=!0,a=!1,i=void 0,e.prev=7,s=this.handlers[Symbol.iterator]();!(o=(u=s.next()).done);o=!0)((c=u.value).areas.includes(t.area)||c.areas.includes("*"))&&c.activationHandler&&c.activationHandler(t);e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),a=!0,i=e.t0;case 15:e.prev=15,e.prev=16,o||null==s.return||s.return();case 18:if(e.prev=18,!a){e.next=21;break}throw i;case 21:return e.finish(18);case 22:return e.finish(15);case 23:if(!n||r){e.next=27;break}return e.next=26,this.modelManager.setItemDirty(t,!0);case 26:this.syncService.sync();case 27:Pt()(this.activeComponents,t),this.streamObservers=this.streamObservers.filter((function(e){return e.component!==t})),this.contextStreamObservers=this.contextStreamObservers.filter((function(e){return e.component!==t})),t.area===ht&&this.postActiveThemesToAllComponents();case 31:case"end":return e.stop()}}),e,this,[[7,11,15,23],[16,,18,22]])}))),function(e){return l.apply(this,arguments)})},{key:"reloadComponent",value:(c=ti(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t.active=!1,r=!0,n=!1,o=void 0,e.prev=4,a=this.handlers[Symbol.iterator]();!(r=(i=a.next()).done);r=!0)((s=i.value).areas.includes(t.area)||s.areas.includes("*"))&&s.activationHandler&&s.activationHandler(t);e.next=12;break;case 8:e.prev=8,e.t0=e.catch(4),n=!0,o=e.t0;case 12:e.prev=12,e.prev=13,r||null==a.return||a.return();case 15:if(e.prev=15,!n){e.next=18;break}throw o;case 18:return e.finish(15);case 19:return e.finish(12);case 20:return this.streamObservers=this.streamObservers.filter((function(e){return e.component!==t})),this.contextStreamObservers=this.contextStreamObservers.filter((function(e){return e.component!==t})),t.area===ht&&this.postActiveThemesToAllComponents(),e.abrupt("return",new Promise((function(e,r){u.timeout((function(){t.active=!0;var r=!0,n=!1,o=void 0;try{for(var a,i=u.handlers[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value;(s.areas.includes(t.area)||s.areas.includes("*"))&&(s.activationHandler&&s.activationHandler(t),e())}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}u.activeComponents.includes(t)||u.activeComponents.push(t),t.area===ht&&u.postActiveThemesToAllComponents(),e()}))})));case 24:case"end":return e.stop()}}),e,this,[[4,8,12,20],[13,,15,19]])}))),function(e){return c.apply(this,arguments)})},{key:"deleteComponent",value:(u=ti(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modelManager.setItemToBeDeleted(t);case 2:this.syncService.sync();case 3:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"isComponentActive",value:function(e){return e.active}},{key:"iframeForComponent",value:function(e){for(var t=0,r=Array.from(document.getElementsByTagName("iframe"));t<r.length;t++){var n=r[t];if(n.dataset.componentId===e.uuid)return n}}},{key:"focusChangedForComponent",value:function(e){var t=document.activeElement===this.iframeForComponent(e),r=!0,n=!1,o=void 0;try{for(var a,i=this.handlers[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value;s.focusHandler&&s.focusHandler(e,t)}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}}},{key:"handleSetSizeEvent",value:function(e,t){var r=function(e,r){var n=Object(o.n)(r.width)?r.width:"".concat(t.width,"px"),a=Object(o.n)(r.height)?r.height:"".concat(t.height,"px");e&&e.setAttribute("style","width:".concat(n,"; height:").concat(a,";"))};if(e.area===mt||e.area===gt){var n=e.area===mt?"inner":"outer",a=document.getElementById("component-content-".concat(n,"-").concat(e.uuid));a&&r(a,t)}else{var i=this.iframeForComponent(e);if(!i)return;if(r(i,t),e.area===vt){var s=i.parentElement;s&&r(s,t)}}}},{key:"editorForNote",value:function(e){var t=this.componentsForArea(yt),r=!0,n=!1,o=void 0;try{for(var a,i=t[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value;if(s.isExplicitlyEnabledForItem(e))return s}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}if(this.isMobile){if(!e.content.mobilePrefersPlainEditor)return this.getDefaultEditor()}else if(!e.getAppDataItem("prefersPlainEditor"))return t.filter((function(e){return e.isDefaultEditor()}))[0]}},{key:"permissionsStringForPermissions",value:function(e,t){var r="",n=e.length,o=function(e,t){return e>0?e===t-1?2===t?" and ":", and ":", ":""};return e.forEach((function(e,s){if(e.name===ui){for(var u=e.content_types.map((function(e){var t,r,n=(t=e,(r={},a(r,i.Note,"note"),a(r,i.Tag,"tag"),a(r,i.SmartTag,"smart tag"),a(r,i.ActionsExtension,"action-based extension"),a(r,i.Component,"component"),a(r,i.Editor,"editor"),a(r,i.Theme,"theme"),a(r,i.ServerExtension,"server extension"),a(r,i.Mfa,"two-factor authentication setting"),a(r,i.FilesafeCredentials,"FileSafe credential"),a(r,i.FilesafeFileMetadata,"FileSafe file"),a(r,i.FilesafeIntegration,"FileSafe integration"),r)[t]);return n?n+"s":"items of type "+e})),c="",l=0;l<u.length;l++){var p=u[l];c+=o(l,u.length+n-s-1),c+=p}r+=o(s,n),r+=c,u.length>=2&&s<n-1&&(r+=", ")}else if(e.name===ci){var f,y=(si(f={},vt,"working note"),si(f,dt,"working note"),si(f,yt,"working note"),f);r+=o(s,n),r+=y[t.area]}})),r+"."}},{key:"components",get:function(){return this.modelManager.getItems([i.Component,i.Theme])}}])&&ri(r.prototype,n),s&&ri(r,s),t}(ya);function Pi(e){return(Pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Oi(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function _i(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Oi(a,n,o,i,s,"next",e)}function s(e){Oi(a,n,o,i,s,"throw",e)}i(void 0)}))}}function ji(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ii(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Di(e,t){return!t||"object"!==Pi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ci(e){return(Ci=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ei(e,t){return(Ei=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ai=function(e){function t(){return ji(this,t),Di(this,Ci(t).apply(this,arguments))}var r,n,a,i,s,u,c,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ei(e,t)}(t,e),r=t,(n=[{key:"getAbsolute",value:(l=_i(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.url,n=t.params,o=t.authentication,e.abrupt("return",this.runHttp({verb:"get",url:r,params:n,authentication:o}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"postAbsolute",value:(c=_i(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.url,n=t.params,o=t.authentication,e.abrupt("return",this.runHttp({verb:"post",url:r,params:n,authentication:o}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"patchAbsolute",value:(u=_i(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.url,n=t.params,o=t.authentication,e.abrupt("return",this.runHttp({verb:"patch",url:r,params:n,authentication:o}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"runHttp",value:(s=_i(regeneratorRuntime.mark((function e(t){var r,n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.verb,n=t.url,o=t.params,a=t.authentication,i=this.createRequest({verb:r,url:n,params:o,authentication:a}),e.abrupt("return",this.runRequest({request:i,verb:r,params:o}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"createRequest",value:function(e){var t=e.verb,r=e.url,n=e.params,o=e.authentication,a=new XMLHttpRequest;return"get"===t&&Object.keys(n).length>0&&(r=this.urlForUrlAndParams(r,n)),a.open(t,r,!0),a.setRequestHeader("Content-type","application/json"),o&&a.setRequestHeader("Authorization","Bearer "+o),a}},{key:"runRequest",value:(i=_i(regeneratorRuntime.mark((function e(t){var r,n,o,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.request,n=t.verb,o=t.params,e.abrupt("return",new Promise((function(e,t){r.onreadystatechange=function(){a.stateChangeHandlerForRequest(r,e,t)},"post"===n||"patch"===n?r.send(JSON.stringify(o)):r.send()})));case 2:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"stateChangeHandlerForRequest",value:function(e,t,r){if(4===e.readyState){var n=e.responseText;if(n)try{n=JSON.parse(n)}catch(e){}Object(o.m)(n)||(n={});var a=e.status;a>=200&&a<=299?(n.status=a,t(n)):(console.error("Request error:",n),Object(o.n)(n)&&(n={error:{message:n}}),n.error||(n.error={status:a}),n.status=a,r(n))}}},{key:"urlForUrlAndParams",value:function(e,t){var r=Object.keys(t).map((function(e){return e+"="+encodeURIComponent(t[e])})).join("&");return e.includes("?")?e+"&"+r:e+"?"+r}}])&&Ii(r.prototype,n),a&&Ii(r,a),t}(ya),Ti=r(52),Mi=r.n(Ti);function Ki(e){return(Ki="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Li(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Ni(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Li(a,n,o,i,s,"next",e)}function s(e){Li(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Ui(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Bi(e,t){return!t||"object"!==Ki(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Vi(e,t,r){return(Vi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Hi(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Hi(e){return(Hi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Wi(e,t){return(Wi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var zi=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Bi(this,Hi(t).call(this))).mappingObservers=[],e.creationObservers=[],e.items=[],e.itemsKeys=[],e.notes=[],e.tags=[],e.components=[],e.itemsHash={},e.resolveQueue={},e.masterCollection=new c,e.systemSmartTags=Or.systemSmartTags(),e}var r,n,a,s,u,l,p,f,h,v,d,m,g,b,w,k,x,S,R,P,O,_,j,I,D,C,E,A;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wi(e,t)}(t,e),r=t,(n=[{key:"getMasterCollection",value:function(){return this.masterCollection}},{key:"deinit",value:function(){Vi(Hi(t.prototype),"deinit",this).call(this),this.resetState()}},{key:"resetState",value:function(){this.items.length=0,this.itemsKeys.length=0,this.notes.length=0,this.tags.length=0,this.components.length=0,this.itemsHash={},this.resolveQueue={},this.masterCollection=new c}},{key:"setItemProperties",value:(A=Ni(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.item,n=t.properties,e.abrupt("return",this.setItemsProperties({items:[r],properties:n}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"setItemsProperties",value:(E=Ni(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c,l,p,f,y,h,v,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.items,n=t.properties,o=Object.keys(n),a=!0,i=!1,s=void 0,e.prev=5,u=r[Symbol.iterator]();case 7:if(a=(c=u.next()).done){e.next=31;break}for(l=c.value,p=!0,f=!1,y=void 0,e.prev=12,h=o[Symbol.iterator]();!(p=(v=h.next()).done);p=!0)d=v.value,l[d]=n[d];e.next=20;break;case 16:e.prev=16,e.t0=e.catch(12),f=!0,y=e.t0;case 20:e.prev=20,e.prev=21,p||null==h.return||h.return();case 23:if(e.prev=23,!f){e.next=26;break}throw y;case 26:return e.finish(23);case 27:return e.finish(20);case 28:a=!0,e.next=7;break;case 31:e.next=37;break;case 33:e.prev=33,e.t1=e.catch(5),i=!0,s=e.t1;case 37:e.prev=37,e.prev=38,a||null==u.return||u.return();case 40:if(e.prev=40,!i){e.next=43;break}throw s;case 43:return e.finish(40);case 44:return e.finish(37);case 45:return e.next=47,this.mapItems({items:r});case 47:case"end":return e.stop()}}),e,this,[[5,33,37,45],[12,16,20,28],[21,,23,27],[38,,40,44]])}))),function(e){return E.apply(this,arguments)})},{key:"modifyItem",value:(C=Ni(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.item,n=t.modifier,e.abrupt("return",this.modifyItems({items:[r],modifier:n}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"modifyItems",value:(D=Ni(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.items,n=t.modifier,e.next=3,n();case 3:return e.next=5,this.setItemsDirty(r,!0);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"mapCollectionToLocalItems",value:(I=Ni(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.collection,n=t.sourceKey,e.abrupt("return",this.mapPayloadsToLocalItems({payloads:r.allPayloads,source:r.source,sourceKey:n}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"mapItem",value:(j=Ni(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.item,n=t.source,o=t.sourceKey,e.next=3,this.mapItems({items:[r],source:n,sourceKey:o});case 3:return a=e.sent,e.abrupt("return",a[0]);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"mapItems",value:(_=Ni(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.items,n=t.source,o=t.sourceKey,a=r.map((function(e){return e.payloadRepresentation()})),e.abrupt("return",this.mapPayloadsToLocalItems({payloads:a,source:n,sourceKey:o}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"mapPayloadToLocalItem",value:(O=Ni(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payload,e.next=3,this.mapPayloadsToLocalItems({payloads:[r]});case 3:return n=e.sent,e.abrupt("return",n[0]);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"mapPayloadsToLocalItems",value:(P=Ni(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,l,p,f,y,h,v,d,m,g,b,w,k,x,S,R,P,O,_,j,I,D,C;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.payloads,n=t.source,o=t.sourceKey,a=[],i=[],s={},u=!0,l=!1,p=void 0,e.prev=7,f=r[Symbol.iterator]();case 9:if(u=(y=f.next()).done){e.next=40;break}if(h=y.value){e.next=14;break}return console.error("Payload is null"),e.abrupt("continue",37);case 14:if(h.isPayload){e.next=16;break}throw"Attempting to map non-payload object into local model.";case 16:if(h.content_type&&h.uuid||h.deleted){e.next=20;break}return console.error("Payload is corrupt:",h),e.abrupt("continue",37);case 20:if(v=this.findItem(h.uuid),d=!1,!0!==h.deleted){e.next=34;break}if(!h.dirty){e.next=28;break}d=!0,v&&(this.removeItemFromRespectiveArray(v),v.updateLocalRelationships()),e.next=34;break;case 28:if(!v){e.next=33;break}return e.next=31,this.removeItemLocally(v);case 31:e.next=34;break;case 33:return e.abrupt("continue",37);case 34:v?v.updateFromPayload(h):(v=zr(h),this.insertItems({items:[v],globalOnly:d}),i.push(v)),v.errorDecrypting||a.push(v),s[v.uuid]={item:v,payload:h};case 37:u=!0,e.next=9;break;case 40:e.next=46;break;case 42:e.prev=42,e.t0=e.catch(7),l=!0,p=e.t0;case 46:e.prev=46,e.prev=47,u||null==f.return||f.return();case 49:if(e.prev=49,!l){e.next=52;break}throw p;case 52:return e.finish(49);case 53:return e.finish(46);case 54:m=[],g=[],b=0,w=Object.keys(s);case 57:if(!(b<w.length)){e.next=89;break}if(k=w[b],x=s[k],S=x.item,R=x.payload,m.push(R),g.push(S),!R.content){e.next=65;break}return e.next=65,this.resolveReferencesForItem(S);case 65:for(P=this.popItemsInterestedInMissingItem({item:S}),O=!0,_=!1,j=void 0,e.prev=69,I=P[Symbol.iterator]();!(O=(D=I.next()).done);O=!0)D.value.addItemAsRelationship(S);e.next=77;break;case 73:e.prev=73,e.t1=e.catch(69),_=!0,j=e.t1;case 77:e.prev=77,e.prev=78,O||null==I.return||I.return();case 80:if(e.prev=80,!_){e.next=83;break}throw j;case 83:return e.finish(80);case 84:return e.finish(77);case 85:S.didCompleteMapping(n);case 86:b++,e.next=57;break;case 89:if(C=new c({payloads:g.map((function(e){return e.payloadRepresentation()})),source:n}),this.masterCollection=this.masterCollection.concat(C),!(i.length>0)){e.next=94;break}return e.next=94,this.notifyCreationObservers(i,n,o);case 94:return e.next=96,this.notifyMappingObservers(a,n,o);case 96:return e.abrupt("return",g);case 97:case"end":return e.stop()}}),e,this,[[7,42,46,54],[47,,49,53],[69,73,77,85],[78,,80,84]])}))),function(e){return P.apply(this,arguments)})},{key:"insertItem",value:function(e){var t=e.item;this.insertItems({items:[t]})}},{key:"insertItems",value:function(e){var t=e.items,r=e.globalOnly,n=!0,o=!1,a=void 0;try{for(var s,u=t[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var c=s.value;if(!this.itemsHash[c.uuid]&&(this.itemsHash[c.uuid]=c,this.items.push(c),!r))if(c.content_type===i.ItemsKey)this.itemsKeys.unshift(c);else if(c.content_type===i.Tag){var l=Mi()(this.tags,c,(function(e){return e.title?e.title.toLowerCase():""}));this.tags.splice(l,0,c)}else c.content_type===i.Note?this.notes.unshift(c):c.content_type===i.Component&&this.components.unshift(c)}}catch(e){o=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw a}}}},{key:"addItem",value:(R=Ni(regeneratorRuntime.mark((function e(t){var r,n=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]&&n[1],e.abrupt("return",this.addItems([t],r));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"addItems",value:(S=Ni(regeneratorRuntime.mark((function e(t){var r,n=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.length>1&&void 0!==n[1]&&n[1],console.warn("ModelManager.addItems is depracated. Use mapPayloadsToLocalItems instead."),r=t.map((function(e){return ra({object:e})})),e.next=5,this.mapPayloadsToLocalItems({payloads:r});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"resolveRelationshipWhenItemAvailable",value:function(e){var t=e.interestedItem,r=e.missingItemId,n=this.resolveQueue[r]||[];n.push(t),this.resolveQueue[r]=n}},{key:"popItemsInterestedInMissingItem",value:function(e){var t=e.item,r=this.resolveQueue[t.uuid];return delete this.resolveQueue[t.uuid],r||[]}},{key:"resolveReferencesForItem",value:(x=Ni(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c,l,p,f,y,h,v,d,m=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m.length>1&&void 0!==m[1]&&m[1],!t.errorDecrypting){e.next=3;break}return e.abrupt("return");case 3:if(n=t.content,t.updateLocalRelationships(),n.references&&!t.deleted){e.next=7;break}return e.abrupt("return");case 7:o=n.references.slice(),a=o.map((function(e){return e.uuid})),i=!0,s=this.findItems(a,i),u=!0,c=!1,l=void 0,e.prev=14,p=s.entries()[Symbol.iterator]();case 16:if(u=(f=p.next()).done){e.next=30;break}if(y=Fi(f.value,2),h=y[0],!(v=y[1])){e.next=25;break}if(t.addItemAsRelationship(v),!r){e.next=23;break}return e.next=23,this.setItemDirty(v,!0);case 23:e.next=27;break;case 25:d=a[h],this.resolveRelationshipWhenItemAvailable({interestedItem:t,missingItemId:d});case 27:u=!0,e.next=16;break;case 30:e.next=36;break;case 32:e.prev=32,e.t0=e.catch(14),c=!0,l=e.t0;case 36:e.prev=36,e.prev=37,u||null==p.return||p.return();case 39:if(e.prev=39,!c){e.next=42;break}throw l;case 42:return e.finish(39);case 43:return e.finish(36);case 44:case"end":return e.stop()}}),e,this,[[14,32,36,44],[37,,39,43]])}))),function(e){return x.apply(this,arguments)})},{key:"addCreationObserver",value:function(e){var t=this;return this.creationObservers.push(e),function(){_t()(t.creationObservers,e)}}},{key:"notifyCreationObservers",value:(k=Ni(regeneratorRuntime.mark((function e(t,r,n){var o,a,i,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=!0,a=!1,i=void 0,e.prev=3,s=this.creationObservers[Symbol.iterator]();case 5:if(o=(u=s.next()).done){e.next=12;break}return c=u.value,e.next=9,c.callback({items:t,source:r,sourceKey:n});case 9:o=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),a=!0,i=e.t0;case 18:e.prev=18,e.prev=19,o||null==s.return||s.return();case 21:if(e.prev=21,!a){e.next=24;break}throw i;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))),function(e,t,r){return k.apply(this,arguments)})},{key:"addMappingObserver",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Array.isArray(e)||(e=[e]);var o={types:e,priority:n,callback:t};return this.mappingObservers.push(o),function(){Pt()(r.mappingObservers,o)}}},{key:"notifyMappingObservers",value:(w=Ni(regeneratorRuntime.mark((function e(t,r,n){var o,a,i,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=this.mappingObservers.sort((function(e,t){return e.priority<t.priority?-1:1})),a=!0,i=!1,s=void 0,e.prev=4,u=regeneratorRuntime.mark((function e(){var o,a,i,s,u,c,p,f,y,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=l.value,a=o.types.includes("*")?t:t.filter((function(e){return o.types.includes(e.content_type)})),i=[],s=[],u=!0,c=!1,p=void 0,e.prev=7,f=a[Symbol.iterator]();!(u=(y=f.next()).done);u=!0)(h=y.value).deleted?s.push(h):i.push(h);e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),c=!0,p=e.t0;case 15:e.prev=15,e.prev=16,u||null==f.return||f.return();case 18:if(e.prev=18,!c){e.next=21;break}throw p;case 21:return e.finish(18);case 22:return e.finish(15);case 23:if(!(a.length>0)){e.next=26;break}return e.next=26,o.callback(a,i,s,r,n);case 26:case"end":return e.stop()}}),e,null,[[7,11,15,23],[16,,18,22]])})),c=o[Symbol.iterator]();case 7:if(a=(l=c.next()).done){e.next=12;break}return e.delegateYield(u(),"t0",9);case 9:a=!0,e.next=7;break;case 12:e.next=18;break;case 14:e.prev=14,e.t1=e.catch(4),i=!0,s=e.t1;case 18:e.prev=18,e.prev=19,a||null==c.return||c.return();case 21:if(e.prev=21,!i){e.next=24;break}throw s;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[4,14,18,26],[19,,21,25]])}))),function(e,t,r){return w.apply(this,arguments)})},{key:"setItemDirty",value:(b=Ni(regeneratorRuntime.mark((function e(t){var r,n,o,a,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(s.length>1&&void 0!==s[1])||s[1],n=s.length>2?s[2]:void 0,o=s.length>3?s[3]:void 0,a=s.length>4?s[4]:void 0,t.content_type===i.Tag&&this.reorderTagLocation(t),e.abrupt("return",this.setItemsDirty([t],r,n,o,a));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"setItemsDirty",value:(g=Ni(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c,l,p,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!(f.length>1&&void 0!==f[1])||f[1],n=f.length>2?f[2]:void 0,o=f.length>3?f[3]:void 0,a=f.length>4?f[4]:void 0,i=!0,s=!1,u=void 0,e.prev=7,c=t[Symbol.iterator]();case 9:if(i=(l=c.next()).done){e.next=17;break}if((p=l.value).isItem){e.next=13;break}throw"Attempting to dirty non-item object.";case 13:p.setDirty({dirty:r,updateClientDate:n,authorized:!0});case 14:i=!0,e.next=9;break;case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(7),s=!0,u=e.t0;case 23:e.prev=23,e.prev=24,i||null==c.return||c.return();case 26:if(e.prev=26,!s){e.next=29;break}throw u;case 29:return e.finish(26);case 30:return e.finish(23);case 31:return e.abrupt("return",this.mapItems({items:t,source:o||en.LocalDirtied,sourceKey:a}));case 32:case"end":return e.stop()}}),e,this,[[7,19,23,31],[24,,26,30]])}))),function(e){return g.apply(this,arguments)})},{key:"duplicateItem",value:(m=Ni(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.item,n=t.isConflict,r.isItem){e.next=3;break}throw"Attempting to duplicate non-item object.";case 3:return o=ra({object:r}),e.next=6,Jr({payload:o,baseCollection:this.getMasterCollection(),isConflict:n});case 6:return a=e.sent,e.next=9,this.mapPayloadsToLocalItems({payloads:a});case 9:return i=e.sent,s=i.find((function(e){return e.uuid===a[0].uuid})),e.abrupt("return",s);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"createItem",value:(d=Ni(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.contentType,n=t.content,o=t.add,a=t.needsSync,r){e.next=3;break}throw"Attempting to create item with no contentType";case 3:return e.t0=ra,e.next=6,L.GenerateUuid();case 6:if(e.t1=e.sent,e.t2=r,e.t3=n,e.t4={uuid:e.t1,content_type:e.t2,content:e.t3},e.t5={object:e.t4},i=(0,e.t0)(e.t5),s=zr(i),!o){e.next=20;break}if(this.insertItem({item:s}),!a){e.next=18;break}return e.next=18,this.setItemDirty(s);case 18:return e.next=20,this.notifyCreationObservers([s]);case 20:return e.abrupt("return",s);case 21:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getDirtyItems",value:function(){return this.items.filter((function(e){return e.dirty&&!e.dummy&&(!e.errorDecrypting||e.deleted)}))}},{key:"setItemToBeDeleted",value:(v=Ni(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.deleted=!0,t.dummy){e.next=4;break}return e.next=4,this.setItemDirty(t,!0);case 4:return e.next=6,this.handleReferencesForItemDeletion(t);case 6:this.removeItemFromRespectiveArray(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"setItemsToBeDeleted",value:(h=Ni(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!0,n=!1,o=void 0,e.prev=3,a=t[Symbol.iterator]();case 5:if(r=(i=a.next()).done){e.next=12;break}return s=i.value,e.next=9,this.setItemToBeDeleted(s);case 9:r=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,o=e.t0;case 18:e.prev=18,e.prev=19,r||null==a.return||a.return();case 21:if(e.prev=21,!n){e.next=24;break}throw o;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))),function(e){return h.apply(this,arguments)})},{key:"handleReferencesForItemDeletion",value:(f=Ni(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c,l,p,f,y,h,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.errorDecrypting){e.next=32;break}r=!0,n=!1,o=void 0,e.prev=4,a=t.content.references[Symbol.iterator]();case 6:if(r=(i=a.next()).done){e.next=18;break}if(s=i.value,!(u=this.findItem(s.uuid))){e.next=15;break}if(t.removeItemAsRelationship(u),!u.hasRelationshipWithItem(t)){e.next=15;break}return u.removeItemAsRelationship(t),e.next=15,this.setItemDirty(u,!0);case 15:r=!0,e.next=6;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(4),n=!0,o=e.t0;case 24:e.prev=24,e.prev=25,r||null==a.return||a.return();case 27:if(e.prev=27,!n){e.next=30;break}throw o;case 30:return e.finish(27);case 31:return e.finish(24);case 32:c=t.allReferencingItems,l=!0,p=!1,f=void 0,e.prev=36,y=c[Symbol.iterator]();case 38:if(l=(h=y.next()).done){e.next=46;break}return(v=h.value).removeItemAsRelationship(t),e.next=43,this.setItemDirty(v,!0);case 43:l=!0,e.next=38;break;case 46:e.next=52;break;case 48:e.prev=48,e.t1=e.catch(36),p=!0,f=e.t1;case 52:e.prev=52,e.prev=53,l||null==y.return||y.return();case 55:if(e.prev=55,!p){e.next=58;break}throw f;case 58:return e.finish(55);case 59:return e.finish(52);case 60:t.resetLocalReferencePointers();case 61:case"end":return e.stop()}}),e,this,[[4,20,24,32],[25,,27,31],[36,48,52,60],[53,,55,59]])}))),function(e){return f.apply(this,arguments)})},{key:"removeItemLocally",value:(p=Ni(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_t()(this.items,{uuid:t.uuid}),delete this.itemsHash[t.uuid],this.removeItemFromRespectiveArray(t),t.isBeingRemovedLocally();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"removeItemFromRespectiveArray",value:function(e){e.content_type===i.Tag?_t()(this.tags,{uuid:e.uuid}):e.content_type===i.Note?_t()(this.notes,{uuid:e.uuid}):e.content_type===i.Component?_t()(this.components,{uuid:e.uuid}):e.content_type===i.ItemsKey&&_t()(this.itemsKeys,{uuid:e.uuid})}},{key:"getItems",value:function(e){return Array.isArray(e)?this.allItems.filter((function(t){return!t.dummy&&(e.includes(t.content_type)||e.includes("*"))})):this.managedItemsForContentType(e)||this.getItems([e])}},{key:"managedItemsForContentType",value:function(e){return e===i.Note?this.notes:e===i.Component?this.components:e===i.Tag?this.tags:null}},{key:"invalidItems",value:function(){return this.allItems.filter((function(e){return e.errorDecrypting}))}},{key:"validItemsForContentType",value:function(e){return(this.managedItemsForContentType(e)||this.allItems).filter((function(t){return!t.errorDecrypting&&(Array.isArray(e)?e.includes(t.content_type):t.content_type===e)}))}},{key:"findItem",value:function(e){return this.itemsHash[e]}},{key:"findItems",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var u=i.value,c=this.itemsHash[u];(c||t)&&r.push(c)}}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}},{key:"itemsMatchingPredicate",value:function(e){return this.itemsMatchingPredicates([e])}},{key:"itemsMatchingPredicates",value:function(e){return this.filterItemsWithPredicates(this.allItems,e)}},{key:"filterItemsWithPredicates",value:function(e,t){return e.filter((function(e){if(e.deleted)return!1;var r=!0,n=!1,o=void 0;try{for(var a,i=t[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value;if(!e.satisfiesPredicate(s))return!1}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}return!0}))}},{key:"importPayloads",value:(l=Ni(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,l,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ko({baseCollection:this.getMasterCollection(),applyCollection:new c({payloads:t,source:en.FileImport})}),e.next=3,r.resultingCollection();case 3:return n=e.sent,e.next=6,this.mapCollectionToLocalItems({collection:n});case 6:o=e.sent,a=!0,i=!1,s=void 0,e.prev=10,u=o[Symbol.iterator]();case 12:if(a=(l=u.next()).done){e.next=20;break}return p=l.value,e.next=16,this.setItemDirty(p,!0,!1);case 16:p.deleted=!1;case 17:a=!0,e.next=12;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(10),i=!0,s=e.t0;case 26:e.prev=26,e.prev=27,a||null==u.return||u.return();case 29:if(e.prev=29,!i){e.next=32;break}throw s;case 32:return e.finish(29);case 33:return e.finish(26);case 34:return e.abrupt("return",o);case 35:case"end":return e.stop()}}),e,this,[[10,22,26,34],[27,,29,33]])}))),function(e){return l.apply(this,arguments)})},{key:"noteCount",value:function(){return this.notes.filter((function(e){return!e.dummy})).length}},{key:"removeAllItemsFromMemory",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,o=this.items[Symbol.iterator]();!(e=(n=o.next()).done);e=!0)n.value.deleted=!0}catch(e){t=!0,r=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw r}}this.notifyMappingObservers(this.items),this.resetState()}},{key:"findTagByTitle",value:function(e){return Object(o.g)(this.tags,"title",e)}},{key:"findOrCreateTagByTitle",value:(u=Ni(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.findTagByTitle(t)){e.next=5;break}return e.next=4,this.createItem({contentType:"Tag",content:{title:t},add:!0,needsSync:!0});case 4:r=e.sent;case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"reorderTagLocation",value:function(e){Pt()(this.tags,e),this.tags.splice(Mi()(this.tags,e,(function(e){return e.title?e.title.toLowerCase():""})),0,e)}},{key:"notesMatchingSmartTag",value:function(e){var t=[new y("content_type","=","Note"),e.content.predicate];if(!e.content.isTrashTag){var r=new y("content.trashed","=",!1);t.push(r)}return this.itemsMatchingPredicates(t)}},{key:"trashSmartTag",value:function(){return this.systemSmartTags.find((function(e){return e.content.isTrashTag}))}},{key:"trashedItems",value:function(){return this.notesMatchingSmartTag(this.trashSmartTag())}},{key:"emptyTrash",value:(s=Ni(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.trashedItems(),e.abrupt("return",this.setItemsToBeDeleted(t));case 2:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"getSmartTags",value:function(){var e=this.validItemsForContentType(i.SmartTag).sort((function(e,t){return e.content.title<t.content.title?-1:1}));return this.systemSmartTags.concat(e)}},{key:"allItems",get:function(){return this.items.slice()}},{key:"allNondummyItems",get:function(){return this.items.filter((function(e){return!e.dummy}))}},{key:"nonDeletedItems",get:function(){return this.items.filter((function(e){return!e.dummy&&!e.deleted}))}}])&&Ui(r.prototype,n),a&&Ui(r,a),t}(ya);function qi(e){return(qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yi(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Ji(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Yi(a,n,o,i,s,"next",e)}function s(e){Yi(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Gi(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Qi(e,t){return!t||"object"!==qi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $i(e){return($i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xi(e,t){return(Xi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Zi=function(e){function t(e){var r,n=e.modelManager,o=e.syncService;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Qi(this,$i(t).call(this))).syncService=o,r.modelManager=n,r.addObservers(),r.resolveQueue=[],r.registeredPredicates=[],r}var r,n,a,i,s,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xi(e,t)}(t,e),r=t,(n=[{key:"popResolveQueue",value:function(){var e=this.resolveQueue.slice();return this.resolveQueue=[],e}},{key:"addObservers",value:function(){var e=this;this.modelManager.addCreationObserver({callback:function(t){var r=t.items;e.resolveQueue=e.resolveQueue.concat(r)}}),this.syncService.addEventObserver(function(){var t=Ji(regeneratorRuntime.mark((function t(r){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r!==h.DownloadFirstSyncCompleted&&r!==h.FullSyncCompleted){t.next=3;break}return t.next=3,e.resolveSingletonsForItems(e.popResolveQueue(),r);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"registerPredicate",value:function(e){this.registeredPredicates.push(e)}},{key:"validItemsMatchingPredicate",value:function(e){return this.modelManager.itemsMatchingPredicate(e).filter((function(e){return!e.deleted&&!e.errorDecrypting}))}},{key:"resolveSingletonsForItems",value:(u=Ji(regeneratorRuntime.mark((function e(t,r){var n,a,i,s,u,c,l,p,f,y,v,d=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=function(e){var t=!0,r=!1,n=void 0;try{for(var o,a=d.registeredPredicates[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var i=o.value;if(e.satisfiesPredicate(i))return d.validItemsMatchingPredicate(i)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}},a=function(e){return e.isSingleton?d.validItemsMatchingPredicate(e.singletonPredicate):null},i=function(e){var t=a(e);return t||n(e)},s=[],u=!0,c=!1,l=void 0,e.prev=7,p=t[Symbol.iterator]();case 9:if(u=(f=p.next()).done){e.next=22;break}if(y=f.value,!s.includes(y)){e.next=13;break}return e.abrupt("continue",19);case 13:if(v=i(y),Object(o.f)(s,v||[]),v&&!(v.length<=1)){e.next=17;break}return e.abrupt("continue",19);case 17:return e.next=19,this.handleStrategy({items:v,strategy:y.singletonStrategy});case 19:u=!0,e.next=9;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(7),c=!0,l=e.t0;case 28:e.prev=28,e.prev=29,u||null==p.return||p.return();case 31:if(e.prev=31,!c){e.next=34;break}throw l;case 34:return e.finish(31);case 35:return e.finish(28);case 36:s.length>0&&r===h.FullSyncCompleted&&setTimeout((function(){d.syncService.sync()}));case 37:case"end":return e.stop()}}),e,this,[[7,24,28,36],[29,,31,35]])}))),function(e,t){return u.apply(this,arguments)})},{key:"handleStrategy",value:(s=Ji(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.items,t.strategy===V){e.next=3;break}throw"Unhandled singleton strategy";case 3:return n=r.sort((function(e,t){return e.errorDecrypting?1:t.errorDecrypting||e.created_at<t.created_at?-1:1})),a=Object(o.c)(n,0),e.next=7,this.modelManager.setItemsToBeDeleted(a);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"findOrCreateSingleton",value:(i=Ji(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.predicate,n=t.createPayload,!((o=this.validItemsMatchingPredicate(r)).length>0)){e.next=4;break}return e.abrupt("return",o[0]);case 4:if(this.syncService.getLastSyncDate()){e.next=7;break}return e.next=7,this.syncService.sync();case 7:if(!((a=this.validItemsMatchingPredicate(r)).length>0)){e.next=10;break}return e.abrupt("return",a[0]);case 10:return i=this.modelManager.itemsMatchingPredicate(r).filter((function(e){return e.errorDecrypting})),e.next=13,this.modelManager.setItemsToBeDeleted(i);case 13:return e.t0=ia,e.t1=n,e.next=17,L.GenerateUuid();case 17:return e.t2=e.sent,e.t3={uuid:e.t2,dirty:!0},e.t4={payload:e.t1,override:e.t3},s=(0,e.t0)(e.t4),e.next=23,this.modelManager.mapPayloadToLocalItem({payload:s});case 23:return u=e.sent,e.next=26,this.syncService.sync();case 26:return e.abrupt("return",u);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})}])&&Gi(r.prototype,n),a&&Gi(r,a),t}(ya);function es(e){return(es="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ts(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function rs(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){ts(a,n,o,i,s,"next",e)}function s(e){ts(a,n,o,i,s,"throw",e)}i(void 0)}))}}function ns(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function os(e,t){return!t||"object"!==es(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function as(e){return(as=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function is(e,t){return(is=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ss=function(e){function t(e){var r,n=e.alertService,o=e.deviceInterface,a=e.httpService,i=e.modelManager,s=e.protocolService,u=e.syncService;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=os(this,as(t).call(this))).alertService=n,r.deviceInterface=o,r.httpService=a,r.modelManager=i,r.protocolService=s,r.syncService=u,r.previousPasswords=[],r}var r,n,o,a,s,u,c,l,p,f,y,h;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&is(e,t)}(t,e),r=t,(n=[{key:"getExtensions",value:function(){return this.modelManager.validItemsForContentType(i.ActionsExtension)}},{key:"extensionsInContextOfItem",value:function(e){return this.getExtensions().filter((function(t){return t.supported_types.includes(e.content_type)||t.actionsWithContextForItem(e).length>0}))}},{key:"loadExtensionInContextOfItem",value:(h=rs(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={content_type:r.content_type,item_uuid:r.uuid},e.abrupt("return",this.httpService.getAbsolute({url:t.url,params:n}).then((function(e){return e.description&&(t.description=e.description),e.supported_types&&(t.supported_types=e.supported_types),e.actions?t.actions=e.actions.map((function(e){return new Nt(e)})):t.actions=[],t})).catch((function(e){return console.error("Error loading extension",e),null})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"runAction",value:(y=rs(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.action,n=t.item,o=t.passwordRequestHandler,r.running=!0,e.t0=r.verb,e.next="get"===e.t0?5:"render"===e.t0?9:"show"===e.t0?13:"post"===e.t0?17:21;break;case 5:return e.next=7,this.handleGetAction({action:r,passwordRequestHandler:o});case 7:return a=e.sent,e.abrupt("break",22);case 9:return e.next=11,this.handleRenderAction({action:r,passwordRequestHandler:o});case 11:return a=e.sent,e.abrupt("break",22);case 13:return e.next=15,this.handleShowAction(r);case 15:return a=e.sent,e.abrupt("break",22);case 17:return e.next=19,this.handlePostAction(r,n);case 19:return a=e.sent,e.abrupt("break",22);case 21:return e.abrupt("break",22);case 22:return r.lastExecuted=new Date,r.running=!1,e.abrupt("return",a);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"handleGetAction",value:(f=rs(regeneratorRuntime.mark((function e(t){var r,n,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.action,n=t.passwordRequestHandler,e.abrupt("return",new Promise((function(e,t){o.alertService.confirm({text:"Are you sure you want to replace the current note contents with this action's results?",onConfirm:function(){o.runConfirmedGetAction({action:r,passwordRequestHandler:n}).then(e)}})})));case 2:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"runConfirmedGetAction",value:(p=rs(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c,l,p,f,y=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.action,n=t.passwordRequestHandler,e.next=3,this.httpService.getAbsolute({url:r.url}).catch((function(e){var t=e&&e.error||{message:"An issue occurred while processing this action. Please try again."};return y.alertService.alert({text:t.message}),r.error=!0,{error:t}}));case 3:if(!(o=e.sent).error){e.next=6;break}return e.abrupt("return",o);case 6:return r.error=!1,e.next=9,this.payloadByDecryptingResponse({response:o,passwordRequestHandler:n});case 9:return a=e.sent,e.next=12,this.modelManager.mapPayload({payload:a,source:en.RemoteActionRetrieved});case 12:for(i=e.sent,s=!0,u=!1,c=void 0,e.prev=16,l=i[Symbol.iterator]();!(s=(p=l.next()).done);s=!0)f=p.value,this.modelManager.setItemDirty(f,!0);e.next=24;break;case 20:e.prev=20,e.t0=e.catch(16),u=!0,c=e.t0;case 24:e.prev=24,e.prev=25,s||null==l.return||l.return();case 27:if(e.prev=27,!u){e.next=30;break}throw c;case 30:return e.finish(27);case 31:return e.finish(24);case 32:return this.syncService.sync(),e.abrupt("return",{response:o,item:o.item});case 34:case"end":return e.stop()}}),e,this,[[16,20,24,32],[25,,27,31]])}))),function(e){return p.apply(this,arguments)})},{key:"handleRenderAction",value:(l=rs(regeneratorRuntime.mark((function e(t){var r,n,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.action,n=t.passwordRequestHandler,e.abrupt("return",this.httpService.getAbsolute({url:r.url}).then(function(){var e=rs(regeneratorRuntime.mark((function e(t){var a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.error=!1,e.next=3,o.payloadByDecryptingResponse({response:t,passwordRequestHandler:n});case 3:if(!(a=e.sent)){e.next=7;break}return i=o.modelManager.mapPayload({payload:a}),e.abrupt("return",{response:t,item:i});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){var t=e&&e.error||{message:"An issue occurred while processing this action. Please try again."};return o.alertService.alert({text:t.message}),r.error=!0,{error:t}})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"payloadByDecryptingResponse",value:(c=rs(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c,l,p,f,y,h,v,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.response,n=t.key,o=t.passwordRequestHandler,a=ra({object:r.item}),e.next=4,this.protocolService.payloadByDecryptingPayload({payload:a,key:n});case 4:if((i=e.sent).errorDecrypting){e.next=7;break}return e.abrupt("return",i);case 7:if(r.auth_params){e.next=10;break}return this.alertService.alert({text:"We were unable to decrypt this revision using your current keys, \n            and this revision is missing metadata that would allow us to try different \n            keys to decrypt it. This can likely be fixed with some manual intervention. \n            Please email hello@standardnotes.org for assistance."}),e.abrupt("return",null);case 10:s=[],u=!0,c=!1,l=void 0,e.prev=14,p=this.previousPasswords[Symbol.iterator]();case 16:if(u=(f=p.next()).done){e.next=34;break}if(y=f.value,!s.includes(y)){e.next=20;break}return e.abrupt("continue",31);case 20:return s.push(y),e.next=23,this.protocolService.computeRootKey({password:y,keyParams:r.auth_params});case 23:if(h=e.sent){e.next=26;break}return e.abrupt("continue",31);case 26:return e.next=28,this.payloadByDecryptingResponse({response:r,key:h,passwordRequestHandler:o});case 28:if(!(v=e.sent)){e.next=31;break}return e.abrupt("return",v);case 31:u=!0,e.next=16;break;case 34:e.next=40;break;case 36:e.prev=36,e.t0=e.catch(14),c=!0,l=e.t0;case 40:e.prev=40,e.prev=41,u||null==p.return||p.return();case 43:if(e.prev=43,!c){e.next=46;break}throw l;case 46:return e.finish(43);case 47:return e.finish(40);case 48:return e.next=50,o();case 50:return d=e.sent,this.previousPasswords.push(d),e.abrupt("return",this.payloadByDecryptingResponse({response:r,key:n,passwordRequestHandler:o}));case 53:case"end":return e.stop()}}),e,this,[[14,36,40,48],[41,,43,47]])}))),function(e){return c.apply(this,arguments)})},{key:"handlePostAction",value:(u=rs(regeneratorRuntime.mark((function e(t,r){var n,o,a,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="decrypted"===t.access_type,e.next=3,this.outgoingPayloadForItem({item:r,decrypted:n});case 3:return o=e.sent,a={items:[o]},e.abrupt("return",this.httpService.postAbsolute({url:t.url,params:a}).then((function(e){return t.error=!1,{response:e}})).catch((function(e){return t.error=!0,console.error("Action error response:",e),i.alertService.alert({text:"An issue occurred while processing this action. Please try again."}),{response:e}})));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"handleShowAction",value:(s=rs(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.deviceInterface.openUrl(t.url),e.abrupt("return",{response:null});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"outgoingPayloadForItem",value:(a=rs(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.item,n=t.decrypted,o=void 0!==n&&n?q.FileDecrypted:q.FileEncrypted,e.abrupt("return",this.protocolService.payloadByEncryptingPayload({payload:r.payloadRepresentation(),intent:o}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})}])&&ns(r.prototype,n),o&&ns(r,o),t}(ya);function us(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function cs(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){us(a,n,o,i,s,"next",e)}function s(e){us(a,n,o,i,s,"throw",e)}i(void 0)}))}}function ls(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ps=function(){function e(t){var r=t.application,n=t.challengeResponder;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.application=r,this.challengeResponder=n,this.stageHandlers={},this.registerStageHandlers()}var t,r,n,o,a;return t=e,r=[{key:"registerStageHandlers",value:function(){throw"Must override Migration.registerStageHandlers"}},{key:"registerStageHandler",value:function(e,t){this.stageHandlers[e]=t}},{key:"markDone",value:function(){this.done=!0,this.onDoneHandler&&this.onDoneHandler(),this.onDoneHandler=null}},{key:"onDone",value:function(e){this.onDoneHandler=e}},{key:"handleStage",value:(a=cs(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.stageHandlers[t])){e.next=4;break}return e.next=4,r();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"requestChallengeResponse",value:(o=cs(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.challengeResponder(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})}],n=[{key:"timestamp",value:function(){throw"Must override Migration.timestamp"}}],r&&ls(t.prototype,r),n&&ls(t,n),e}();function fs(e){return(fs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ys(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hs(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function vs(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){hs(a,n,o,i,s,"next",e)}function s(e){hs(a,n,o,i,s,"throw",e)}i(void 0)}))}}function ds(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ms(e,t){return!t||"object"!==fs(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function gs(e,t,r){return(gs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=bs(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function bs(e){return(bs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ws(e,t){return(ws=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ks={Default:1,Ephemeral:2},xs={Default:1,Disabled:2},Ss={Default:1,Nonwrapped:2},Rs={Wrapped:"wrapped",Unwrapped:"unwrapped",Nonwrapped:"nonwrapped"},Ps=function(e){function t(e){var r,n=e.protocolService,o=e.deviceInterface,a=e.namespace;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=ms(this,bs(t).call(this))).deviceInterface=o,r.protocolService=n,r.namespace=a,r.setPersistencePolicy(ks.Default),r.setEncryptionPolicy(xs.Default),r.storagePersistable=!1,r}var r,n,a,s,u,c,l,p,f,y,h,v,d,m,g,b,k,x,S,R,P,O,_,j;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ws(e,t)}(t,e),r=t,n=[{key:"handleApplicationStage",value:(j=vs(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,gs(bs(t.prototype),"handleApplicationStage",this).call(this,r);case 2:r===w&&(this.storagePersistable=!0);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"setPersistencePolicy",value:(_=vs(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.persistencePolicy=t,this.persistencePolicy!==ks.Ephemeral){e.next=6;break}return e.next=4,this.deviceInterface.removeAllRawStorageValues();case 4:return e.next=6,this.clearAllPayloads();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"setEncryptionPolicy",value:(O=vs(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.encryptionPolicy=t;case 1:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"isEphemeralSession",value:function(){return this.persistencePolicy===ks.Ephemeral}},{key:"initializeFromDisk",value:(P=vs(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deviceInterface.getRawStorageValue(this.getPersistenceKey());case 2:t=e.sent,r=t?JSON.parse(t):null,this.setInitialValues(r);case 5:case"end":return e.stop()}}),e,this)}))),function(){return P.apply(this,arguments)})},{key:"persistAsValueToDisk",value:(R=vs(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deviceInterface.setRawStorageValue(this.getPersistenceKey(),JSON.stringify(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"setInitialValues",value:function(e){e||(e=this.defaultValuesObject()),e[Rs.Unwrapped]||(e[Rs.Unwrapped]={}),this.values=e}},{key:"isStorageWrapped",value:function(){var e=this.values[Rs.Wrapped];return!Object(o.l)(e)&&Object.keys(e).length>0}},{key:"canDecryptWithKey",value:(S=vs(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.values[Rs.Wrapped],e.next=3,this.decryptWrappedValue({wrappedValue:r,key:t,throws:!1});case 3:return n=e.sent,e.abrupt("return",!n.errorDecrypting);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"decryptWrappedValue",value:(x=vs(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.wrappedValue,n=t.key,r.content_type){e.next=3;break}throw"Attempting to decrypt nonexistent wrapped value";case 3:return o=ra({object:r,override:{content_type:i.EncryptedStorage}}),e.next=6,this.protocolService.payloadByDecryptingPayload({payload:o,key:n});case 6:return a=e.sent,e.abrupt("return",a);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"decryptStorage",value:(k=vs(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.values[Rs.Wrapped],e.next=3,this.decryptWrappedValue({wrappedValue:t});case 3:if(!(r=e.sent).errorDecrypting){e.next=6;break}throw"Unable to decrypt storage.";case 6:this.values[Rs.Unwrapped]=Object(o.a)(r.content),delete this.values[Rs.Wrapped];case 8:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"generatePersistenceValue",value:(b=vs(regeneratorRuntime.mark((function e(){var t,r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object.assign({},this.values),r=t[Rs.Unwrapped],e.t0=ra,e.next=5,L.GenerateUuid();case 5:return e.t1=e.sent,e.t2=r,e.t3=i.EncryptedStorage,e.t4={uuid:e.t1,content:e.t2,content_type:e.t3},e.t5={object:e.t4},n=(0,e.t0)(e.t5),e.next=13,this.protocolService.payloadByEncryptingPayload({payload:n,intent:q.LocalStoragePreferEncrypted});case 13:return o=e.sent,t[Rs.Wrapped]=o,t[Rs.Unwrapped]=null,e.abrupt("return",t);case 17:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"repersistToDisk",value:(g=vs(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.storagePersistable){e.next=2;break}return e.abrupt("return");case 2:if(this.persistencePolicy!==ks.Ephemeral){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this.generatePersistenceValue();case 6:return t=e.sent,this.values[Rs.Wrapped]=t[Rs.Wrapped],e.abrupt("return",this.persistAsValueToDisk(t));case 9:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"setValue",value:(m=vs(regeneratorRuntime.mark((function e(t,r){var n,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>2&&void 0!==o[2]?o[2]:Ss.Default,this.values){e.next=3;break}throw"Attempting to set storage key ".concat(t," before loading local storage.");case 3:return this.values[this.domainKeyForMode(n)][t]=r,e.abrupt("return",this.repersistToDisk());case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"getValue",value:(d=vs(regeneratorRuntime.mark((function e(t){var r,n=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]?n[1]:Ss.Default,this.values){e.next=3;break}throw"Attempting to get storage key ".concat(t," before loading local storage.");case 3:if(this.values[this.domainKeyForMode(r)]){e.next=5;break}throw"Storage domain mode not available ".concat(r," for key ").concat(t);case 5:return e.abrupt("return",this.values[this.domainKeyForMode(r)][t]);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"removeValue",value:(v=vs(regeneratorRuntime.mark((function e(t){var r,n=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]?n[1]:Ss.Default,this.values){e.next=3;break}throw"Attempting to remove storage key ".concat(t," before loading local storage.");case 3:return delete this.values[this.domainKeyForMode(r)][t],e.abrupt("return",this.repersistToDisk());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"getPersistenceKey",value:function(){return A(this.namespace,E.StorageObject)}},{key:"defaultValuesObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.wrapped,r=e.unwrapped,n=e.nonwrapped;return this.constructor.defaultValuesObject({wrapped:t,unwrapped:r,nonwrapped:n})}},{key:"domainKeyForMode",value:function(e){return this.constructor.domainKeyForMode(e)}},{key:"clearValues",value:(h=vs(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setInitialValues(),e.next=3,this.repersistToDisk();case 3:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"getAllRawPayloads",value:(y=vs(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deviceInterface.getAllRawDatabasePayloads());case 1:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"savePayload",value:(f=vs(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.savePayloads([t]));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"savePayloads",value:(p=vs(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.persistencePolicy!==ks.Ephemeral){e.next=2;break}return e.abrupt("return");case 2:r=[],n=[],o=!0,a=!1,i=void 0,e.prev=7,s=t[Symbol.iterator]();case 9:if(o=(u=s.next()).done){e.next=22;break}if(!(c=u.value).discardable){e.next=15;break}r.push(c),e.next=19;break;case 15:return e.next=17,this.protocolService.payloadByEncryptingPayload({payload:c,intent:this.encryptionPolicy===xs.Default?q.LocalStoragePreferEncrypted:q.LocalStorageDecrypted});case 17:l=e.sent,n.push(l);case 19:o=!0,e.next=9;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(7),a=!0,i=e.t0;case 28:e.prev=28,e.prev=29,o||null==s.return||s.return();case 31:if(e.prev=31,!a){e.next=34;break}throw i;case 34:return e.finish(31);case 35:return e.finish(28);case 36:if(!(r.length>0)){e.next=39;break}return e.next=39,this.deletePayloads(r);case 39:return e.next=41,this.deviceInterface.saveRawDatabasePayloads(n);case 41:case"end":return e.stop()}}),e,this,[[7,24,28,36],[29,,31,35]])}))),function(e){return p.apply(this,arguments)})},{key:"deletePayloads",value:(l=vs(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!0,n=!1,o=void 0,e.prev=3,a=t[Symbol.iterator]();case 5:if(r=(i=a.next()).done){e.next=12;break}return s=i.value,e.next=9,this.deletePayloadWithId(s.uuid);case 9:r=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,o=e.t0;case 18:e.prev=18,e.prev=19,r||null==a.return||a.return();case 21:if(e.prev=21,!n){e.next=24;break}throw o;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))),function(e){return l.apply(this,arguments)})},{key:"deletePayloadWithId",value:(c=vs(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deviceInterface.removeRawDatabasePayloadWithId(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"clearAllPayloads",value:(u=vs(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deviceInterface.removeAllRawDatabasePayloads());case 1:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"clearAllData",value:(s=vs(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.clearValues(),this.clearAllPayloads()]));case 1:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})}],a=[{key:"defaultValuesObject",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.wrapped,n=void 0===r?{}:r,o=t.unwrapped,a=void 0===o?{}:o,i=t.nonwrapped,s=void 0===i?{}:i;return ys(e={},Rs.Wrapped,n),ys(e,Rs.Unwrapped,a),ys(e,Rs.Nonwrapped,s),e}},{key:"domainKeyForMode",value:function(e){if(e===Ss.Default)return Rs.Unwrapped;if(e===Ss.Nonwrapped)return Rs.Nonwrapped;throw"Invalid mode"}}],n&&ds(r.prototype,n),a&&ds(r,a),t}(ya);function Os(e){return(Os="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function js(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Is(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){js(a,n,o,i,s,"next",e)}function s(e){js(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Ds(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Cs(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Es(e,t){return!t||"object"!==Os(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function As(e){return(As=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ts(e,t){return(Ts=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ms=function(e){function t(){return Ds(this,t),Es(this,As(t).apply(this,arguments))}var r,n,a,s,u,c,l,p,f,y,h,v;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ts(e,t)}(t,e),r=t,n=[{key:"registerStageHandlers",value:function(){var e=this;this.registerStageHandler(m,Is(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!I(e.application.environment)){t.next=4;break}return t.abrupt("return",e.migrateStorageStructureForWebDesktop());case 4:if(!D(e.application.environment)){t.next=6;break}return t.abrupt("return",e.migrateStorageStructureForMobile());case 6:case"end":return t.stop()}}),t)})))),this.registerStageHandler(b,Is(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.migrateArbitraryRawStorageToManagedStorageAllPlatforms();case 2:return t.next=4,e.migrateSessionStorage();case 4:case"end":return t.stop()}}),t)})))),this.registerStageHandler(k,Is(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.createDefaultItemsKeyForAllPlatforms();case 2:e.markDone();case 3:case"end":return t.stop()}}),t)}))))}},{key:"migrateStorageStructureForWebDesktop",value:(v=Is(regeneratorRuntime.mark((function e(){var t,r,n,a,i,s,u,c,l,p,f,y,h,v,d,m,g,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.application.deviceInterface,_s(t={},Rs.Wrapped,null),_s(t,Rs.Unwrapped,{}),_s(t,Rs.Nonwrapped,{}),n=t,e.next=4,r.getJsonParsedStorageValue("auth_params");case 4:return(a=e.sent)&&(n.nonwrapped[E.RootKeyParams]=a),e.next=8,r.getJsonParsedStorageValue("encryptedStorage");case 8:if(!(i=e.sent)){e.next=35;break}return s=ra({object:i}),e.next=13,this.webDesktopHelperGetPasscodeKeyAndDecryptEncryptedStorage(s);case 13:if(u=e.sent,c=u.key,l=u.decryptedStoragePayload,p=u.keyParams,n.nonwrapped[E.RootKeyWrapperKeyParams]=p.getPortableValue(),f=Object(o.a)(l.content.storage),n.nonwrapped[E.RootKeyParams]=f.auth_params,y=c,Object(o.l)(f.mk)){e.next=30;break}return e.next=25,this.webDesktopHelperExtractAndWrapAccountKeysFromValueStore(c,f);case 25:h=e.sent,v=h.accountKey,d=h.wrappedKey,y=v,n.nonwrapped[E.WrappedRootKey]=d;case 30:return e.next=32,this.webDesktopHelperEncryptStorage(y,l,f);case 32:n.wrapped=e.sent,e.next=55;break;case 35:return e.next=37,this.application.deviceInterface.getRawStorageValue("ak");case 37:return m=e.sent,g=Object(o.l)(m)?W.V002:W.V003,e.t0=ee,e.next=42,this.application.deviceInterface.getRawStorageValue("mk");case 42:return e.t1=e.sent,e.next=45,this.application.deviceInterface.getRawStorageValue("pw");case 45:return e.t2=e.sent,e.t3=m,e.t4=g,e.t5={masterKey:e.t1,serverPassword:e.t2,dataAuthenticationKey:e.t3,version:e.t4},e.t6={content:e.t5},e.next=52,e.t0.Create.call(e.t0,e.t6);case 52:return b=e.sent,e.next=55,this.application.deviceInterface.setKeychainValue(b.getPersistableValue());case 55:return e.next=57,this.allPlatformHelperSetStorageStructure(n);case 57:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"allPlatformHelperSetStorageStructure",value:(h=Is(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=Ps.defaultValuesObject(t))[Rs.Unwrapped]=null,e.next=4,this.application.deviceInterface.setRawStorageValue(A(this.application.namespace,E.StorageObject),JSON.stringify(r));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"webDesktopHelperGetPasscodeKeyAndDecryptEncryptedStorage",value:(y=Is(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.application.deviceInterface.getJsonParsedStorageValue("offlineParams");case 2:r=e.sent,n=this.application.protocolService.createKeyParams(r),o={errorDecrypting:!0};case 5:if(!o.errorDecrypting){e.next=18;break}return e.next=8,this.requestChallengeResponse(C.LocalPasscode);case 8:return i=e.sent,s=i.value,e.next=12,this.application.protocolService.computeRootKey({password:s,keyParams:n});case 12:return a=e.sent,e.next=15,this.application.protocolService.payloadByDecryptingPayload({payload:t,key:a});case 15:o=e.sent,e.next=5;break;case 18:return e.abrupt("return",{decryptedStoragePayload:o,key:a,keyParams:n});case 19:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"webDesktopHelperExtractAndWrapAccountKeysFromValueStore",value:(f=Is(regeneratorRuntime.mark((function e(t,r){var n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.ak?W.V003:W.V002,e.next=3,ee.Create({content:{masterKey:r.mk,serverPassword:r.pw,dataAuthenticationKey:r.ak,version:n}});case 3:if(o=e.sent,delete r.mk,delete r.pw,delete r.ak,a=ra({object:o}),!t){e.next=12;break}return e.next=11,this.application.protocolService.payloadByEncryptingPayload({payload:a,key:t,intent:q.LocalStorageEncrypted});case 11:i=e.sent;case 12:return e.abrupt("return",{accountKey:o,wrappedKey:i});case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"webDesktopHelperEncryptStorage",value:(p=Is(regeneratorRuntime.mark((function e(t,r,n){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.application.protocolService.payloadByEncryptingPayload({key:t,intent:q.LocalStoragePreferEncrypted,payload:ia({payload:r,override:{content_type:i.EncryptedStorage,content:n}})});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return p.apply(this,arguments)})},{key:"migrateStorageStructureForMobile",value:(l=Is(regeneratorRuntime.mark((function e(){var t,r,n,a,s,u,c,l,p,f,y,h,v,d,m,g,b,w,k,x,S=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.application.deviceInterface.getJsonParsedStorageValue("encrypted_account_keys");case 2:return r=e.sent,e.next=5,this.application.deviceInterface.getJsonParsedStorageValue("auth_params");case 5:return n=e.sent,e.next=8,this.application.deviceInterface.getJsonParsedStorageValue("pc_params");case 8:return a=e.sent,s={nonwrapped:(t={},_s(t,E.WrappedRootKey,r),_s(t,E.RootKeyWrapperKeyParams,a),_s(t,E.RootKeyParams,n),t),unwrapped:{}},e.next=12,this.application.deviceInterface.getKeychainValue();case 12:if(u=e.sent,!a){e.next=57;break}if(c=this.application.protocolService.createKeyParams(a),l=function(){var e=Is(regeneratorRuntime.mark((function e(){var t,r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=u.offline.pw,r={serverPassword:null};case 2:if(r.serverPassword===t){e.next=12;break}return e.next=5,S.requestChallengeResponse(C.LocalPasscode);case 5:return n=e.sent,o=n.value,e.next=9,S.application.protocolService.computeRootKey({password:o,keyParams:c});case 9:r=e.sent,e.next=2;break;case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=u.offline.timing,s.unwrapped[E.MobilePasscodeTiming]=p,!r){e.next=36;break}return e.next=21,l();case 21:return f=e.sent,e.next=24,this.application.protocolService.payloadByDecryptingPayload({payload:ra({object:r}),key:f});case 24:return y=e.sent,h=y.content.accountKeys,v=Object(o.l)(h.ak)?W.V002:W.V003,d=ia({payload:y,override:{content:{masterKey:h.mk,serverPassword:h.pw,dataAuthenticationKey:h.ak,version:h.version||v,accountKeys:null}}}),e.next=30,this.application.protocolService.payloadByEncryptingPayload({payload:d,key:f,intent:q.LocalStoragePreferEncrypted});case 30:return m=e.sent,s.nonwrapped[E.WrappedRootKey]=m,e.next=34,this.application.deviceInterface.clearKeychainValue();case 34:e.next=55;break;case 36:if(r){e.next=55;break}return e.next=39,l();case 39:return g=e.sent,e.t0=ra,e.next=43,L.GenerateUuid();case 43:return e.t1=e.sent,e.t2=s.unwrapped,e.t3=i.EncryptedStorage,e.t4={uuid:e.t1,content:e.t2,content_type:e.t3},e.t5={object:e.t4},b=(0,e.t0)(e.t5),e.next=51,this.application.protocolService.payloadByEncryptingPayload({payload:b,key:g,intent:q.LocalStoragePreferEncrypted});case 51:return w=e.sent,s.wrapped=w,e.next=55,this.application.deviceInterface.clearKeychainValue();case 55:e.next=65;break;case 57:if(!u||!u.mk){e.next=65;break}return k=Object(o.l)(u.ak)?W.V002:W.V003,e.next=62,ee.Create({content:{masterKey:u.mk,serverPassword:u.pw,dataAuthenticationKey:u.ak,version:u.version||k}});case 62:return x=e.sent,e.next=65,this.application.deviceInterface.setKeychainValue(x.getPersistableValue());case 65:return e.next=67,this.allPlatformHelperSetStorageStructure(s);case 67:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"migrateArbitraryRawStorageToManagedStorageAllPlatforms",value:(c=Is(regeneratorRuntime.mark((function e(){var t,r,n,a,i,s,u,c,l,p,f,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.application.deviceInterface.getAllRawStorageKeyValues();case 2:t=e.sent,r=[A(this.application.namespace,E.StorageObject),"encryptedStorage","offlineParams","pc_params"],n=function(e){try{return JSON.parse(e)}catch(t){return e}},a=!0,i=!1,s=void 0,e.prev=8,u=t[Symbol.iterator]();case 10:if(a=(c=u.next()).done){e.next=23;break}if(l=c.value,p=l.key,f=l.value,!r.includes(p)){e.next=16;break}return e.abrupt("continue",20);case 16:if(Object(o.l)(f)){e.next=20;break}return y=n(f),e.next=20,this.application.storageService.setValue(p,y);case 20:a=!0,e.next=10;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(8),i=!0,s=e.t0;case 29:e.prev=29,e.prev=30,a||null==u.return||u.return();case 32:if(e.prev=32,!i){e.next=35;break}throw s;case 35:return e.finish(32);case 36:return e.finish(29);case 37:case"end":return e.stop()}}),e,this,[[8,25,29,37],[30,,32,36]])}))),function(){return c.apply(this,arguments)})},{key:"migrateSessionStorage",value:(u=Is(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.application.storageService.getValue("jwt");case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:return r=new xa(t),e.next=8,this.application.storageService.setValue(E.Session,r);case 8:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"createDefaultItemsKeyForAllPlatforms",value:(s=Is(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.application.keyManager.getRootKey();case 2:if(!(t=e.sent)){e.next=14;break}return e.next=6,this.application.keyManager.getRootKeyParams();case 6:return r=e.sent,n=it.FromRaw({itemsKey:t.masterKey,dataAuthenticationKey:t.dataAuthenticationKey,version:r.version}),e.next=10,n.initUUID();case 10:return e.next=12,this.application.modelManager.mapItem({item:n});case 12:return e.next=14,this.application.modelManager.setItemDirty(n);case 14:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})}],a=[{key:"timestamp",value:function(){return new Date("2020-01-15").getTime()}}],n&&Cs(r.prototype,n),a&&Cs(r,a),t}(ps);function Ks(e){return(Ks="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fs(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Ls(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Fs(a,n,o,i,s,"next",e)}function s(e){Fs(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Ns(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Us(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Bs(e,t){return!t||"object"!==Ks(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Vs(e){return(Vs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Hs(e,t){return(Hs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ws=function(e){function t(){return Ns(this,t),Bs(this,Vs(t).apply(this,arguments))}var r,n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hs(e,t)}(t,e),r=t,n=[{key:"registerStageHandlers",value:function(){var e=this;this.registerStageHandler(m,Ls(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.migrateMigrationTimestampAllPlatforms();case 2:e.markDone();case 3:case"end":return t.stop()}}),t)}))))}},{key:"migrateMigrationTimestampAllPlatforms",value:(i=Ls(regeneratorRuntime.mark((function e(){var t,r,n,a,i,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!1,r=0,n=["migrations","ephemeral","user","cachedThemes","syncToken"];case 3:if(!(r<n.length)){e.next=14;break}return a=n[r],e.next=7,this.application.deviceInterface.getRawStorageValue(a);case 7:if(!e.sent){e.next=11;break}return t=!0,e.abrupt("break",14);case 11:r++,e.next=3;break;case 14:return i=A(this.application.namespace,"last_migration_timestamp"),e.next=17,this.application.deviceInterface.getRawStorageValue(i);case 17:if(s=e.sent,(u=!Object(o.l)(s))||!t){e.next=25;break}return c=new Date(0).getTime(),e.next=23,this.application.deviceInterface.setRawStorageValue(i,c);case 23:e.next=32;break;case 25:if(u||t){e.next=31;break}return l=(new Date).getTime(),e.next=29,this.application.deviceInterface.setRawStorageValue(i,l);case 29:e.next=32;break;case 31:case 32:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})}],a=[{key:"timestamp",value:function(){return new Date("2020-01-01").getTime()}}],n&&Us(r.prototype,n),a&&Us(r,a),t}(ps);function zs(e){return(zs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qs(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Ys(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){qs(a,n,o,i,s,"next",e)}function s(e){qs(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Js(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Gs(e,t){return!t||"object"!==zs(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Qs(e,t,r){return(Qs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=$s(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function $s(e){return($s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xs(e,t){return(Xs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Zs=function(e){function t(e){var r,n=e.application,o=e.challengeResponder;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Gs(this,$s(t).call(this))).application=n,r.challengeResponder=o,r}var r,a,i,s,u,c,l,p,f,y;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xs(e,t)}(t,e),r=t,(a=[{key:"initialize",value:(y=Ys(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.runBaseMigration();case 2:return e.next=4,this.getRequiredMigrations();case 4:this.activeMigrations=e.sent,this.activeMigrations.length>0&&(t=Object(o.q)(this.activeMigrations)).onDone(Ys(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.saveLastMigrationTimestamp(t.constructor.timestamp());case 2:case"end":return e.stop()}}),e)}))));case 6:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"handleApplicationStage",value:(f=Ys(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qs($s(t.prototype),"handleApplicationStage",this).call(this,r);case 2:return r===g&&(this.addLoginObserver(),this.addSyncObserver()),e.next=5,this.handleStage(r);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"runBaseMigration",value:(p=Ys(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ws({application:this.application}),e.next=3,t.handleStage(m);case 3:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"getRequiredMigrations",value:(l=Ys(regeneratorRuntime.mark((function e(){var t,r,o,a,i,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLastMigrationTimestamp();case 2:for(t=e.sent,r=[],o=Object.keys(n).map((function(e){return n[e]})).sort((function(e,t){var r=e.timestamp(),n=t.timestamp();return r<n?-1:r>n?1:0})),a=!0,i=!1,s=void 0,e.prev=8,u=o[Symbol.iterator]();!(a=(c=u.next()).done);a=!0)(l=c.value).timestamp()>t&&r.push(new l({application:this.application,challengeResponder:this.challengeResponder}));e.next=16;break;case 12:e.prev=12,e.t0=e.catch(8),i=!0,s=e.t0;case 16:e.prev=16,e.prev=17,a||null==u.return||u.return();case 19:if(e.prev=19,!i){e.next=22;break}throw s;case 22:return e.finish(19);case 23:return e.finish(16);case 24:return e.abrupt("return",r);case 25:case"end":return e.stop()}}),e,this,[[8,12,16,24],[17,,19,23]])}))),function(){return l.apply(this,arguments)})},{key:"getTimeStampKey",value:function(){return A(this.application.namespace,"last_migration_timestamp")}},{key:"getLastMigrationTimestamp",value:(c=Ys(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.application.deviceInterface.getRawStorageValue(this.getTimeStampKey());case 2:if(t=e.sent,!Object(o.l)(t)){e.next=5;break}throw"Timestamp should not be null. Be sure to run base migration first.";case 5:return e.abrupt("return",JSON.parse(t));case 6:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"saveLastMigrationTimestamp",value:(u=Ys(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.application.deviceInterface.setRawStorageValue(this.getTimeStampKey(),JSON.stringify(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"addLoginObserver",value:function(){var e=this;this.application.addEventObserver(function(){var t=Ys(regeneratorRuntime.mark((function t(r,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r!==d.SignedIn){t.next=3;break}return t.next=3,e.handleStage(R);case 3:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())}},{key:"addSyncObserver",value:function(){var e=this;this.application.syncService.addEventObserver(function(){var t=Ys(regeneratorRuntime.mark((function t(r,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r!==h.FullSyncCompleted){t.next=3;break}return t.next=3,e.handleStage(S);case 3:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())}},{key:"handleStage",value:(s=Ys(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!0,n=!1,o=void 0,e.prev=3,a=this.activeMigrations[Symbol.iterator]();case 5:if(r=(i=a.next()).done){e.next=12;break}return s=i.value,e.next=9,s.handleStage(t);case 9:r=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,o=e.t0;case 18:e.prev=18,e.prev=19,r||null==a.return||a.return();case 21:if(e.prev=21,!n){e.next=24;break}throw o;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))),function(e){return s.apply(this,arguments)})}])&&Js(r.prototype,a),i&&Js(r,i),t}(ya);function eu(e){return(eu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tu(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ru(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function nu(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){ru(a,n,o,i,s,"next",e)}function s(e){ru(a,n,o,i,s,"throw",e)}i(void 0)}))}}function ou(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function au(e,t){return!t||"object"!==eu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function iu(e,t,r){return(iu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=su(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function su(e){return(su=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function uu(e,t){return(uu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var cu=function(e){function t(e){var r,n=e.modelManager,a=e.crypto;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!n)throw"Invalid ProtocolService construction.";return(r=au(this,su(t).call(this))).operators=[],r.modelManager=n,r.crypto=a,!r.crypto&&Object(o.o)()&&Object(ae.isWebCryptoAvailable)()&&(r.crypto=new ae.SNWebCrypto),L.SetGenerators({syncImpl:r.crypto.generateUUIDSync,asyncImpl:r.crypto.generateUUIDSync}),r}var r,n,a,i,s,u,c,l,p,f,y,h,v,d,m;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&uu(e,t)}(t,e),r=t,(n=[{key:"setKeyManager",value:function(e){this.keyManager=e}},{key:"setItemsKeyManager",value:function(e){var t=this;this.keyObsUnsubscribe=e.addItemsKeyChangeObserver(nu(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.decryptErroredItems();case 2:case"end":return e.stop()}}),e)}))))}},{key:"deinit",value:(m=nu(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.keyObsUnsubscribe(),e.abrupt("return",iu(su(t.prototype),"deinit",this).call(this));case 2:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"getLatestVersion",value:function(){return W.V004}},{key:"getUserVersion",value:(d=nu(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keyManager.getRootKeyParams();case 2:return t=e.sent,e.abrupt("return",t&&t.version);case 4:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"upgradeAvailable",value:(v=nu(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUserVersion();case 2:return e.t0=e.sent,e.t1=this.getLatestVersion(),e.abrupt("return",e.t0!==e.t1);case 5:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"platformSupportsKeyDerivation",value:function(e){return z(e.version,W.V004)>=0||!!Object(ae.isWebCryptoAvailable)()}},{key:"supportedVersions",value:function(){return[W.V001,W.V002,W.V003,W.V004]}},{key:"isVersionNewerThanLibraryVersion",value:function(e){return 1===z(e,this.getLatestVersion())}},{key:"isProtocolVersionOutdated",value:function(e){var t={};t[W.V001]=Date.parse("2018-01-01"),t[W.V002]=Date.parse("2020-01-01");var r=t[e];return!!r&&new Date>r}},{key:"costMinimumForVersion",value:function(e){if(z(e,W.V003)>=0)throw"Cost minimums only apply to versions <= 002";if(e===W.V001)return ke.pwCost();if(e===W.V002)return Ee.pwCost();throw"Invalid version for cost minimum: ".concat(e)}},{key:"createOperatorForLatestVersion",value:function(){return this.createOperatorForVersion(this.getLatestVersion())}},{key:"createOperatorForVersion",value:function(e){if(e===W.V001)return new ke(this.crypto);if(e===W.V002)return new Ee(this.crypto);if(e===W.V003)return new Be(this.crypto);if(e===W.V004)return new Xe(this.crypto);if(e===W.V000Base64Decrypted)return this.createOperatorForLatestVersion();throw"Unable to find operator for version ".concat(e)}},{key:"operatorForVersion",value:function(e){var t=e,r=this.operators[t];return r||(r=this.createOperatorForVersion(e),this.operators[t]=r),r}},{key:"defaultOperator",value:function(){return this.operatorForVersion(this.getLatestVersion())}},{key:"computeRootKey",value:(h=nu(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.password,n=t.keyParams,o=n.version,a=this.operatorForVersion(o),e.abrupt("return",a.computeRootKey({password:r,keyParams:n}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"createRootKey",value:(y=nu(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.identifier,n=t.password,o=this.defaultOperator(),e.abrupt("return",o.createRootKey({identifier:r,password:n}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"payloadContentFormatForIntent",value:function(e){var t=e.key,r=e.intent;if(t){if(r===q.Sync||r===q.FileEncrypted||r===q.FilePreferEncrypted||r===q.LocalStorageEncrypted||r===q.LocalStoragePreferEncrypted)return oe.EncryptedString;throw"Unhandled encrypted case in protocolService.payloadContentFormatForIntent."}if(r===q.LocalStorageDecrypted||r===q.LocalStoragePreferEncrypted||r===q.FileDecrypted||r===q.FilePreferEncrypted)return oe.DecryptedBareObject;if(r===q.SyncDecrypted)return oe.DecryptedBase64String;throw"Unhandled decrypted case in protocolService.payloadContentFormatForIntent."}},{key:"payloadByEncryptingPayload",value:(f=nu(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.payload,n=t.key,a=t.intent,!r.errorDecrypting){e.next=3;break}return e.abrupt("return",r);case 3:if(!Object(o.l)(a)){e.next=5;break}throw"Attempting to encrypt payload with null intent";case 5:if(n||G(a)){e.next=9;break}return e.next=8,this.keyManager.keyToUseForEncryptionOfPayload({payload:r,intent:a});case 8:n=e.sent;case 9:if(n||!Q(a)){e.next=11;break}throw"Attempting to generate encrypted payload with no key.";case 11:if(r.getFormat()===oe.DecryptedBareObject){e.next=13;break}throw"Attempting to encrypt already encrypted payload.";case 13:if(r.isPayload){e.next=15;break}throw"Attempting to encrypt non-payload.";case 15:if(r.content){e.next=17;break}throw"Attempting to encrypt payload with no content.";case 17:if(r.uuid){e.next=19;break}throw"Attempting to encrypt payload with no uuid.";case 19:return i=n?n.version:this.getLatestVersion(),s=this.payloadContentFormatForIntent({key:n,intent:a}),u=this.operatorForVersion(i),e.next=24,u.generateEncryptionParameters({payload:r,key:n,format:s});case 24:if(c=e.sent){e.next=27;break}throw"Unable to generate encryption parameters";case 27:return e.abrupt("return",na({object:r,override:c,intent:a}));case 28:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"payloadsByEncryptingPayloads",value:(p=nu(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,u,c,l,p,f,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.payloads,n=t.intent,a=[],i=!0,s=!1,u=void 0,e.prev=5,c=r[Symbol.iterator]();case 7:if(i=(l=c.next()).done){e.next=17;break}return p=l.value,f=Object(o.k)(n)?n(p):n,e.next=12,this.payloadByEncryptingPayload({payload:p,intent:f});case 12:y=e.sent,a.push(y);case 14:i=!0,e.next=7;break;case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(5),s=!0,u=e.t0;case 23:e.prev=23,e.prev=24,i||null==c.return||c.return();case 26:if(e.prev=26,!s){e.next=29;break}throw u;case 29:return e.finish(26);case 30:return e.finish(23);case 31:return e.abrupt("return",a);case 32:case"end":return e.stop()}}),e,this,[[5,19,23,31],[24,,26,30]])}))),function(e){return p.apply(this,arguments)})},{key:"payloadByDecryptingPayload",value:(l=nu(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.payload,n=t.key,r.content){e.next=3;break}throw"Attempting to decrypt payload that has no content.";case 3:if(r.isPayload){e.next=5;break}throw"Attempting to decrypt non-payload.";case 5:if((o=r.getFormat())!==oe.DecryptedBareObject){e.next=8;break}return e.abrupt("return",r);case 8:if(n||o!==oe.EncryptedString){e.next=14;break}return e.next=11,this.keyManager.keyToUseForDecryptionOfPayload({payload:r});case 11:if(n=e.sent){e.next=14;break}return e.abrupt("return",ra({object:r,override:{waitingForKey:!0,errorDecrypting:!0}}));case 14:return a=r.version,i=this.operatorForVersion(a),s=sa(r),e.next=19,i.generateDecryptedParameters({encryptedParameters:s,key:n});case 19:return u=e.sent,e.abrupt("return",ra({object:r,override:u}));case 21:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"payloadsByDecryptingPayloads",value:(c=nu(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,u,c,l,p,f,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.payloads,n=t.key,a=[],i=!0,s=!1,u=void 0,e.prev=5,c=r[Symbol.iterator]();case 7:if(i=(l=c.next()).done){e.next=35;break}if(p=l.value){e.next=12;break}return a.push(p),e.abrupt("continue",32);case 12:if(p.isPayload){e.next=14;break}throw"Attempting to decrypt non-payload object in payloadsByDecryptingPayloads.";case 14:if(!0!==p.deleted||!Object(o.l)(p.content)){e.next=17;break}return a.push(p),e.abrupt("continue",32);case 17:if(Object(o.n)(p.content)){e.next=21;break}return a.push(p),e.abrupt("continue",32);case 21:return e.prev=21,e.next=24,this.payloadByDecryptingPayload({payload:p,key:n});case 24:f=e.sent,a.push(f),e.next=32;break;case 28:e.prev=28,e.t0=e.catch(21),a.push(ra({object:p,override:(y={},tu(y,ce.ErrorDecrypting,!0),tu(y,ce.ErrorDecryptingChanged,!p.errorDecrypting),y)})),console.error("Error decrypting payload",p,e.t0);case 32:i=!0,e.next=7;break;case 35:e.next=41;break;case 37:e.prev=37,e.t1=e.catch(5),s=!0,u=e.t1;case 41:e.prev=41,e.prev=42,i||null==c.return||c.return();case 44:if(e.prev=44,!s){e.next=47;break}throw u;case 47:return e.finish(44);case 48:return e.finish(41);case 49:return e.abrupt("return",a);case 50:case"end":return e.stop()}}),e,this,[[5,37,41,49],[21,28],[42,,44,48]])}))),function(e){return c.apply(this,arguments)})},{key:"decryptErroredItems",value:(u=nu(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=this.modelManager.allItems.filter((function(e){return e.waitingForKey||e.errorDecrypting}))).length){e.next=3;break}return e.abrupt("return");case 3:return r=t.map((function(e){return e.payloadRepresentation()})),e.next=6,this.payloadsByDecryptingPayloads({payloads:r});case 6:return n=e.sent,e.next=9,this.modelManager.mapPayloadsToLocalItems({payloads:n});case 9:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"payloadsByDecryptingBackupFile",value:(s=nu(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.data,n=t.password,o=r.keyParams||r.auth_params,a=r.items,i=a.map((function(e){return oa({object:e,source:en.FileImport})})),!o){e.next=13;break}return e.next=7,this.computeRootKey({password:n,keyParams:o});case 7:return u=e.sent,e.next=10,this.payloadsByDecryptingPayloads({payloads:i,key:u});case 10:s=e.sent,e.next=14;break;case 13:s=i;case 14:return e.abrupt("return",s);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"createKeyParams",value:function(e){if(e.isKeyParamsObject)throw"Attempting to create key params from non-raw value.";return e.version||(e.version=W.V002),re(e)}},{key:"createBackupFile",value:(i=nu(regeneratorRuntime.mark((function e(){var t,r,n,o,a,i,s,u,c,l,p=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=p.length>0&&void 0!==p[0]?p[0]:{},r=t.subItems,n=t.intent,o=t.returnIfEmpty,a=r||this.modelManager.allItems,!o||0!==a.length){e.next=4;break}return e.abrupt("return",null);case 4:return n||(n=q.FilePreferEncrypted),i=a.map((function(e){return ra({object:e})})),e.next=8,this.payloadsByEncryptingPayloads({payloads:i,intent:n});case 8:return s=e.sent,u={items:s},e.next=12,this.keyManager.getRootKeyParams();case 12:return(c=e.sent)&&n!==q.FileDecrypted&&(u.keyParams=c.getPortableValue()),l=2,e.abrupt("return",JSON.stringify(u,null,l));case 16:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})}])&&ou(r.prototype,n),a&&ou(r,a),t}(ya);function lu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var pu=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.item=Object(o.e)({},t),this.defaultContentKeyToDiffOn="text",this.textCharDiffLength=0,Object(o.n)(this.item.updated_at)&&(this.item.updated_at=new Date(this.item.updated_at))}var t,r,n;return t=e,(r=[{key:"setPreviousEntry",value:function(e){this.hasPreviousEntry=null!=e,this.item.content[this.defaultContentKeyToDiffOn]&&(this.textCharDiffLength=e?this.item.content[this.defaultContentKeyToDiffOn].length-e.item.content[this.defaultContentKeyToDiffOn].length:this.item.content[this.defaultContentKeyToDiffOn].length)}},{key:"operationVector",value:function(){return void 0!==this.textCharDiffLength?this.hasPreviousEntry&&0!==this.textCharDiffLength?this.textCharDiffLength<0?-1:1:0:1}},{key:"deltaSize",value:function(){return void 0!==this.textCharDiffLength?Math.abs(this.textCharDiffLength):1}},{key:"isSameAsEntry",value:function(e){if(!e)return!1;var t=new H(ra({object:this.item})),r=new H(ra({object:e.item}));return t.isItemContentEqualWith(r)}}])&&lu(t.prototype,r),n&&lu(t,n),e}();function fu(e){return(fu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yu(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function hu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vu(e,t){return!t||"object"!==fu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function du(e){return(du=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mu(e,t){return(mu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var gu=function(e){function t(){return yu(this,t),vu(this,du(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mu(e,t)}(t,e),r=t,(n=[{key:"previewTitle",value:function(){return this.item.updated_at.toLocaleString()}},{key:"previewSubTitle",value:function(){return this.hasPreviousEntry?this.textCharDiffLength<0?"".concat(-1*this.textCharDiffLength," characters removed"):this.textCharDiffLength>0?"".concat(this.textCharDiffLength," characters added"):"Title or metadata changed":"".concat(this.textCharDiffLength," characters loaded")}}])&&hu(r.prototype,n),o&&hu(r,o),t}(pu);function bu(e){var t,r,n,o=(t={},r=i.Note,n=gu,r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t)[e.content_type];if(!o)throw"Invalid item history class";return new o(e)}function wu(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ku(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var xu=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(wu(this,e),this.entries||(this.entries=[]),t.entries){var r=!0,n=!1,o=void 0;try{for(var a,i=t.entries[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value,u=this.createEntryForItem(s.item);u.setPreviousEntry(this.getLastEntry()),this.entries.push(u)}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}}}var t,r,n;return t=e,(r=[{key:"createEntryForItem",value:function(e){return bu(e)}},{key:"getLastEntry",value:function(){return this.entries[this.entries.length-1]}},{key:"addHistoryEntryForItem",value:function(e){var t=this.createEntryForItem(e),r=this.getLastEntry();if(t.setPreviousEntry(r),!t.isSameAsEntry(r))return this.entries.push(t),t}},{key:"clear",value:function(){this.entries.length=0}},{key:"optimize",value:function(){var e=this,t=[],r=function(e){return e.deltaSize()>15},n=function(n,o,a){if(a)t.push(n);else{var i=t.indexOf(n);-1!==i&&t.splice(i,1)}if(a&&r(n)&&-1===n.operationVector()){var s=e.entries[o-1];s&&t.push(s)}};this.entries.forEach((function(t,o){if(0===o||o===e.entries.length-1)n(t,o,!0);else{var a=r(t);n(t,o,a)}})),this.entries=this.entries.filter((function(e,r){return-1!==t.indexOf(e)}))}}])&&ku(t.prototype,r),n&&ku(t,n),e}();function Su(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ru=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,t),this.content||(this.content={}),this.content.itemUUIDToItemHistoryMapping||(this.content.itemUUIDToItemHistoryMapping={}),Object.keys(this.content.itemUUIDToItemHistoryMapping).forEach((function(e){var t=r.content.itemUUIDToItemHistoryMapping[e];r.content.itemUUIDToItemHistoryMapping[e]=new xu(t)})),this.setItemRevisionThreshold(60)}var t,r,n;return t=e,(r=[{key:"addEntryForItem",value:function(e){return this.historyForItem(e).addHistoryEntryForItem(e)}},{key:"historyForItem",value:function(e){var t=this.content.itemUUIDToItemHistoryMapping[e.uuid];return t||(t=new xu,this.content.itemUUIDToItemHistoryMapping[e.uuid]=t),t}},{key:"clearItemHistory",value:function(e){this.historyForItem(e).clear()}},{key:"clearAllHistory",value:function(){this.content.itemUUIDToItemHistoryMapping={}}},{key:"setItemRevisionThreshold",value:function(e){this.itemRevisionThreshold=e}},{key:"optimizeHistoryForItem",value:function(e){var t=this.historyForItem(e);t.entries.length>this.itemRevisionThreshold&&t.optimize()}}])&&Su(t.prototype,r),n&&Su(t,n),e}();function Pu(e){return(Pu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ou(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function _u(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Ou(a,n,o,i,s,"next",e)}function s(e){Ou(a,n,o,i,s,"throw",e)}i(void 0)}))}}function ju(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Iu(e,t){return!t||"object"!==Pu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Du(e){return(Du=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Cu(e,t){return(Cu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Eu=function(e){function t(e){var r,n=e.modelManager,o=e.storageService,a=e.contentTypes,i=e.timeout;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Iu(this,Du(t).call(this))).modelManager=n,r.storageService=o,r.contentTypes=a,r.timeout=i,r}var r,n,a,i,s,u,c,l,p,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Cu(e,t)}(t,e),r=t,(n=[{key:"initializeFromDisk",value:(f=_u(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.getValue(E.SessionHistoryPersistable);case 2:return this.persistable=e.sent,e.next=5,this.storageService.getValue(E.SessionHistoryRevisions).then((function(e){return new Ru(e)}));case 5:return this.historySession=e.sent,e.next=8,this.storageService.getValue(E.SessionHistoryOptimize);case 8:t=e.sent,Object(o.l)(t)?this.autoOptimize=!0:this.autoOptimize=t,this.addMappingObserver();case 11:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"addMappingObserver",value:function(){var e=this;this.modelManager.addMappingObserver(this.contentTypes,(function(t,r,n,o,a){if(o!==en.LocalDirtied){var i=!0,s=!1,u=void 0;try{for(var c,l=t[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var p=c.value;try{p.deleted||e.addHistoryEntryForItem(p)}catch(e){console.error("Unable to add item history entry:",e)}}}catch(e){s=!0,u=e}finally{try{i||null==l.return||l.return()}finally{if(s)throw u}}}}))}},{key:"isDiskEnabled",value:function(){return this.persistable}},{key:"isAutoOptimizeEnabled",value:function(){return this.autoOptimize}},{key:"saveToDisk",value:(p=_u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.persistable){e.next=2;break}return e.abrupt("return");case 2:this.storageService.setValue(E.SessionHistoryRevisions,this.historySession);case 3:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"setSessionItemRevisionThreshold",value:function(e){this.historySession.setItemRevisionThreshold(e)}},{key:"addHistoryEntryForItem",value:(l=_u(regeneratorRuntime.mark((function e(t){var r,n,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={uuid:t.uuid,content_type:t.content_type,updated_at:t.updated_at,content:t.getContentCopy()},n=this.historySession.addEntryForItem(r),this.autoOptimize&&this.historySession.optimizeHistoryForItem(t),n&&this.persistable&&(this.diskTimeout&&(this.timeout.hasOwnProperty("cancel")?this.timeout.cancel(this.diskTimeout):clearTimeout(this.diskTimeout)),this.diskTimeout=this.timeout((function(){o.saveToDisk()}),2e3));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"historyForItem",value:function(e){return this.historySession.historyForItem(e)}},{key:"clearHistoryForItem",value:(c=_u(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.historySession.clearItemHistory(t),e.abrupt("return",this.saveToDisk());case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"clearAllHistory",value:(u=_u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.historySession.clearAllHistory(),e.abrupt("return",this.storageService.removeValue(E.SessionHistoryRevisions));case 2:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"toggleDiskSaving",value:(s=_u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.persistable=!this.persistable,!this.persistable){e.next=6;break}this.storageService.setValue(E.SessionHistoryPersistable,!0),this.saveToDisk(),e.next=8;break;case 6:return this.storageService.setValue(E.SessionHistoryPersistable,!1),e.abrupt("return",this.storageService.removeValue(E.SessionHistoryRevisions));case 8:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"toggleAutoOptimize",value:(i=_u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.autoOptimize=!this.autoOptimize,this.autoOptimize?this.storageService.setValue(E.SessionHistoryOptimize,!0):this.storageService.setValue(E.SessionHistoryOptimize,!1);case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})}])&&ju(r.prototype,n),a&&ju(r,a),t}(ya);function Au(e){return(Au="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Tu(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Mu(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Tu(a,n,o,i,s,"next",e)}function s(e){Tu(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Ku(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Fu(e,t){return!t||"object"!==Au(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Lu(e){return(Lu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Nu(e,t){return(Nu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Uu={ManageExtensions:"ActionManageExtensions",ManageBackups:"ActionManageBackups",ViewProtectedNotes:"ActionViewProtectedNotes",ManagePrivileges:"ActionManagePrivileges",ManagePasscode:"ActionManagePasscode",DeleteNote:"ActionDeleteNote"},Bu={AccountPassword:"CredentialAccountPassword",LocalPasscode:"CredentialLocalPasscode"},Vu=0,Hu=300,Wu=3600,zu=604800,qu=function(e){function t(e){var r,n=e.modelManager,o=e.syncService,a=e.singletonManager,i=e.keyManager,s=e.storageService,u=e.sessionManager;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!(n&&o&&a&&i))throw"Invalid privileges manager construction.";return(r=Fu(this,Lu(t).call(this))).modelManager=n,r.syncService=o,r.singletonManager=a,r.keyManager=i,r.storageService=s,r.sessionManager=u,r.loadDefaults(),r}var r,n,o,a,i,s,u,c,l,p,f,h,v,d;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nu(e,t)}(t,e),r=t,(n=[{key:"loadDefaults",value:function(){this.availableActions=Object.keys(Uu).map((function(e){return Uu[e]})),this.availableCredentials=[Bu.AccountPassword,Bu.LocalPasscode],this.sessionLengths=[Vu,Hu,Wu,zu]}},{key:"getAvailableActions",value:function(){return this.availableActions}},{key:"getAvailableCredentials",value:function(){return this.availableCredentials}},{key:"netCredentialsForAction",value:(d=Mu(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPrivileges();case 2:r=e.sent,n=r.getCredentialsForAction(t),o=[],a=!0,i=!1,s=void 0,e.prev=8,u=n[Symbol.iterator]();case 10:if(a=(c=u.next()).done){e.next=27;break}if((l=c.value)!==Bu.AccountPassword){e.next=19;break}return e.next=15,this.sessionManager.online();case 15:e.sent&&o.push(l),e.next=24;break;case 19:if(l!==Bu.LocalPasscode){e.next=24;break}return e.next=22,this.keyManager.hasRootKeyWrapper();case 22:e.sent&&o.push(l);case 24:a=!0,e.next=10;break;case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(8),i=!0,s=e.t0;case 33:e.prev=33,e.prev=34,a||null==u.return||u.return();case 36:if(e.prev=36,!i){e.next=39;break}throw s;case 39:return e.finish(36);case 40:return e.finish(33);case 41:return e.abrupt("return",o);case 42:case"end":return e.stop()}}),e,this,[[8,29,33,41],[34,,36,40]])}))),function(e){return d.apply(this,arguments)})},{key:"getPrivileges",value:(v=Mu(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=wr.contentType(),r=new y("content_type","=",t),e.abrupt("return",this.singletonManager.findOrCreateSingleton({predicate:r,createPayload:ra({object:{content_type:t,content:{}}})}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"savePrivileges",value:(h=Mu(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPrivileges();case 2:return t=e.sent,e.next=5,this.modelManager.setItemDirty(t);case 5:return e.abrupt("return",this.syncService.sync());case 6:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"setSessionLength",value:(f=Mu(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,o=void 0,(o=new Date).setSeconds(o.getSeconds()+n),r=o,e.next=4,this.storageService.setValue(E.PrivilegesExpirey,r);case 4:return e.next=6,this.storageService.setValue(E.PrivilegesSessionLength,t);case 6:case"end":return e.stop()}var n,o}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"clearSession",value:(p=Mu(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.setSessionLength(Vu));case 1:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"getSelectedSessionLength",value:(l=Mu(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.getValue(E.PrivilegesSessionLength);case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t);case 7:return e.abrupt("return",Vu);case 8:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"getSessionExpirey",value:(c=Mu(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.getValue(E.PrivilegesExpirey);case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",new Date(t));case 7:return e.abrupt("return",new Date);case 8:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"actionHasPrivilegesConfigured",value:(u=Mu(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.netCredentialsForAction(t);case 2:return e.t0=e.sent.length,e.abrupt("return",e.t0>0);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"actionRequiresPrivilege",value:(s=Mu(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionExpirey();case 2:if(!(e.sent>new Date)){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,this.netCredentialsForAction(t);case 7:return r=e.sent,e.abrupt("return",r.length>0);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"authenticateAction",value:(i=Mu(regeneratorRuntime.mark((function e(t,r){var n,o,a,i,s,u,c,l,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.netCredentialsForAction(t);case 2:n=e.sent,o=[],a=[],i=!0,s=!1,u=void 0,e.prev=8,c=n[Symbol.iterator]();case 10:if(i=(l=c.next()).done){e.next=19;break}return p=l.value,e.next=14,this.verifyAuthenticationParameters(p,r[p]);case 14:e.sent?o.push(p):a.push(p);case 16:i=!0,e.next=10;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(8),s=!0,u=e.t0;case 25:e.prev=25,e.prev=26,i||null==c.return||c.return();case 28:if(e.prev=28,!s){e.next=31;break}throw u;case 31:return e.finish(28);case 32:return e.finish(25);case 33:return e.abrupt("return",{success:0===a.length,successfulCredentials:o,failedCredentials:a});case 34:case"end":return e.stop()}}),e,this,[[8,21,25,33],[26,,28,32]])}))),function(e,t){return i.apply(this,arguments)})},{key:"verifyAuthenticationParameters",value:(a=Mu(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==Bu.AccountPassword){e.next=4;break}return e.abrupt("return",this.keyManager.validateAccountPassword(r));case 4:if(t!==Bu.LocalPasscode){e.next=6;break}return e.abrupt("return",this.keyManager.validatePasscode(r));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"displayInfoForCredential",value:function(e){var t={};return t[Bu.AccountPassword]={label:"Account Password",prompt:"Please enter your account password."},t[Bu.LocalPasscode]={label:"Local Passcode",prompt:"Please enter your local passcode."},t[e]}},{key:"displayInfoForAction",value:function(e){var t={};return t[Uu.ManageExtensions]={label:"Manage Extensions"},t[Uu.ManageBackups]={label:"Download/Import Backups"},t[Uu.ViewProtectedNotes]={label:"View Protected Notes"},t[Uu.ManagePrivileges]={label:"Manage Privileges"},t[Uu.ManagePasscode]={label:"Manage Passcode"},t[Uu.DeleteNote]={label:"Delete Notes"},t[e]}},{key:"getSessionLengthOptions",value:function(){return[{value:Vu,label:"Don't Remember"},{value:Hu,label:"5 Minutes"},{value:Wu,label:"1 Hour"},{value:zu,label:"1 Week"}]}}])&&Ku(r.prototype,n),o&&Ku(r,o),t}(ya);function Yu(e){return(Yu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ju(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Gu(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Ju(a,n,o,i,s,"next",e)}function s(e){Ju(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Qu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $u(e){return($u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xu(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zu(e,t){return(Zu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ec=0,tc=1,rc=2,nc=3,oc=function(e){function t(e){var r,n=e.modelManager,o=e.storageService,a=e.protocolService,i=e.itemsKeyManager,s=e.deviceInterface;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!(n&&o&&a&&i&&s))throw"Invalid KeyManager construction";return(r=function(e,t){return!t||"object"!==Yu(t)&&"function"!=typeof t?Xu(e):t}(this,$u(t).call(this))).keyMode=ec,r.protocolService=a,r.modelManager=n,r.storageService=o,r.itemsKeyManager=i,r.deviceInterface=s,r.keyObservers=[],Object.defineProperty(Xu(r),"rootKey",{enumerable:!1,writable:!0}),r}var r,n,a,s,u,c,l,p,f,y,h,v,d,m,g,b,w,k,x,S,R,P,O,_,j,I;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zu(e,t)}(t,e),r=t,(n=[{key:"initialize",value:(I=Gu(regeneratorRuntime.mark((function e(){var t,r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWrappedRootKeyFromStorage();case 2:return t=e.sent,e.next=5,this.getAccountKeyParams();case 5:return r=e.sent,e.next=8,this.hasRootKeyWrapper();case 8:if(n=e.sent,a=!Object(o.l)(t)||!Object(o.l)(r),!n||!a){e.next=14;break}this.keyMode=rc,e.next=27;break;case 14:if(!n||a){e.next=18;break}this.keyMode=nc,e.next=27;break;case 18:if(n||!a){e.next=22;break}this.keyMode=tc,e.next=27;break;case 22:if(n||a){e.next=26;break}this.keyMode=ec,e.next=27;break;case 26:throw"Invalid key mode condition";case 27:if(this.keyMode!==tc){e.next=33;break}return e.next=30,this.getRootKeyFromKeychain();case 30:return this.rootKey=e.sent,e.next=33,this.notifyObserversOfChange();case 33:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"onStatusChange",value:function(e){var t=this;return this.keyObservers.push(e),function(){Object(o.u)(t.keyObservers,e)}}},{key:"notifyObserversOfChange",value:(j=Gu(regeneratorRuntime.mark((function e(){var t,r,n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,r=!1,n=void 0,e.prev=3,o=this.keyObservers[Symbol.iterator]();case 5:if(t=(a=o.next()).done){e.next=12;break}return i=a.value,e.next=9,i();case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),r=!0,n=e.t0;case 18:e.prev=18,e.prev=19,t||null==o.return||o.return();case 21:if(e.prev=21,!r){e.next=24;break}throw n;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))),function(){return j.apply(this,arguments)})},{key:"getRootKeyFromKeychain",value:(_=Gu(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deviceInterface.getKeychainValue();case 2:if(t=e.sent,!Object(o.l)(t)){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,ee.Create({content:t});case 7:return r=e.sent,e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"saveRootKeyToKeychain",value:(O=Gu(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(o.l)(this.rootKey)){e.next=2;break}throw"Attempting to non-existent root key to the keychain.";case 2:if(this.keyMode===tc){e.next=4;break}throw"Should not be persisting wrapped key to keychain.";case 4:return t=this.rootKey.getPersistableValue(),e.next=7,this.deviceInterface.setKeychainValue(t);case 7:case"end":return e.stop()}}),e,this)}))),function(){return O.apply(this,arguments)})},{key:"hasRootKeyWrapper",value:(P=Gu(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRootKeyWrapperKeyParams();case 2:return t=e.sent,e.abrupt("return",!Object(o.l)(t));case 4:case"end":return e.stop()}}),e,this)}))),function(){return P.apply(this,arguments)})},{key:"hasPasscode",value:function(){return this.keyMode===nc||this.keyMode===rc}},{key:"rootKeyNeedsUnwrapping",value:(R=Gu(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.hasRootKeyWrapper();case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}e.t0=Object(o.l)(this.rootKey);case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)})},{key:"getRootKeyWrapperKeyParams",value:(S=Gu(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.getValue(E.RootKeyWrapperKeyParams,Ss.Nonwrapped);case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",this.protocolService.createKeyParams(t));case 6:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"getWrappedRootKeyFromStorage",value:(x=Gu(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageService.getValue(E.WrappedRootKey,Ss.Nonwrapped));case 1:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"getRootKeyParams",value:(k=Gu(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.keyMode!==nc){e.next=4;break}return e.abrupt("return",this.getRootKeyWrapperKeyParams());case 4:if(this.keyMode!==tc&&this.keyMode!==rc){e.next=8;break}return e.abrupt("return",this.getAccountKeyParams());case 8:throw"Unhandled key mode for getRootKeyParams ".concat(this.keyMode);case 9:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"getAccountKeyParams",value:(w=Gu(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.getValue(E.RootKeyParams,Ss.Nonwrapped);case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",this.protocolService.createKeyParams(t));case 6:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"validateWrappingKey",value:(b=Gu(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWrappedRootKeyFromStorage();case 2:if(r=e.sent,this.keyMode!==nc){e.next=7;break}return e.abrupt("return",this.storageService.canDecryptWithKey(t));case 7:if(this.keyMode!==tc&&this.keyMode!==rc){e.next=15;break}return n=ra({object:r}),e.next=11,this.protocolService.payloadByDecryptingPayload({payload:n,key:t});case 11:return o=e.sent,e.abrupt("return",!o.errorDecrypting);case 15:throw"Unhandled case in validateWrappingKey";case 16:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"computeWrappingKey",value:(g=Gu(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.passcode,e.next=3,this.getRootKeyWrapperKeyParams();case 3:return n=e.sent,e.next=6,this.protocolService.computeRootKey({password:r,keyParams:n});case 6:return o=e.sent,e.abrupt("return",o);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"unwrapRootKey",value:(m=Gu(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.wrappingKey,this.keyMode!==nc){e.next=4;break}return this.rootKey=r,e.abrupt("return");case 4:if(this.keyMode===rc){e.next=6;break}throw"Invalid key mode condition for unwrapping.";case 6:return e.next=8,this.getWrappedRootKeyFromStorage();case 8:return n=e.sent,o=ra({object:n}),e.next=12,this.protocolService.payloadByDecryptingPayload({payload:o,key:r});case 12:if(!(a=e.sent).errorDecrypting){e.next=17;break}throw"Unable to decrypt root key with provided wrapping key.";case 17:return e.next=19,ee.Create({uuid:a.uuid,content:a.content});case 19:return this.rootKey=e.sent,e.next=22,this.notifyObserversOfChange();case 22:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"setNewRootKeyWrapper",value:(d=Gu(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.wrappingKey,n=t.keyParams,this.keyMode!==ec){e.next=5;break}this.keyMode=nc,e.next=10;break;case 5:if(this.keyMode!==tc){e.next=9;break}this.keyMode=rc,e.next=10;break;case 9:throw"Attempting to set wrapper on already wrapped key.";case 10:return e.next=12,this.deviceInterface.clearKeychainValue();case 12:if(this.keyMode!==nc&&this.keyMode!==rc){e.next=27;break}if(this.keyMode!==nc){e.next=19;break}return this.rootKey=r,e.next=17,this.itemsKeyManager.reencryptItemsKeys();case 17:e.next=21;break;case 19:return e.next=21,this.wrapAndPersistRootKey({wrappingKey:r});case 21:return e.next=23,this.storageService.setValue(E.RootKeyWrapperKeyParams,n.getPortableValue(),Ss.Nonwrapped);case 23:return e.next=25,this.notifyObserversOfChange();case 25:e.next=28;break;case 27:throw"Invalid keyMode on setNewRootKeyWrapper";case 28:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"wrapAndPersistRootKey",value:(v=Gu(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.wrappingKey,n=ra({object:this.rootKey,override:{content:this.rootKey.getPersistableValue()}}),e.next=4,this.protocolService.payloadByEncryptingPayload({payload:n,key:r,intent:q.LocalStorageEncrypted});case 4:return o=e.sent,e.next=7,this.storageService.setValue(E.WrappedRootKey,o,Ss.Nonwrapped);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"removeRootKeyWrapper",value:(h=Gu(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.keyMode===nc||this.keyMode===rc){e.next=2;break}throw"Attempting to remove root key wrapper on unwrapped key.";case 2:return this.keyMode===nc?(this.keyMode=ec,this.rootKey=null):this.keyMode===rc&&(this.keyMode=tc),e.next=5,this.storageService.removeValue(E.WrappedRootKey,Ss.Nonwrapped);case 5:return e.next=7,this.storageService.removeValue(E.RootKeyWrapperKeyParams,Ss.Nonwrapped);case 7:if(this.keyMode!==tc){e.next=10;break}return e.next=10,this.saveRootKeyToKeychain();case 10:return e.next=12,this.notifyObserversOfChange();case 12:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"setNewRootKey",value:(y=Gu(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.key,n=t.keyParams,r.isRootKey){e.next=3;break}throw"Root key must be a ".concat(i.RootKey," object.");case 3:if(n){e.next=5;break}throw"keyParams must be supplied if setting root key.";case 5:if(this.keyMode!==nc){e.next=9;break}this.keyMode=rc,e.next=17;break;case 9:if(this.keyMode!==ec){e.next=13;break}this.keyMode=tc,e.next=17;break;case 13:if(this.keyMode!==tc&&this.keyMode!==rc){e.next=16;break}e.next=17;break;case 16:throw"Unhandled key mode for setNewRootKey ".concat(this.keyMode);case 17:if(o=this.rootKey,this.rootKey=r,o!==r){e.next=21;break}throw"Attempting to set root key as same current value.";case 21:return e.next=23,this.storageService.setValue(E.RootKeyParams,n.getPortableValue(),Ss.Nonwrapped);case 23:if(this.keyMode!==tc){e.next=28;break}return e.next=26,this.saveRootKeyToKeychain();case 26:e.next=31;break;case 28:if(this.keyMode!==rc){e.next=31;break}return e.next=31,this.wrapAndPersistRootKey({wrappingKey:o});case 31:return e.next=33,this.notifyObserversOfChange(i.RootKey);case 33:return e.next=35,this.itemsKeyManager.reencryptItemsKeys();case 35:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"getRootKey",value:(f=Gu(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rootKey);case 1:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"clearLocalKeyState",value:(p=Gu(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deviceInterface.clearKeychainValue();case 2:return e.next=4,this.storageService.removeValue(E.WrappedRootKey,Ss.Nonwrapped);case 4:return e.next=6,this.storageService.removeValue(E.RootKeyWrapperKeyParams,Ss.Nonwrapped);case 6:return e.next=8,this.storageService.removeValue(E.RootKeyParams,Ss.Nonwrapped);case 8:return this.keyMode=ec,this.rootKey=null,e.next=12,this.notifyObserversOfChange();case 12:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"validateAccountPassword",value:(l=Gu(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRootKeyParams();case 2:return r=e.sent,e.next=5,this.protocolService.computeRootKey({password:t,keyParams:r});case 5:return n=e.sent,o=n.compare(this.rootKey),e.abrupt("return",o?n:null);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"validatePasscode",value:(c=Gu(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRootKeyWrapperKeyParams();case 2:return r=e.sent,e.next=5,this.protocolService.computeRootKey({password:t,keyParams:r});case 5:return n=e.sent,e.abrupt("return",this.validateWrappingKey(n));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"contentTypeUsesRootKeyEncryption",value:function(e){return e===i.ItemsKey||e===i.EncryptedStorage}},{key:"keyToUseForEncryptionOfPayload",value:(u=Gu(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.payload,n=t.intent,!Object(o.l)(n)){e.next=3;break}throw"Intent must be supplied when looking up key for encryption of item.";case 3:if(!this.contentTypeUsesRootKeyEncryption(r.content_type)){e.next=16;break}return e.next=6,this.getRootKey();case 6:if(a=e.sent){e.next=13;break}if(!Q(n)){e.next=12;break}throw"Root key encryption is required but no root key is available.";case 12:return e.abrupt("return",null);case 13:return e.abrupt("return",a);case 16:return e.abrupt("return",this.itemsKeyManager.getDefaultItemsKey());case 17:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"keyToUseForDecryptionOfPayload",value:(s=Gu(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.payload,!this.contentTypeUsesRootKeyEncryption(r.content_type)){e.next=3;break}return e.abrupt("return",this.getRootKey());case 3:if(!r.items_key_id){e.next=6;break}return n=this.itemsKeyManager.itemsKeyForPayload(r),e.abrupt("return",n);case 6:if((o=r.version)!==this.protocolService.getLatestVersion()){e.next=9;break}throw"No associated key found for item encrypted with latest protocol version.";case 9:return e.abrupt("return",this.itemsKeyManager.defaultItemsKeyForItemVersion(o));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})}])&&Qu(r.prototype,n),a&&Qu(r,a),t}(ya);function ac(e){return(ac="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ic(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function sc(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){ic(a,n,o,i,s,"next",e)}function s(e){ic(a,n,o,i,s,"throw",e)}i(void 0)}))}}function uc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function cc(e,t){return!t||"object"!==ac(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function lc(e){return(lc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pc(e,t){return(pc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var fc=W.V003,yc=function(e){function t(e){var r,n=e.syncService,o=e.modelManager,a=e.protocolService;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=cc(this,lc(t).call(this))).syncService=n,r.modelManager=o,r.protocolService=a,r.keyObservers=[],r.registerSyncObserver(),r.modelManager.addMappingObserver([i.ItemsKey],sc(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.notifyObserversOfChange();case 2:case"end":return e.stop()}}),e)})))),r}var r,n,a,s,u,c,l,p,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pc(e,t)}(t,e),r=t,(n=[{key:"setKeyManager",value:function(e){this.keyManager=e}},{key:"addItemsKeyChangeObserver",value:function(e){var t=this;return this.keyObservers.push(e),function(){Object(o.u)(t.keyObservers,e)}}},{key:"notifyObserversOfChange",value:(f=sc(regeneratorRuntime.mark((function e(){var t,r,n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,r=!1,n=void 0,e.prev=3,o=this.keyObservers[Symbol.iterator]();case 5:if(t=(a=o.next()).done){e.next=12;break}return i=a.value,e.next=9,i();case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),r=!0,n=e.t0;case 18:e.prev=18,e.prev=19,t||null==o.return||o.return();case 21:if(e.prev=21,!r){e.next=24;break}throw n;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))),function(){return f.apply(this,arguments)})},{key:"registerSyncObserver",value:function(){var e=this;this.syncService.addEventObserver(function(){var t=sc(regeneratorRuntime.mark((function t(r){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r!==h.FullSyncCompleted){t.next=3;break}return t.next=3,e.handleFullSyncCompletion();case 3:if(r!==h.DownloadFirstSyncCompleted){t.next=6;break}return t.next=6,e.handleDownloadFirstSyncCompletion();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"handleDownloadFirstSyncCompletion",value:(p=sc(regeneratorRuntime.mark((function e(){var t,r,n,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.allItemsKeys,r=t.filter((function(e){return e.neverSynced})),n=t.find((function(e){return!e.neverSynced&&e.isDefault})),Object(o.l)(n)){e.next=9;break}return e.next=7,this.modelManager.setItemsToBeDeleted(r);case 7:e.next=20;break;case 9:return e.next=11,this.keyManager.getRootKey();case 11:if(!(a=e.sent)){e.next=20;break}if(!((i=r.filter((function(e){return e.version!==a.version}))).length>0)){e.next=17;break}return e.next=17,this.modelManager.setItemsToBeDeleted(i);case 17:if(0!==t.length){e.next=20;break}return e.next=20,this.createNewDefaultItemsKey();case 20:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"handleFullSyncCompletion",value:(l=sc(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.getDefaultItemsKey()){e.next=6;break}return e.next=4,this.createNewDefaultItemsKey();case 4:if(this.keyManager.keyMode!==nc){e.next=6;break}return e.abrupt("return",this.syncService.repersistAllItems());case 6:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"itemsKeyForPayload",value:function(e){return this.allItemsKeys.find((function(t){return t.uuid===e.items_key_id}))}},{key:"getDefaultItemsKey",value:function(){return 1===this.allItemsKeys.length?this.allItemsKeys[0]:this.allItemsKeys.find((function(e){return e.isDefault}))}},{key:"reencryptItemsKeys",value:(c=sc(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=this.allItemsKeys).length>0)){e.next=4;break}return e.next=4,this.modelManager.setItemsDirty(t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"defaultItemsKeyForItemVersion",value:(u=sc(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.allItemsKeys.find((function(e){return e.version===t})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"createNewDefaultItemsKey",value:(s=sc(regeneratorRuntime.mark((function e(){var t,r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keyManager.getRootKey();case 2:if(t=e.sent,!(z(r=t?t.version:this.protocolService.getLatestVersion(),fc)<=0)){e.next=10;break}return n=it.FromRaw({itemsKey:t.masterKey,dataAuthenticationKey:t.dataAuthenticationKey,version:r}),e.next=8,n.initUUID();case 8:e.next=13;break;case 10:return e.next=12,this.protocolService.operatorForVersion(r).createItemsKey();case 12:n=e.sent;case 13:if(!(o=this.getDefaultItemsKey())){e.next=18;break}return o.content.isDefault=!1,e.next=18,this.modelManager.setItemDirty(o);case 18:return n.content.isDefault=!0,a=n.payloadRepresentation({override:{dirty:!0}}),e.next=22,this.modelManager.mapPayloadToLocalItem({payload:a});case 22:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"allItemsKeys",get:function(){return this.modelManager.itemsKeys}}])&&uc(r.prototype,n),a&&uc(r,a),t}(ya);function hc(e,t){return e.sort((function(e,r){var n=new Date(r.updated_at)-new Date(e.updated_at),o=0,a=0;return t&&(o=t.indexOf(e.content_type),a=t.indexOf(r.content_type),-1===o&&(o=t.length),-1===a&&(a=t.length)),o===a?n:o<a?-1:1}))}function vc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var dc=function(){function e(t){var r=t.interval,n=t.receiver;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.interval=r,this.receiver=n}var t,r,n;return t=e,(r=[{key:"setSyncInProgress",value:function(e){this.inProgress=!0}},{key:"setUploadStatus",value:function(e){var t=e.completed,r=e.total;this.completedUpload=t,this.totalUpload=r}},{key:"setDownloadStatus",value:function(e){var t=e.downloaded;this.downloaded=t}},{key:"setDatabaseLoadStatus",value:function(e){var t=e.current,r=e.total,n=e.done;this.databaseLoadCurrent=t,this.databaseLoadTotal=r,this.databaseLoadDone=n}},{key:"setDidBegin",value:function(){this.syncing=!0,this.syncStart=new Date}},{key:"setDidEnd",value:function(){this.syncing=!1,this.syncEnd=new Date}},{key:"startTimingMonitor",value:function(){var e=this;this.timingMonitor&&this.this.stopTimingMonitor(),this.timingMonitor=this.interval((function(){e.secondsSinceSyncStart>5&&(e.receiver(h.SyncTakingTooLong),e.stopTimingMonitor())}),500)}},{key:"stopTimingMonitor",value:function(){this.interval.hasOwnProperty("cancel")?this.interval.cancel(this.timingMonitor):clearInterval(this.timingMonitor),this.timingMonitor=null}},{key:"hasError",value:function(){return this.error}},{key:"setError",value:function(e){this.error=e}},{key:"clearError",value:function(){this.error=null}},{key:"reset",value:function(){this.downloaded=0,this.completedUpload=0,this.totalUpload=0,this.inProgress=!1,this.syncing=!1,this.error=null}},{key:"syncInProgress",get:function(){return!0===this.syncing}},{key:"secondsSinceSyncStart",get:function(){return(new Date-this.syncStart)/1e3}}])&&vc(t.prototype,r),n&&vc(t,n),e}();function mc(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function gc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var bc=function(){function e(t){var r=t.receiver,n=t.maxDiscordance;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.discordance=0,this.receiver=r,this.maxDiscordance=n,this.reset()}var t,r,n,o,a;return t=e,(r=[{key:"setLastPresaveSyncDate",value:function(e){this._lastPreSyncSave=e}},{key:"setLastSyncDate",value:function(e){this._lastSyncDate=e}},{key:"isOutOfSync",value:function(){return this.outOfSync}},{key:"reset",value:function(){this._lastSyncDate=null,this._lastPreSyncSave=null,this.discordance=0,this.outOfSync=!1}},{key:"getLastClientIntegrityHash",value:function(){return this.lastClientHash}},{key:"clearIntegrityHashes",value:function(){this.lastClientHash=null,this.lastServerHash=null}},{key:"setIntegrityHashes",value:(o=regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.clientHash,n=t.serverHash,this.lastClientHash=r,this.lastServerHash=n,n&&0!==n.length&&r&&r!==n?(this.discordance++,this.discordance>=this.maxDiscordance&&!this.outOfSync&&(this.outOfSync=!0,this.receiver(h.EnterOutOfSync))):(this.outOfSync&&(this.outOfSync=!1,this.receiver(h.ExitOutOfSync)),this.discordance=0);case 5:case"end":return e.stop()}}),e,this)})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=o.apply(e,t);function i(e){mc(a,r,n,i,s,"next",e)}function s(e){mc(a,r,n,i,s,"throw",e)}i(void 0)}))},function(e){return a.apply(this,arguments)})},{key:"lastPreSyncSaveDate",get:function(){return this._lastPreSyncSave}},{key:"lastSyncDate",get:function(){return this._lastSyncDate}},{key:"needsSync",get:function(){return this.discordance>0&&this.discordance<this.maxDiscordance}}])&&gc(t.prototype,r),n&&gc(t,n),e}();function wc(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function kc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var xc=function(){function e(t){var r=t.apiService,n=t.protocolService,o=t.contentType,a=t.customEvent,i=t.limit;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.apiService=r,this.protocolService=n,this.contentType=o,this.customEvent=a,this.limit=i,this.progressObj={retrievedPayloads:[]}}var t,r,n,o,a;return t=e,(r=[{key:"run",value:(o=regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.apiService.sync({lastSyncToken:this.progressObj.lastSyncToken,paginationToken:this.progressObj.paginationToken,limit:this.limit||500,contentType:this.contentType,customEvent:this.customEvent});case 2:return t=e.sent,r=t.retrieved_items.map((function(e){return oa({object:e,source:en.RemoteRetrieved})})),e.next=6,this.protocolService.payloadsByDecryptingPayloads({payloads:r});case 6:if(n=e.sent,this.progressObj.retrievedPayloads=this.progressObj.retrievedPayloads.concat(n),this.progressObj.lastSyncToken=t.sync_token,this.progressObj.paginationToken=t.cursor_token,!t.cursor_token){e.next=14;break}return e.abrupt("return",this.run());case 14:return e.abrupt("return",this.progressObj.retrievedPayloads);case 15:case"end":return e.stop()}}),e,this)})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=o.apply(e,t);function i(e){wc(a,r,n,i,s,"next",e)}function s(e){wc(a,r,n,i,s,"throw",e)}i(void 0)}))},function(){return a.apply(this,arguments)})}])&&kc(t.prototype,r),n&&kc(t,n),e}();function Sc(e){return e===en.RemoteRetrieved?qo:e===en.RemoteSaved?ta:e===en.ConflictData||e===en.ConflictUuid?Lo:void 0}function Rc(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Pc(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Rc(a,n,o,i,s,"next",e)}function s(e){Rc(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Oc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var _c=function(){function e(t){var r=t.response,n=t.decryptedResponsePayloads,o=t.baseCollection,a=t.payloadsSavedOrSaving;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.response=r,this.baseCollection=o,this.relatedCollectionSet=new p({collections:[new c({payloads:n,source:en.DecryptedTransient}),new c({payloads:a,source:en.SavedOrSaving})]})}var t,r,n,o,a;return t=e,(r=[{key:"collectionsByProcessingResponse",value:(a=Pc(regeneratorRuntime.mark((function e(){var t,r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.collectionByProcessingRawItems({rawItems:this.response.rawRetrievedItems,source:en.RemoteRetrieved});case 3:return r=e.sent,t.push(r),e.next=7,this.collectionByProcessingRawItems({rawItems:this.response.rawSavedItems,source:en.RemoteSaved});case 7:return n=e.sent,t.push(n),e.next=11,this.collectionByProcessingRawItems({rawItems:this.response.rawUuidConflictItems,source:en.ConflictUuid});case 11:return o=e.sent,t.push(o),e.next=15,this.collectionByProcessingRawItems({rawItems:this.response.rawDataConflictItems,source:en.ConflictData});case 15:return a=e.sent,t.push(a),e.abrupt("return",t);case 18:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"collectionByProcessingRawItems",value:(o=Pc(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,l,p=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.rawItems,n=t.source,o=r.map((function(e){return oa({object:e,source:n})})),a=new c({payloads:o,source:n}),i=Sc(n),s=new i({baseCollection:this.baseCollection,applyCollection:a,relatedCollectionSet:this.relatedCollectionSet}),e.next=7,s.resultingCollection();case 7:return u=e.sent,l=u.allPayloads.map((function(e){return ia({payload:e,override:{dirty:p.finalDirtyStateForPayload(e)}})})),e.abrupt("return",new c({payloads:l,source:n}));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"finalDirtyStateForPayload",value:function(e){var t=this.baseCollection.findPayload(e.uuid);return t?t.dirtiedDate>t.lastSyncBegan:e.dirty}}])&&Oc(t.prototype,r),n&&Oc(t,n),e}();function jc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ic=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rawResponse=t,Object(o.d)(this)}var t,r,n;return t=e,(r=[{key:"error",get:function(){return this.rawResponse.error}},{key:"lastSyncToken",get:function(){return this.rawResponse[Aa]}},{key:"paginationToken",get:function(){return this.rawResponse[Ta]}},{key:"integrityHash",get:function(){return this.rawResponse[Ka]}},{key:"checkIntegrity",get:function(){return this.integrityHash&&!this.paginationToken}},{key:"numberOfItemsInvolved",get:function(){return this.rawSavedItems.concat(this.rawRetrievedItems).concat(this.rawItemsFromConflicts).length}},{key:"allProcessedPayloads",get:function(){return this.retrievedPayloads.concat(this.savedPayloads).concat(this.conflictPayloads)}},{key:"savedPayloads",get:function(){return this.rawSavedItems.map((function(e){return oa({object:e,source:en.RemoteSaved})}))}},{key:"retrievedPayloads",get:function(){return this.rawRetrievedItems.map((function(e){return oa({object:e,source:en.RemoteRetrieved})}))}},{key:"conflictPayloads",get:function(){return this.rawItemsFromConflicts.map((function(e){return oa({object:e,source:en.RemoteRetrieved})}))}},{key:"rawSavedItems",get:function(){return this.rawResponse.saved_items||[]}},{key:"rawRetrievedItems",get:function(){return this.rawResponse.retrieved_items||[]}},{key:"rawUuidConflictItems",get:function(){return this.rawConflictObjects.filter((function(e){return"uuid_conflict"===e.type})).map((function(e){return e.unsaved_item||e.item}))}},{key:"rawDataConflictItems",get:function(){return this.rawConflictObjects.filter((function(e){return"sync_conflict"===e.type})).map((function(e){return e.server_item||e.item}))}},{key:"rawItemsFromConflicts",get:function(){var e=this.rawResponse.conflicts||[],t=this.rawResponse.unsaved||[],r=e.map((function(e){return e.unsaved_item||e.server_item})),n=t.map((function(e){return e.item}));return r.concat(n)}},{key:"rawConflictObjects",get:function(){var e=this.rawResponse.conflicts||[],t=this.rawResponse.unsaved||[];return e.concat(t)}},{key:"hasError",get:function(){return!Object(o.l)(this.rawResponse.error)}}])&&jc(t.prototype,r),n&&jc(t,n),e}();function Dc(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Cc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ec=function(){function e(t){var r=t.payloads,n=t.receiver,o=t.lastSyncToken,a=t.paginationToken,i=t.checkIntegrity,s=t.apiService;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.payloads=r,this.pendingPayloads=r,this.lastSyncToken=o,this.paginationToken=a,this.checkIntegrity=i,this.apiService=s,this.receiver=n,this.responses=[]}var t,r,n,a,i;return t=e,(r=[{key:"popPayloads",value:function(e){var t=this.pendingPayloads.slice(0,e);return Object(o.x)(this.pendingPayloads,t),t}},{key:"run",value:(a=regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.popPayloads(this.upLimit),e.next=3,this.apiService.sync({payloads:t,lastSyncToken:this.lastSyncToken,paginationToken:this.paginationToken,limit:this.downLimit,checkIntegrity:this.checkIntegrity});case 3:return r=e.sent,n=new Ic(r),this.responses.push(n),this.lastSyncToken=n.lastSyncToken,this.paginationToken=n.paginationToken,e.next=10,this.receiver(n,1);case 10:if(this.done){e.next=12;break}return e.abrupt("return",this.run());case 12:case"end":return e.stop()}}),e,this)})),i=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=a.apply(e,t);function i(e){Dc(o,r,n,i,s,"next",e)}function s(e){Dc(o,r,n,i,s,"throw",e)}i(void 0)}))},function(){return i.apply(this,arguments)})},{key:"payloadsSavedOrSaving",get:function(){return Object(o.b)(this.payloads,this.pendingPayloads)}},{key:"done",get:function(){return 0===this.pendingPayloads.length&&!this.paginationToken}},{key:"upLimit",get:function(){return 150}},{key:"downLimit",get:function(){return 150}},{key:"numberOfItemsInvolved",get:function(){var e=0,t=!0,r=!1,n=void 0;try{for(var o,a=this.responses[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)e+=o.value.numberOfItemsInvolved}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return e}}])&&Cc(t.prototype,r),n&&Cc(t,n),e}();function Ac(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Tc(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Mc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Kc=function(){function e(t){var r=t.payloads,n=t.receiver;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.payloads=r,this.receiver=n}var t,r,n,o,a;return t=e,(r=[{key:"run",value:(o=regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.payloads.map((function(e){var t;return oa({object:e,source:en.LocalSaved,override:(t={},Ac(t,ce.Dirty,!1),Ac(t,ce.LastSyncEnd,new Date),t)})})),r={payloads:t},e.next=4,this.receiver(r,1);case 4:case"end":return e.stop()}}),e,this)})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=o.apply(e,t);function i(e){Tc(a,r,n,i,s,"next",e)}function s(e){Tc(a,r,n,i,s,"throw",e)}i(void 0)}))},function(){return a.apply(this,arguments)})}])&&Mc(t.prototype,r),n&&Mc(t,n),e}();function Fc(e){return(Fc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Lc(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Nc(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Uc(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Bc(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Uc(a,n,o,i,s,"next",e)}function s(e){Uc(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Vc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Hc(e,t){return!t||"object"!==Fc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Wc(e,t,r){return(Wc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=zc(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function zc(e){return(zc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qc(e,t){return(qc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Yc=1,Jc=2,Gc={Default:1,DownloadFirst:2},Qc={External:1,SpawnQueue:2,ResolveQueue:3,MoreDirtyItems:4,AfterDownloadFirst:5,IntegrityCheck:6,ResolveOutOfSync:7},$c=function(e){function t(e){var r,n=e.sessionManager,o=e.protocolService,a=e.storageService,s=e.modelManager,u=e.apiService,c=e.interval;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Hc(this,zc(t).call(this))).sessionManager=n,r.protocolService=o,r.modelManager=s,r.storageService=a,r.apiService=u,r.interval=c,r.statusObservers=[],r.resolveQueue=[],r.spawnQueue=[],r.majorChangeThreshold=15,r.maxDiscordance=5,r.initializeStatus(),r.initializeState(),r.localLoadPriorty=[i.ItemsKey,i.UserPrefs,i.Privileges,i.Component,i.Theme],r.nonEncryptedTypes=[i.Mfa,i.ServerExtension],r}var r,n,a,s,u,l,p,f,y,v,d,m,g,b,w,k,x,S,R,P,O,_,j,I,D,C,A,T;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qc(e,t)}(t,e),r=t,(n=[{key:"initializeStatus",value:function(){var e=this;this.opStatus=new dc({interval:this.interval,receiver:function(t){e.notifyEvent(t)}})}},{key:"initializeState",value:function(){var e=this;this.state=new bc({maxDiscordance:this.maxDiscordance,receiver:function(t){t===h.EnterOutOfSync?e.notifyEvent(h.EnterOutOfSync):t===h.ExitOutOfSync&&e.notifyEvent(h.ExitOutOfSync)}})}},{key:"lockSyncing",value:function(){this.locked=!0}},{key:"unlockSyncing",value:function(){this.locked=!1}},{key:"isOutOfSync",value:function(){return this.state.isOutOfSync()}},{key:"getLastSyncDate",value:function(){return this.state.lastSyncDate}},{key:"resetSyncState",value:function(){this.state.reset()}},{key:"getDatabasePayloads",value:(T=Bc(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageService.getAllRawPayloads());case 1:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"isDatabaseLoaded",value:function(){return this.databaseLoaded}},{key:"loadDatabasePayloads",value:(A=Bc(regeneratorRuntime.mark((function e(t){var r,n,a,s,u,c,l,p,f,y,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.databaseLoaded){e.next=2;break}throw"Attempting to initialize already initialized local database.";case 2:return r=t.map((function(e){return ra({object:e})})),n=hc(r,this.localLoadPriorty),a=n.filter((function(e){return e.content_type===i.ItemsKey})),Object(o.x)(n,a),e.next=8,this.protocolService.payloadsByDecryptingPayloads({payloads:a});case 8:return s=e.sent,e.next=11,this.modelManager.mapPayloadsToLocalItems({payloads:s,source:en.LocalRetrieved});case 11:u=n.length,c=100,l=Math.ceil(u/c),p=0;case 15:if(!(p<l)){e.next=28;break}return f=p*c,y=n.slice(f,f+c),e.next=20,this.protocolService.payloadsByDecryptingPayloads({payloads:y});case 20:return v=e.sent,e.next=23,this.modelManager.mapPayloadsToLocalItems({payloads:v,source:en.LocalRetrieved});case 23:this.notifyEvent(h.LocalDataIncrementalLoad),this.opStatus.setDatabaseLoadStatus({current:f,total:u});case 25:p++,e.next=15;break;case 28:this.opStatus.setDatabaseLoadStatus({done:!0}),this.databaseLoaded=!0;case 30:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"setLastSyncToken",value:(C=Bc(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.syncToken=t,e.abrupt("return",this.storageService.setValue(E.LastSyncToken,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"setPaginationToken",value:(D=Bc(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cursorToken=t,!t){e.next=5;break}return e.abrupt("return",this.storageService.setValue(E.PaginationToken,t));case 5:return e.abrupt("return",this.storageService.removeValue(E.PaginationToken));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"getLastSyncToken",value:(I=Bc(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.syncToken){e.next=4;break}return e.next=3,this.storageService.getValue(E.LastSyncToken);case 3:this.syncToken=e.sent;case 4:return e.abrupt("return",this.syncToken);case 5:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"getPaginationToken",value:(j=Bc(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cursorToken){e.next=4;break}return e.next=3,this.storageService.getValue(E.PaginationToken);case 3:this.cursorToken=e.sent;case 4:return e.abrupt("return",this.cursorToken);case 5:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"clearSyncPositionTokens",value:(_=Bc(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.syncToken=null,this.cursorToken=null,e.next=4,this.storageService.removeValue(E.LastSyncToken);case 4:return e.next=6,this.storageService.removeValue(E.PaginationToken);case 6:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"itemsNeedingSync",value:(O=Bc(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.modelManager.getDirtyItems(),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e,this)}))),function(){return O.apply(this,arguments)})},{key:"alternateUuidForItem",value:(P=Bc(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isItem){e.next=2;break}throw"Attempting to alternate uuid of non-item object";case 2:return r=ra({object:t}),e.next=5,Qr({payload:r,baseCollection:this.modelManager.getMasterCollection()});case 5:return n=e.sent,e.next=8,this.modelManager.mapPayloadsToLocalItems({payloads:n,source:en.LocalSaved});case 8:return o=e.sent,e.next=11,this.persistPayloads({decryptedPayloads:n});case 11:return e.abrupt("return",o[0]);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"markAllItemsAsNeedingSync",value:(R=Bc(regeneratorRuntime.mark((function e(){var t,r,n,o,a,i,s,u,c,l,p,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.length>0&&void 0!==f[0]?f[0]:{},r=t.alternateUuids,this.log("Marking all items as needing sync"),!r){e.next=30;break}n=this.modelManager.allNondummyItems.filter((function(e){return!e.errorDecrypting})).slice(),o=!0,a=!1,i=void 0,e.prev=7,s=n[Symbol.iterator]();case 9:if(o=(u=s.next()).done){e.next=16;break}return c=u.value,e.next=13,this.alternateUuidForItem(c);case 13:o=!0,e.next=9;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),a=!0,i=e.t0;case 22:e.prev=22,e.prev=23,o||null==s.return||s.return();case 25:if(e.prev=25,!a){e.next=28;break}throw i;case 28:return e.finish(25);case 29:return e.finish(22);case 30:return l=this.modelManager.allNondummyItems,p=l.map((function(e){return ra({object:e,override:{dirty:!0}})})),e.next=34,this.modelManager.mapPayloadsToLocalItems({payloads:p});case 34:return e.next=36,this.persistPayloads({decryptedPayloads:p});case 36:case"end":return e.stop()}}),e,this,[[7,18,22,30],[23,,25,29]])}))),function(){return R.apply(this,arguments)})},{key:"repersistAllItems",value:(S=Bc(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.modelManager.allItems,r=t.map((function(e){return ra({object:e})})),e.abrupt("return",this.persistPayloads({decryptedPayloads:r}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"popPayloadsNeedingPreSyncSave",value:(x=Bc(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.state.lastPreSyncSaveDate){e.next=3;break}return e.abrupt("return",t);case 3:return n=t.filter((function(e){return!e.dirtiedDate||e.dirtiedDate>r})),this.state.setLastPresaveSyncDate(new Date),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"timingStrategyResolveOnNext",value:function(){var e=this;return new Promise((function(t,r){e.resolveQueue.push({resolve:t,reject:r})}))}},{key:"timingStrategyForceSpawnNew",value:function(e){var t=this;return new Promise((function(r,n){t.spawnQueue.push({resolve:r,reject:n,options:e})}))}},{key:"popSpawnQueue",value:function(){if(0===this.spawnQueue.length)return null;var e=this.spawnQueue[0];return Object(o.v)(this.spawnQueue,0),this.log("Syncing again from spawn queue"),this.sync(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Lc(Object(r),!0).forEach((function(t){Nc(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lc(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({timingStrategy:Jc,source:Qc.SpawnQueue},e.options)).then((function(){e.resolve()})).catch((function(){e.reject()}))}},{key:"payloadsByPreparingForServer",value:function(e){var t=this;return this.protocolService.payloadsByEncryptingPayloads({payloads:e,intent:function(e){return t.nonEncryptedTypes.includes(e.content_type)?q.SyncDecrypted:q.Sync}})}},{key:"sync",value:(k=Bc(regeneratorRuntime.mark((function e(){var t,r,n,a,i,s,u,c,l,p,f,y,v,d,m,g,b,w,k,x,S,R,P,O,_,j,I,D=this,C=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=C.length>0&&void 0!==C[0]?C[0]:{},r=t.timingStrategy,n=t.mode,a=t.checkIntegrity,i=t.source,!this.locked){e.next=4;break}return this.log("Sync Locked"),e.abrupt("return");case 4:return s=function(){return D.syncLock},u=function(){D.syncLock=!0},c=function(){D.syncLock=!1},l=this.opStatus.syncInProgress,p=this.databaseLoaded,(f=!s())&&p&&!l&&u(),i||(i=Qc.External),e.next=14,this.itemsNeedingSync();case 14:return y=e.sent,v=y.filter((function(e){return e.neverSynced&&e.deleted})),Object(o.x)(y,v),d=y.map((function(e){return e.payloadRepresentation()})),e.next=20,this.popPayloadsNeedingPreSyncSave(d);case 20:return m=e.sent,e.next=23,this.persistPayloads({decryptedPayloads:m});case 23:if(g=this.resolveQueue.slice(),b=Object(o.l)(r)?Yc:r,!l&&p&&f){e.next=36;break}if(this.log(f?l?"Attempting to sync while existing sync in progress.":"Attempting to sync before local database has loaded.":"Another function call has begun preparing for sync."),b!==Yc){e.next=31;break}return e.abrupt("return",this.timingStrategyResolveOnNext());case 31:if(b!==Jc){e.next=35;break}return e.abrupt("return",this.timingStrategyForceSpawnNew({mode:n,checkIntegrity:a,source:i}));case 35:throw"Unhandled timing strategy ".concat(b);case 36:return this.opStatus.setDidBegin(),w=new Date,e.next=40,this.modelManager.setItemsProperties({items:y,properties:Nc({},ce.LastSyncBegan,w)});case 40:return k=Object(o.l)(n)?Gc.Default:n,e.next=43,this.sessionManager.online();case 43:if(x=e.sent,k!==Gc.Default){e.next=56;break}if(this.completedInitialSync){e.next=47;break}throw"Attempting to default mode sync without having completed initial.";case 47:if(!x){e.next=53;break}return e.next=50,this.payloadsByPreparingForServer(d);case 50:S=e.sent,e.next=54;break;case 53:S=d;case 54:e.next=57;break;case 56:k===Gc.DownloadFirst&&(S=[]);case 57:if(!x){e.next=63;break}return e.next=60,this.syncOnlineOperation({payloads:S,checkIntegrity:a,source:i,mode:k});case 60:R=e.sent,e.next=66;break;case 63:return e.next=65,this.syncOfflineOperation({payloads:S});case 65:R=e.sent;case 66:return e.next=68,R.run();case 68:for(this.opStatus.setDidEnd(),c(),P=!0,O=!1,_=void 0,e.prev=73,j=g[Symbol.iterator]();!(P=(I=j.next()).done);P=!0)I.value.resolve();e.next=81;break;case 77:e.prev=77,e.t0=e.catch(73),O=!0,_=e.t0;case 81:e.prev=81,e.prev=82,P||null==j.return||j.return();case 84:if(e.prev=84,!O){e.next=87;break}throw _;case 87:return e.finish(84);case 88:return e.finish(81);case 89:if(Object(o.x)(this.resolveQueue,g),!this.opStatus.hasError()){e.next=92;break}return e.abrupt("return");case 92:return this.opStatus.reset(),this.state.setLastSyncDate(new Date),R.numberOfItemsInvolved>=this.majorChangeThreshold&&this.notifyEvent(h.MajorDataChange),e.next=97,this.handleNeverSyncedDeleted(v);case 97:if(k===Gc.DownloadFirst){e.next=100;break}return e.next=100,this.notifyEvent(h.FullSyncCompleted,{source:i});case 100:if(k!==Gc.DownloadFirst){e.next=107;break}return this.completedInitialSync=!0,e.next=104,this.notifyEvent(h.DownloadFirstSyncCompleted);case 104:return e.abrupt("return",this.sync({source:Qc.AfterDownloadFirst,checkIntegrity:!0}));case 107:if(this.popSpawnQueue()||!(this.resolveQueue.length>0)){e.next=112;break}this.log("Syncing again from resolve queue"),this.sync({source:Qc.ResolveQueue}),e.next=125;break;case 112:return e.next=114,this.itemsNeedingSync();case 114:if(e.t1=e.sent.length,!(e.t1>0)){e.next=119;break}return e.abrupt("return",this.sync({source:Qc.MoreDirtyItems}));case 119:if(!R.checkIntegrity){e.next=123;break}this.state.needsSync&&R.done&&(this.log("Syncing again from integrity check"),this.sync({checkIntegrity:!0,timingStrategy:Jc,source:Qc.IntegrityCheck})),e.next=125;break;case 123:return e.next=125,this.state.clearIntegrityHashes();case 125:case"end":return e.stop()}}),e,this,[[73,77,81,89],[82,,84,88]])}))),function(){return k.apply(this,arguments)})},{key:"syncOnlineOperation",value:(w=Bc(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payloads,n=t.checkIntegrity,o=t.source,a=t.mode,this.log("Syncing online user","source:",o,"mode:",a,"payloads:",r),e.t0=Ec,e.t1=this.apiService,e.t2=r,e.t3=n,e.next=8,this.getLastSyncToken();case 8:return e.t4=e.sent,e.next=11,this.getPaginationToken();case 11:return e.t5=e.sent,e.t6=function(){var e=Bc(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==r){e.next=11;break}if(!(n=t).hasError){e.next=7;break}return e.next=5,s.handleErrorServerResponse({operation:i,response:n});case 5:e.next=9;break;case 7:return e.next=9,s.handleSuccessServerResponse({operation:i,response:n});case 9:e.next=14;break;case 11:if(2!==r){e.next=14;break}return e.next=14,s.handleStatusChange({operation:i});case 14:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),e.t7={apiService:e.t1,payloads:e.t2,checkIntegrity:e.t3,lastSyncToken:e.t4,paginationToken:e.t5,receiver:e.t6},i=new e.t0(e.t7),e.abrupt("return",i);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"syncOfflineOperation",value:(b=Bc(regeneratorRuntime.mark((function e(t){var r,n,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payloads,this.log("Syncing offline user",r),n=new Kc({payloads:r,receiver:function(){var e=Bc(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==r){e.next=5;break}return e.next=3,o.handleOfflineResponse(t);case 3:e.next=8;break;case 5:if(2!==r){e.next=8;break}return e.next=8,o.handleStatusChange({operation:n});case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}),e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"handleStatusChange",value:(g=Bc(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.operation,n=r.pendingUploadCount(),o=r.totalUploadCount(),a=o-n,this.opStatus.setUploadStatus({completed:a,total:o});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"handleOfflineResponse",value:(m=Bc(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payloads,n=this.modelManager.getMasterCollection(),o=r.map((function(e){return n.findPayload(e.uuid).mergedWith(e)})),e.next=5,this.persistPayloads({decryptedPayloads:o});case 5:return e.next=7,this.modelManager.mapPayloadsToLocalItems({payloads:r,source:en.LocalSaved});case 7:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"handleErrorServerResponse",value:(d=Bc(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.operation,r=t.response,this.log("Sync Error",r),401===r.status&&this.notifyEvent(h.InvalidSession),this.opStatus.setError(r.error),this.notifyEvent(h.SyncError,r.error);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"handleSuccessServerResponse",value:(v=Bc(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,u,c,l,p,f,y,v,d,m,g,b,w,k,x,S,R,P;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.operation,n=t.response,!this._simulate_latency){e.next=4;break}return e.next=4,Object(o.w)(this._simulate_latency.latency);case 4:this.log("Online Sync Response",n.rawResponse),this.setLastSyncToken(n.lastSyncToken),this.setPaginationToken(n.paginationToken),this.opStatus.clearError(),this.opStatus.setDownloadStatus({downloaded:n.allProcessedPayloads.length}),a=[],i=!0,s=!1,u=void 0,e.prev=13,c=n.allProcessedPayloads[Symbol.iterator]();case 15:if(i=(l=c.next()).done){e.next=26;break}if(!(p=l.value).deleted&&p.fields().includes(ce.Content)){e.next=19;break}return e.abrupt("continue",23);case 19:return e.next=21,this.protocolService.payloadByDecryptingPayload({payload:p});case 21:f=e.sent,a.push(f);case 23:i=!0,e.next=15;break;case 26:e.next=32;break;case 28:e.prev=28,e.t0=e.catch(13),s=!0,u=e.t0;case 32:e.prev=32,e.prev=33,i||null==c.return||c.return();case 35:if(e.prev=35,!s){e.next=38;break}throw u;case 38:return e.finish(35);case 39:return e.finish(32);case 40:return y=this.modelManager.getMasterCollection(),v=new _c({response:n,decryptedResponsePayloads:a,payloadsSavedOrSaving:r.payloadsSavedOrSaving,baseCollection:y}),e.next=44,v.collectionsByProcessingResponse();case 44:d=e.sent,m=!0,g=!1,b=void 0,e.prev=48,w=d[Symbol.iterator]();case 50:if(m=(k=w.next()).done){e.next=62;break}return x=k.value,e.next=54,this.modelManager.mapCollectionToLocalItems({collection:x});case 54:return S=void 0,R=ca(x.source),S=R.fields().includes(ce.Content)?x.allPayloads:x.allPayloads.map((function(e){return y.findPayload(e.uuid).mergedWith(e)})),e.next=59,this.persistPayloads({decryptedPayloads:S});case 59:m=!0,e.next=50;break;case 62:e.next=68;break;case 64:e.prev=64,e.t1=e.catch(48),g=!0,b=e.t1;case 68:e.prev=68,e.prev=69,m||null==w.return||w.return();case 71:if(e.prev=71,!g){e.next=74;break}throw b;case 74:return e.finish(71);case 75:return e.finish(68);case 76:return e.next=78,this.notifyEvent(h.SingleSyncCompleted,n);case 78:if(!n.checkIntegrity){e.next=84;break}return e.next=81,this.computeDataIntegrityHash();case 81:return P=e.sent,e.next=84,this.state.setIntegrityHashes({clientHash:P,serverHash:n.integrityHash});case 84:case"end":return e.stop()}}),e,this,[[13,28,32,40],[33,,35,39],[48,64,68,76],[69,,71,75]])}))),function(e){return v.apply(this,arguments)})},{key:"handleNeverSyncedDeleted",value:(y=Bc(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.map((function(e){return e.payloadRepresentation({override:{dirty:!1}})})),e.next=3,this.modelManager.mapPayloadsToLocalItems({payloads:r});case 3:return e.next=5,this.persistPayloads({decryptedPayloads:r});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"persistPayloads",value:(f=Bc(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.decryptedPayloads,0!==(n=void 0===r?[]:r).length){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.storageService.savePayloads(n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"computeDataIntegrityHash",value:(p=Bc(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.modelManager.nonDeletedItems.sort((function(e,t){return t.updated_at-e.updated_at})),r=t.map((function(e){return e.updatedAtTimestamp()})),n=r.join(","),e.abrupt("return",this.protocolService.crypto.sha256(n));case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error computing data integrity hash",e.t0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return p.apply(this,arguments)})},{key:"deinit",value:(l=Bc(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Wc(zc(t.prototype),"deinit",this).call(this),this.state.reset(),this.opStatus.reset(),this.resolveQueue=[],this.spawnQueue=[],e.next=7,this.clearSyncPositionTokens();case 7:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"resolveOutOfSync",value:(u=Bc(regeneratorRuntime.mark((function e(){var t,r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new xc({apiService:this.apiService,protocolService:this.protocolService,customEvent:"resolve-out-of-sync"}),e.next=3,t.run();case 3:return r=e.sent,n=new Io({baseCollection:this.modelManager.getMasterCollection(),applyCollection:new c({payloads:r,source:en.RemoteRetrieved})}),e.next=7,n.resultingCollection();case 7:return o=e.sent,e.next=10,this.modelManager.mapCollectionToLocalItems({collection:o});case 10:return e.next=12,this.persistPayloads({decryptedPayloads:o.payloads});case 12:return e.abrupt("return",this.sync({checkIntegrity:!0,source:Qc.ResolveOutOfSync}));case 13:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"statelessDownloadAllItems",value:(s=Bc(regeneratorRuntime.mark((function e(){var t,r,n,o,a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},r=t.contentType,n=t.customEvent,o=new xc({apiService:this.apiService,protocolService:this.protocolService,contentType:r,customEvent:n}),e.next=4,o.run();case 4:return a=e.sent,e.abrupt("return",a.map((function(e){return zr(e)})));case 6:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"ut_setDatabaseLoaded",value:function(e){this.databaseLoaded=e}},{key:"ut_beginLatencySimulator",value:function(e){this._simulate_latency={latency:e||1e3,enabled:!0}}},{key:"ut_endLatencySimulator",value:function(){this._simulate_latency=null}}])&&Vc(r.prototype,n),a&&Vc(r,a),t}(ya);function Xc(e){return(Xc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zc(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function el(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Zc(a,n,o,i,s,"next",e)}function s(e){Zc(a,n,o,i,s,"throw",e)}i(void 0)}))}}function tl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function rl(e,t){return!t||"object"!==Xc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function nl(e){return(nl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ol(e,t){return(ol=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var al=function(e){function t(e){var r,n=e.storageService,o=e.keyManager,a=e.protocolService;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=rl(this,nl(t).call(this))).storageService=n,r.keyManager=o,r.protocolService=a,r}var r,n,o,a,i,s,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ol(e,t)}(t,e),r=t,(n=[{key:"isPasscodeLocked",value:function(){return this.keyManager.rootKeyNeedsUnwrapping()}},{key:"getLaunchChallenges",value:(u=el(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.keyManager.hasPasscode();case 3:return e.sent&&t.push(C.LocalPasscode),e.next=7,this.storageService.getValue(E.BiometricPrefs,Ss.Nonwrapped);case 7:return(r=e.sent)&&r.enabled&&t.push(C.Biometric),e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"enableBiometrics",value:(s=el(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.setValue(E.BiometricPrefs,{enabled:!0},Ss.Nonwrapped);case 2:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"validateChallengeResponse",value:(i=el(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.challenge!==C.LocalPasscode){e.next=4;break}return e.abrupt("return",this.keyManager.validatePasscode(t.value));case 4:if(t.challenge!==C.AccountPassword){e.next=8;break}return e.abrupt("return",this.keyManager.validateAccountPassword(t.value));case 8:if(t.challenge!==C.Biometric){e.next=10;break}return e.abrupt("return",!0===t.value);case 10:throw"Cannot validate challenge type ".concat(t.challenge);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"handleChallengeResponse",value:(a=el(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.challenge!==C.LocalPasscode){e.next=8;break}return e.next=3,this.keyManager.computeWrappingKey({passcode:t.value});case 3:return r=e.sent,e.next=6,this.keyManager.unwrapRootKey({wrappingKey:r});case 6:e.next=8;break;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})}])&&tl(r.prototype,n),o&&tl(r,o),t}(ya);function il(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function sl(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){il(a,n,o,i,s,"next",e)}function s(e){il(a,n,o,i,s,"throw",e)}i(void 0)}))}}function ul(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ll=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.environment,n=t.platform,o=t.namespace,a=t.host,i=t.deviceInterface,s=t.swapClasses,u=t.skipClasses,c=t.crypto;if(ul(this,e),!i)throw"Device Interface must be supplied.";if(!r)throw"Environment must be supplied when creating an application.";if(!n)throw"Platform must be supplied when creating an application.";this.environment=r,this.platform=n,this.namespace=o||"",this.host=a,this.deviceInterface=i,this.crypto=c,this.swapClasses=s,this.skipClasses=u,this.eventHandlers=[],this.services=[],this.streamObservers=[],this.serviceObservers=[],this.managedSubscribers=[],this.constructServices()}var t,r,n,a,s,u,c,l,p,f,y,S,R,P,O,_,j,I,D,C,E,A,T,M,K,F,L,N,U,B,V,H,W,z,q,Y,J,G,Q,$,X,Z,ee,te,re,ne,oe,ae,ie;return t=e,(r=[{key:"prepareForLaunch",value:(ie=sl(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.callbacks).requiresChallengeResponses){e.next=3;break}throw"Application.launch callbacks are not properly configured.";case 3:return this.launchCallbacks=r,e.next=6,this.deviceInterface.openDatabase();case 6:return e.next=8,this.migrationService.initialize();case 8:return e.next=10,this.handleStage(m);case 10:return e.next=12,this.storageService.initializeFromDisk();case 12:return e.next=14,this.keyManager.initialize();case 14:return e.next=16,this.handleStage(g);case 16:return this.started=!0,e.next=19,this.notifyEvent(d.Started);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return ie.apply(this,arguments)})},{key:"launch",value:(ae=sl(regeneratorRuntime.mark((function e(){var t,r,n,o,a=this,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},r=t.awaitDatabaseLoad,e.next=3,this.handleLaunchAuthentication();case 3:return e.next=5,this.storageService.isStorageWrapped();case 5:if(!e.sent){e.next=8;break}return e.next=8,this.storageService.decryptStorage();case 8:return e.next=10,this.handleStage(b);case 10:return e.next=12,this.sessionManager.initializeFromDisk();case 12:return this.historyManager.initializeFromDisk(),this.unlocked=!0,e.next=16,this.notifyEvent(d.Launched);case 16:return e.next=18,this.handleStage(w);case 18:return e.next=20,this.syncService.getDatabasePayloads();case 20:return n=e.sent,e.next=23,this.handleStage(k);case 23:if(o=this.syncService.loadDatabasePayloads(n).then(sl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.dealloced){e.next=2;break}throw"Application has been destroyed.";case 2:return e.next=4,a.handleStage(x);case 4:return a.beginAutoSyncTimer(),e.abrupt("return",a.syncService.sync({mode:Gc.DownloadFirst}));case 6:case"end":return e.stop()}}),e)})))),!r){e.next=27;break}return e.next=27,o;case 27:case"end":return e.stop()}}),e,this)}))),function(){return ae.apply(this,arguments)})},{key:"beginAutoSyncTimer",value:function(){var e=this;this.autoSyncInterval=this.deviceInterface.interval((function(){e.syncService.log("Syncing from autosync"),e.sync()}),3e4)}},{key:"handleLaunchAuthentication",value:(oe=sl(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deviceAuthService.getLaunchChallenges();case 2:return t=e.sent,e.next=5,this.handleLaunchChallenge(t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return oe.apply(this,arguments)})},{key:"handleLaunchChallenge",value:(ne=sl(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,u,c,l,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.slice();case 1:if(!(r.length>0)){e.next=43;break}return e.next=4,this.launchCallbacks.requiresChallengeResponses(r);case 4:n=e.sent,a=Array.isArray(n)?n:[n],i=!0,s=!1,u=void 0,e.prev=9,c=a[Symbol.iterator]();case 11:if(i=(l=c.next()).done){e.next=27;break}return p=l.value,e.next=15,this.deviceAuthService.validateChallengeResponse(p);case 15:if(!e.sent){e.next=22;break}return e.next=19,this.deviceAuthService.handleChallengeResponse(p);case 19:Object(o.u)(r,p.challenge),e.next=24;break;case 22:return e.next=24,this.launchCallbacks.handleChallengeFailures([p]);case 24:i=!0,e.next=11;break;case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(9),s=!0,u=e.t0;case 33:e.prev=33,e.prev=34,i||null==c.return||c.return();case 36:if(e.prev=36,!s){e.next=39;break}throw u;case 39:return e.finish(36);case 40:return e.finish(33);case 41:e.next=1;break;case 43:case"end":return e.stop()}}),e,this,[[9,29,33,41],[34,,36,40]])}))),function(e){return ne.apply(this,arguments)})},{key:"getMigrationChallengeResponder",value:function(){var e=this;return(function(){var t=sl(regeneratorRuntime.mark((function t(r){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.launchCallbacks.requiresChallengeResponses([r]);case 2:return n=t.sent,t.abrupt("return",n[0]);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"handleStage",value:(re=sl(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!0,n=!1,o=void 0,e.prev=3,a=this.services[Symbol.iterator]();case 5:if(r=(i=a.next()).done){e.next=12;break}return s=i.value,e.next=9,s.handleApplicationStage(t);case 9:r=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,o=e.t0;case 18:e.prev=18,e.prev=19,r||null==a.return||a.return();case 21:if(e.prev=21,!n){e.next=24;break}throw o;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))),function(e){return re.apply(this,arguments)})},{key:"addEventObserver",value:function(e,t){var r=this,n={callback:e,singleEvent:t};return this.eventHandlers.push(n),function(){Object(o.u)(r.eventHandlers,n)}}},{key:"addSingleEventObserver",value:function(e,t){return this.addEventObserver((function(r){r===e&&t()}),e)}},{key:"notifyEvent",value:(te=sl(regeneratorRuntime.mark((function e(t,r){var n,o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,o=!1,a=void 0,e.prev=3,i=this.eventHandlers.slice()[Symbol.iterator]();case 5:if(n=(s=i.next()).done){e.next=18;break}if(!(u=s.value).singleEvent||u.singleEvent!==t){e.next=12;break}return e.next=10,u.callback(t,r||{});case 10:e.next=15;break;case 12:if(u.singleEvent){e.next=15;break}return e.next=15,u.callback(t,r||{});case 15:n=!0,e.next=5;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(3),o=!0,a=e.t0;case 24:e.prev=24,e.prev=25,n||null==i.return||i.return();case 27:if(e.prev=27,!o){e.next=30;break}throw a;case 30:return e.finish(27);case 31:return e.finish(24);case 32:case"end":return e.stop()}}),e,this,[[3,20,24,32],[25,,27,31]])}))),function(e,t){return te.apply(this,arguments)})},{key:"isDatabaseLoaded",value:function(){return this.syncService.isDatabaseLoaded()}},{key:"savePayload",value:(ee=sl(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.payload,n=ia({payload:r,override:{dirty:!0}}),e.next=4,this.modelManager.mapPayloadToLocalItem({payload:n});case 4:return e.next=6,this.syncService.sync();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return ee.apply(this,arguments)})},{key:"findItem",value:function(e){var t=e.uuid;return this.modelManager.findItem(t)}},{key:"findItems",value:function(e){var t=e.predicate;return this.modelManager.itemsMatchingPredicate(t)}},{key:"mergeItem",value:(Z=sl(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.item,n=t.source,e.abrupt("return",this.modelManager.mapItem({item:r,source:n}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return Z.apply(this,arguments)})},{key:"createItem",value:(X=sl(regeneratorRuntime.mark((function e(t){var r,n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.contentType,n=t.content,o=t.add,a=t.needsSync,e.next=3,this.modelManager.createItem({contentType:r,content:n,add:o,needsSync:a});case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return X.apply(this,arguments)})},{key:"saveItem",value:($=sl(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.item,e.next=3,this.modelManager.setItemDirty(r,!0);case 3:return e.next=5,this.syncService.sync();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return $.apply(this,arguments)})},{key:"saveItems",value:(Q=sl(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.items,e.next=3,this.modelManager.setItemsDirty(r);case 3:return e.next=5,this.syncService.sync();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return Q.apply(this,arguments)})},{key:"setItemNeedsSync",value:(G=sl(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.item,n=t.updateUserModifiedDate,e.abrupt("return",this.modelManager.setItemDirty(r,!0,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"setItemsNeedsSync",value:(J=sl(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.items,e.abrupt("return",this.modelManager.setItemsDirty(r));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return J.apply(this,arguments)})},{key:"deleteItem",value:(Y=sl(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.item,this.modelManager.setItemToBeDeleted(r),this.sync();case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Y.apply(this,arguments)})},{key:"deleteItemLocally",value:(q=sl(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.item,this.modelManager.removeItemLocally(r);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"emptyTrash",value:(z=sl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modelManager.emptyTrash();case 2:return e.abrupt("return",this.sync());case 3:case"end":return e.stop()}}),e,this)}))),function(){return z.apply(this,arguments)})},{key:"getTrashedItems",value:function(){return this.modelManager.trashedItems()}},{key:"getItems",value:function(e){var t=e.contentType;return this.modelManager.getItems(t)}},{key:"getDisplayableItems",value:function(e){var t=e.contentType;return this.modelManager.validItemsForContentType(t)}},{key:"getNotesMatchingSmartTag",value:function(e){var t=e.smartTag;return this.modelManager.notesMatchingSmartTag(t)}},{key:"findTag",value:function(e){var t=e.title;return this.modelManager.findTagByTitle(t)}},{key:"findOrCreateTag",value:(W=sl(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.title,e.abrupt("return",this.modelManager.findOrCreateTagByTitle(r));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return W.apply(this,arguments)})},{key:"getSmartTags",value:function(){return this.modelManager.getSmartTags()}},{key:"getNoteCount",value:function(){return this.modelManager.noteCount()}},{key:"streamItems",value:function(e){var t=this,r=e.contentType,n=e.stream,a=this.modelManager.addMappingObserver(r,(function(e,t,r,o,a){var i=e.map((function(e){return e.content_type}));n({items:e,contentTypes:i,source:o,sourceKey:a})}));return this.streamObservers.push(a),function(){Object(o.u)(t.streamObservers,a)}}},{key:"setHost",value:(H=sl(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.apiService.setHost(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return H.apply(this,arguments)})},{key:"getHost",value:(V=sl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.apiService.getHost());case 1:case"end":return e.stop()}}),e,this)}))),function(){return V.apply(this,arguments)})},{key:"getUser",value:function(){if(!this.unlocked)throw"Attempting to access user before application unlocked";return this.sessionManager.getUser()}},{key:"getUserVersion",value:(B=sl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.protocolService.getUserVersion());case 1:case"end":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:"protocolUpgradeAvailable",value:(U=sl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.protocolService.upgradeAvailable());case 1:case"end":return e.stop()}}),e,this)}))),function(){return U.apply(this,arguments)})},{key:"noAccount",value:function(){var e=this.getUser();return Object(o.l)(e)}},{key:"importData",value:(N=sl(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.data,n=t.password,o=t.awaitSync,e.next=3,this.protocolService.payloadsByDecryptingBackupFile({data:r,password:n});case 3:return a=e.sent,i=a.filter((function(e){return!e.errorDecrypting})),e.next=7,this.modelManager.importPayloads(i);case 7:if(s=e.sent,u=this.sync(),!o){e.next=12;break}return e.next=12,u;case 12:return e.abrupt("return",{affectedItems:s,errorCount:a.length-i.length});case 13:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"createBackupFile",value:(L=sl(regeneratorRuntime.mark((function e(){var t,r,n,o,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},r=t.subItems,n=t.intent,o=t.returnIfEmpty,e.abrupt("return",this.protocolService.createBackupFile({subItems:r,intent:n,returnIfEmpty:o}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return L.apply(this,arguments)})},{key:"isEphemeralSession",value:function(){return this.storageService.isEphemeralSession()}},{key:"lockSyncing",value:function(){this.syncService.lockSyncing()}},{key:"unlockSyncing",value:function(){this.syncService.unlockSyncing()}},{key:"getSyncStatus",value:(F=sl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.syncService.status);case 1:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"sync",value:(K=sl(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.syncService.sync(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return K.apply(this,arguments)})},{key:"resolveOutOfSync",value:(M=sl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.syncService.resolveOutOfSync());case 1:case"end":return e.stop()}}),e,this)}))),function(){return M.apply(this,arguments)})},{key:"setValue",value:(T=sl(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageService.setValue(t,r,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return T.apply(this,arguments)})},{key:"getValue",value:(A=sl(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageService.getValue(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return A.apply(this,arguments)})},{key:"removeValue",value:(E=sl(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageService.removeValue(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return E.apply(this,arguments)})},{key:"clearDatabase",value:(C=sl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageService.clearAllPayloads());case 1:case"end":return e.stop()}}),e,this)}))),function(){return C.apply(this,arguments)})},{key:"rewriteItemsKeys",value:(D=sl(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.itemsKeyManager.allItemsKeys,r=t.map((function(e){return e.payloadRepresentation()})),e.next=4,this.storageService.deletePayloads(r);case 4:return e.next=6,this.syncService.persistPayloads({decryptedPayloads:r});case 6:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"restart",value:(I=sl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deinit();case 2:return this.dealloced=!1,this.constructServices(),e.next=6,this.prepareForLaunch({callbacks:this.launchCallbacks});case 6:return e.next=8,this.launch({awaitDatabaseLoad:!0});case 8:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"deinit",value:(j=sl(regeneratorRuntime.mark((function e(){var t,r,n,o,a,i,s,u,c,l,p,f,y,h,v,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(clearInterval(this.autoSyncInterval),t=!0,r=!1,n=void 0,e.prev=4,o=this.serviceObservers[Symbol.iterator]();!(t=(a=o.next()).done);t=!0)(0,a.value)();e.next=12;break;case 8:e.prev=8,e.t0=e.catch(4),r=!0,n=e.t0;case 12:e.prev=12,e.prev=13,t||null==o.return||o.return();case 15:if(e.prev=15,!r){e.next=18;break}throw n;case 18:return e.finish(15);case 19:return e.finish(12);case 20:for(i=!0,s=!1,u=void 0,e.prev=23,c=this.managedSubscribers[Symbol.iterator]();!(i=(l=c.next()).done);i=!0)(0,l.value)();e.next=31;break;case 27:e.prev=27,e.t1=e.catch(23),s=!0,u=e.t1;case 31:e.prev=31,e.prev=32,i||null==c.return||c.return();case 34:if(e.prev=34,!s){e.next=37;break}throw u;case 37:return e.finish(34);case 38:return e.finish(31);case 39:p=!0,f=!1,y=void 0,e.prev=42,h=this.services[Symbol.iterator]();case 44:if(p=(v=h.next()).done){e.next=52;break}if(!(d=v.value).deinit){e.next=49;break}return e.next=49,d.deinit();case 49:p=!0,e.next=44;break;case 52:e.next=58;break;case 54:e.prev=54,e.t2=e.catch(42),f=!0,y=e.t2;case 58:e.prev=58,e.prev=59,p||null==h.return||h.return();case 61:if(e.prev=61,!f){e.next=64;break}throw y;case 64:return e.finish(61);case 65:return e.finish(58);case 66:this.streamObservers=[],this.clearServices(),this.dealloced=!0,this.started=!1;case 70:case"end":return e.stop()}}),e,this,[[4,8,12,20],[13,,15,19],[23,27,31,39],[32,,34,38],[42,54,58,66],[59,,61,65]])}))),function(){return j.apply(this,arguments)})},{key:"registerService",value:function(e){this.services.push(e)}},{key:"register",value:(_=sl(regeneratorRuntime.mark((function e(t){var r,n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.email,n=t.password,o=t.ephemeral,a=t.mergeLocal,this.lockSyncing(),e.next=4,this.sessionManager.register({email:r,password:n});case 4:if((i=e.sent).response.error){e.next=27;break}return e.next=8,this.keyManager.setNewRootKey({key:i.rootKey,keyParams:i.keyParams});case 8:return this.syncService.resetSyncState(),e.next=11,this.storageService.setPersistencePolicy(o?ks.Ephemeral:ks.Default);case 11:if(!a){e.next=16;break}return e.next=14,this.syncService.markAllItemsAsNeedingSync({alternateUuids:!0});case 14:e.next=19;break;case 16:return this.modelManager.removeAllItemsFromMemory(),e.next=19,this.clearDatabase();case 19:return e.next=21,this.notifyEvent(d.SignedIn);case 21:return this.unlockSyncing(),e.next=24,this.syncService.sync({mode:Gc.DownloadFirst,timingStrategy:Jc});case 24:this.protocolService.decryptErroredItems(),e.next=28;break;case 27:this.unlockSyncing();case 28:return e.abrupt("return",i.response);case 29:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"signIn",value:(O=sl(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.email,n=t.password,o=t.strict,a=t.ephemeral,i=t.mfaKeyPath,s=t.mfaCode,u=t.mergeLocal,c=void 0===u||u,this.lockSyncing(),e.next=4,this.sessionManager.signIn({email:r,password:n,strict:o,mfaKeyPath:i,mfaCode:s});case 4:if((l=e.sent).response.error){e.next=27;break}return e.next=8,this.keyManager.setNewRootKey({key:l.rootKey,keyParams:l.keyParams});case 8:return this.syncService.resetSyncState(),e.next=11,this.storageService.setPersistencePolicy(a?ks.Ephemeral:ks.Default);case 11:if(!c){e.next=16;break}return e.next=14,this.syncService.markAllItemsAsNeedingSync({alternateUuids:!0});case 14:e.next=19;break;case 16:return this.modelManager.removeAllItemsFromMemory(),e.next=19,this.clearDatabase();case 19:return e.next=21,this.notifyEvent(d.SignedIn);case 21:return this.unlockSyncing(),e.next=24,this.syncService.sync({mode:Gc.DownloadFirst,checkIntegrity:!0,timingStrategy:Jc});case 24:this.protocolService.decryptErroredItems(),e.next=28;break;case 27:this.unlockSyncing();case 28:return e.abrupt("return",l.response);case 29:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"changePassword",value:(P=sl(regeneratorRuntime.mark((function e(t){var r,n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.email,n=t.currentPassword,o=t.newPassword,e.next=3,this.keyManager.getRootKeyParams();case 3:return a=e.sent,this.lockSyncing(),e.next=7,this.sessionManager.changePassword({email:r,currentPassword:n,currentKeyParams:a,newPassword:o});case 7:if((i=e.sent).response.error){e.next=18;break}return e.next=11,this.keyManager.setNewRootKey({key:i.rootKey,keyParams:i.keyParams});case 11:return e.next=13,this.itemsKeyManager.createNewDefaultItemsKey();case 13:return this.unlockSyncing(),e.next=16,this.syncService.sync();case 16:e.next=19;break;case 18:this.unlockSyncing();case 19:return e.abrupt("return",i.response);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"signOut",value:(R=sl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionManager.signOut();case 2:return e.next=4,this.keyManager.clearLocalKeyState();case 4:return e.next=6,this.storageService.clearAllData();case 6:return e.next=8,this.notifyEvent(d.SignedOut);case 8:return e.next=10,this.restart();case 10:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)})},{key:"validateAccountPassword",value:(S=sl(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.password,e.abrupt("return",this.keyManager.validateAccountPassword(r));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"isStarted",value:function(){return this.started}},{key:"hasPasscode",value:function(){return this.keyManager.hasPasscode()}},{key:"isLocked",value:(y=sl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.started){e.next=2;break}return e.abrupt("return",!0);case 2:return e.abrupt("return",this.deviceAuthService.isPasscodeLocked());case 3:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"lock",value:(f=sl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restart());case 1:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"setPasscode",value:(p=sl(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.protocolService.crypto.generateUUID();case 2:return r=e.sent,e.next=5,this.protocolService.createRootKey({identifier:r,password:t});case 5:return n=e.sent,o=n.key,a=n.keyParams,e.next=10,this.keyManager.setNewRootKeyWrapper({wrappingKey:o,keyParams:a});case 10:return e.next=12,this.rewriteItemsKeys();case 12:return e.next=14,this.syncService.sync();case 14:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"removePasscode",value:(l=sl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keyManager.removeRootKeyWrapper();case 2:return e.next=4,this.rewriteItemsKeys();case 4:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"changePasscode",value:(c=sl(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.removePasscode();case 2:return e.abrupt("return",this.setPasscode(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"setStorageEncryptionPolicy",value:(u=sl(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.setEncryptionPolicy(t);case 2:return e.abrupt("return",this.syncService.repersistAllItems());case 3:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"generateUuid",value:(s=sl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.protocolService.crypto.generateUUID());case 1:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"changeDeviceInterface",value:(a=sl(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.deviceInterface=t,r=!0,n=!1,o=void 0,e.prev=4,a=this.services[Symbol.iterator]();!(r=(i=a.next()).done);r=!0)(s=i.value).deviceInterface&&(s.deviceInterface=t);e.next=12;break;case 8:e.prev=8,e.t0=e.catch(4),n=!0,o=e.t0;case 12:e.prev=12,e.prev=13,r||null==a.return||a.return();case 15:if(e.prev=15,!n){e.next=18;break}throw o;case 18:return e.finish(15);case 19:return e.finish(12);case 20:case"end":return e.stop()}}),e,this,[[4,8,12,20],[13,,15,19]])}))),function(e){return a.apply(this,arguments)})},{key:"constructServices",value:function(){this.createModelManager(),this.createProtocolService(this.modelManager),this.createMigrationService(),this.createAlertManager(),this.createHttpManager(),this.createStorageManager(),this.createApiService(),this.createSessionManager(),this.createSyncManager(),this.createItemsKeyManager(),this.createKeyManager(),this.protocolService.setKeyManager(this.keyManager),this.protocolService.setItemsKeyManager(this.itemsKeyManager),this.itemsKeyManager.setKeyManager(this.keyManager),this.createDeviceAuthService(),this.createSingletonManager(),this.createComponentManager(),this.createPrivilegesManager(),this.createHistoryManager(),this.createActionsManager()}},{key:"clearServices",value:function(){this.migrationService=null,this.alertService=null,this.httpService=null,this.modelManager=null,this.protocolService=null,this.storageService=null,this.apiService=null,this.sessionManager=null,this.syncService=null,this.keyManager=null,this.itemsKeyManager=null,this.deviceAuthService=null,this.singletonManager=null,this.componentManager=null,this.privilegesService=null,this.actionsManager=null,this.services=[]}},{key:"createMigrationService",value:function(){this.migrationService=new(this.getClass(Zs))({application:this,challengeResponder:this.getMigrationChallengeResponder()}),this.services.push(this.migrationService)}},{key:"createAlertManager",value:function(){this.shouldSkipClass(ka)||(this.alertService=new(this.getClass(ka))({deviceInterface:this.deviceInterface}),this.services.push(this.alertService))}},{key:"createApiService",value:function(){this.apiService=new(this.getClass(Qa))({storageService:this.storageService,httpService:this.httpService,host:this.host}),this.services.push(this.apiService)}},{key:"createComponentManager",value:function(){this.shouldSkipClass(Ri)||(this.componentManager=new(this.getClass(Ri))({modelManager:this.modelManager,syncService:this.syncService,alertService:this.alertService,timeout:this.deviceInterface.timeout,environment:this.environment,platform:this.platform}),this.services.push(this.componentManager))}},{key:"createHttpManager",value:function(){this.httpService=new(this.getClass(Ai)),this.services.push(this.httpService)}},{key:"createKeyManager",value:function(){var e=this;this.keyManager=new(this.getClass(oc))({modelManager:this.modelManager,storageService:this.storageService,protocolService:this.protocolService,itemsKeyManager:this.itemsKeyManager,deviceInterface:this.deviceInterface}),this.keyManager.onStatusChange(sl(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.notifyEvent(d.KeyStatusChanged);case 2:case"end":return t.stop()}}),t)})))),this.services.push(this.keyManager)}},{key:"createItemsKeyManager",value:function(){this.itemsKeyManager=new(this.getClass(yc))({modelManager:this.modelManager,syncService:this.syncService,protocolService:this.protocolService}),this.services.push(this.itemsKeyManager)}},{key:"createModelManager",value:function(){this.modelManager=new(this.getClass(zi)),this.services.push(this.modelManager)}},{key:"createSingletonManager",value:function(){this.singletonManager=new(this.getClass(Zi))({modelManager:this.modelManager,syncService:this.syncService}),this.services.push(this.singletonManager)}},{key:"createStorageManager",value:function(){this.storageService=new(this.getClass(Ps))({protocolService:this.protocolService,namespace:this.namespace,deviceInterface:this.deviceInterface}),this.services.push(this.storageService)}},{key:"createProtocolService",value:function(e){this.protocolService=new(this.getClass(cu))({modelManager:e,crypto:this.crypto}),this.services.push(this.protocolService)}},{key:"createSessionManager",value:function(){this.sessionManager=new(this.getClass(Ea))({storageService:this.storageService,alertService:this.alertService,protocolService:this.protocolService,apiService:this.apiService,timeout:this.deviceInterface.timeout}),this.services.push(this.sessionManager)}},{key:"createSyncManager",value:function(){var e=this;this.syncService=new(this.getClass($c))({modelManager:this.modelManager,storageService:this.storageService,sessionManager:this.sessionManager,protocolService:this.protocolService,apiService:this.apiService,interval:this.deviceInterface.interval});var t=this.syncService.addEventObserver(function(){var t=sl(regeneratorRuntime.mark((function t(r){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=r,a=void 0,!(n=(a={},v(a,h.FullSyncCompleted,d.CompletedSync),v(a,h.SyncError,d.FailedSync),v(a,h.SyncTakingTooLong,d.HighLatencySync),v(a,h.EnterOutOfSync,d.EnteredOutOfSync),v(a,h.ExitOutOfSync,d.ExitedOutOfSync),a)[o])){t.next=4;break}return t.next=4,e.notifyEvent(n);case 4:case"end":return t.stop()}var o,a}),t)})));return function(e){return t.apply(this,arguments)}}());this.serviceObservers.push(t),this.services.push(this.syncService)}},{key:"createDeviceAuthService",value:function(){this.deviceAuthService=new(this.getClass(al))({storageService:this.storageService,protocolService:this.protocolService,keyManager:this.keyManager}),this.services.push(this.deviceAuthService)}},{key:"createPrivilegesManager",value:function(){this.privilegesService=new(this.getClass(qu))({storageService:this.storageService,keyManager:this.keyManager,modelManager:this.modelManager,syncService:this.syncService,sessionManager:this.sessionManager,singletonManager:this.singletonManager}),this.services.push(this.privilegesService)}},{key:"createHistoryManager",value:function(){this.historyManager=new(this.getClass(Eu))({storageService:this.storageService,modelManager:this.modelManager,contentTypes:[i.Note],timeout:this.deviceInterface.timeout}),this.services.push(this.historyManager)}},{key:"createActionsManager",value:function(){this.actionsManager=new(this.getClass(ss))({alertService:this.alertService,deviceInterface:this.deviceInterface,httpService:this.httpService,modelManager:this.modelManager,protocolService:this.protocolService,syncService:this.syncService}),this.services.push(this.actionsManager)}},{key:"shouldSkipClass",value:function(e){return this.skipClasses&&this.skipClasses.includes(e)}},{key:"getClass",value:function(e){var t=this.swapClasses&&this.swapClasses.find((function(t){return t.swap===e}));return t?t.with:e}}])&&cl(t.prototype,r),n&&cl(t,n),e}();function pl(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function fl(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){pl(a,n,o,i,s,"next",e)}function s(e){pl(a,n,o,i,s,"throw",e)}i(void 0)}))}}function yl(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function hl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var vl=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.namespace,n=t.timeout,a=t.interval;if(yl(this,e),!n||!a)throw"'timeout' and 'interval' are required to initialize device interface.";this.namespace=r,this.timeout=n||setTimeout.bind(Object(o.h)()),this.interval=a||setInterval.bind(Object(o.h)())}var t,r,n,a,i,s,u,c,l,p,f,y,h,v,d,m,g,b;return t=e,(r=[{key:"getRawStorageValue",value:(b=fl(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override DeviceInterface.getRawStorageValue";case 1:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)})},{key:"getJsonParsedStorageValue",value:(g=fl(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRawStorageValue(t);case 2:return r=e.sent,e.abrupt("return",r?JSON.parse(r):r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"getAllRawStorageKeyValues",value:(m=fl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override DeviceInterface.getAllRawStorageKeyValues";case 1:case"end":return e.stop()}}),e)}))),function(){return m.apply(this,arguments)})},{key:"setRawStorageValue",value:(d=fl(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override DeviceInterface.setRawStorageValue";case 1:case"end":return e.stop()}}),e)}))),function(e,t){return d.apply(this,arguments)})},{key:"removeRawStorageValue",value:(v=fl(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override DeviceInterface.removeRawStorageValue";case 1:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"removeAllRawStorageValues",value:(h=fl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override DeviceInterface.removeAllRawStorageValues";case 1:case"end":return e.stop()}}),e)}))),function(){return h.apply(this,arguments)})},{key:"openDatabase",value:(y=fl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override DeviceInterface.openDatabase";case 1:case"end":return e.stop()}}),e)}))),function(){return y.apply(this,arguments)})},{key:"getAllRawDatabasePayloads",value:(f=fl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override DeviceInterface.getAllRawDatabasePayloads";case 1:case"end":return e.stop()}}),e)}))),function(){return f.apply(this,arguments)})},{key:"saveRawDatabasePayload",value:(p=fl(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override DeviceInterface.saveRawDatabasePayload";case 1:case"end":return e.stop()}}),e)}))),function(e){return p.apply(this,arguments)})},{key:"saveRawDatabasePayloads",value:(l=fl(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override DeviceInterface.saveRawDatabasePayloads";case 1:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"removeRawDatabasePayloadWithId",value:(c=fl(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override DeviceInterface.removeRawDatabasePayloadWithId";case 1:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"removeAllRawDatabasePayloads",value:(u=fl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override DeviceInterface.removeAllRawDatabasePayloads";case 1:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)})},{key:"getKeychainValue",value:(s=fl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override DeviceInterface.getKeychainValue";case 1:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)})},{key:"setKeychainValue",value:(i=fl(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override DeviceInterface.setKeychainValue";case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"clearKeychainValue",value:(a=fl(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"Must override DeviceInterface.clearKeychainValue";case 1:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})}])&&hl(t.prototype,r),n&&hl(t,n),e}();var dl=function e(t){var r=t.challenge,n=t.value;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.challenge=r,this.value=n,Object.freeze(this)}}])}));
//# sourceMappingURL=snjs.min.js.map